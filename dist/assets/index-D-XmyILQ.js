var _l=Object.defineProperty;var kl=(t,s,a)=>s in t?_l(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a;var pr=(t,s,a)=>kl(t,typeof s!="symbol"?s+"":s,a);import{r as i,j as e,V as bn,h as jn,A as vn,i as Nn,X as Lr,T as wn,D as Sn,k as Tl,l as Ft,m as Cn,n as _n,I as kn,o as Al,H as Rl,p as Pr,q as Ea,t as Tn,v as Il,w as Ge,S as Hs,F as Fl,x as Dl,y as Ll,z as An,B as Pl,E as El,L as Rn,G as In,J as Fn,K as Ol,M as Ml,N as $l,Q as Hl,U as Dn,W as H,Y as Ul,Z as Ln,_ as aa,$ as Bl,a0 as Vl,a1 as Pn,a2 as Oa,a3 as ma,a4 as ea,a5 as En,a6 as On,a7 as ql,a8 as _r,a9 as ir,O as Mn,e as zl,C as $n,aa as Ql,ab as Hn,ac as Un,d as Yl,ad as Gl,ae as Kl,af as Bn,ag as Wl,ah as Vn,ai as Jl,aj as qn,ak as Xl,al as zn,am as Zl,an as Qn,ao as Yn,ap as eo,aq as Gn,ar as to,as as so,at as ao,au as Kn,av as Wn,aw as Jn,ax as ro,ay as Xn,az as Zn,aA as no,aB as io,aC as lo,aD as oo,aE as ei,aF as ti,aG as co,aH as Er,aI as si,aJ as uo,aK as mo,aL as ho,aM as po,aN as kr,aO as fo,aP as xo,aQ as go,aR as yo,aS as bo,aT as jo,aU as Or,aV as vo,aW as ai,aX as No,aY as wo,aZ as So,a_ as ri,a$ as Co,b0 as ni,b1 as sr,b2 as ii,b3 as _o,b4 as ko,b5 as li,b6 as oi,b7 as To,b8 as ci,b9 as di,ba as ui,bb as mi,bc as hi,bd as pi,be as fi,bf as Ao,bg as Ro,bh as Io,bi as Fo,bj as Do,bk as Lo,bl as xi,bm as gi,bn as Po,bo as Eo,bp as Oo,bq as Mo,br as $o,bs as Ho,bt as Uo,bu as Bo,bv as Vo,bw as qo,bx as zo,by as Qo,bz as Yo,bA as Go,bB as Ko}from"./react-Bl_O7c-4.js";import{Z as Wo,$ as Jo,a0 as ja,a1 as Ps,a2 as ar,a3 as ta,a4 as sa,a5 as Es,a6 as Os,a7 as Ia,a8 as Fa,a9 as Xo,aa as yi,ab as ys,ac as bi,ad as ji,ae as Zo,af as ec,ag as tc,ah as sc,ai as ac,aj as rc,ak as nc,al as ic,am as lc,an as oc,ao as cc,ap as dc,aq as uc}from"./vendor-vYexraHo.js";import{k as vi,g as Ni,b as wi,d as mc}from"./tanstack-QWRLyFEK.js";import"./radix-BA32w1ww.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&r(d)}).observe(document,{childList:!0,subtree:!0});function a(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(n){if(n.ep)return;n.ep=!0;const o=a(n);fetch(n.href,o)}})();const hc=1,pc=1e6;let fr=0;function fc(){return fr=(fr+1)%Number.MAX_SAFE_INTEGER,fr.toString()}const xr=new Map,Xr=t=>{if(xr.has(t))return;const s=setTimeout(()=>{xr.delete(t),Da({type:"REMOVE_TOAST",toastId:t})},pc);xr.set(t,s)},xc=(t,s)=>{switch(s.type){case"ADD_TOAST":return{...t,toasts:[s.toast,...t.toasts].slice(0,hc)};case"UPDATE_TOAST":return{...t,toasts:t.toasts.map(a=>a.id===s.toast.id?{...a,...s.toast}:a)};case"DISMISS_TOAST":{const{toastId:a}=s;return a?Xr(a):t.toasts.forEach(r=>{Xr(r.id)}),{...t,toasts:t.toasts.map(r=>r.id===a||a===void 0?{...r,open:!1}:r)}}case"REMOVE_TOAST":return s.toastId===void 0?{...t,toasts:[]}:{...t,toasts:t.toasts.filter(a=>a.id!==s.toastId)}}},Za=[];let er={toasts:[]};function Da(t){er=xc(er,t),Za.forEach(s=>{s(er)})}function gc({...t}){const s=fc(),a=n=>Da({type:"UPDATE_TOAST",toast:{...n,id:s}}),r=()=>Da({type:"DISMISS_TOAST",toastId:s});return Da({type:"ADD_TOAST",toast:{...t,id:s,open:!0,onOpenChange:n=>{n||r()}}}),{id:s,dismiss:r,update:a}}function Si(){const[t,s]=i.useState(er);return i.useEffect(()=>(Za.push(s),()=>{const a=Za.indexOf(s);a>-1&&Za.splice(a,1)}),[t]),{...t,toast:gc,dismiss:a=>Da({type:"DISMISS_TOAST",toastId:a})}}function J(...t){return Wo(Jo(t))}const yc=Tl,Ci=i.forwardRef(({className:t,...s},a)=>e.jsx(bn,{ref:a,className:J("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",t),...s}));Ci.displayName=bn.displayName;const bc=ja("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),_i=i.forwardRef(({className:t,variant:s,...a},r)=>e.jsx(jn,{ref:r,className:J(bc({variant:s}),t),...a}));_i.displayName=jn.displayName;const jc=i.forwardRef(({className:t,...s},a)=>e.jsx(vn,{ref:a,className:J("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",t),...s}));jc.displayName=vn.displayName;const ki=i.forwardRef(({className:t,...s},a)=>e.jsx(Nn,{ref:a,className:J("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-destructive-foreground/70 group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive group-[.destructive]:focus:ring-offset-destructive",t),"toast-close":"",...s,children:e.jsx(Lr,{className:"h-4 w-4"})}));ki.displayName=Nn.displayName;const Ti=i.forwardRef(({className:t,...s},a)=>e.jsx(wn,{ref:a,className:J("text-sm font-semibold",t),...s}));Ti.displayName=wn.displayName;const Ai=i.forwardRef(({className:t,...s},a)=>e.jsx(Sn,{ref:a,className:J("text-sm opacity-90",t),...s}));Ai.displayName=Sn.displayName;function vc(){const{toasts:t}=Si();return e.jsxs(yc,{children:[t.map(function({id:s,title:a,description:r,action:n,...o}){const d=a,c=r,u=n??null;return e.jsxs(_i,{...o,children:[e.jsxs("div",{className:"grid gap-1",children:[d&&e.jsx(Ti,{children:d}),c&&e.jsx(Ai,{children:c})]}),"// @ts-ignore ReactNode typing differs between hoisted React definitions; runtime rendering is safe",u,e.jsx(ki,{})]},s)}),e.jsx(Ci,{})]})}const Ri=i.createContext(void 0),Ma=()=>{const t=i.useContext(Ri);if(!t)throw new Error("useNotifier must be used within a NotificationProvider");return t},Nc=({children:t})=>{const{toast:s}=Si(),a=i.useCallback((r,n)=>{s({title:n.charAt(0).toUpperCase()+n.slice(1),description:r,variant:n==="error"?"destructive":"default"})},[s]);return e.jsxs(Ri.Provider,{value:{addNotification:a},children:[t,e.jsx(vc,{})]})},Ii=i.createContext(void 0),Mr=()=>{const t=i.useContext(Ii);if(!t)throw new Error("useResearchTrail must be used within a ResearchTrailProvider");return t},wc=({children:t})=>{const[s,a]=i.useState([]),o={trail:s,addTrailItem:d=>{let c;if(d.type==="search"?c={...d,timestamp:new Date}:c={...d,timestamp:new Date},s.length>0){const u=s[s.length-1];if(u.type===c.type&&"term"in u&&"term"in c&&u.term===c.term||u.type===c.type&&"hts"in u&&"hts"in c&&u.hts===c.hts)return}a(u=>[c,...u])},clearTrail:()=>{a([])}};return e.jsx(Ii.Provider,{value:o,children:t})};class Sc extends Error{constructor(a,r,n){super(a);pr(this,"status");pr(this,"body");this.name="ApiError",this.status=r,this.body=n}}const rs=async(t,s)=>{const a=await fetch(t,s);if(!a.ok){const n=await a.text();throw new Sc(`${a.status} ${n}`,a.status,n)}return{data:await a.json(),response:a}},Fi=async t=>{const{data:s}=await rs(`/api/get-hts-details?hts_code=${encodeURIComponent(t)}`);return s},Cc=async t=>{const s=`/.netlify/functions/hts-proxy?keyword=${encodeURIComponent(t)}`,{data:a}=await rs(s);if(!Array.isArray(a.results))throw new Error(a.error||"API 回傳資料格式異常");return a.results},_c=({term:t,enabled:s})=>Ft({queryKey:["hts-search",t],enabled:s,queryFn:()=>Cc(t)}),Di=i.createContext(void 0),ra=()=>{const t=i.useContext(Di);if(!t)throw new Error("useSearch must be used within a SearchProvider");return t},kc=({children:t})=>{const[s,a]=i.useState(()=>{if(typeof window<"u")try{const b=new URLSearchParams(window.location.search).get("tab");if(b&&["intelligence","advanced-trends","query","hts","sources","federal-register","federal-register2","dataweb","verifier","translation","charts"].includes(b))return b}catch{}return"intelligence"}),[r,n]=i.useState(""),[o,d]=i.useState(0),[c,u]=i.useState([]),[p,v]=i.useState(!1),[_,j]=i.useState(null),{addNotification:f}=Ma(),{addTrailItem:x}=Mr(),T=_c({term:_??"",enabled:!!_});i.useEffect(()=>{if(!(typeof window>"u"))try{const g=new URL(window.location.href);g.searchParams.set("tab",s),s!=="intelligence"&&(g.searchParams.delete("hts"),g.searchParams.delete("term")),window.history.replaceState({},"",g.toString())}catch{}},[s]);const w=(g,b="N/A")=>{x({type:"view_hts",hts:g,description:b}),n(g),d(R=>R+1),a("intelligence")},S=i.useCallback(async g=>{const b=g.trim();if(b.length<2){f("Please enter at least two characters","info");return}x({type:"search",term:b}),n(b),j(b)},[f,x]);i.useEffect(()=>{T.data&&(u(T.data),f(`查詢完成，共 ${T.data.length} 筆資料`,"success"))},[T.data,f]),i.useEffect(()=>{if(!T.error)return;const g=T.error instanceof Error?T.error.message:String(T.error);f(`查詢失敗: ${g}`,"error"),u([])},[T.error,f]),i.useEffect(()=>{v(!!_&&T.isFetching)},[_,T.isFetching]);const y={activeTab:s,setActiveTab:a,htsSearchTerm:r,searchHtsCode:w,performHtsSearch:S,htsResults:c,isHtsLoading:p,htsNavToken:o};return e.jsx(Di.Provider,{value:y,children:t})},Ne=i.forwardRef(({className:t,...s},a)=>e.jsx("div",{ref:a,className:J("rounded-lg border bg-card text-card-foreground shadow-sm",t),...s}));Ne.displayName="Card";const ot=i.forwardRef(({className:t,...s},a)=>e.jsx("div",{ref:a,className:J("flex flex-col space-y-1.5 p-6",t),...s}));ot.displayName="CardHeader";const pt=i.forwardRef(({className:t,...s},a)=>e.jsx("div",{ref:a,className:J("text-2xl font-semibold leading-none tracking-tight",t),...s}));pt.displayName="CardTitle";const $s=i.forwardRef(({className:t,...s},a)=>e.jsx("div",{ref:a,className:J("text-sm text-muted-foreground",t),...s}));$s.displayName="CardDescription";const Be=i.forwardRef(({className:t,...s},a)=>e.jsx("div",{ref:a,className:J("p-6 pt-0",t),...s}));Be.displayName="CardContent";const Tc=i.forwardRef(({className:t,...s},a)=>e.jsx("div",{ref:a,className:J("flex items-center p-6 pt-0",t),...s}));Tc.displayName="CardFooter";const He=i.forwardRef(({className:t,type:s,...a},r)=>e.jsx("input",{type:s,className:J("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:r,...a}));He.displayName="Input";const Ac=ja("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function ht({className:t,variant:s,...a}){return e.jsx("div",{className:J(Ac({variant:s}),t),...a})}const Li=ja("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground"},size:{default:"h-10 px-3 min-w-10",sm:"h-9 px-2.5 min-w-9",lg:"h-11 px-5 min-w-11"}},defaultVariants:{variant:"default",size:"default"}}),Rc=i.forwardRef(({className:t,variant:s,size:a,...r},n)=>e.jsx(Cn,{ref:n,className:J(Li({variant:s,size:a,className:t})),...r}));Rc.displayName=Cn.displayName;const Pi=i.createContext({size:"default",variant:"default"}),ba=i.forwardRef(({className:t,variant:s,size:a,children:r,...n},o)=>e.jsx(_n,{ref:o,className:J("flex items-center justify-center gap-1",t),...n,children:e.jsx(Pi.Provider,{value:{variant:s,size:a},children:r})}));ba.displayName=_n.displayName;const as=i.forwardRef(({className:t,children:s,variant:a,size:r,...n},o)=>{const d=i.useContext(Pi);return e.jsx(kn,{ref:o,className:J(Li({variant:d.variant||a,size:d.size||r}),t),...n,children:s})});as.displayName=kn.displayName;const zs=Il,ws=i.forwardRef(({className:t,...s},a)=>e.jsx(Al,{ref:a,className:J("border-b",t),...s}));ws.displayName="AccordionItem";const Ts=i.forwardRef(({className:t,children:s,...a},r)=>e.jsx(Rl,{className:"flex",children:e.jsxs(Pr,{ref:r,className:J("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",t),...a,children:[s,e.jsx(Ea,{className:"h-4 w-4 shrink-0 transition-transform duration-200"})]})}));Ts.displayName=Pr.displayName;const Ss=i.forwardRef(({className:t,children:s,...a},r)=>e.jsx(Tn,{ref:r,className:"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...a,children:e.jsx("div",{className:J("pb-4 pt-0",t),children:s})}));Ss.displayName=Tn.displayName;const As=({icon:t,title:s,description:a,className:r})=>e.jsx(Ne,{className:`border-dashed ${r||""}`,children:e.jsxs(Be,{className:"text-center py-10",children:[t&&e.jsx("div",{className:"mx-auto h-12 w-12 text-muted-foreground mb-4",children:t}),e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:s}),a&&e.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:a})]})}),Ei="tariff_rules_cache_v1",Oi=()=>{if(!(typeof window>"u"))try{const t=window.sessionStorage.getItem(Ei);if(!t)return;const s=JSON.parse(t);return Array.isArray(s)?s:void 0}catch{return}},Ic=t=>{if(!(typeof window>"u"))try{window.sessionStorage.setItem(Ei,JSON.stringify(t))}catch{}},Fc=()=>Ft({queryKey:["tariff-rules"],initialData:Oi(),staleTime:1/0,queryFn:async()=>{const{data:t}=await rs("/assets/data/tariff_rules.json");if(!Array.isArray(t))throw new Error("tariff_rules.json 格式不正確");return Ic(t),t}}),Dc=({item:t})=>{var d;const{searchHtsCode:s}=ra(),{t:a}=Ge(),r=t.material.includes("Steel")&&t.material.includes("Aluminum")?a("fr.tariffQuery.materialMixed"):t.material.includes("Steel")?a("fr.tariffQuery.materialSteel"):t.material.includes("Aluminum")?a("fr.tariffQuery.materialAluminum"):"",n=c=>{c&&s(c)},o=c=>{var u,p,v;return c?e.jsxs("div",{className:"mt-4 pt-4 border-t border-dashed border-border space-y-4",children:[e.jsx("h4",{className:"text-base font-semibold text-foreground",children:a("fr.tariffQuery.applicableMeasures")}),((u=c.sec232)==null?void 0:u.applicable)&&e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0 text-sm font-semibold text-destructive bg-destructive/10 px-3 py-1 rounded-full",children:a("fr.tariffQuery.sec232")}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-base font-bold text-destructive",children:c.sec232.rate}),e.jsx("p",{className:"text-sm text-muted-foreground",children:c.sec232.note})]})]}),((p=c.sec301)==null?void 0:p.applicable)&&e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0 text-sm font-semibold text-warning-foreground bg-warning/10 px-3 py-1 rounded-full",children:a("fr.tariffQuery.sec301")}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-base font-bold text-warning",children:c.sec301.rate}),e.jsx("p",{className:"text-sm text-muted-foreground",children:c.sec301.note})]})]}),((v=c.ad_cvd)==null?void 0:v.applicable)&&e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0 text-sm font-semibold text-info-foreground bg-info/10 px-3 py-1 rounded-full",children:a("fr.tariffQuery.adcvd")}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-base font-bold text-info",children:a("fr.tariffQuery.highRisk")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:c.ad_cvd.note})]})]})]}):null};return e.jsx(Ne,{className:"rounded-2xl shadow-md overflow-hidden",children:e.jsx(zs,{type:"single",collapsible:!0,children:e.jsxs(ws,{value:"item-1",className:"border-b-0",children:[e.jsx(Ts,{className:"p-6 hover:no-underline hover:bg-accent",children:e.jsxs("div",{className:"flex-grow pr-4 text-left",children:[e.jsxs("div",{className:"flex justify-between items-start gap-4",children:[e.jsxs("h2",{className:"text-xl font-bold text-foreground",children:[t.description,t.isDerivative&&e.jsx(ht,{variant:"secondary",className:"ml-3 align-middle",children:a("fr.tariffQuery.derivative")})]}),e.jsx(ht,{variant:t.material.includes("Steel")&&t.material.includes("Aluminum")?"default":t.material.includes("Steel")?"secondary":"outline",className:"flex-shrink-0 mt-1",children:r})]}),e.jsx("p",{className:"text-base text-muted-foreground mt-2",children:a("fr.tariffQuery.chapter",{chapter:t.chapter})})]})}),e.jsxs(Ss,{className:"px-6 pb-6 pt-2",children:[e.jsx("div",{className:"divide-y divide-border",children:(d=t.details)==null?void 0:d.map((c,u)=>e.jsxs("div",{className:"py-3 flex items-start",children:[e.jsx("button",{className:"text-base font-mono text-primary w-36 flex-shrink-0 cursor-pointer hover:underline hover:text-primary/80 p-0 bg-transparent border-none text-left h-auto",onClick:p=>{p.stopPropagation(),n(c.hts||c.sub_hts||"")},children:c.hts||c.sub_hts}),e.jsx("span",{className:"text-base text-foreground ml-4",children:c.desc||""})]},u))}),o(t.tariffs)]})]})})})},Lc=()=>{const{t}=Ge(),[s,a]=i.useState(""),[r,n]=i.useState("All"),{addNotification:o}=Ma(),[d,c]=i.useState(!1),[u,p]=i.useState(!1),v=Fc(),_=v.data??[],j=!v.data&&v.isLoading;i.useEffect(()=>{if(d)return;const x=Oi();x!=null&&x.length&&o(t("fr.tariffQuery.cachedLoaded",{count:x.length}),"success"),c(!0)},[o,d,t]),i.useEffect(()=>{if(!v.error)return;const x=v.error instanceof Error?v.error.message:String(v.error);o(t("fr.tariffQuery.loadError",{message:x}),"error")},[v.error,o,t]),i.useEffect(()=>{!v.isSuccess||!v.isFetchedAfterMount||u||(o(t("fr.tariffQuery.remoteLoaded",{count:_.length}),"success"),p(!0))},[v.isSuccess,v.isFetchedAfterMount,u,_.length,o,t]);const f=i.useMemo(()=>_.length===0?[]:_.filter(x=>{var g;const T=s.toLowerCase().trim();if(!(r==="All"||x.material.includes(r)))return!1;if(T==="")return!0;const S=x.description.toLowerCase().includes(T)||x.chapter.toLowerCase().includes(T),y=(g=x.details)==null?void 0:g.some(b=>(b.hts||b.sub_hts||"").toLowerCase().includes(T)||(b.desc||"").toLowerCase().includes(T));return S||y}).sort((x,T)=>(x.isDerivative?0:1)-(T.isDerivative?0:1)),[_,s,r]);return e.jsxs("div",{children:[e.jsx(Ne,{className:"mb-8 sticky top-4 z-10 p-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-grow",children:[e.jsx(Hs,{className:"w-5 h-5 text-muted-foreground absolute top-1/2 left-4 transform -translate-y-1/2"}),e.jsx(He,{type:"text",placeholder:t(j?"fr.tariffQuery.searchPlaceholderLoading":"fr.tariffQuery.searchPlaceholder"),className:"w-full h-12 p-4 pl-12 rounded-xl",disabled:j,value:s,onChange:x=>a(x.target.value)})]}),e.jsxs(ba,{type:"single",value:r,onValueChange:x=>x&&n(x),className:"p-1 rounded-xl bg-muted",children:[e.jsx(as,{value:"All",className:"px-4 py-2",children:t("fr.tariffQuery.filterAll")}),e.jsx(as,{value:"Steel",className:"px-4 py-2",children:t("fr.tariffQuery.filterSteel")}),e.jsx(as,{value:"Aluminum",className:"px-4 py-2",children:t("fr.tariffQuery.filterAluminum")})]})]})}),e.jsxs("main",{className:"space-y-6 mt-8",children:[j&&e.jsx("div",{className:"text-center py-16",children:e.jsx("p",{className:"text-lg text-muted-foreground",children:t("status.loading")})}),!j&&f.length===0&&e.jsx("div",{className:"text-center py-16",children:e.jsx(As,{icon:e.jsx(Fl,{className:"h-16 w-16"}),title:t("fr.tariffQuery.emptyTitle"),description:t("fr.tariffQuery.emptyDesc")})}),f.map((x,T)=>e.jsx(Dc,{item:x},T))]})]})},Mi=t=>Ft({queryKey:["hts-details",t],queryFn:()=>Fi(t),enabled:!!t}),Tr=ja("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",glass:"bg-accent/20 text-accent-foreground backdrop-blur-md border border-accent/30 shadow-md hover:bg-accent/30 focus:ring-accent/40"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),ee=i.forwardRef(({className:t,variant:s,size:a,asChild:r=!1,...n},o)=>{const d=r?Dl:"button";return e.jsx(d,{className:J(Tr({variant:s,size:a,className:t})),ref:o,...n})});ee.displayName="Button";const $a=Pl,Ha=El,va=i.forwardRef(({className:t,align:s="center",sideOffset:a=4,...r},n)=>e.jsx(Ll,{children:e.jsx(An,{ref:n,align:s,sideOffset:a,className:J("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]",t),...r})}));va.displayName=An.displayName;function wt({className:t,...s}){return e.jsx("div",{className:J("animate-pulse rounded-md bg-muted",t),...s})}const ha=Ol,na=i.forwardRef(({className:t,...s},a)=>e.jsx(Rn,{ref:a,className:J("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",t),...s}));na.displayName=Rn.displayName;const is=i.forwardRef(({className:t,...s},a)=>e.jsx(In,{ref:a,className:J("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",t),...s}));is.displayName=In.displayName;const ls=i.forwardRef(({className:t,...s},a)=>e.jsx(Fn,{ref:a,className:J("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...s}));ls.displayName=Fn.displayName;const $r=Ml,$i=$l,Hr=Hl,bt=({title:t,data:s,defaultOpen:a=!1})=>s?e.jsxs($r,{defaultOpen:a,className:"mt-4 rounded-lg border bg-muted/50",children:[e.jsx($i,{asChild:!0,children:e.jsxs("div",{className:"flex w-full cursor-pointer items-center justify-between p-4 font-medium text-foreground",children:[e.jsx("span",{children:t}),e.jsx(Dn,{className:"h-4 w-4"})]})}),e.jsx(Hr,{children:e.jsx("pre",{className:"whitespace-pre-wrap break-all bg-muted p-4 text-sm text-foreground border-t border-border",children:JSON.stringify(s,null,2)})})]}):null,Pc=t=>{const s=t.replace(/\s+/g,"");return s==="{}"||s==="[]"},Ec=t=>{if(t==null)return!1;if(typeof t=="string"){const s=t.trim();return!(!s||Pc(s))}return Array.isArray(t)?t.length>0:!0},Zr=({label:t,value:s})=>Ec(s)?e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-[11px] font-semibold uppercase tracking-wide text-muted-foreground",children:t}),e.jsx("div",{className:"text-xs whitespace-pre-line leading-relaxed break-words",children:s})]}):null,en=(t,s)=>{if(!t||t.length===0)return null;const a=t.map(r=>r==null?"":String(r)).filter(Boolean);return a.length===0?null:a.join(", ")},La=({doc:t})=>{var w,S;const{t:s}=Ge(),a=[t.document_number,t.type,t.publication_date].filter(Boolean).join(" | "),r=t.agencies_text||en(t.agency_names),n=Array.isArray(t.topics)&&t.topics.length>0?t.topics.map(y=>typeof y=="string"?y:(y==null?void 0:y.name)||(y==null?void 0:y.title)||"").filter(Boolean).join(", "):null,o=(w=t.docket_ids)!=null&&w.length?t.docket_ids.join(", "):t.docket_id,d=Array.isArray(t.cfr_references)&&t.cfr_references.length>0?t.cfr_references.map(y=>y?typeof y=="string"?y:typeof y=="object"?[y.title,y.part].filter(Boolean).join(" "):String(y):"").filter(Boolean).join(", "):null,c=t.start_page||t.end_page?`${t.start_page??"?"} - ${t.end_page??"?"}${t.page_length?` (${t.page_length} pp)`:""}`:t.page_length?`${t.page_length} pp`:null,u=t.page_views&&(t.page_views.count||t.page_views.last_updated)?`${t.page_views.count??s("fr.doc.na")} (${t.page_views.last_updated??s("fr.doc.updatedUnknown")})`:null,p=y=>y==null?void 0:s(y?"fr.doc.yes":"fr.doc.no"),v=t.regulation_id_number_info&&typeof t.regulation_id_number_info=="object"?e.jsx(bt,{title:s("fr.doc.regulationIdInfo"),data:t.regulation_id_number_info}):t.regulation_id_number_info?String(t.regulation_id_number_info):void 0,_=t.regulations_dot_gov_info&&typeof t.regulations_dot_gov_info=="object"?e.jsx(bt,{title:s("fr.doc.regsGovJson"),data:t.regulations_dot_gov_info}):t.regulations_dot_gov_info,j=Array.isArray(t.dockets)&&t.dockets.length>0?e.jsx(bt,{title:s("fr.doc.dockets"),data:t.dockets}):t.dockets,f=(y,g,b)=>g?{label:y,value:e.jsx("a",{href:g,target:"_blank",rel:"noreferrer",className:"text-primary underline break-all",children:b||g})}:null,x=[f(s("fr.doc.htmlUrl"),t.html_url,s("fr.doc.viewOnFr")),f(s("fr.doc.fullText"),t.body_html_url||t.full_text_xml_url,s("fr.doc.fullText")),f(s("fr.doc.pdf"),t.pdf_url,s("fr.doc.pdf")),f(s("fr.doc.publicInspectionPdf"),t.public_inspection_pdf_url,s("fr.doc.publicInspectionPdf")),f(s("fr.doc.rawText"),t.raw_text_url),f(s("fr.doc.jsonUrl"),t.json_url),f(s("fr.doc.modsUrl"),t.mods_url),f(s("fr.doc.commentUrl"),t.comment_url),f(s("fr.doc.regsGovUrl"),t.regulations_dot_gov_url||((S=t.regulations_dot_gov_info)==null?void 0:S.regulations_dot_gov_url))].filter(Boolean),T=[{label:s("fr.doc.action"),value:t.action},{label:s("fr.doc.dates"),value:t.dates},{label:s("fr.doc.effectiveOn"),value:t.effective_on},{label:s("fr.doc.commentCloseOn"),value:t.comments_close_on},{label:s("fr.doc.addresses"),value:t.addresses},{label:s("fr.doc.contact"),value:t.contact},{label:s("fr.doc.furtherInfo"),value:t.further_information},{label:s("fr.doc.supplementaryInfo"),value:t.supplementary_information},{label:s("fr.doc.abstract"),value:t.abstract},{label:s("fr.doc.topics"),value:n},{label:s("fr.doc.docketIds"),value:o},{label:s("fr.doc.dockets"),value:j},{label:s("fr.doc.regIdNumbers"),value:en(t.regulation_id_numbers)},{label:s("fr.doc.regulationIdInfo"),value:v},{label:s("fr.doc.cfrReferences"),value:d},{label:s("fr.doc.citation"),value:t.citation},{label:s("fr.doc.correctionOf"),value:t.correction_of&&JSON.stringify(t.correction_of,null,2)},{label:s("fr.doc.corrections"),value:t.corrections&&JSON.stringify(t.corrections,null,2)},{label:s("fr.doc.pageRange"),value:c},{label:s("fr.doc.pageViews"),value:u},{label:s("fr.doc.volume"),value:t.volume},{label:s("fr.doc.startPage"),value:t.start_page},{label:s("fr.doc.endPage"),value:t.end_page},{label:s("fr.doc.presidentialDocNumber"),value:t.presidential_document_number},{label:s("fr.doc.proclamationNumber"),value:t.proclamation_number},{label:s("fr.doc.signingDate"),value:t.signing_date},{label:s("fr.doc.significant"),value:p(t.significant)},{label:s("fr.doc.subtype"),value:t.subtype},{label:s("fr.doc.tocDoc"),value:t.toc_doc},{label:s("fr.doc.tocSubject"),value:t.toc_subject},{label:s("fr.doc.topicsRaw"),value:t.topics&&JSON.stringify(t.topics,null,2)},{label:s("fr.doc.agencyNames"),value:r},{label:s("fr.doc.regsGovInfo"),value:_},{label:s("fr.doc.execOrderNotes"),value:t.executive_order_notes},{label:s("fr.doc.execOrderNumber"),value:t.executive_order_number}];return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-sm leading-tight text-foreground",children:t.title}),a&&e.jsx("div",{className:"text-[11px] text-muted-foreground mt-0.5",children:a}),r&&e.jsx("div",{className:"text-[11px] text-muted-foreground mt-0.5",children:r})]}),e.jsx("div",{className:"grid gap-3 md:grid-cols-2",children:T.map(({label:y,value:g})=>e.jsx(Zr,{label:y,value:g},y))}),x.length>0&&e.jsx("div",{className:"grid gap-3 md:grid-cols-2",children:x.map(({label:y,value:g})=>e.jsx(Zr,{label:y,value:g},y))})]})},Hi=new Map,Oc=t=>{try{return Hi.get(t)}catch{return}},Mc=(t,s)=>{try{Hi.set(t,s)}catch{}};function Pa(t,s,a){if(!(a==null||a===""))if(Array.isArray(a))for(const r of a)Pa(t,`${s}[]`,r);else if(typeof a=="object")for(const[r,n]of Object.entries(a))Pa(t,`${s}[${r}]`,n);else{const r=String(a);s.endsWith("[]")||t.has(s)?t.append(s,r):t.set(s,r)}}async function ia(t,s){const a=t.toString();if(!(s!=null&&s.includeHeaders)&&!(s!=null&&s.skipCache)){const d=Oc(a);if(d)return{url:a,payload:d,status:200}}const r=await fetch(a),n=await r.json().catch(()=>({})),o={};try{for(const[d,c]of r.headers.entries())o[d.toLowerCase()]=String(c)}catch{}return r.ok&&!(s!=null&&s.includeHeaders)&&!(s!=null&&s.skipCache)&&Mc(a,n),{url:a,payload:n,status:r.status,headers:o}}async function lr(t){var r;const s=new URL("/api/fr-ts-search",window.location.origin),a=!!(t.conditions&&typeof t.conditions.term=="string"&&t.conditions.term.trim());if(t.term&&!a&&s.searchParams.set("conditions[term]",t.term),t.per_page&&s.searchParams.set("per_page",String(t.per_page)),t.page&&s.searchParams.set("page",String(t.page)),t.order&&s.searchParams.set("order",String(t.order)),(r=t.facets)!=null&&r.length&&s.searchParams.set("facets",t.facets.join(",")),t.base_uri&&s.searchParams.set("base_uri",t.base_uri),t.debug&&s.searchParams.set("debug","1"),s.searchParams.set("highlight","true"),t.conditions)for(const[n,o]of Object.entries(t.conditions))Pa(s.searchParams,`conditions[${n}]`,o);return ia(s,{includeHeaders:t.includeHeaders,skipCache:t.skipCache})}async function $c(t,s){var r;const a=new URL("/api/fr-ts-find",window.location.origin);return a.searchParams.set("document_number",t),(r=s==null?void 0:s.fields)!=null&&r.length&&a.searchParams.set("fields",s.fields.join(",")),s!=null&&s.publication_date&&a.searchParams.set("publication_date",s.publication_date),s!=null&&s.base_uri&&a.searchParams.set("base_uri",s.base_uri),ia(a,{includeHeaders:s==null?void 0:s.includeHeaders,skipCache:s==null?void 0:s.skipCache})}async function Hc(t){var a;const s=new URL("/api/fr-ts-agencies",window.location.origin);return s.searchParams.set("action","all"),(a=t==null?void 0:t.fields)!=null&&a.length&&s.searchParams.set("fields",t.fields.join(",")),t!=null&&t.base_uri&&s.searchParams.set("base_uri",t.base_uri),ia(s,{includeHeaders:t==null?void 0:t.includeHeaders,skipCache:t==null?void 0:t.skipCache})}async function Uc(t){const s=new URL("/api/fr-ts-search-details",window.location.origin);if(t!=null&&t.for&&s.searchParams.set("for",t.for),t!=null&&t.term&&s.searchParams.set("conditions[term]",t.term),t!=null&&t.base_uri&&s.searchParams.set("base_uri",t.base_uri),t!=null&&t.conditions)for(const[a,r]of Object.entries(t.conditions))Pa(s.searchParams,`conditions[${a}]`,r);return ia(s,{includeHeaders:t==null?void 0:t.includeHeaders,skipCache:t==null?void 0:t.skipCache})}async function Bc(t){const s=new URL("/api/fr-ts-suggested-searches",window.location.origin);return s.searchParams.set("action","search"),t!=null&&t.base_uri&&s.searchParams.set("base_uri",t.base_uri),ia(s,{includeHeaders:t==null?void 0:t.includeHeaders,skipCache:t==null?void 0:t.skipCache})}async function Vc(t,s){const a=new URL("/api/fr-ts-suggested-searches",window.location.origin);return a.searchParams.set("action","find"),a.searchParams.set("slug",t),s!=null&&s.base_uri&&a.searchParams.set("base_uri",s.base_uri),ia(a,{includeHeaders:s==null?void 0:s.includeHeaders,skipCache:s==null?void 0:s.skipCache})}async function qc(t){const s=new URL("/api/fr-ts-sections",window.location.origin);return t!=null&&t.term&&s.searchParams.set("term",t.term),t!=null&&t.base_uri&&s.searchParams.set("base_uri",t.base_uri),ia(s,{includeHeaders:t==null?void 0:t.includeHeaders,skipCache:t==null?void 0:t.skipCache})}async function zc(t,s){const a=new URL("/api/fr-ts-facet",window.location.origin);if(a.searchParams.set("facet",t),s!=null&&s.page&&a.searchParams.set("page",String(s.page)),s!=null&&s.base_uri&&a.searchParams.set("base_uri",s.base_uri),s!=null&&s.conditions)for(const[r,n]of Object.entries(s.conditions))Pa(a.searchParams,`conditions[${r}]`,n);return ia(a,{includeHeaders:s==null?void 0:s.includeHeaders,skipCache:s==null?void 0:s.skipCache})}function rr(t){return t!==null&&typeof t=="object"}function Qc(t){if(!rr(t))return t;const s=rr(t.attributes)?t.attributes:void 0;return s?{...t,...s}:t}function Yc(t){if(!Array.isArray(t))return{};const s=t.map(r=>rr(r)?{name:r.name??r.raw_name,id:r.id,slug:r.slug,raw_name:r.raw_name}:{}),a=s.map(r=>(r==null?void 0:r.name)||(r==null?void 0:r.raw_name)||"").filter(Boolean).join(", ");return{agencies:s,agencies_text:a}}function gr(t){return Array.isArray(t)?t.map(s=>String(s)):typeof t=="string"?t?[t]:[]:[]}function Gc(t){const s=rr(t)?t:{},a=s.highlight||s.highlights||{},r=s.excerpts,n=gr(r),o=gr(a==null?void 0:a.excerpts),d=gr(a==null?void 0:a.matches);return(n.length?n:o.length?o:d).map(u=>String(u))}function Ui(t){if(!t)return null;const s=Qc(t),a=String(s.document_number||s.documentNumber||""),r=String(s.title||s.name||""),n=s.type||s.action,o=s.publication_date||s.published_at||s.date,d=s.html_url||s.body_html_url||s.full_text_url,c=s.body_html_url??null,u=s.pdf_url??null,p=s.public_inspection_pdf_url??null,v=s.abstract,_=Array.isArray(s.agency_names)?s.agency_names.map(ve=>String(ve)):void 0,{agencies:j,agencies_text:f}=Yc(s.agencies),x=Gc(s),T=s.addresses,w=s.contact||s.contacts,S=s.comment_url,y=s.comments_close_on??null,g=s.disposition_notes,b=s.further_information,R=s.supplementary_information,P=s.action,z=s.dates,B=s.docket_id?String(s.docket_id):void 0,M=Array.isArray(s.docket_ids)?s.docket_ids.map(ve=>String(ve)):void 0,A=Array.isArray(s.dockets)?s.dockets:void 0,V=s.effective_on,q=s.start_page!=null?Number(s.start_page):void 0,I=s.end_page!=null?Number(s.end_page):void 0,k=s.page_length!=null?Number(s.page_length):void 0,F=s.page_views??null,U=s.full_text_xml_url,ne=s.raw_text_url,ge=s.json_url,$=s.mods_url,le=Array.isArray(s.regulation_id_numbers)?s.regulation_id_numbers.map(ve=>String(ve)):void 0,_e=s.regulation_id_number_info,Ee=s.regulations_dot_gov_info,Fe=s.regulations_dot_gov_url??null,et=s.significant??null,ze=s.signing_date??null,G=s.subtype??null,Ce=s.toc_doc??null,pe=s.toc_subject??null,W=Array.isArray(s.topics)?s.topics:void 0,Q=s.volume??null,K=s.presidential_document_number??null,we=s.proclamation_number??null,X=Array.isArray(s.cfr_references)?s.cfr_references:void 0,xe=s.citation,$e=s.correction_of,Ae=Array.isArray(s.corrections)?s.corrections:void 0,ct=s.images,Tt=s.images_metadata,Z=s.not_received_for_publication,fe=s.explanation,ue=s.executive_order_notes,ye=s.executive_order_number;return{document_number:a,title:r,type:n,publication_date:o,html_url:d,body_html_url:c,pdf_url:u,public_inspection_pdf_url:p,agencies:j,agencies_text:f,agency_names:_,abstract:typeof v=="string"?v:void 0,addresses:T,contact:w,comment_url:S,comments_close_on:y,disposition_notes:g,excerpts:x,action:P,dates:z,docket_id:B,docket_ids:M,dockets:A,effective_on:V,start_page:q,end_page:I,page_length:k,page_views:F,full_text_xml_url:U,raw_text_url:ne,json_url:ge,mods_url:$,regulation_id_numbers:le,regulation_id_number_info:_e,regulations_dot_gov_info:Ee,regulations_dot_gov_url:Fe,further_information:b,supplementary_information:R,significant:et,signing_date:ze,subtype:G,toc_doc:Ce,toc_subject:pe,topics:W,volume:Q,presidential_document_number:K,proclamation_number:we,cfr_references:X,citation:xe,correction_of:$e,corrections:Ae,images:ct,images_metadata:Tt,not_received_for_publication:Z,explanation:fe,executive_order_notes:ue,executive_order_number:ye}}function Kc(t){var s;return t?Array.isArray(t==null?void 0:t.results)?t.results:Array.isArray((s=t==null?void 0:t.documents)==null?void 0:s.results)?t.documents.results:Array.isArray(t==null?void 0:t.documents)?t.documents:[]:[]}function Ur(t){return Kc(t).map(a=>Ui(a)).filter(a=>!!a&&!!a.document_number&&!!a.title)}function Bi(t){const s=(t==null?void 0:t.document)??t;return Ui(s)}function Vi(t){return String(t||"").replace(/\n/g,"<br/>").replace(/<span\s+class=["']match["']>/gi,'<span style="background-color:#fde68a;padding:0 2px;border-radius:2px;">')}const Br=async(t,s)=>{var o,d;const a=await $c(t.trim(),{includeHeaders:!0,skipCache:!0,base_uri:s});if(a.status!==200)throw new Error(((o=a.payload)==null?void 0:o.error)||`HTTP ${a.status}`);const r=a.headers||{},n=r["x-adapter-mode"]||(typeof((d=a.payload)==null?void 0:d.adapter_mode)=="string"?a.payload.adapter_mode:"");return{payload:a.payload,url:a.url,headers:r,adapterMode:n}},or=async(t,s,a)=>{const r=(a==null?void 0:a.baseUri)||"",{payload:n,url:o,adapterMode:d}=await t.fetchQuery({queryKey:["fr-adapter-find",r,s],queryFn:()=>Br(s,a==null?void 0:a.baseUri)}),c=(n==null?void 0:n.document)||n;return{normalized:Bi(n),raw:c,url:o,adapterMode:d}},Wc=({htsCode:t})=>{const{addNotification:s}=Ma(),{t:a}=Ge(),{data:r,error:n,isLoading:o}=Mi(t);if(i.useEffect(()=>{if(n){const c=n instanceof Error?n.message:a("fr.htsCard.detailLoadFailed");s(a("fr.htsCard.detailLoadFailedDesc",{message:c}),"error")}},[n,s,t,a]),o)return e.jsx("div",{className:"text-destructive text-sm p-2",children:a("status.loading")});if(n){const c=n instanceof Error?n.message:a("fr.htsCard.detailLoadFailed");return e.jsx("div",{className:"text-destructive text-sm p-2 bg-destructive/10 rounded",children:c})}if(!r)return null;const d=r;return e.jsxs("div",{className:"bg-muted/50 rounded-lg p-3 text-sm border border-border",children:[e.jsx("div",{className:"font-semibold text-foreground",children:d.description||a("fr.htsCard.noDescription")}),e.jsxs("div",{className:"mt-2 space-y-1 text-muted-foreground",children:[d.base_rate&&e.jsxs("div",{children:[a("fr.htsCard.rateGeneral"),": ",d.base_rate]}),d.special&&e.jsxs("div",{children:[a("fr.htsCard.rateSpecial"),": ",d.special]}),d.other&&e.jsxs("div",{children:[a("fr.htsCard.rateOther"),": ",d.other]})]})]})},tn=({docs:t})=>{const{t:s}=Ge(),a=ma(),[r,n]=i.useState(null),[o,d]=i.useState(null),[c,u]=i.useState(null),[p,v]=i.useState(!1),[_,j]=i.useState(null);if(!t||t.length===0)return e.jsx("p",{className:"text-sm text-muted-foreground",children:s("fr.htsCard.noData")});const f=async x=>{if(x){if(r===x){n(null),d(null),u(null),j(null);return}n(x),d(null),u(null),j(null),v(!0);try{const T=await or(a,x);u(T.raw),T.normalized?d(T.normalized):j(s("fr.htsCard.docNotFound"))}catch(T){j(T instanceof Error?T.message:String(T))}finally{v(!1)}}};return e.jsx("div",{className:"grid gap-3",children:t.map(x=>e.jsxs("div",{className:"border rounded-lg p-3 text-sm",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx(ht,{variant:"secondary",className:"rounded-full",children:x.type}),e.jsx("span",{className:"font-medium text-foreground",children:x.title})]}),e.jsx("div",{className:"mt-1 text-xs text-muted-foreground",children:s("fr.htsCard.docMeta",{date:x.publication_date,agencies:x.agencies_text||(Array.isArray(x.agencies)?x.agencies.map(T=>(T==null?void 0:T.name)||(T==null?void 0:T.raw_name)||"").filter(Boolean).join(", "):"")})}),e.jsxs("div",{className:"mt-2 flex items-center gap-4 text-xs",children:[e.jsxs("a",{className:"inline-flex items-center gap-1 text-primary hover:underline",href:x.html_url,target:"_blank",rel:"noreferrer",children:[s("fr.htsCard.linkOriginal")," ",e.jsx(ea,{className:"h-3 w-3"})]}),x.body_html_url&&e.jsxs("a",{className:"inline-flex items-center gap-1 text-primary hover:underline hover:text-primary/80",href:x.body_html_url,target:"_blank",rel:"noreferrer",children:[s("fr.htsCard.linkFullText")," ",e.jsx(ea,{className:"h-3 w-3"})]}),x.public_inspection_pdf_url&&e.jsxs("a",{className:"inline-flex items-center gap-1 text-primary hover:underline",href:x.public_inspection_pdf_url,target:"_blank",rel:"noreferrer",children:[s("fr.htsCard.linkPublicInspection")," ",e.jsx(ea,{className:"h-3 w-3"})]}),e.jsx(ee,{variant:"link",size:"sm",className:"h-auto px-0 text-xs",onClick:()=>f(x.document_number),children:r===x.document_number?s("fr.htsCard.hideDocDetail"):s("fr.htsCard.showDocDetail")})]}),r===x.document_number&&e.jsxs("div",{className:"mt-2 border rounded-md p-2 bg-muted/40 text-xs",children:[p&&e.jsx("div",{children:s("fr.htsCard.loadingDocDetail")}),_&&e.jsx("div",{className:"text-destructive",children:_}),!p&&!_&&o&&e.jsx(La,{doc:o}),!p&&!_&&!o&&e.jsx("div",{children:s("fr.htsCard.docNotFound")}),c&&e.jsx("div",{className:"mt-2",children:e.jsx(bt,{title:s("fr.htsCard.rawTitle"),data:c})})]})]},x.document_number))})},Jc=({details:t})=>{var r,n,o;const{t:s}=Ge();if(!t)return null;const a=d=>typeof d=="number"?d.toLocaleString("en-US",{style:"currency",currency:"USD",maximumFractionDigits:0}):"—";return e.jsxs("div",{className:"space-y-4",children:[((r=t.tradeStats)==null?void 0:r.length)>0&&e.jsxs(Ne,{children:[e.jsx(ot,{className:"pb-2",children:e.jsxs(pt,{className:"text-base flex items-center gap-2",children:[e.jsx(Vl,{className:"h-4 w-4"}),s("fr.htsCard.tradeStatsTitle")]})}),e.jsx(Be,{children:e.jsx("ul",{className:"list-disc pl-5 mt-1 text-sm text-muted-foreground",children:t.tradeStats.map((d,c)=>e.jsxs("li",{children:[d.year,": ",a(d.value)]},c))})})]}),((n=t.investigations)==null?void 0:n.length)>0&&e.jsxs(Ne,{children:[e.jsx(ot,{className:"pb-2",children:e.jsxs(pt,{className:"text-base flex items-center gap-2",children:[e.jsx(Pn,{className:"h-4 w-4"}),s("fr.htsCard.investigationsTitle")]})}),e.jsx(Be,{children:e.jsx("div",{className:"space-y-4",children:t.investigations.map((d,c)=>e.jsxs("div",{className:"text-sm",children:[e.jsx("a",{href:d.url,target:"_blank",rel:"noopener noreferrer",className:"font-medium text-primary hover:underline",children:d.title}),e.jsxs("div",{className:"mt-1 text-xs text-muted-foreground",children:[e.jsxs("p",{children:[e.jsxs("span",{className:"font-semibold",children:[s("fr.htsCard.caseNumber"),":"]})," ",Array.isArray(d.caseNumbers)?d.caseNumbers.join(", "):s("status.empty")]}),e.jsxs("p",{children:[e.jsxs("span",{className:"font-semibold",children:[s("fr.htsCard.countries"),":"]})," ",Array.isArray(d.countries)?d.countries.join(", "):s("status.empty")]})]})]},c))})})]}),((o=t.programs_dataweb)==null?void 0:o.length)>0&&e.jsxs(Ne,{children:[e.jsx(ot,{className:"pb-2",children:e.jsxs(pt,{className:"text-base flex items-center gap-2",children:[e.jsx(Oa,{className:"h-4 w-4"}),s("fr.htsCard.programsTitle")]})}),e.jsx(Be,{children:e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:t.programs_dataweb.map((d,c)=>e.jsxs(ht,{variant:d.status==="Eligible"?"default":"outline",className:d.status==="Eligible"?"bg-success/10 text-success border border-success/20":"",children:[d.code,": ",d.status]},c))})})]})]})},Xc=({rawData:t})=>{var a,r,n,o,d,c;const{t:s}=Ge();return t?e.jsx("div",{className:"mt-4 pt-4 border-t",children:e.jsxs(ha,{defaultValue:"overview",className:"w-full",children:[e.jsxs(na,{className:"w-full flex flex-wrap gap-1",children:[e.jsx(is,{value:"overview",children:s("fr.htsCard.tabOverview")}),Array.isArray((a=t.fr_subgroups)==null?void 0:a.subgroups)&&t.fr_subgroups.subgroups.reduce((u,p)=>u+((p==null?void 0:p.count)||0),0)>0&&e.jsx(is,{value:"all",children:s("fr.htsCard.tabAll",{count:((n=(r=t.fr_subgroups)==null?void 0:r.all)==null?void 0:n.length)||0})}),Array.isArray((o=t.fr_subgroups)==null?void 0:o.subgroups)&&t.fr_subgroups.subgroups.filter(u=>((u==null?void 0:u.count)||0)>0).map(u=>e.jsxs(is,{value:u.tag,children:[u.label," (",u.count,")"]},u.tag))]}),e.jsx(ls,{value:"overview",className:"mt-4",children:e.jsx(Jc,{details:t.get_hts_details})}),Array.isArray((d=t.fr_subgroups)==null?void 0:d.all)&&t.fr_subgroups.all.length>0&&e.jsx(ls,{value:"all",className:"mt-4",children:e.jsx(tn,{docs:t.fr_subgroups.all})}),Array.isArray((c=t.fr_subgroups)==null?void 0:c.subgroups)&&t.fr_subgroups.subgroups.filter(u=>((u==null?void 0:u.count)||0)>0).map(u=>e.jsx(ls,{value:u.tag,className:"mt-4",children:e.jsx(tn,{docs:u.documents||[]})},u.tag))]})}):null},Zc=({item:t,detailedData:s})=>{var d,c,u,p,v,_,j;const{t:a}=Ge(),r=i.useMemo(()=>({...t,...s}),[t,s]),n=[((d=r.extra_duties)==null?void 0:d.s232_steel)&&"Sec 232 Steel",((c=r.extra_duties)==null?void 0:c.s232_aluminum)&&"Sec 232 Aluminum",((u=r.extra_duties)==null?void 0:u.s301)&&"Sec 301"].filter(Boolean),o=((p=r.investigations)==null?void 0:p.length)||0;return e.jsxs("div",{className:"mt-4 pt-4 border-t border-dashed",children:[e.jsx("h4",{className:"text-base font-semibold text-foreground mb-3",children:a("fr.htsCard.storyHeading")}),e.jsxs("div",{className:"grid gap-3 text-sm leading-6",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ul,{className:"h-4 w-4 mt-0.5 text-muted-foreground flex-shrink-0"}),e.jsxs("span",{children:[e.jsxs("strong",{children:[a("fr.htsCard.basicRates")," "]}),a("fr.htsCard.basicRatesDesc",{general:r.general||"—",other:r.other||"—",units:(v=r.units)!=null&&v.length?r.units.join(", "):a("status.empty")})]})]}),n.length>0&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ln,{className:"h-4 w-4 mt-0.5 text-destructive flex-shrink-0"}),e.jsxs("span",{children:[e.jsxs("strong",{children:[a("fr.htsCard.extraDuties")," "]}),a("fr.htsCard.extraDutiesDesc",{duties:n.join("、")})]})]}),o>0&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(aa,{className:"h-4 w-4 mt-0.5 text-warning flex-shrink-0"}),e.jsxs("span",{children:[e.jsxs("strong",{children:[a("fr.htsCard.tradeRemedy")," "]}),a("fr.htsCard.tradeRemedyDesc",{count:o})]})]}),(r.effectiveDate||r.endDate)&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Bl,{className:"h-4 w-4 mt-0.5 text-muted-foreground flex-shrink-0"}),e.jsxs("span",{children:[e.jsxs("strong",{children:[a("fr.htsCard.validPeriod")," "]}),e.jsx("span",{className:"font-mono text-muted-foreground ml-1",children:((_=r.effectiveDate)==null?void 0:_.split(" ")[0])||"N/A"}),e.jsx("span",{className:"mx-1",children:"~"}),e.jsx("span",{className:"font-mono text-muted-foreground",children:((j=r.endDate)==null?void 0:j.split(" ")[0])||"N/A"})]})]})]})]})},sn=({item:t,allItems:s,searchTerm:a})=>{var A,V;const{htsResults:r,searchHtsCode:n}=ra(),{addNotification:o}=Ma(),{t:d}=Ge(),[c,u]=i.useState(null),[p,v]=i.useState(!1),[_,j]=i.useState(null),[f,x]=i.useState(null),[T,w]=i.useState(()=>{try{const q=`hts_card_open_${(t.htsno||"").replace(/\./g,"")}`,I=sessionStorage.getItem(q);return I?I==="1":!1}catch{return!1}});i.useEffect(()=>{try{if(!T)return;const q=`hts_card_data_${(t.htsno||"").replace(/\./g,"")}`,I=sessionStorage.getItem(q);if(I){const k=JSON.parse(I);k!=null&&k.detailedData&&u(k.detailedData),k!=null&&k.rawResponses&&x(k.rawResponses)}}catch{}},[]);const S=q=>{if(!a||!q)return q;const I=new RegExp(a.replace(/[-\/\\^$*+?.()|[\\\]{}]/g,"\\$&"),"gi");return q.replace(I,`<mark class="bg-muted px-1 rounded-sm">${a}</mark>`)},y=q=>{const k=S(q).replace(/&lt;il&gt;/g,"<em>").replace(/&lt;\/il&gt;/g,"</em>");return e.jsx("span",{dangerouslySetInnerHTML:{__html:k}})},g=t.description||"",b=(c==null?void 0:c.description)||"",R=c&&b&&b!==g,P=q=>{q.preventDefault(),n(t.htsno)},z=async()=>{const q=!T;w(q);try{const I=`hts_card_open_${(t.htsno||"").replace(/\./g,"")}`;sessionStorage.setItem(I,q?"1":"0")}catch{}if(q&&!c&&!p){v(!0),j(null),x(null);const I=U=>{const ne=String(U||"").replace(/\D/g,"");let ge=ne;if(ne.length>=12?ne.endsWith("000000")?ge=ne.slice(0,6):ne.endsWith("0000")?ge=ne.slice(0,8):ne.endsWith("00")&&(ge=ne.slice(0,10)):ne.length===10&&ne.endsWith("00")&&(ge=ne.slice(0,8)),ge.length>=4){let $=[ge.slice(0,4)];return ge.length>=6&&$.push(ge.slice(4,6)),ge.length>=8&&$.push(ge.slice(6,8)),ge.length>=10&&$.push(ge.slice(8,10)),ge.length>=12&&$.push(ge.slice(10,12)),$.join(".")}return U},k={},F=U=>{x(k);try{const ne=`hts_card_data_${(t.htsno||"").replace(/\./g,"")}`;sessionStorage.setItem(ne,JSON.stringify({detailedData:U,rawResponses:k}))}catch{}};try{const U=t.htsno,ne=I(U),ge=ne.replace(/\./g,""),$=await Fi(ge);if($!=null&&$.error)throw new Error($.error);k.get_hts_details=$,u($);try{const le=await lr({term:ne,per_page:1e4,includeHeaders:!1,skipCache:!0}),_e=Ur(le.payload),Ee=new Map,Fe=["sec232","sec301","trq","sec201","cvd","general","ad","other"],et={sec232:"Sec. 232",sec301:"Sec. 301",trq:"TRQ",sec201:"Sec. 201",cvd:"CVD",general:"General Tariffs",ad:"AD",other:"Other"},ze=new Map,G=W=>{const Q=String(W||""),K=Q.toLowerCase();return K.includes("section 232")?"sec232":K.includes("section 301")?"sec301":K.includes("tariff rate quota")?"trq":K.includes("section 201")?"sec201":K.includes("countervailing duty")||/\bCVD\b/i.test(Q)?"cvd":K.includes("general tariffs")?"general":K.includes("antidumping")||/\bAD\b/i.test(Q)?"ad":"other"};for(const W of _e){const Q=String((W==null?void 0:W.abstract)||""),K=G(Q),we=ze.get(K)||[];we.push(W),ze.set(K,we);const X=Array.isArray(W==null?void 0:W.agencies)?W.agencies:[];if(X.length)for(const xe of X){const $e=String((xe==null?void 0:xe.slug)||(xe==null?void 0:xe.name)||(xe==null?void 0:xe.raw_name)||"").toLowerCase()||"(unknown)";Ee.has($e)||Ee.set($e,{slug:(xe==null?void 0:xe.slug)||$e,name:(xe==null?void 0:xe.name)||(xe==null?void 0:xe.raw_name)||$e,documents:[],subgroups:new Map});const Ae=Ee.get($e);Ae.documents.push(W);const ct=Ae.subgroups.get(K)||[];ct.push(W),Ae.subgroups.set(K,ct)}else{const xe="(unclassified)";Ee.has(xe)||Ee.set(xe,{slug:xe,name:"Unclassified",documents:[],subgroups:new Map});const $e=Ee.get(xe);$e.documents.push(W);const Ae=$e.subgroups.get(K)||[];Ae.push(W),$e.subgroups.set(K,Ae)}}const Ce=Array.from(Ee.values()).map(W=>{const Q=Array.from(W.subgroups.entries()).map(([K,we])=>({tag:K,label:et[K]||K,count:we.length,documents:we}));return Q.sort((K,we)=>Fe.indexOf(K.tag)-Fe.indexOf(we.tag)||we.count-K.count),{slug:W.slug,name:W.name,count:W.documents.length,documents:W.documents,subgroups:Q}}).sort((W,Q)=>Q.count-W.count||W.name.localeCompare(Q.name));k.fr_agencies={groups:Ce};const pe=Array.from(ze.entries()).map(([W,Q])=>({tag:W,label:et[W]||W,count:Q.length,documents:Q})).filter(W=>(W.count||0)>0).sort((W,Q)=>Fe.indexOf(W.tag)-Fe.indexOf(Q.tag)||Q.count-W.count);k.fr_subgroups={total:_e.length,all:_e,subgroups:pe}}catch(le){console.error("Failed to load Federal Register documents",le)}F($??null)}catch(U){const ne=(U==null?void 0:U.message)||d("fr.htsCard.detailLoadFailed");k.get_hts_details||(k.get_hts_details={error:ne}),j(ne),o(ne,"error"),F(c??null)}finally{v(!1)}}},B=i.useMemo(()=>c?{...t,...c}:t,[t,c]),M=i.useMemo(()=>{var F,U,ne;const q=[],I=B;(F=I.extra_duties)!=null&&F.s232_steel&&q.push({label:"Sec 232 Steel",severity:"high",title:"Section 232 tariffs on steel might apply."}),(U=I.extra_duties)!=null&&U.s232_aluminum&&q.push({label:"Sec 232 Aluminum",severity:"high",title:"Section 232 tariffs on aluminum might apply."}),(ne=I.extra_duties)!=null&&ne.s301&&q.push({label:"Sec 301",severity:"high",title:"Section 301 tariffs on goods from China might apply."});const k=new Set;return(I.investigations||[]).forEach(ge=>{(ge.types||[ge.type]).filter(Boolean).forEach($=>k.add($))}),k.forEach(ge=>q.push({label:ge,severity:"medium",title:`This HTS code is subject to ${ge} investigations.`})),q},[B]);return i.useMemo(()=>{var I;const q=B.programs;if(Array.isArray(q)&&q.length>0){const k=q[0].rate_text||"Free",F=q.map(U=>U.code).join(", ");return`${k} (${F})`}return((I=B.raw)==null?void 0:I.special)||B.special},[B]),e.jsxs("div",{className:"border rounded-lg p-4 my-2 bg-card text-card-foreground shadow-sm",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-grow",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx("p",{className:"font-mono text-lg tracking-wider",children:e.jsxs("a",{className:"text-primary hover:text-primary/80 hover:underline",href:`https://hts.usitc.gov/search?query=${encodeURIComponent(t.htsno)}`,onClick:P,title:d("fr.htsCard.htsLinkHint",{code:t.htsno}),children:[t.htsno,t.statisticalSuffix&&e.jsxs("span",{className:"text-muted-foreground",children:[".",t.statisticalSuffix]})]})}),M.map(q=>e.jsx(ht,{variant:q.severity==="high"?"destructive":"secondary",children:q.label},q.label))]}),e.jsx("div",{className:"text-foreground mt-2 text-base space-y-2",children:R?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx(ht,{variant:"outline",className:"mr-2 mt-1 flex-shrink-0",children:"HTS.gov"}),e.jsx("span",{children:y(g)})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx(ht,{variant:"outline",className:"mr-2 mt-1 flex-shrink-0",children:"DataWeb"}),e.jsx("span",{children:y(b)})]})]}):y(g)})]}),e.jsx(ee,{variant:"ghost",size:"sm",onClick:z,children:d(T?"fr.htsCard.hideDocDetail":"fr.htsCard.showDocDetail")})]}),e.jsx(Zc,{item:t,detailedData:c}),e.jsx("div",{className:"mt-4 pt-4 border-t border-dashed border-border",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-muted-foreground mb-1",children:d("fr.htsCard.rateLabelGeneral")}),e.jsx("p",{className:"text-foreground font-semibold text-base",children:t.general||"—"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-muted-foreground mb-1",children:d("fr.htsCard.rateLabelSpecial")}),e.jsx("p",{className:"text-foreground font-semibold text-base",children:t.special||"—"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-muted-foreground mb-1",children:d("fr.htsCard.rateLabelOther")}),e.jsx("p",{className:"text-foreground font-semibold text-base",children:t.other||t.col2||"—"})]})]})}),t.footnotes&&t.footnotes.length>0&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-dashed border-border",children:[e.jsx("p",{className:"font-medium text-muted-foreground text-base mb-2",children:d("fr.htsCard.footnoteHeading")}),t.footnotes.map((q,I)=>{var U,ne,ge;const k=((U=q.value)==null?void 0:U.includes("232"))||((ne=q.value)==null?void 0:ne.includes("9903.")),F=((ge=q.value)==null?void 0:ge.match(/99\d{2}\.\d{2}\.\d{2}/g))||[];return e.jsx("div",{className:"footnote-container relative mt-2",children:e.jsxs("div",{className:`text-sm ${k?"text-destructive":"text-muted-foreground"}`,children:[e.jsxs("span",{className:"font-semibold",children:[q.columns.join(", "),":"]}),k&&" ・ ",q.value.split(/(99\d{2}\.\d{2}\.\d{2})/g).map(($,le)=>F.includes($)?e.jsxs($a,{children:[e.jsx(Ha,{asChild:!0,children:e.jsx("button",{className:"text-primary hover:text-primary/80 font-semibold hover:underline p-0 h-auto bg-transparent border-none",onClick:_e=>_e.preventDefault(),children:$})}),e.jsx(va,{children:e.jsx(Wc,{htsCode:$})})]},`fn-${I}-match-${le}-${$}`):e.jsx(H.Fragment,{children:$},`fn-${I}-text-${le}`))]})},I)})]}),T&&(p?e.jsx("div",{className:"mt-4 pt-4 border-t border-dashed border-border",children:e.jsx(wt,{className:"h-5 w-1/2"})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-3 text-xs text-muted-foreground space-y-1",children:[e.jsxs("div",{children:[d("fr.htsCard.indent"),": ",t.indent||"0"]}),((A=t.units)==null?void 0:A.length)>0&&e.jsxs("div",{children:[d("fr.htsCard.units"),": ",t.units.join(", ")]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-dashed border-border",children:_?e.jsx("div",{className:"text-destructive text-sm",children:_}):((V=B.staged_rates)==null?void 0:V.length)>0&&e.jsxs("div",{className:"mt-4 pt-4 border-t",children:[e.jsx("h4",{className:"text-base font-semibold text-foreground mb-3",children:d("fr.htsCard.otherCompliance")}),B.staged_rates&&B.staged_rates.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("p",{className:"font-medium text-muted-foreground",children:[d("fr.htsCard.stagedRates"),":"]}),e.jsx("ul",{className:"list-disc pl-5 mt-1 text-muted-foreground",children:B.staged_rates.map((q,I)=>e.jsxs("li",{children:[q.year,": ",q.rate_text]},I))})]})]})})]})),T&&f&&e.jsx("div",{className:"mt-4 pt-4 border-t",children:e.jsx(bt,{title:"API Raw Responses (Debug Mode)",data:f})}),T&&e.jsx(Xc,{rawData:f})]})},ed=ja("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),Te=i.forwardRef(({className:t,...s},a)=>e.jsx(En,{ref:a,className:J(ed(),t),...s}));Te.displayName=En.displayName;const pa=i.forwardRef(({className:t,...s},a)=>e.jsx(On,{className:J("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",t),...s,ref:a,children:e.jsx(ql,{className:J("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));pa.displayName=On.displayName;const td=ja("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),Rs=i.forwardRef(({className:t,variant:s,...a},r)=>e.jsx("div",{ref:r,role:"alert",className:J(td({variant:s}),t),...a}));Rs.displayName="Alert";const ua=i.forwardRef(({className:t,...s},a)=>e.jsx("h5",{ref:a,className:J("mb-1 font-medium leading-none tracking-tight",t),...s}));ua.displayName="AlertTitle";const Is=i.forwardRef(({className:t,...s},a)=>e.jsx("div",{ref:a,className:J("text-sm [&_p]:leading-relaxed",t),...s}));Is.displayName="AlertDescription";const qi=async(t,s)=>{const a=new URLSearchParams;a.set("year",t),a.set("search_term",s);const{data:r}=await rs(`/api/baseline-adapter?${a.toString()}`);return r},sd=({year:t,searchTerm:s,enabled:a=!0})=>Ft({queryKey:["baseline-adapter",t,s],enabled:!!(t&&s)&&a,staleTime:5*60*1e3,queryFn:()=>qi(t,s)}),ad=(t,s=!0)=>Ft({queryKey:["hts-dataset",t],enabled:!!t&&s,staleTime:1/0,queryFn:async()=>{const{data:a}=await rs(`/assets/data/${t}`);return a}}),Ra=t=>{const s=t.match(/(\d+)/);return s?`Chapter ${parseInt(s[1],10)}`:t.trim()},Vr=({node:t,allItems:s,searchTerm:a})=>{const n=a.trim().length>0,o=!n,d=o?Number(t.indent)<1:Number(t.indent)<2,[c,u]=i.useState(d);if(i.useEffect(()=>{u(n?!0:o?Number(t.indent)<1:Number(t.indent)<2)},[n,o,t.indent]),t.children&&t.children.length>0){const p=_=>{_.target.closest("button, a, input, textarea, select")||u(f=>!f)},v=_=>{(_.key==="Enter"||_.key===" ")&&(_.preventDefault(),p(_))};return e.jsxs($r,{open:c,onOpenChange:u,className:"w-full",children:[e.jsxs("div",{className:`flex items-start gap-3 rounded-lg border border-border/60 bg-card/60 px-3 py-2 cursor-pointer ${n?"border-l-4 border-l-sky-500 bg-sky-500/10 shadow-md":""}`,role:"button",tabIndex:0,onClick:p,onKeyDown:v,children:[e.jsx("div",{className:"flex-grow min-w-0",children:e.jsx(sn,{item:t,allItems:s,searchTerm:a})}),e.jsx("button",{type:"button",className:"flex-shrink-0 w-9 h-9 mt-4 flex items-center justify-center rounded-md hover:bg-accent text-muted-foreground",onClick:_=>{_.stopPropagation(),u(j=>!j)},children:e.jsx(ir,{className:`h-5 w-5 transition-transform duration-200 ${c?"rotate-90":""}`})})]}),e.jsx(Hr,{className:"relative border-l-2 border-border ml-5 pl-2 mt-2 space-y-2",children:t.children.map(_=>e.jsx(Vr,{node:_,allItems:s,searchTerm:a},_.htsno))})]})}return e.jsx("div",{className:`flex items-start pl-9 rounded-lg ${n?"border-l-4 border-l-sky-500 bg-sky-500/10 shadow-md":""}`,children:e.jsx("div",{className:"flex-grow min-w-0",children:e.jsx(sn,{item:t,allItems:s,searchTerm:a})})})},zi=({items:t,searchTerm:s})=>{const a=i.useMemo(()=>{if(!t||t.length===0)return[];const r=[],n=[{children:r,indent:-1}];for(const o of t){const d={...o,children:[]},c=Number(d.indent)||0;for(;Number(n[n.length-1].indent)>=c;)n.pop();n[n.length-1].children.push(d),n.push(d)}return r},[t]);return e.jsx("div",{className:"space-y-2",children:a.map(r=>e.jsx(Vr,{node:r,allItems:t,searchTerm:s},r.htsno))})},rd=({chapters:t,searchTerm:s})=>{const a=Object.keys(t).sort((n,o)=>{const d=parseInt(n.replace(/\D/g,""),10)||0,c=parseInt(o.replace(/\D/g,""),10)||0;return d-c}),r=s?a:[];return e.jsx(zs,{type:"multiple",className:"w-full space-y-2",defaultValue:r,children:a.map(n=>{const o=t[n];return e.jsxs(ws,{value:n,className:"border rounded-lg bg-card",children:[e.jsxs(Ts,{className:"px-4 py-3 text-lg font-semibold hover:no-underline",children:[n," (",o.length," items)"]}),e.jsx(Ss,{className:"px-4 pt-2 pb-4 border-t",children:e.jsx(zi,{items:o,searchTerm:s})})]},n)})})},yr=({items:t=[]})=>e.jsx("div",{className:"grid gap-2",children:t.map(s=>{const a=e.jsxs("div",{className:"flex items-start justify-between rounded-lg border bg-background px-4 py-3 transition hover:bg-accent/50",children:[e.jsxs("div",{className:"text-left space-y-1",children:[e.jsx("div",{className:"font-medium leading-tight text-foreground",children:s.label}),s.description&&e.jsx("p",{className:"text-sm text-muted-foreground leading-snug",children:s.description})]}),e.jsx(Oa,{className:"h-4 w-4 text-muted-foreground"})]});return s.url?e.jsx("a",{href:s.url,target:"_blank",rel:"noreferrer",className:"block",children:a},s.label):e.jsx("div",{className:"block",children:a},s.label)})}),an=({structure:t,chapterData:s,searchTerm:a})=>{const{t:r}=Ge(),n=i.useMemo(()=>{if(!s)return{};const p={};return Object.keys(s).forEach(v=>{p[Ra(v)]=s[v]}),p},[s]),o=t.tariff_sections||[],d=a.trim(),c=d.length>0,u=[];return e.jsx("div",{className:"space-y-3",children:e.jsxs(zs,{type:"multiple",className:"space-y-3",defaultValue:c?["sections"]:[],children:[e.jsxs(ws,{value:"intro",className:"rounded-xl border bg-muted/40 shadow-sm",children:[e.jsx(Ts,{className:"px-4 py-3 text-left hover:no-underline flex items-center justify-between gap-4",children:e.jsxs("div",{className:"flex flex-col text-left",children:[e.jsx("span",{className:"text-xs font-semibold uppercase tracking-wide text-primary",children:r("htsStructure.introduction")}),e.jsx("span",{className:"text-base md:text-lg font-semibold text-foreground",children:t.about_hts.title}),t.about_hts.description&&e.jsx("span",{className:"text-sm text-muted-foreground leading-snug",children:t.about_hts.description})]})}),e.jsx(Ss,{className:"px-4 pb-4",children:e.jsx(yr,{items:t.about_hts.items})})]}),e.jsxs(ws,{value:"notes",className:"rounded-xl border bg-muted/40 shadow-sm",children:[e.jsx(Ts,{className:"px-4 py-3 text-left hover:no-underline flex items-center justify-between gap-4",children:e.jsxs("div",{className:"flex flex-col text-left",children:[e.jsx("span",{className:"text-xs font-semibold uppercase tracking-wide text-primary",children:r("htsStructure.generalNotes")}),e.jsx("span",{className:"text-base md:text-lg font-semibold text-foreground",children:t.general_notes.title}),t.general_notes.description&&e.jsx("span",{className:"text-sm text-muted-foreground leading-snug",children:t.general_notes.description})]})}),e.jsx(Ss,{className:"px-4 pb-4",children:e.jsx(yr,{items:t.general_notes.items})})]}),e.jsxs(ws,{value:"sections",className:"rounded-xl border bg-muted/40 shadow-sm",children:[e.jsx(Ts,{className:"px-4 py-3 text-left hover:no-underline flex items-center justify-between gap-4",children:e.jsxs("div",{className:"flex flex-col text-left",children:[e.jsx("span",{className:"text-xs font-semibold uppercase tracking-wide text-primary",children:r("htsStructure.tariffSchedule")}),e.jsx("span",{className:"text-base md:text-lg font-semibold text-foreground",children:r("htsStructure.sectionsChapters")}),s&&e.jsx("span",{className:"text-xs text-muted-foreground",children:r(c?"htsStructure.searchMatched":"htsStructure.localLoaded")})]})}),e.jsx(Ss,{className:"px-4 pb-4",children:e.jsx(zs,{type:"multiple",className:"space-y-2",defaultValue:u,children:o.map(p=>{const v=s?p.chapters.filter(j=>n[Ra(j.label)]):p.chapters;if(s&&v.length===0)return null;const _=[];return e.jsxs(ws,{value:p.section_label,className:"border rounded-lg bg-card",children:[e.jsx(Ts,{className:"px-4 py-3 text-left hover:no-underline flex items-start justify-between gap-4",children:e.jsxs("div",{className:"flex flex-col text-left max-w-3xl",children:[e.jsx("span",{className:"text-xs font-semibold uppercase tracking-wide text-muted-foreground",children:p.section_label}),e.jsx("span",{className:"text-base font-semibold text-foreground",children:p.section_title}),p.section_range&&e.jsx("span",{className:"text-sm text-muted-foreground",children:p.section_range})]})}),e.jsx(Ss,{className:"px-4 pb-3",children:e.jsx(zs,{type:"multiple",className:"space-y-2",defaultValue:c?v.map(j=>Ra(j.label)):_,children:v.map(j=>{const f=Ra(j.label),x=n[f],T=!!(x&&x.length>0);return e.jsxs(ws,{value:f,className:"border rounded-md bg-muted/30",children:[e.jsx(Ts,{className:"px-3 py-2 text-left hover:no-underline flex items-start justify-between gap-3",children:e.jsxs("div",{className:"flex flex-col text-left max-w-2xl",children:[e.jsx("span",{className:"font-medium leading-tight text-foreground",children:j.label}),j.description&&e.jsx("span",{className:"text-sm text-muted-foreground",children:j.description}),T&&e.jsxs("span",{className:"text-xs text-primary",children:[(x==null?void 0:x.length)??0," 條目"]})]})}),e.jsx(Ss,{className:"px-3 pb-3 space-y-2",children:T?e.jsx(zi,{items:x,searchTerm:a}):e.jsxs("div",{className:"flex items-center justify-between rounded-md border bg-background px-3 py-2 text-sm text-muted-foreground",children:[e.jsx("span",{children:j.description||"尚未載入章節內容"}),j.url&&e.jsx("a",{href:j.url,target:"_blank",rel:"noreferrer",className:"text-primary hover:underline text-xs",children:"查看來源"})]})})]},f)})},`chapters-${c?d:"browse"}-${p.section_label}`)})]},p.section_label)})},`sections-${c?d:"browse"}`)})]}),e.jsxs(ws,{value:"appendices",className:"rounded-xl border bg-muted/40 shadow-sm",children:[e.jsx(Ts,{className:"px-4 py-3 text-left hover:no-underline flex items-center justify-between gap-4",children:e.jsxs("div",{className:"flex flex-col text-left",children:[e.jsx("span",{className:"text-xs font-semibold uppercase tracking-wide text-primary",children:r("htsStructure.appendices")}),e.jsx("span",{className:"text-base md:text-lg font-semibold text-foreground",children:t.appendices.title}),t.appendices.description&&e.jsx("span",{className:"text-sm text-muted-foreground leading-snug",children:t.appendices.description})]})}),e.jsx(Ss,{className:"px-4 pb-4",children:e.jsx(yr,{items:t.appendices.items})})]})]},`structure-${c?d:"browse"}`)})},nd=()=>{const{t,i18n:s}=Ge(),{htsSearchTerm:a}=ra(),{addNotification:r}=Ma(),[n,o]=i.useState(a),[d,c]=i.useState(!1),[u,p]=i.useState([]),[v,_]=i.useState(null),j=sd({year:(v==null?void 0:v.year)??"",searchTerm:(v==null?void 0:v.searchTerm)??"",enabled:!!v}),[f,x]=i.useState(!1),[T,w]=i.useState(!1),[S,y]=i.useState(null),[g,b]=i.useState(null),[R,P]=i.useState(null),[z,B]=i.useState(null),[M,A]=i.useState(null),[V,q]=i.useState(null),I=ad((V==null?void 0:V.fileName)??"",!!V),[k,F]=i.useState(!1),[U,ne]=i.useState(null),[ge,$]=i.useState(!1),[le,_e]=i.useState(null);i.useEffect(()=>{try{const W=sessionStorage.getItem("htsdb_state");if(W){const Q=JSON.parse(W);typeof(Q==null?void 0:Q.term)=="string"&&!f&&o(Q.term),Array.isArray(Q==null?void 0:Q.results)&&p(Q.results)}}catch{}},[f]),i.useEffect(()=>{try{if(!f){const W={term:n,results:u};sessionStorage.setItem("htsdb_state",JSON.stringify(W))}}catch{}},[n,u,f]),i.useEffect(()=>{(async()=>{$(!0),_e(null);try{const Q=(s.language||"").toLowerCase(),we=Q.startsWith("zh")&&(Q.includes("tw")||Q.includes("hant"))?"/assets/data/HTSUSstructure_zhtw.json":"/assets/data/HTSUSstructure.json",X=await fetch(we);if(!X.ok)throw new Error(`無法載入 HTSUS 結構檔案: ${we}`);const xe=await X.json();ne(xe)}catch(Q){const K=(Q==null?void 0:Q.message)??"structure load error";_e(K),r(K,"error")}finally{$(!1)}})()},[r,s.language]),i.useEffect(()=>{a&&u.length===0&&!f&&(o(a),et(a))},[a,f]);const Ee=H.useCallback(async W=>{const K=W.name.match(/^(\d{4})HTSRev(\d+)$/);if(!K){b(t("fr.hts.versionFormatError"));return}const we=parseInt(K[1],10);let X=parseInt(K[2],10);w(!0),F(!1);for(let xe=0;xe<10&&(X--,!(X<=0));xe++){const $e=`${we}HTSRev${X}.json`,Ae=`/assets/data/${$e}`;try{if((await fetch(Ae,{method:"HEAD"})).ok){A($e),F(!0),w(!1);return}}catch{}}w(!1),b(t("fr.hts.versionFallbackFailed",{desc:W.description}))},[t]),Fe=i.useCallback((W,Q,K)=>{w(!0),b(null),F(!1),A(null),q({fileName:W,isFallback:Q,info:K})},[]);i.useEffect(()=>{if(!f){y(null),P(null),b(null),F(!1),A(null),B(null);return}(async()=>{w(!0);try{const Q=await fetch("/.netlify/functions/get-hts-current-release");if(!Q.ok)throw new Error("??????????");const K=await Q.json();B(K);const we=`${K.name}.json`;await Fe(we,!1,K)}catch(Q){r(t("fr.hts.versionLoadFailed",{message:Q.message}),"error"),b(t("fr.hts.versionLoadFailed",{message:Q.message})),w(!1)}})()},[f,r]),i.useEffect(()=>{if(!f||!S)return;const W=n.toLowerCase();if(!W){P(S);return}const Q={};for(const K in S){const we=S[K],X=new Set;if(we.forEach((Ae,ct)=>{(Ae.description.toLowerCase().includes(W)||Ae.htsno.toLowerCase().includes(W))&&X.add(ct)}),X.size===0)continue;const xe=new Set(X);X.forEach(Ae=>{let Tt=Number(we[Ae].indent);for(let Z=Ae-1;Z>=0;Z--){const fe=Number(we[Z].indent);if(fe<Tt&&(xe.add(Z),Tt=fe,Tt===0))break}});const $e=we.filter((Ae,ct)=>xe.has(ct));$e.length>0&&(Q[K]=$e)}P(Q)},[n,S,f]);const et=W=>{const Q=(W??n).trim();if(!Q){p([]);return}c(!0),_({year:new Date().getFullYear().toString(),searchTerm:Q})};i.useEffect(()=>{if(j.error){const we=j.error instanceof Error?j.error.message:String(j.error);r(t("fr.hts.advancedSearchFailed",{message:we}),"error"),p([]),c(!1);return}const W=j.data;if(!W)return;const K=(Array.isArray(W==null?void 0:W.results)?W.results:[]).map(we=>({htsno:we.htsno||"",description:we.description||"",indent:we.indent||"0",general:we.general||"",special:we.special||"",other:we.other||we.col2||"",statisticalSuffix:we.statisticalSuffix||"",units:we.units||[],footnotes:we.footnotes||[],extra_duties:we.extra_duties||void 0,investigations:we.investigations||[]}));p(K),c(!1)},[j.data,j.error]);const ze=()=>{f||et()},G=()=>{M&&Fe(M,!0,z)};H.useEffect(()=>{if(!V)return;if(I.error){const K=I.error instanceof Error?I.error.message:String(I.error);r(`file load error${K}`,"error"),b(t("fr.hts.fileLoadError",{message:K})),!V.isFallback&&V.info?Ee(V.info):w(!1);return}if(!I.data)return;const W=Array.isArray(I.data)?I.data:[],Q={};for(const K of W){if(!K.htsno||K.htsno.length<2)continue;const we=K.htsno.substring(0,2),X=Ra(`Chapter ${parseInt(we,10)}`);Q[X]||(Q[X]=[]),Q[X].push(K)}y(Q),P(Q),V.isFallback&&V.info&&b(t("fr.hts.fileLoadFallback",{name:V.fileName.replace(".json",""),desc:V.info.description})),w(!1)},[V,I.data,I.error]);const Ce=i.useMemo(()=>{if(!u||u.length===0)return[];const W=[],Q=[{children:W,indent:-1}];for(const K of u){const we={...K,children:[]},X=Number(we.indent)||0;for(;Number(Q[Q.length-1].indent)>=X;)Q.pop();Q[Q.length-1].children.push(we),Q.push(we)}return W},[u]),pe=!f&&!n&&!d&&u.length===0;return e.jsxs("div",{className:"p-4 lg:p-6",children:[e.jsx(Ne,{className:"mb-8 sticky top-4 z-10 bg-background/95 backdrop-blur-sm",children:e.jsx(Be,{className:"p-4 md:p-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 md:items-center",children:[e.jsx(Te,{htmlFor:"hts-database-search",className:"sr-only",children:t("fr.hts.searchLabel")}),e.jsxs("div",{className:"relative flex-grow",children:[e.jsx(Hs,{className:"w-5 h-5 text-muted-foreground absolute top-1/2 left-4 transform -translate-y-1/2"}),e.jsx(He,{type:"text",id:"hts-database-search",placeholder:t(f?"fr.hts.placeholderFull":"fr.hts.placeholderApi"),className:"w-full h-12 p-4 pl-12 rounded-xl",value:n,onChange:W=>o(W.target.value),onKeyDown:W=>W.key==="Enter"&&!d&&ze()})]}),!f&&e.jsx(ee,{onClick:ze,disabled:d,size:"lg",className:"h-12",children:t(d?"fr.hts.searching":"fr.hts.search")}),e.jsxs("div",{className:"flex items-center space-x-2 pt-2 md:pt-0 flex-shrink-0",children:[e.jsx(pa,{id:"full-table-switch",checked:f,onCheckedChange:W=>{x(W),o("")}}),e.jsx(Te,{htmlFor:"full-table-switch",children:t("fr.hts.toggleFull")})]})]})})}),e.jsxs("main",{className:"space-y-6",children:[f&&e.jsxs(e.Fragment,{children:[T&&e.jsx("div",{className:"space-y-4",children:[...Array(5)].map((W,Q)=>e.jsx(wt,{className:"h-12 w-full rounded-lg"},Q))}),k&&M&&z&&e.jsxs(Rs,{variant:"destructive",children:[e.jsx(aa,{className:"h-4 w-4"}),e.jsx(ua,{children:t("fr.hts.warningTitle")}),e.jsx(Is,{children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("span",{children:t("fr.hts.fallbackDesc1",{desc:z.description})}),e.jsx("span",{children:t("fr.hts.fallbackDesc2",{name:M.replace(".json","")})}),e.jsx("div",{className:"mt-2",children:e.jsx(ee,{onClick:G,size:"sm",children:t("fr.hts.fallbackConfirm")})})]})})]}),!k&&g&&e.jsxs(Rs,{variant:"destructive",children:[e.jsx(aa,{className:"h-4 w-4"}),e.jsx(ua,{children:t("fr.hts.warningTitle")}),e.jsx(Is,{children:g})]}),ge&&!R&&e.jsx("div",{className:"space-y-3",children:[...Array(4)].map((W,Q)=>e.jsx(wt,{className:"h-10 w-full rounded-lg"},Q))}),U&&e.jsx(an,{structure:U,chapterData:R,searchTerm:n}),!U&&R&&e.jsx(rd,{chapters:R,searchTerm:n})]}),!f&&e.jsxs(e.Fragment,{children:[d&&e.jsx("div",{className:"space-y-4",children:[...Array(3)].map((W,Q)=>e.jsxs(Ne,{className:"p-4 space-y-3",children:[e.jsx(wt,{className:"h-6 w-3/4"}),e.jsx(wt,{className:"h-4 w-full"}),e.jsx(wt,{className:"h-4 w-5/6"})]},Q))}),pe&&e.jsxs("div",{className:"space-y-4",children:[ge&&e.jsx("div",{className:"space-y-3",children:[...Array(4)].map((W,Q)=>e.jsx(wt,{className:"h-10 w-full rounded-lg"},Q))}),!ge&&U&&e.jsx(an,{structure:U,searchTerm:n}),!ge&&!U&&e.jsx("div",{className:"py-16",children:e.jsx(As,{icon:e.jsx(_r,{className:"h-16 w-16"}),title:t("fr.hts.emptyTitle"),description:le||t("fr.hts.emptyDesc")})})]}),!d&&u.length===0&&!pe&&e.jsx("div",{className:"py-16",children:e.jsx(As,{icon:e.jsx(_r,{className:"h-16 w-16"}),title:t("fr.hts.emptyTitle"),description:t("fr.hts.emptyDesc")})}),Ce.map(W=>e.jsx(Vr,{node:W,allItems:u,searchTerm:n},W.htsno))]})]})]})},Qi=i.createContext(void 0),id=({children:t})=>{const[s,a]=i.useState([]),[r,n]=i.useState([]),[o,d]=i.useState({years:5,ytd:!0}),[c,u]=i.useState("cons"),[p,v]=i.useState(["quantity"]),[_,j]=i.useState({enabled:!1,topN:5,year:null}),f=i.useMemo(()=>({hts:s,setHts:a,countryCodes:r,setCountryCodes:n,period:o,setPeriod:d,flow:c,setFlow:u,metrics:p,setMetrics:v,breakout:_,setBreakout:j}),[s,r,o,c,p,_]);return e.jsx(Qi.Provider,{value:f,children:t})},Yi=()=>{const t=i.useContext(Qi);if(t===void 0)throw new Error("useMarketTrends must be used within a MarketTrendsProvider");return t},ld=[{id:"usitc_hts",label:"USITC · HTSUS",home:"https://hts.usitc.gov/",buildDirect:t=>`https://hts.usitc.gov/?query=${encodeURIComponent(t)}`,buildSite:t=>`https://www.google.com/search?q=${encodeURIComponent(`site:hts.usitc.gov ${t}`)}`},{id:"bis_232",label:"BIS · Section 232",home:"https://www.bis.gov/",buildSite:t=>{const a=`(site:bis.gov OR site:bis.doc.gov) ("Section 232" OR Proclamation OR Inclusions OR Exclusions) ${(t||"").trim()}`.trim();return`https://www.google.com/search?q=${encodeURIComponent(a)}`}},{id:"federal_register",label:"Federal Register",home:"https://www.federalregister.gov/",buildDirect:t=>`https://www.federalregister.gov/documents/search?conditions%5Bterm%5D=${encodeURIComponent(t)}%20Section%20232`},{id:"regulations",label:"Regulations.gov (dockets)",home:"https://www.regulations.gov/",buildDirect:t=>`https://www.regulations.gov/search?filter=${encodeURIComponent(t+" Section 232")}`},{id:"quantgov",label:"QuantGov · Tariff Explorer",home:"https://www.quantgov.org/",buildDirect:()=>"https://www.quantgov.org/tariffs"}],od=[{id:"hts_api",label:"USITC HTS REST API",docs:"https://hts.usitc.gov/",build:t=>[{name:"search",url:`https://hts.usitc.gov/reststop/search?keyword=${encodeURIComponent(t||"copper")}`},{name:"exportList (JSON)",url:"https://hts.usitc.gov/reststop/exportList?from=0100&to=0200&format=JSON&styles=false"}]},{id:"fr_api",label:"Federal Register API",docs:"https://www.federalregister.gov/developers/api/v1",build:t=>[{name:"documents.json",url:`https://www.federalregister.gov/api/v1/documents.json?conditions%5Bterm%5D=${encodeURIComponent(t||"Section 232")}`}]},{id:"regs_api",label:"Regulations.gov v4",docs:"https://open.gsa.gov/api/regulationsgov/",build:t=>[{name:"documents (BIS, Section 232)",url:`https://api.regulations.gov/v4/documents?filter%5BsearchTerm%5D=${encodeURIComponent(t||"Section 232")}&filter%5Bagency%5D=BIS&page%5Bsize%5D=250`}]},{id:"dataweb",label:"USITC DataWeb API",docs:"https://dataweb.usitc.gov/",build:()=>[{name:"DataWeb Portal",url:"https://dataweb.usitc.gov/"}]}];function cd({src:t,keyword:s}){const a=t.buildDirect?t.buildDirect(s):null,r=t.buildSite?t.buildSite(s):null;return e.jsxs(Ne,{children:[e.jsx(ot,{children:e.jsx(pt,{className:"text-base",children:t.label})}),e.jsxs(Be,{className:"flex flex-wrap gap-2",children:[e.jsx(ee,{variant:"outline",size:"sm",asChild:!0,children:e.jsxs("a",{href:t.home,target:"_blank",rel:"noreferrer",children:["官方首頁 ",e.jsx(ea,{className:"w-3 h-3 ml-1.5"})]})}),a&&e.jsx(ee,{variant:"outline",size:"sm",asChild:!0,children:e.jsxs("a",{href:a,target:"_blank",rel:"noreferrer",children:["站內搜尋 ",e.jsx(ea,{className:"w-3 h-3 ml-1.5"})]})}),r&&e.jsx(ee,{variant:"outline",size:"sm",asChild:!0,children:e.jsxs("a",{href:r,target:"_blank",rel:"noreferrer",children:["Google site: ",e.jsx(ea,{className:"w-3 h-3 ml-1.5"})]})})]})]})}function dd(t){const s=encodeURIComponent,a=`(site:bis.gov OR site:bis.doc.gov) ("Section 232" OR Proclamation OR Inclusions OR Exclusions) ${t}`.trim();return[{group:"官方來源",items:[{label:"USITC HTSUS 站內搜尋",url:`https://hts.usitc.gov/?query=${s(t)}`,hint:"官方 HTS 檢索"},{label:"HTSUS site: 支援",url:`https://www.google.com/search?q=${s(`site:hts.usitc.gov ${t}`)}`,hint:"使用 Google 的 USITC 索引"},{label:"Federal Register 檢索",url:`https://www.federalregister.gov/documents/search?conditions%5Bterm%5D=${s(t+" Section 232")}`,hint:"Proclamations/Annex/規則"},{label:"Regulations.gov 檢索",url:`https://www.regulations.gov/search?filter=${s(t+" Section 232")}`,hint:"Docket 與意見"}]},{group:"CBP 實務",items:[{label:"CBP Trade Remedies（site:）",url:`https://www.google.com/search?q=${s(`site:cbp.gov "Trade Remedies" ${t}`)}`,hint:"措施/適用清單"},{label:"CBP CSMS（site:）",url:`https://www.google.com/search?q=${s(`site:cbp.gov CSMS ${t}`)}`,hint:"CSMS 訊息"}]},{group:"情資彙整/視覺化",items:[{label:"BIS 站內（site:）",url:`https://www.google.com/search?q=${s(a)}`,hint:"BIS 主題 / Inclusions/Exclusions"},{label:"QuantGov（Tariff Explorer）",url:"https://www.quantgov.org/tariffs",hint:"視覺化資料"}]}]}function ud(){const[t,s]=i.useState(""),a=i.useMemo(()=>dd(t.trim()),[t]);return e.jsxs(Ne,{children:[e.jsxs(ot,{children:[e.jsx(pt,{children:"多來源搜尋面板"}),e.jsx($s,{children:"輸入一次關鍵字（HTS 10 碼、產品名稱、國別或 Chapter 99 代碼），系統會產生對應來源連結。"})]}),e.jsxs(Be,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(He,{value:t,onChange:r=>s(r.target.value),placeholder:"例如：ERW steel pipe、9903.81.90、copper tube"}),e.jsx(ee,{variant:"outline",onClick:()=>s(""),children:"清除"})]}),e.jsx("div",{className:"space-y-5",children:a.map(r=>e.jsxs(Ne,{children:[e.jsx(ot,{children:e.jsx(pt,{className:"text-base",children:r.group})}),e.jsx(Be,{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:r.items.map(n=>e.jsxs("a",{href:n.url,target:"_blank",rel:"noreferrer",className:"group rounded-xl border p-4 hover:bg-muted flex flex-col gap-1",children:[e.jsx("div",{className:"font-medium text-sm",children:n.label}),e.jsx("div",{className:"text-xs text-muted-foreground",children:n.hint}),e.jsx("div",{className:"text-[11px] text-muted-foreground/80 break-all opacity-0 group-hover:opacity-100 transition",children:n.url})]},n.label))})]},r.group))})]})]})}function md(){const[t,s]=i.useState("");return e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Section 232 綜合情報工具"}),e.jsxs(ha,{defaultValue:"app1",className:"w-full",children:[e.jsxs(na,{className:"grid w-full grid-cols-4",children:[e.jsx(is,{value:"app1",children:"來源入口"}),e.jsx(is,{value:"app2",children:"多來源搜尋"}),e.jsx(is,{value:"app3",children:"API 端點"}),e.jsx(is,{value:"app5_6",children:"其他資源"})]}),e.jsx(ls,{value:"app1",className:"mt-4",children:e.jsxs(Ne,{children:[e.jsxs(ot,{children:[e.jsx(pt,{children:"來源入口"}),e.jsx($s,{children:"集中列出常用官方來源。可在下方輸入關鍵字，使用「站內搜尋」或「Google site:」。"})]}),e.jsxs(Be,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(He,{value:t,onChange:a=>s(a.target.value),placeholder:"輸入一次關鍵字，供各卡片使用"}),e.jsx(ee,{variant:"outline",onClick:()=>s(""),children:"清除"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:ld.map(a=>e.jsx(cd,{src:a,keyword:t},a.id))})]})]})}),e.jsx(ls,{value:"app2",className:"mt-4",children:e.jsx(ud,{})}),e.jsx(ls,{value:"app3",className:"mt-4",children:e.jsxs(Ne,{children:[e.jsxs(ot,{children:[e.jsx(pt,{children:"API/CSV 端點"}),e.jsx($s,{children:"常用 API 與資料端點清單。部分 URL 會使用「來源入口」分頁的關鍵字。"})]}),e.jsx(Be,{className:"grid grid-cols-1 gap-4",children:od.map(a=>e.jsxs(Ne,{className:"overflow-hidden",children:[e.jsxs(ot,{className:"flex-row items-center gap-2",children:[e.jsx(pt,{className:"text-base flex-grow",children:a.label}),e.jsx(ee,{variant:"outline",size:"sm",asChild:!0,children:e.jsxs("a",{href:a.docs,target:"_blank",rel:"noreferrer",children:["文件/首頁 ",e.jsx(ea,{className:"w-3 h-3 ml-1.5"})]})})]}),e.jsx(Be,{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:a.build((t||"").trim()).map(({name:r,url:n})=>e.jsxs("div",{className:"rounded-lg border p-3 text-sm",children:[e.jsx("div",{className:"font-semibold",children:r}),e.jsx("div",{className:"text-xs text-muted-foreground break-all mt-1",children:n}),e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsx(ee,{variant:"secondary",size:"sm",asChild:!0,children:e.jsx("a",{href:n,target:"_blank",rel:"noreferrer",children:"開啟"})}),e.jsx(ee,{variant:"ghost",size:"sm",onClick:()=>navigator.clipboard.writeText(n),children:"複製"})]})]},r))})]},a.id))})]})}),e.jsx(ls,{value:"app5_6",className:"mt-4",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(Ne,{children:[e.jsxs(ot,{children:[e.jsx(pt,{children:"貿易統計面板（DataWeb）"}),e.jsx($s,{children:"USITC DataWeb 需要帳號與 Token。此處提供入口連結以便後續擴充儀表板。"})]}),e.jsx(Be,{children:e.jsx(ee,{variant:"outline",asChild:!0,children:e.jsxs("a",{href:"https://dataweb.usitc.gov/",target:"_blank",rel:"noreferrer",children:["DataWeb Portal ",e.jsx(ea,{className:"w-3 h-3 ml-1.5"})]})})})]}),e.jsxs(Ne,{children:[e.jsxs(ot,{children:[e.jsx(pt,{children:"重要公告/專區"}),e.jsx($s,{children:"彙整常用公告專區快速入口（可再擴充自動化彙整）。"})]}),e.jsxs(Be,{className:"flex flex-wrap gap-3",children:[e.jsx(ee,{variant:"outline",asChild:!0,children:e.jsx("a",{href:"https://www.bis.doc.gov/index.php/232-steel",target:"_blank",rel:"noreferrer",children:"BIS · 232 鋼"})}),e.jsx(ee,{variant:"outline",asChild:!0,children:e.jsx("a",{href:"https://www.bis.doc.gov/index.php/232-aluminum",target:"_blank",rel:"noreferrer",children:"BIS · 232 鋁"})}),e.jsx(ee,{variant:"outline",asChild:!0,children:e.jsx("a",{href:"https://www.federalregister.gov/",target:"_blank",rel:"noreferrer",children:"Federal Register"})}),e.jsx(ee,{variant:"outline",asChild:!0,children:e.jsx("a",{href:"https://www.cbp.gov/newsroom/csms",target:"_blank",rel:"noreferrer",children:"CBP · CSMS"})})]})]})]})})]})]})}const cr=Yl,hd=Gl,pd=zl,Gi=i.forwardRef(({className:t,...s},a)=>e.jsx(Mn,{ref:a,className:J("fixed inset-0 z-50 bg-background/80 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...s}));Gi.displayName=Mn.displayName;const Ua=i.forwardRef(({className:t,children:s,...a},r)=>e.jsxs(pd,{children:[e.jsx(Gi,{}),e.jsxs($n,{ref:r,className:J("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...a,children:[s,e.jsxs(Ql,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(Lr,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Ua.displayName=$n.displayName;const Ba=({className:t,...s})=>e.jsx("div",{className:J("flex flex-col space-y-1.5 text-center sm:text-left",t),...s});Ba.displayName="DialogHeader";const qr=({className:t,...s})=>e.jsx("div",{className:J("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s});qr.displayName="DialogFooter";const Va=i.forwardRef(({className:t,...s},a)=>e.jsx(Hn,{ref:a,className:J("text-lg font-semibold leading-none tracking-tight",t),...s}));Va.displayName=Hn.displayName;const dr=i.forwardRef(({className:t,...s},a)=>e.jsx(Un,{ref:a,className:J("text-sm text-muted-foreground",t),...s}));dr.displayName=Un.displayName;const fd=({item:t})=>{const{searchHtsCode:s}=ra(),a=()=>{switch(t.type){case"search":return e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-semibold",children:"搜尋:"}),e.jsx(ht,{variant:"secondary",className:"ml-2 font-mono",children:t.term})]});case"view_hts":return e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-semibold",children:"查看:"}),e.jsxs("div",{className:"mt-1",children:[e.jsx("p",{className:"font-mono text-primary cursor-pointer hover:underline hover:text-primary/80",onClick:()=>s(t.hts),children:t.hts}),e.jsx("p",{className:"text-muted-foreground text-sm truncate",children:t.description})]})]});default:return null}};return e.jsx("div",{className:"border-b border-border px-4 py-3 last:border-b-0",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[a(),e.jsx("time",{className:"text-xs text-muted-foreground self-start ml-4 flex-shrink-0",children:t.timestamp.toLocaleTimeString()})]})})},xd=()=>{const{trail:t,clearTrail:s}=Mr(),a=()=>{if(t.length===0){alert("研究軌跡是空的，沒有可匯出的內容。");return}const r=`# 研究軌跡報告

產生時間: ${new Date().toLocaleString()}

---

`,n=t.slice().reverse().map(p=>{const v=`\`${p.timestamp.toLocaleTimeString()}\``;return p.type==="search"?`* ${v} **搜尋**: \`${p.term}\``:p.type==="view_hts"?`* ${v} **查看**: \`${p.hts}\` - ${p.description}`:""}).join(`
`),o=r+n,d=new Blob([o],{type:"text/markdown;charset=utf-8"}),c=URL.createObjectURL(d),u=document.createElement("a");u.href=c,u.download=`research-trail-${new Date().toISOString().split("T")[0]}.md`,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(c)};return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"flex-grow overflow-y-auto -mx-4 -my-3",children:t.length===0?e.jsx(As,{icon:e.jsx(Kl,{className:"h-12 w-12"}),title:"尚未有任何研究活動",description:"您的查詢歷史將會顯示在這裡。"}):e.jsx("div",{children:t.map((r,n)=>e.jsx(fd,{item:r},n))})}),e.jsx("div",{className:"pt-4 mt-4 border-t border-border",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ee,{onClick:a,className:"flex-1",children:"匯出 (Markdown)"}),e.jsx(ee,{onClick:s,variant:"secondary",className:"flex-1",children:"清除軌跡"})]})})]})},nr=i.forwardRef(({className:t,...s},a)=>e.jsx("textarea",{className:J("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:a,...s}));nr.displayName="Textarea";const $t=to,Ht=so,Pt=i.forwardRef(({className:t,children:s,...a},r)=>e.jsxs(Bn,{ref:r,className:J("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),...a,children:[s,e.jsx(Wl,{asChild:!0,children:e.jsx(Ea,{className:"h-4 w-4 opacity-50"})})]}));Pt.displayName=Bn.displayName;const Ki=i.forwardRef(({className:t,...s},a)=>e.jsx(Vn,{ref:a,className:J("flex cursor-default items-center justify-center py-1",t),...s,children:e.jsx(Jl,{className:"h-4 w-4"})}));Ki.displayName=Vn.displayName;const Wi=i.forwardRef(({className:t,...s},a)=>e.jsx(qn,{ref:a,className:J("flex cursor-default items-center justify-center py-1",t),...s,children:e.jsx(Ea,{className:"h-4 w-4"})}));Wi.displayName=qn.displayName;const Et=i.forwardRef(({className:t,children:s,position:a="popper",...r},n)=>e.jsx(Xl,{children:e.jsxs(zn,{ref:n,className:J("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:a,...r,children:[e.jsx(Ki,{}),e.jsx(Zl,{className:J("p-1",a==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s}),e.jsx(Wi,{})]})}));Et.displayName=zn.displayName;const gd=i.forwardRef(({className:t,...s},a)=>e.jsx(Qn,{ref:a,className:J("py-1.5 pl-8 pr-2 text-sm font-semibold",t),...s}));gd.displayName=Qn.displayName;const nt=i.forwardRef(({className:t,children:s,...a},r)=>e.jsx(Yn,{ref:r,className:J("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...a,children:e.jsx(eo,{children:s})}));nt.displayName=Yn.displayName;const yd=i.forwardRef(({className:t,...s},a)=>e.jsx(Gn,{ref:a,className:J("-mx-1 my-1 h-px bg-muted",t),...s}));yd.displayName=Gn.displayName;function bd(){const[t,s]=i.useState("bearer"),[a,r]=i.useState(()=>localStorage.getItem("dataweb_api_key")||""),[n,o]=i.useState(!1),[d,c]=i.useState("/api/v2/tariff/currentTariffLookup"),[u,p]=i.useState("POST"),[v,_]=i.useState(()=>JSON.stringify({searchTerm:"7306.30"},null,2)),[j,f]=i.useState(!1),[x,T]=i.useState(""),[w,S]=i.useState(""),[y,g]=i.useState(null),[b,R]=i.useState(""),P=async()=>{try{const A=`/api/dataweb-proxy?endpoint=${encodeURIComponent("/api/v2/system-alert")}`,V=await fetch(A,{method:"GET"}),q=await V.text(),I=/Site under maintenance/i.test(q)||/<html/i.test(q)&&!q.trim().startsWith("{")&&!q.trim().startsWith("[");V.status===503||I?R("提示：DataWeb 可能正在維護中 (偵測到 503 或 HTML 回應)，POST 請求可能會失敗。"):R("")}catch{}};H.useEffect(()=>{P()},[]);const z=[{name:"1. Tariffs: currentTariffLookup",endpoint:"/api/v2/tariff/currentTariffLookup",method:"POST",body:{searchTerm:"7306.30"}},{name:"1. Tariffs: futureTariffAgreementSingle",endpoint:"/api/v2/tariff/futureTariffAgreementSingle",method:"POST",body:{countryCode:"CA",commodityId:"7306.30"}},{name:"1. Tariffs: currentTariffYear",endpoint:"/api/v2/tariff/currentTariffYear",method:"GET",body:void 0},{name:"1. Tariffs: currentTariffDetails",endpoint:"/api/v2/tariff/currentTariffDetails?year=2024&hts8=73063010",method:"GET",body:void 0},{name:"2. System Alerts: get",endpoint:"/api/v2/system-alert",method:"GET",body:void 0},{name:"3. Saved Queries: getAll",endpoint:"/api/v2/savedQuery/getAllSavedQueries",method:"GET",body:void 0},{name:"4. Run Query: runReport",endpoint:"/api/v2/report2/runReport",method:"POST",body:{savedQueryName:"",savedQueryDesc:"",isOwner:!0,runMonthly:!1,reportOptions:{tradeType:"Import",classificationSystem:"HTS"},searchOptions:{MiscGroup:{districts:{districtsSelectType:"all"},importPrograms:{programsSelectType:"all"},extImportPrograms:{programsSelectType:"all"},provisionCodes:{provisionCodesSelectType:"all"}},commodities:{aggregation:"Aggregate Commodities",codeDisplayFormat:"YES",commodities:["730630"],commoditiesExpanded:[],commoditiesManual:"",commodityGroups:{systemGroups:[],userGroups:[]},commoditySelectType:"list",granularity:"10",groupGranularity:null,searchGranularity:null},componentSettings:{dataToReport:["CONS_FIR_UNIT_QUANT"],scale:"1",timeframeSelectType:"fullYears",years:["2023","2024"],startDate:null,endDate:null,startMonth:null,endMonth:null,yearsTimeline:"Annual"},countries:{aggregation:"Aggregate Countries",countries:[],countriesExpanded:[{name:"All Countries",value:"all"}],countriesSelectType:"all",countryGroups:{systemGroups:[],userGroups:[]}}},sortingAndDataFormat:{DataSort:{columnOrder:[],fullColumnOrder:[],sortOrder:[]},reportCustomizations:{exportCombineTables:!1,showAllSubtotal:!0,totalRecords:"20000",exportRawData:!1}}}},{name:"5. Query Info: getGlobalVars",endpoint:"/api/v2/query/getGlobalVars",method:"GET",body:void 0},{name:"6. Notifications: getPreferences",endpoint:"/api/v2/notification/notification-preferences",method:"GET",body:void 0},{name:"7. Commodities: validateSearch",endpoint:"/api/v2/commodity/validateCommoditySearch",method:"POST",body:{tradeType:"Import",classificationSystem:"HTS",search:"7306.30"}},{name:"8. Programs: getForHTS",endpoint:"/api/v2/program/programs?hts8=73063010",method:"GET",body:void 0},{name:"9. Districts: getAll",endpoint:"/api/v2/district/getAllDistricts",method:"GET",body:void 0},{name:"10. Countries: getAll",endpoint:"/api/v2/country/getAllCountries",method:"GET",body:void 0}],B=A=>{const V=parseInt(A,10);if(isNaN(V)||V<0||V>=z.length)return;const q=z[V];c(q.endpoint),p(q.method),_(q.body?JSON.stringify(q.body,null,2):"")},M=async()=>{var A;f(!0),T(""),S(""),g(null);try{localStorage.setItem("dataweb_api_key",a);const V=`/api/dataweb-proxy?endpoint=${encodeURIComponent(d)}`,q={"content-type":"application/json"};a.trim()&&(t==="bearer"?q["x-dw-auth"]=`Bearer ${a.trim()}`:q["x-dw-key"]=a.trim());const I={method:u};u==="POST"&&v&&(I.body=v),I.headers=q;const k=await fetch(V,I);T(`${k.status} ${k.statusText}`);const F=await k.text();if(((A=k.headers.get("content-type"))==null?void 0:A.includes("text/html"))||/<html/i.test(F)&&!F.trim().startsWith("{")&&!F.trim().startsWith("["))S(`[偵測到 HTML 回應，可能為 DataWeb 維護頁面]

${F}`);else try{const ne=JSON.parse(F);g(ne),S("")}catch{S(F)}}catch(V){T("ERROR"),S((V==null?void 0:V.message)||String(V))}finally{f(!1)}};return e.jsxs("div",{className:"p-4 space-y-6",children:[e.jsx(Ne,{children:e.jsxs(ot,{children:[e.jsx(pt,{children:"DataWeb API 驗證器"}),e.jsx($s,{children:"手動測試 USITC DataWeb API 端點。"})]})}),b&&e.jsx("div",{className:"text-sm text-warning-foreground bg-warning/10 border border-warning/20 rounded-lg p-3",children:b}),e.jsxs(Ne,{children:[e.jsx(ot,{children:e.jsx(pt,{className:"text-base",children:"連線設定"})}),e.jsx(Be,{className:"space-y-4",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx(Te,{children:"授權類型 + 金鑰"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs($t,{value:t,onValueChange:A=>s(A),children:[e.jsx(Pt,{className:"w-[200px]",children:e.jsx(Ht,{})}),e.jsxs(Et,{children:[e.jsx(nt,{value:"bearer",children:"Authorization: Bearer"}),e.jsx(nt,{value:"x-api-key",children:"X-Api-Key (可能不支援)"})]})]}),e.jsxs("div",{className:"relative flex-grow",children:[e.jsx(He,{className:"pr-10",type:n?"text":"password",placeholder:"請輸入 DataWeb API 金鑰",value:a,onChange:A=>r(A.target.value)}),e.jsx(ee,{variant:"ghost",size:"icon",className:"absolute top-1/2 right-1 -translate-y-1/2 h-8 w-8",onClick:()=>o(A=>!A),children:n?e.jsx(ao,{className:"h-4 w-4"}):e.jsx(Kn,{className:"h-4 w-4"})})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground pt-1",children:t==="bearer"?"建議使用 Bearer (JWT) 作為 Tariff 憑證類型。":"X-Api-Key 可能不被所有 Tariff 端點支援。"})]})})]}),e.jsxs(Ne,{children:[e.jsx(ot,{children:e.jsx(pt,{className:"text-base",children:"請求內容"})}),e.jsxs(Be,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(Te,{children:"預設集"}),e.jsxs($t,{onValueChange:B,children:[e.jsx(Pt,{children:e.jsx(Ht,{placeholder:"選擇一個預設請求..."})}),e.jsx(Et,{children:z.map((A,V)=>e.jsx(nt,{value:String(V),children:A.name},V))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-[3fr_1fr] gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(Te,{htmlFor:"dwv-endpoint",children:"Endpoint"}),e.jsx(He,{id:"dwv-endpoint",value:d,onChange:A=>c(A.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(Te,{htmlFor:"dwv-method",children:"Method"}),e.jsxs($t,{value:u,onValueChange:A=>p(A),children:[e.jsx(Pt,{id:"dwv-method",children:e.jsx(Ht,{})}),e.jsxs(Et,{children:[e.jsx(nt,{value:"POST",children:"POST"}),e.jsx(nt,{value:"GET",children:"GET"})]})]})]})]}),u==="POST"&&e.jsxs("div",{className:"space-y-1",children:[e.jsx(Te,{htmlFor:"dwv-body",children:"JSON Body"}),e.jsx(nr,{id:"dwv-body",className:"h-40 font-mono text-xs",value:v,onChange:A=>_(A.target.value)})]})]})]}),e.jsx("div",{className:"flex gap-2 border-t pt-6",children:e.jsx(ee,{onClick:M,disabled:j||!!b&&u==="POST",size:"lg",children:j?"執行中...":b&&u==="POST"?"維護中，暫停 POST":"執行請求"})}),e.jsxs(Ne,{children:[e.jsx(ot,{children:e.jsx(pt,{className:"text-base",children:"請求結果"})}),e.jsxs(Be,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(Te,{children:"狀態"}),e.jsx("div",{className:"text-sm text-muted-foreground mt-1 break-all border rounded-md px-3 py-2 bg-muted/50",children:x||"尚未發送請求"})]}),e.jsxs("div",{children:[e.jsx(Te,{children:"回應"}),e.jsx("div",{className:"mt-1 border rounded-md p-3 text-sm max-h-[600px] overflow-auto bg-muted/50",children:y?e.jsx(bt,{title:"JSON 回應",data:y}):e.jsx("pre",{className:"whitespace-pre-wrap break-words",children:w||"無回應內容"})})]})]})]})]})}const jd=t=>Ft({queryKey:["adcvd-tracker",t],enabled:!!t,queryFn:async()=>{const{data:s}=await rs(`/api/get-ad-cvd-tracker?hts_code=${encodeURIComponent(t)}`);return{countries:Array.isArray(s==null?void 0:s.countries)?s.countries:[],idsLinks:Array.isArray(s==null?void 0:s.idsLinks)?s.idsLinks:[],updatedAt:(s==null?void 0:s.updatedAt)||null}}}),vd=t=>t.reduce((s,a)=>{var n,o;const r=a.code;return r&&(s[r]={desc:a.description||"N/A",countries:((n=a.countriesgroups)==null?void 0:n.countries)||[],group_name:((o=a.countriesgroups)==null?void 0:o.group_name)||"N/A"}),s},{}),Nd=()=>Ft({queryKey:["program-names"],queryFn:async()=>{const{data:t}=await rs("/api/get-program-names"),s=Array.isArray(t==null?void 0:t.programs)?t.programs:[];return vd(s)},staleTime:1/0}),zr=({documentNumber:t,enabled:s=!0})=>Ft({queryKey:["company-rates",t],enabled:s&&!!t,staleTime:5*60*1e3,queryFn:async()=>{const{data:a}=await rs(`/api/get-company-rates?document_number=${encodeURIComponent(t)}`);return a}}),Ji=i.forwardRef(({className:t,...s},a)=>e.jsx(Wn,{className:J("grid gap-2",t),...s,ref:a}));Ji.displayName=Wn.displayName;const Xi=i.forwardRef(({className:t,...s},a)=>e.jsx(Jn,{ref:a,className:J("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),...s,children:e.jsx(ro,{className:"flex items-center justify-center",children:e.jsx(Xn,{className:"h-2.5 w-2.5 fill-current text-current"})})}));Xi.displayName=Jn.displayName;const wd=({isOpen:t,onClose:s,programs:a,effectiveDate:r,endDate:n})=>{const{t:o}=Ge(),d=o,[c,u]=i.useState({}),[p,v]=i.useState(!1),[_,j]=i.useState("all");i.useEffect(()=>{t&&Object.keys(c).length===0&&(v(!0),fetch("/api/get-program-names").then(x=>x.json()).then(x=>{const T=x.programs.reduce((w,S)=>{var y,g;return w[S.code]={desc:S.description,countries:((y=S.countriesgroups)==null?void 0:y.countries)||[],group_name:((g=S.countriesgroups)==null?void 0:g.group_name)||"N/A"},w},{});u(T)}).catch(console.error).finally(()=>v(!1)))},[t,c]);const f=i.useMemo(()=>a.map(x=>{var T,w,S;return{...x,description:((T=c[x.code])==null?void 0:T.desc)||"N/A",countries:((w=c[x.code])==null?void 0:w.countries)||[],group_name:((S=c[x.code])==null?void 0:S.group_name)||"N/A"}}).filter(x=>_==="all"?!0:x.status===_),[a,c,_]);return e.jsx(cr,{open:t,onOpenChange:x=>!x&&s(),children:e.jsxs(Ua,{className:"max-w-5xl",children:[e.jsxs(Ba,{children:[e.jsx(Va,{children:d("programs.title")}),e.jsx(dr,{children:d("programs.description",{start:r?new Date(r).toLocaleDateString():d("programs.na"),end:n?new Date(n).toLocaleDateString():d("programs.na")})})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Te,{className:"text-sm font-medium",children:d("programs.filter")}),e.jsx(Ji,{value:_,onValueChange:x=>x&&j(x),className:"flex items-center gap-4",children:["all","Eligible","Not Eligible"].map(x=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Xi,{value:x,id:`status-${x}`}),e.jsx(Te,{htmlFor:`status-${x}`,className:"font-normal",children:d(x==="all"?"programs.status.all":x==="Eligible"?"programs.status.eligible":"programs.status.notEligible")})]},x))})]}),e.jsx("div",{className:"overflow-x-auto rounded-lg border max-h-[60vh]",children:p?e.jsx("p",{className:"p-4 text-center text-muted-foreground",children:d("programs.loading")}):e.jsxs("table",{className:"min-w-full divide-y divide-border",children:[e.jsx("thead",{className:"bg-muted sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider w-2/5",children:d("programs.table.program")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider w-1/5",children:d("programs.table.rate")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider w-2/5",children:d("programs.table.countries")})]})}),e.jsx("tbody",{className:"bg-card divide-y divide-border text-card-foreground",children:f.map((x,T)=>e.jsxs("tr",{children:[e.jsxs("td",{className:"px-6 py-4 align-top",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-sm font-semibold",children:x.code}),e.jsx(ht,{variant:x.status==="Eligible"?"default":"destructive",className:"ml-2",children:x.status==="Eligible"?d("programs.status.eligible"):d("programs.status.notEligible")})]}),e.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:x.description})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-muted-foreground align-top",children:x.rate_text}),e.jsx("td",{className:"px-6 py-4 text-sm text-muted-foreground align-top",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:x.group_name}),x.countries.length>0&&e.jsxs($t,{children:[e.jsx(Pt,{className:"mt-1 h-7 text-xs",children:e.jsx(Ht,{placeholder:d("programs.countriesPlaceholder",{count:x.countries.length})})}),e.jsx(Et,{children:x.countries.map(w=>e.jsx(nt,{value:w,children:w},w))})]})]})})]},`${x.code}-${T}`))})]})})]}),e.jsx(qr,{children:e.jsx(ee,{variant:"secondary",onClick:s,children:d("actions.close")})})]})})},la=no,Us=io,Bs=lo,Ms=i.forwardRef(({className:t,sideOffset:s=4,...a},r)=>e.jsx(Zn,{ref:r,sideOffset:s,className:J("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]",t),...a}));Ms.displayName=Zn.displayName;const br=({label:t,value:s,icon:a,title:r})=>{const n=e.jsx("div",{className:"flex h-full items-center justify-between rounded-2xl border p-4 shadow-sm bg-card",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"rounded-xl bg-muted p-2",children:a}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:t}),e.jsx("div",{className:"text-xl font-semibold tracking-tight",children:s})]})]})});return r?e.jsxs(Us,{children:[e.jsx(Bs,{asChild:!0,children:e.jsx("div",{className:"cursor-help h-full",children:n})}),e.jsx(Ms,{children:e.jsx("p",{children:r})})]}):n},Sd=({data:t})=>{var x,T,w,S,y,g,b;const{t:s}=Ge(),a=s,[r,n]=i.useState(!1),o=t.hts8||"N/A",d=((x=t.raw)==null?void 0:x.description)||a("htsCard.noHtsDescription"),c=t.description||a("htsCard.noDatawebDescription"),u=t.base_rate,p=((T=t.raw)==null?void 0:T.other)||null,v=(w=t.extra_duties)==null?void 0:w.s301,_=i.useMemo(()=>{var z;const P=(((z=v==null?void 0:v.source)==null?void 0:z.name)||"").match(/List\s*([0-9A-Z]+)/i);return P?`List ${P[1].toUpperCase()}`:null},[v]),j=i.useMemo(()=>{var z,B,M;const R=[];(z=t.extra_duties)!=null&&z.s232_steel&&R.push({label:a("htsCard.sec232Steel"),severity:"high",title:a("htsCard.sec232SteelDesc")}),(B=t.extra_duties)!=null&&B.s232_aluminum&&R.push({label:a("htsCard.sec232Aluminum"),severity:"high",title:a("htsCard.sec232AluminumDesc")}),(M=t.extra_duties)!=null&&M.s301&&R.push({label:a("htsCard.sec301"),severity:"high",title:a("htsCard.sec301Desc")});const P=new Set;return(t.investigations||[]).forEach(A=>{(A.types||[]).forEach(V=>{V!=="Other"&&P.add(V)})}),P.forEach(A=>{R.push({label:a("htsCard.investigationBadge",{type:A}),severity:"medium",title:a("htsCard.investigationTitle",{type:A})})}),R},[t]),f=i.useMemo(()=>{if(!t.programs||t.programs.length===0)return null;const R=t.programs[0].rate_text,P=t.programs.map(z=>z.code).join(", ");return`${R} (${P})`},[t.programs]);return e.jsxs(e.Fragment,{children:[e.jsx(la,{children:e.jsxs(Ne,{className:"rounded-2xl shadow-md",children:[e.jsxs(ot,{children:[e.jsx(pt,{className:"text-lg",children:e.jsx("span",{children:a("htsCard.detailsTitle",{code:o})})}),e.jsxs("div",{className:"pt-2 text-sm text-muted-foreground border-t mt-2 space-y-1",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx(ht,{variant:"outline",className:"mr-2",children:"HTS.gov"}),e.jsx("span",{className:"text-foreground",children:d})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx(ht,{variant:"outline",className:"mr-2",children:"DataWeb"}),e.jsx("span",{className:"text-foreground",children:c})]})]})]}),e.jsxs(Be,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[e.jsx(br,{label:a("htsCard.mfnRate"),value:u??a("htsCard.na"),icon:e.jsx(_r,{className:"h-5 w-5"})}),e.jsx(br,{label:a("htsCard.col2Rate"),value:p??a("htsCard.na"),icon:e.jsx(oo,{className:"h-5 w-5"})}),j.length>0&&e.jsx(br,{label:a("htsCard.applicableRegs"),value:e.jsx("div",{className:"flex flex-wrap gap-2 mt-1",children:j.map(R=>e.jsx(ht,{variant:R.severity==="high"?"destructive":"secondary",children:R.label},R.label))}),icon:e.jsx(aa,{className:"h-5 w-5 text-amber-600"}),title:j.map(R=>R.title).join(" ")})]}),f&&e.jsxs("div",{className:"rounded-lg border bg-accent p-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-sm font-medium text-accent-foreground flex items-center",children:[e.jsx(ei,{className:"h-4 w-4 mr-2 text-success"}),a("htsCard.specialRates")]}),e.jsx(ee,{variant:"outline",size:"sm",onClick:()=>n(!0),children:a("htsCard.specialDetails")})]}),e.jsx("div",{className:"text-sm text-accent-foreground pt-2",children:f})]}),v&&e.jsxs("div",{className:"rounded-lg border bg-destructive/10 p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-destructive",children:[e.jsx(aa,{className:"h-4 w-4"}),a("htsCard.s301Measures")]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:a("htsCard.s301List")}),e.jsx("div",{className:"font-semibold text-foreground",children:_||a("htsCard.na")})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:a("htsCard.s301Rate")}),e.jsx("div",{className:"font-semibold text-foreground",children:v.max_rate_text||a("htsCard.na")})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:a("htsCard.s301Effective")}),e.jsx("div",{className:"font-semibold text-foreground",children:((S=v.source)==null?void 0:S.effective)||a("htsCard.na")})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:a("htsCard.s301Action")}),e.jsx("div",{className:"font-semibold text-foreground",children:((y=v.source)==null?void 0:y.action_title)||((g=v.source)==null?void 0:g.action)||((b=v.source)==null?void 0:b.name)||a("htsCard.na")})]})]})]})]})]})}),e.jsx(wd,{isOpen:r,onClose:()=>n(!1),programs:t.programs_dataweb||[],effectiveDate:t.effectiveDate,endDate:t.endDate})]})},Ys=i.forwardRef(({className:t,...s},a)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:a,className:J("w-full caption-bottom text-sm",t),...s})}));Ys.displayName="Table";const oa=i.forwardRef(({className:t,...s},a)=>e.jsx("thead",{ref:a,className:J("[&_tr]:border-b",t),...s}));oa.displayName="TableHeader";const Gs=i.forwardRef(({className:t,...s},a)=>e.jsx("tbody",{ref:a,className:J("[&_tr:last-child]:border-0",t),...s}));Gs.displayName="TableBody";const Cd=i.forwardRef(({className:t,...s},a)=>e.jsx("tfoot",{ref:a,className:J("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",t),...s}));Cd.displayName="TableFooter";const Gt=i.forwardRef(({className:t,...s},a)=>e.jsx("tr",{ref:a,className:J("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",t),...s}));Gt.displayName="TableRow";const us=i.forwardRef(({className:t,...s},a)=>e.jsx("th",{ref:a,className:J("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",t),...s}));us.displayName="TableHead";const _t=i.forwardRef(({className:t,...s},a)=>e.jsx("td",{ref:a,className:J("p-4 align-middle [&:has([role=checkbox])]:pr-0",t),...s}));_t.displayName="TableCell";const _d=i.forwardRef(({className:t,...s},a)=>e.jsx("caption",{ref:a,className:J("mt-4 text-sm text-muted-foreground",t),...s}));_d.displayName="TableCaption";const kd={Brazil:"BR",China:"CN",Germany:"DE",India:"IN",Indonesia:"ID",Italy:"IT",Japan:"JP",Mexico:"MX","South Korea":"KR","Korea, Republic of":"KR",Taiwan:"TW",Thailand:"TH",Turkey:"TR","The Netherlands":"NL",Netherlands:"NL","United Kingdom":"GB",Vietnam:"VN"};function Td(t){const s=kd[t];return s?s.toUpperCase().replace(/./g,a=>String.fromCodePoint(a.charCodeAt(0)+127397)):"🏳️"}const Ad=()=>e.jsxs(Ys,{children:[e.jsx(oa,{children:e.jsxs(Gt,{children:[e.jsx(us,{className:"w-[25%]",children:e.jsx(wt,{className:"h-5 w-24"})}),e.jsx(us,{children:e.jsx(wt,{className:"h-5 w-32"})}),e.jsx(us,{className:"text-right w-[120px]",children:e.jsx(wt,{className:"h-5 w-20"})})]})}),e.jsx(Gs,{children:[...Array(3)].map((t,s)=>e.jsxs(Gt,{children:[e.jsx(_t,{children:e.jsx(wt,{className:"h-5 w-3/4"})}),e.jsx(_t,{children:e.jsx(wt,{className:"h-5 w-full"})}),e.jsx(_t,{className:"text-right",children:e.jsx(wt,{className:"h-9 w-24"})})]},s))})]}),Rd=({isLoading:t,countryList:s,updatedAt:a,onViewDetails:r})=>{const{t:n}=Ge(),o=n,d=s&&s.length>0;return e.jsxs(Ne,{className:"rounded-2xl shadow-md",children:[e.jsx(ot,{children:e.jsx("div",{className:"flex justify-between items-start",children:e.jsxs("div",{children:[e.jsx(pt,{children:o("adcvdTracker.title")}),a&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:o("adcvdTracker.lastUpdated",{date:new Date(a).toLocaleString()})})]})})}),e.jsx(Be,{children:t?e.jsx(Ad,{}):d?e.jsx(la,{children:e.jsxs(Ys,{children:[e.jsx(oa,{children:e.jsxs(Gt,{children:[e.jsx(us,{className:"w-[25%]",children:o("adcvdTracker.country")}),e.jsx(us,{children:o("adcvdTracker.rates")}),e.jsx(us,{className:"text-right w-[120px]",children:o("adcvdTracker.detailsHeader")})]})}),e.jsx(Gs,{children:s.map(c=>{var u,p;return e.jsxs(Gt,{children:[e.jsxs(_t,{className:"font-medium",children:[e.jsx("span",{className:"mr-2 text-lg",role:"img","aria-label":c.country,children:Td(c.country)}),c.country]}),e.jsx(_t,{children:(u=c.latest)!=null&&u.title?e.jsxs(Us,{children:[e.jsx(Bs,{asChild:!0,children:e.jsx("a",{href:c.latest.url,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-muted-foreground hover:text-primary hover:underline line-clamp-2",children:c.latest.title})}),e.jsx(Ms,{children:e.jsx("p",{className:"max-w-md",children:c.latest.title})})]}):e.jsx("p",{className:"text-sm text-muted-foreground italic",children:o("adcvdTracker.noRecent")})}),e.jsx(_t,{className:"text-right",children:e.jsx(ee,{size:"sm",onClick:()=>{var v;return((v=c.latest)==null?void 0:v.document_number)&&r(c.country,c.latest.document_number)},disabled:!((p=c.latest)!=null&&p.document_number),children:o("adcvdTracker.viewDetails")})})]},c.country)})})]})}):e.jsx(As,{icon:e.jsx(Oa,{className:"h-10 w-10"}),title:o("adcvdTracker.emptyTitle"),description:o("adcvdTracker.emptyDesc")})})]})},fs=i.forwardRef(({className:t,...s},a)=>e.jsx(ti,{ref:a,className:J("grid place-content-center peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",t),...s,children:e.jsx(co,{className:J("grid place-content-center text-current"),children:e.jsx(Er,{className:"h-4 w-4"})})}));fs.displayName=ti.displayName;const Qr=i.forwardRef(({className:t,...s},a)=>e.jsxs(si,{ref:a,className:J("relative flex w-full touch-none select-none items-center",t),...s,children:[e.jsx(uo,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:e.jsx(mo,{className:"absolute h-full bg-primary"})}),e.jsx(ho,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));Qr.displayName=si.displayName;const Id=({queryKey:t,buildUrl:s,buildSecondaryUrl:a,buildTertiaryUrl:r,enabled:n})=>Ft({queryKey:t,enabled:n,staleTime:5*60*1e3,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,queryFn:async({signal:o})=>{const d=s(),c=a?a():null,u=r?r():null,p=typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now(),[v,_,j]=await Promise.all([rs(d,{signal:o}),c?fetch(c,{signal:o}).then(async S=>({response:S,text:await S.text()})):Promise.resolve(null),u?fetch(u,{signal:o}).then(async S=>({response:S,text:await S.text()})):Promise.resolve(null)]),f=typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now(),x=Number.isFinite(f-p)?Math.max(0,f-p):null;let T=null;if(_)try{T=JSON.parse(_.text)}catch{T=_.text}let w=null;if(j)try{w=JSON.parse(j.text)}catch{w=j.text}return{payload:v.data,adapterMode:v.response.headers.get("X-Adapter-Mode")||"",adapterCache:v.response.headers.get("X-Cache")||"",requestId:v.response.headers.get("X-Request-ID")||"",lastReportBody:v.response.headers.get("X-Report-Body")||"",diagDurationMs:x,secondary:T,tertiary:w}}}),Zi="dw_countries_cache_v1",Ar=24*60*60*1e3,Fd="/api/dataweb-proxy?endpoint=/api/v2/country/getAllCountries",Dd=["/dist/assets/data/countries.json","/assets/data/countries.json"],Ld=()=>{try{const t=JSON.parse(localStorage.getItem(Zi)||"null");if(t&&Date.now()-t.ts<Ar&&Array.isArray(t.options))return t.options}catch{}return null},Rr=t=>{try{localStorage.setItem(Zi,JSON.stringify({ts:Date.now(),options:t}))}catch{}},el=t=>Array.isArray(t==null?void 0:t.options)?t.options:Array.isArray(t)?t:[];async function Pd(){for(const t of Dd)try{const s=await fetch(t,{cache:"force-cache"});if(!s.ok)continue;const a=await s.json(),r=el(a);if(r.length)return r}catch{}return null}const Ed=()=>{const t={};try{const s=(localStorage.getItem("dataweb_api_key")||"").trim();s&&(t["x-dw-auth"]=s.startsWith("Bearer ")?s:`Bearer ${s}`)}catch{}return t},tl=async()=>{const{data:t}=await rs(Fd,{headers:Ed()});return el(t)};async function sl(){const t=Ld();if(t)return t;const s=await Pd();if(s!=null&&s.length)return Rr(s),s;try{const a=await tl();if(a.length)return Rr(a),a}catch{}return[]}async function Od(){const t=await tl();return Rr(t),t}function rn(t,s){if(!(s!=null&&s.length)||!(t!=null&&t.length))return[];const a=new Map;for(const n of s){const o=String(n.name).split(" - ")[0].trim().toLowerCase();a.set(o,n.value)}const r=[];for(const n of t){const o=a.get(String(n).trim().toLowerCase());o&&r.push(o)}return Array.from(new Set(r))}function ya(t){return(t||"").replace(/\D/g,"").slice(0,6)}function Md(t,s=5){if(!Array.isArray(t))return[];const a=[...t];return a.slice(Math.max(0,a.length-s))}const al=()=>Ft({queryKey:["countries"],queryFn:sl,staleTime:Ar,gcTime:Ar}),rl=({countryCodes:t,setCountryCodes:s})=>{const{data:a=[]}=al(),{t:r}=Ge(),n=r,[o,d]=i.useState(""),c=a.filter(u=>!o||u.name.toLowerCase().includes(o.toLowerCase()));return e.jsxs($a,{children:[e.jsx(Ha,{asChild:!0,children:e.jsx(ee,{size:"sm",variant:"glass",children:n("countrySelector.button")})}),e.jsx(va,{className:"w-[30rem]",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"text",value:o,onChange:u=>d(u.target.value),placeholder:n("countrySelector.searchPlaceholder"),className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"}),e.jsx("div",{className:"max-h-64 overflow-auto",children:e.jsxs("ul",{className:"divide-y divide-border",children:[e.jsx("li",{className:`cursor-pointer rounded-sm px-2 py-2 text-sm ${t.length===0?"bg-accent font-semibold text-accent-foreground":"hover:bg-accent"}`,onClick:()=>s([]),children:n("countrySelector.all")}),c.map(u=>{const p=t.includes(u.value);return e.jsx("li",{className:`cursor-pointer rounded-sm px-2 py-2 text-sm ${p?"bg-primary text-primary-foreground":"hover:bg-accent"}`,onClick:()=>{const v=p?t.filter(_=>_!==u.value):[...t,u.value];s(v)},children:u.name},u.value)})]})})]})})]})},Ya=(t=1)=>`rgb(var(--chart-${(t-1)%5+1}))`,ka=["Top1","Top2","Top3","Others"],Ga=["Others","Top3","Top2","Top1"],$d=(t=[])=>{const s={};for(const a of t)!a||!a.name||s[a.name]||(s[a.name]=a);return Object.values(s)},Hd=({active:t,payload:s,label:a})=>{if(!t||!s||s.length===0)return null;const r=$d(s);return e.jsxs("div",{className:"rounded-lg border bg-card px-3 py-2 text-xs shadow",children:[e.jsx("div",{className:"font-medium text-foreground mb-1",children:a}),e.jsx("div",{className:"space-y-1",children:r.map((n,o)=>{var d,c;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"inline-block h-2 w-2 rounded",style:{backgroundColor:n.color}}),e.jsxs("span",{className:"text-foreground",children:[n.name,": ",((c=(d=n.value)==null?void 0:d.toLocaleString)==null?void 0:c.call(d))||n.value]})]},o)})})]})},fa=(t,s)=>{var a;try{const r=(a=t==null?void 0:t.dto)==null?void 0:a.tables;if(!Array.isArray(r)||!r.length)return null;if(s){const n=r.findIndex(o=>{var _,j,f;const d=String((o==null?void 0:o.name)||(o==null?void 0:o.tab_name)||"").toLowerCase(),c=d.includes("year-to-date")||d.includes("ytd"),u=((j=(_=o==null?void 0:o.column_groups)==null?void 0:_[1])==null?void 0:j.columns)||[],v=(u.length?String(((f=u[0])==null?void 0:f.label)||"").toLowerCase():"").includes("year_to_date");return c||v});if(n>=0)return{dto:{tables:[r[n]]}}}return{dto:{tables:[r[0]]}}}catch{return null}},nl=t=>{const s=String(t||"").trim(),a=s.match(/(19|20)\d{2}/);return a?a[0]:s},Ud=t=>{var s,a,r,n,o,d;try{const c=(a=(s=t==null?void 0:t.dto)==null?void 0:s.tables)==null?void 0:a[0];if(!c)return null;const u=Array.isArray(c.column_groups)?c.column_groups:[];let p=u.find(f=>Array.isArray(f==null?void 0:f.columns)&&f.columns.length>0&&f.columns.every(x=>/(19|20)\d{2}/.test(String(x==null?void 0:x.label))));p||(p=[...u].reverse().find(f=>Array.isArray(f==null?void 0:f.columns)&&f.columns.some(x=>/(19|20)\d{2}/.test(String(x==null?void 0:x.label)))));const v=Array.isArray(p==null?void 0:p.columns)?p.columns.map(f=>nl(f.label)):[];if(!v.length)return null;const _=((n=(r=c.row_groups)==null?void 0:r[0])==null?void 0:n.rowsNew)||((d=(o=c.row_groups)==null?void 0:o[0])==null?void 0:d.rows)||c.rows||[];let j=v.length-1;for(let f=v.length-1;f>=0;f--)if(_.some(T=>{const w=(T==null?void 0:T.rowEntries)||(T==null?void 0:T.entries)||[],S=Math.max(0,w.length-v.length),y=w[S+f]??0,g=((y==null?void 0:y.value)??y??"0").toString();return(parseFloat(g.replace(/[^0-9.\-]/g,""))||0)>0})){j=f;break}return String(v[j]??"")}catch{return null}},ks=t=>{var s,a;try{const r=(a=(s=t==null?void 0:t.dto)==null?void 0:s.tables)==null?void 0:a[0];if(!r)return[];const n=Array.isArray(r.column_groups)?r.column_groups:[];let o=n.find(d=>Array.isArray(d==null?void 0:d.columns)&&d.columns.length>0&&d.columns.every(c=>/(19|20)\d{2}/.test(String(c==null?void 0:c.label))));return o||(o=[...n].reverse().find(d=>Array.isArray(d==null?void 0:d.columns)&&d.columns.some(c=>/(19|20)\d{2}/.test(String(c==null?void 0:c.label))))),Array.isArray(o==null?void 0:o.columns)?o.columns.map(d=>nl(d.label)):[]}catch{return[]}},Bd=(t,s,a,r,n)=>{var o,d,c,u,p,v,_,j,f,x,T,w,S,y,g,b,R;if(a)try{const P=(d=(o=t==null?void 0:t.dto)==null?void 0:o.tables)==null?void 0:d[0];if(!P)return[];const z=ks(t),M=(((u=(c=P.row_groups)==null?void 0:c[0])==null?void 0:u.rowsNew)||((v=(p=P.row_groups)==null?void 0:p[0])==null?void 0:v.rows)||P.rows||[]).filter(Boolean).map(I=>{var $,le;const k=(I==null?void 0:I.rowEntries)||(I==null?void 0:I.entries)||[],F=String((($=k==null?void 0:k[0])==null?void 0:$.value)??(k==null?void 0:k[0])??"N/A"),U=String(((le=k==null?void 0:k[1])==null?void 0:le.value)??(k==null?void 0:k[1])??(s==="value"?"USD":"number")),ne=Math.max(0,k.length-z.length),ge=z.map((_e,Ee)=>{const Fe=k[ne+Ee]??0,et=((Fe==null?void 0:Fe.value)??Fe??"0").toString();return parseFloat(et.replace(/[^0-9.\-]/g,""))||0});return{country:F,unit:U,series:ge}});let A=z.length>0?z.length-1:0;if(n&&z.includes(String(n)))A=z.indexOf(String(n));else for(let I=z.length-1;I>=0;I--)if(M.some(F=>{var U;return(((U=F.series)==null?void 0:U[I])??0)>0})){A=I;break}return M.map(I=>{var k;return{country:I.country,unit:I.unit,value:((k=I.series)==null?void 0:k[A])??0}}).sort((I,k)=>k.value-I.value).slice(0,Math.max(1,r)).map(I=>({year:I.country,quantity:I.value,unit:I.unit}))}catch{return[]}try{const P=(j=(_=t==null?void 0:t.dto)==null?void 0:_.tables)==null?void 0:j[0];if(!P)return[];const z=ks(t);if(!z.length)return[];const B=((w=(T=(x=(f=P.row_groups)==null?void 0:f[0])==null?void 0:x.rowsNew)==null?void 0:T[0])==null?void 0:w.rowEntries)||((b=(g=(y=(S=P.row_groups)==null?void 0:S[0])==null?void 0:y.rows)==null?void 0:g[0])==null?void 0:b.entries)||[],M=s==="value"?"USD":((R=B[0])==null?void 0:R.value)||"number",A=[];z.forEach((q,I)=>{var F;const k=parseFloat(String(((F=B[I+1])==null?void 0:F.value)??"0").replace(/,/g,""))||0;A.push({year:q,quantity:k,unit:M})});const V=new Date().getFullYear();return A}catch{return[]}},Vd=({htsCode:t,defaultAdcvdCountries:s=[]})=>{const{t:a}=Ge(),{setActiveTab:r}=ra(),[n,o]=i.useState(!1),[d,c]=i.useState([]),[u,p]=i.useState(!1),[v,_]=i.useState(!0),[j,f]=i.useState([]),{hts:x,setHts:T,countryCodes:w,setCountryCodes:S,period:y,setPeriod:g,flow:b,setFlow:R,metrics:P,setMetrics:z,breakout:B,setBreakout:M}=Yi(),A=i.useMemo(()=>a("market.advanced.metricLabels",{returnObjects:!0}),[a]),V=m=>(A==null?void 0:A[m])||m,q=m=>{const D=V(m),O=m==="quantity"?"":a("market.chart.unitUSD");return O?`${D} (${O})`:D},I=m=>z([m]),k=P[0]||"quantity",{enabled:F,topN:U,year:ne}=B,{years:ge,ytd:$}=y,[le,_e]=i.useState(!1),[Ee,Fe]=i.useState(!1),[et,ze]=i.useState(!1);i.useEffect(()=>{try{localStorage.setItem("mt_sync_to_adv",le?"1":"0")}catch{}},[le]);function G(){const m=new URLSearchParams;return m.set("commodities",t),m.set("history_years",String(ge)),m.set("flow",b),m.set("metric",k),m.set("ytd",String($)),F?m.set("granularity","6"):m.set("granularity","10"),F&&(m.set("breakout","true"),U&&m.set("topN",String(U))),w.length>0&&m.set("countries",w.join(",")),Ee&&m.set("diagnostic","1"),`/api/get-trade-report?${m.toString()}`}function Ce(){const m={"cons:quantity":"CONS_FIR_UNIT_QUANT","cons:value":"CONS_CUSTOMS_VALUE","cons:cif":"CONS_COST_INS_FREIGHT","cons:charges":"CONS_CHARGES_INS_FREIGHT","cons:calc_duties":"CONS_CALC_DUTY","cons:dutiable":"CONS_CUSTOMS_VALUE_SUB_DUTY","gen:quantity":"GEN_FIR_UNIT_QUANTITY","gen:value":"GEN_CUSTOMS_VALUE","gen:cif":"GEN_COST_INS_FREIGHT","gen:charges":"GEN_CHARGES_INS_FREIGHT","gen:calc_duties":"GEN_CALC_DUTY","gen:dutiable":"GEN_DUTIABLE_VALUE"};if(k==="landed"){const O=m[`${b}:cif`],de=m[`${b}:calc_duties`];return[O,de].filter(Boolean)}const D=m[`${b}:${k}`];return D?[D]:["CONS_FIR_UNIT_QUANT"]}const pe=i.useMemo(()=>{try{const m=G(),D=Ce();return JSON.stringify({url:m,dataToReport:D},null,2)}catch{return JSON.stringify({url:"",dataToReport:[]},null,2)}},[t,ge,b,k,F,$,w,Ee]),W=i.useMemo(()=>w.slice().sort().join(",")||"ALL",[w]);i.useEffect(()=>{b==="gen"&&(["quantity","value","cif","charges"].includes(k)||I("quantity"))},[b,k,I]);const Q=i.useMemo(()=>["market-trends-chart",{htsCode:t,flow:b,metric:k,breakout:F,countriesKey:W,ytd:$,historyYears:ge,diagnostic:Ee,nbBreakoutTopN20:!F}],[t,b,k,F,W,$,ge,Ee]),{data:K,error:we,isFetching:X,isLoading:xe,refetch:$e}=Id({queryKey:Q,buildUrl:G,buildSecondaryUrl:()=>{const m=new URLSearchParams;return m.set("commodities",t),m.set("history_years",String(ge)),m.set("flow",b),m.set("metric",k),m.set("ytd",String($)),m.set("granularity","10"),w.length>0&&m.set("countries",w.join(",")),Ee&&m.set("diagnostic","1"),`/api/get-trade-report?${m.toString()}`},buildTertiaryUrl:F?void 0:()=>{const m=new URLSearchParams;return m.set("commodities",t),m.set("history_years",String(ge)),m.set("flow",b),m.set("metric",k),m.set("ytd",String($)),m.set("breakout","true"),m.set("granularity","6"),m.set("topN","20"),w.length>0&&m.set("countries",w.join(",")),Ee&&m.set("diagnostic","1"),`/api/get-trade-report?${m.toString()}`},enabled:!!t}),Ae=(K==null?void 0:K.payload)??null,ct=(K==null?void 0:K.secondary)??null,Tt=(K==null?void 0:K.tertiary)??null,Z=(K==null?void 0:K.adapterMode)??"",fe=(K==null?void 0:K.adapterCache)??"",ue=(K==null?void 0:K.requestId)??"",ye=(K==null?void 0:K.lastReportBody)??"",ve=(K==null?void 0:K.diagDurationMs)??null,De=we?we instanceof Error?we.message:String(we):null,jt=X||xe;i.useEffect(()=>{le&&t&&x[0]!==t&&T([t])},[le,t,x,T]);const vt=()=>{t&&$e()},qt=i.useMemo(()=>ks(Ae),[Ae]),ft=i.useMemo(()=>{if(!F||$)return qt;const m=String(new Date().getFullYear()),D=qt.filter(O=>O!==m);return D.length?D:qt},[F,$,qt]),Zt=i.useMemo(()=>F?Ud(Ae):null,[Ae,F]),it=i.useMemo(()=>{if(!F)return null;const m=ft;return(ne&&m.includes(ne)?ne:Zt&&m.includes(Zt)?Zt:m[m.length-1]||null)||null},[F,ne,ft,Zt]),xt=i.useMemo(()=>{var Ue,Se,se,ke,be,We,rt,Oe,Je,l,h,Y,E,Le,ae,Pe,Re,Ye,tt,St,es,Nt,It,gt,ut,Ct,oe,je,yt,qe,Qe,lt,Ie,Me,kt,ts,Qt,bs,Bt,js,mt,Yt,Ot,Xt,ss,Ds,vs,Ns,Ks,ca,Ws,Js,Xs,qa,Sa,za;const m=N=>N!=="quantity",D=fa(Ae,$)||Ae;if(D!=null&&D.__landed)try{const N=D.cif,L=D.duty,ce=D.charges;if(F){const te=ks(N);let Xe=te.length?te.length-1:0;it&&te.includes(String(it))&&(Xe=te.indexOf(String(it)));const me=At=>{var Zs,Ca,Gr,Kr,Wr;const Vt=(Ca=(Zs=At==null?void 0:At.dto)==null?void 0:Zs.tables)==null?void 0:Ca[0],Vs=((Kr=(Gr=Vt==null?void 0:Vt.row_groups)==null?void 0:Gr[0])==null?void 0:Kr.rowsNew)||[],Ls=new Map;for(const hr of Vs){const _a=(hr==null?void 0:hr.rowEntries)||[],Jr=String(((Wr=_a==null?void 0:_a[0])==null?void 0:Wr.value)??"N/A"),Sl=Math.max(0,_a.length-te.length),Qa=_a[Sl+Xe]??0,Cl=parseFloat(String((Qa==null?void 0:Qa.value)??Qa??"0").replace(/[^0-9.\-]/g,""))||0;Ls.set(Jr,(Ls.get(Jr)||0)+Cl)}return Ls},st=me(N),Ze=me(L),at=me(ce),dt=new Map(st);for(const[At,Vt]of Ze.entries())dt.set(At,(dt.get(At)||0)+Vt);for(const[At,Vt]of at.entries())dt.set(At,(dt.get(At)||0)+Vt);return Array.from(dt.entries()).map(([At,Vt])=>({year:At,quantity:Vt,unit:"USD"})).sort((At,Vt)=>Vt.quantity-At.quantity).slice(0,Math.max(1,U))}else{const te=(((be=(ke=(se=(Se=(Ue=N==null?void 0:N.dto)==null?void 0:Ue.tables)==null?void 0:Se[0])==null?void 0:se.column_groups)==null?void 0:ke[1])==null?void 0:be.columns)||[]).map(dt=>String(dt.label)),Xe=((Y=(h=(l=(Je=(Oe=(rt=(We=N==null?void 0:N.dto)==null?void 0:We.tables)==null?void 0:rt[0])==null?void 0:Oe.row_groups)==null?void 0:Je[0])==null?void 0:l.rowsNew)==null?void 0:h[0])==null?void 0:Y.rowEntries)||[],me=((tt=(Ye=(Re=(Pe=(ae=(Le=(E=L==null?void 0:L.dto)==null?void 0:E.tables)==null?void 0:Le[0])==null?void 0:ae.row_groups)==null?void 0:Pe[0])==null?void 0:Re.rowsNew)==null?void 0:Ye[0])==null?void 0:tt.rowEntries)||[],st=((Ct=(ut=(gt=(It=(Nt=(es=(St=ce==null?void 0:ce.dto)==null?void 0:St.tables)==null?void 0:es[0])==null?void 0:Nt.row_groups)==null?void 0:It[0])==null?void 0:gt.rowsNew)==null?void 0:ut[0])==null?void 0:Ct.rowEntries)||[],Ze=te.map((dt,_s)=>{var Ls,Zs,Ca;const At=parseFloat(String(((Ls=Xe[_s+1])==null?void 0:Ls.value)??"0").replace(/[^0-9.\-]/g,""))||0,Vt=parseFloat(String(((Zs=me[_s+1])==null?void 0:Zs.value)??"0").replace(/[^0-9.\-]/g,""))||0,Vs=parseFloat(String(((Ca=st[_s+1])==null?void 0:Ca.value)??"0").replace(/[^0-9.\-]/g,""))||0;return{year:dt,quantity:At+Vt+Vs,unit:"USD"}}),at=new Date().getFullYear();return Ze.filter(dt=>$?!0:!(dt.year===String(at)&&dt.quantity===0))}}catch{return[]}const O=m(k)?"value":"quantity",de=fa(Ae,$)||Ae;let he=Bd(de,O,F,U,it||void 0);try{if(!F&&Array.isArray(he)&&he.length===0){const N=(je=(oe=de==null?void 0:de.dto)==null?void 0:oe.tables)==null?void 0:je[0],L=ks(de),ce=(yt=N==null?void 0:N.total)==null?void 0:yt.values;if(Array.isArray(L)&&L.length>0&&Array.isArray(ce)&&ce.length>=L.length+1){const te=String(((Qe=(qe=N==null?void 0:N.column_groups)==null?void 0:qe[1])==null?void 0:Qe.label)||"").toLowerCase(),Xe=te.includes("dollar")||te.includes("value")||O==="value"?"USD":"number",me=L.map((Ze,at)=>{const dt=String(ce[at+1]??"0"),_s=parseFloat(dt.replace(/[^0-9.\-]/g,""))||0;return{year:Ze,quantity:_s,unit:Xe}}),st=new Date().getFullYear();he=me.filter(Ze=>$?!0:!(Ze.year===String(st)&&Ze.quantity===0))}}}catch{}try{if(F&&Array.isArray(he)&&he.length===0){const N=(Ie=(lt=de==null?void 0:de.dto)==null?void 0:lt.tables)==null?void 0:Ie[0],L=ks(de);let ce=L.length?L.length-1:0;it&&L.includes(String(it))&&(ce=L.indexOf(String(it)));const te=((kt=(Me=N==null?void 0:N.row_groups)==null?void 0:Me[0])==null?void 0:kt.rowsNew)||((Qt=(ts=N==null?void 0:N.row_groups)==null?void 0:ts[0])==null?void 0:Qt.rows)||(N==null?void 0:N.rows)||[];if(Array.isArray(te)&&te.length){const me=(at=>{const dt=String(at||"").toLowerCase();return dt.includes("usd")||dt.includes("dollar")||dt.includes("$")||O==="value"?"USD":"number"})((js=(Bt=(bs=te==null?void 0:te[0])==null?void 0:bs.rowEntries)==null?void 0:Bt[1])==null?void 0:js.value);he=te.filter(Boolean).map(at=>{var Zs;const dt=(at==null?void 0:at.rowEntries)||(at==null?void 0:at.entries)||[],_s=String(((Zs=dt==null?void 0:dt[0])==null?void 0:Zs.value)??(dt==null?void 0:dt[0])??"N/A"),At=Math.max(0,dt.length-L.length),Vt=dt[At+ce]??0,Vs=((Vt==null?void 0:Vt.value)??Vt??"0").toString(),Ls=parseFloat(Vs.replace(/[^0-9.\-]/g,""))||0;return{country:_s,value:Ls}}).sort((at,dt)=>dt.value-at.value).slice(0,Math.max(1,U)).map(at=>({year:at.country,quantity:at.value,unit:me}))}}}catch{}try{if(!F&&Array.isArray(he)&&he.length===0){const N=(Yt=(mt=de==null?void 0:de.dto)==null?void 0:mt.tables)==null?void 0:Yt[0],L=ks(de),ce=((Xt=(Ot=N==null?void 0:N.row_groups)==null?void 0:Ot[0])==null?void 0:Xt.rowsNew)||((Ds=(ss=N==null?void 0:N.row_groups)==null?void 0:ss[0])==null?void 0:Ds.rows)||(N==null?void 0:N.rows)||[];if(Array.isArray(ce)&&ce.length){const te=ce[0],Xe=(te==null?void 0:te.rowEntries)||(te==null?void 0:te.entries)||[],me=String(((vs=Xe==null?void 0:Xe[1])==null?void 0:vs.value)||(O==="value"?"USD":"number")),st=Math.max(0,Xe.length-L.length),Ze=L.map((dt,_s)=>{const At=Xe[st+_s]??0,Vt=((At==null?void 0:At.value)??At??"0").toString(),Vs=parseFloat(Vt.replace(/[^0-9.\-]/g,""))||0;return{year:dt,quantity:Vs,unit:me}}),at=new Date().getFullYear();he=Ze.filter(dt=>$?!0:!(dt.year===String(at)&&dt.quantity===0))}}}catch{}try{if(F&&Array.isArray(he)&&he.length>0&&/^\d{4}$/.test(String(he[0].year||""))){const N=(Ks=(Ns=Ae==null?void 0:Ae.dto)==null?void 0:Ns.tables)==null?void 0:Ks[0],L=ks(Ae);let ce=L.length?L.length-1:0;it&&L.includes(String(it))&&(ce=L.indexOf(String(it)));const te=((Ws=(ca=N==null?void 0:N.row_groups)==null?void 0:ca[0])==null?void 0:Ws.rowsNew)||((Xs=(Js=N==null?void 0:N.row_groups)==null?void 0:Js[0])==null?void 0:Xs.rows)||[],Xe=String(((za=(Sa=(qa=te==null?void 0:te[0])==null?void 0:qa.rowEntries)==null?void 0:Sa[1])==null?void 0:za.value)||(m(k)?"USD":"number"));he=te.filter(Boolean).map(Ze=>{var Ls;const at=(Ze==null?void 0:Ze.rowEntries)||[],dt=String(((Ls=at==null?void 0:at[0])==null?void 0:Ls.value)??"N/A"),_s=Math.max(0,at.length-L.length),At=at[_s+ce]??0,Vt=((At==null?void 0:At.value)??At??"0").toString(),Vs=parseFloat(Vt.replace(/[^0-9.\-]/g,""))||0;return{country:dt,value:Vs}}).sort((Ze,at)=>at.value-Ze.value).slice(0,Math.max(1,U)).map(Ze=>({year:Ze.country,quantity:Ze.value,unit:Xe}))}}catch{}return he},[Ae,k,F,U,it]),xs=i.useMemo(()=>{var m,D,O,de,he,Ue,Se,se;try{const ke=fa(ct,$)||ct,be=(D=(m=ke==null?void 0:ke.dto)==null?void 0:m.tables)==null?void 0:D[0],We=((de=(O=be==null?void 0:be.row_groups)==null?void 0:O[0])==null?void 0:de.rowsNew)||((Ue=(he=be==null?void 0:be.row_groups)==null?void 0:he[0])==null?void 0:Ue.rows)||[],rt=ks(ke);if(!Array.isArray(We)||!We.length||!rt.length)return{};const Oe=((Se=We[0])==null?void 0:Se.rowEntries)||((se=We[0])==null?void 0:se.entries)||[],Je=Math.max(0,Oe.length-rt.length),l={};return rt.forEach((h,Y)=>{const E=Oe[Je+Y]??0,Le=((E==null?void 0:E.value)??E??"0").toString();l[h]=parseFloat(Le.replace(/[^0-9.\-]/g,""))||0}),l}catch{return{}}},[ct,$]),Dt=i.useMemo(()=>{var m,D,O,de,he,Ue,Se,se,ke,be,We,rt;if(F)return null;try{const Oe=fa(Tt,$)||Tt,Je=(D=(m=Oe==null?void 0:Oe.dto)==null?void 0:m.tables)==null?void 0:D[0],l=((de=(O=Je==null?void 0:Je.row_groups)==null?void 0:O[0])==null?void 0:de.rowsNew)||((Ue=(he=Je==null?void 0:Je.row_groups)==null?void 0:he[0])==null?void 0:Ue.rows)||(Je==null?void 0:Je.rows)||[],h=ks(Oe);if(!Array.isArray(l)||!l.length||!h.length)return null;const Y=l.map(ae=>{var Pe,Re,Ye,tt;return String(((Re=(Pe=ae==null?void 0:ae.rowEntries)==null?void 0:Pe[0])==null?void 0:Re.value)??((tt=(Ye=ae==null?void 0:ae.entries)==null?void 0:Ye[0])==null?void 0:tt.value)??"N/A")}),E={};h.forEach((ae,Pe)=>{var Re;E[ae]={};for(const Ye of l){const tt=(Ye==null?void 0:Ye.rowEntries)||(Ye==null?void 0:Ye.entries)||[],St=String(((Re=tt==null?void 0:tt[0])==null?void 0:Re.value)??"N/A"),es=Math.max(0,tt.length-h.length),Nt=tt[es+Pe]??0,It=((Nt==null?void 0:Nt.value)??Nt??"0").toString();E[ae][St]=parseFloat(It.replace(/[^0-9.\-]/g,""))||0}});const Le=String(((ke=(se=(Se=l==null?void 0:l[0])==null?void 0:Se.rowEntries)==null?void 0:se[1])==null?void 0:ke.value)??((rt=(We=(be=l==null?void 0:l[0])==null?void 0:be.entries)==null?void 0:We[1])==null?void 0:rt.value)??"").trim()||"";return{years:h,countries:Y,valuesByYear:E,unit:Le}}catch{return null}},[F,Tt,$]),zt=i.useMemo(()=>{var m,D,O,de,he,Ue,Se;if(F)return{data:[],series:[...ka],stackOrder:[...Ga]};try{const se=fa(Ae,$)||Ae,ke=(D=(m=se==null?void 0:se.dto)==null?void 0:m.tables)==null?void 0:D[0],be=((de=(O=ke==null?void 0:ke.row_groups)==null?void 0:O[0])==null?void 0:de.rowsNew)||((Ue=(he=ke==null?void 0:ke.row_groups)==null?void 0:he[0])==null?void 0:Ue.rows)||[],We=(Se=Dt==null?void 0:Dt.years)!=null&&Se.length?Dt.years:ks(Ae);if(!Array.isArray(We)||!We.length)return{data:[],series:[...ka],stackOrder:[...Ga]};const rt=new Map;d.forEach(h=>{const Y=String(h.name||"").split(" - ")[0];rt.set(h.value,Y)});const Oe=(w||[]).map(h=>rt.get(h)||h).filter(Boolean),Je=[];let l=(Dt==null?void 0:Dt.unit)||"";return We.forEach((h,Y)=>{var Nt,It,gt,ut,Ct,oe,je,yt,qe;let E=[];if(Dt){const Qe=((Nt=Dt.valuesByYear)==null?void 0:Nt[h])||{};E=Object.entries(Qe)}else{if(!Array.isArray(be)||!be.length)return;E=[];for(const Qe of be){const lt=(Qe==null?void 0:Qe.rowEntries)||(Qe==null?void 0:Qe.entries)||[],Ie=String(((It=lt==null?void 0:lt[0])==null?void 0:It.value)??"N/A");!l&&(lt!=null&&lt[1])&&(l=String(((gt=lt[1])==null?void 0:gt.value)||""));const Me=Math.max(0,lt.length-We.length),kt=lt[Me+Y]??0,ts=((kt==null?void 0:kt.value)??kt??"0").toString(),Qt=parseFloat(ts.replace(/[^0-9.\-]/g,""))||0;E.push([Ie,Qt])}}const Le=E.reduce((Qe,[,lt])=>Qe+lt,0),ae=xs[h]||0,Pe=Dt?Math.max(ae,Le):ae||Le;if(Pe<=0)return;let Re=[],Ye=Pe;if(Oe.length>0){const Qe=Oe.map(Ie=>{const Me=E.find(([kt])=>kt===Ie||kt.split(" - ")[0]===Ie);return[Ie,Me?Me[1]:0]});Ye=Qe.reduce((Ie,[,Me])=>Ie+Me,0),Re=[...Qe].sort((Ie,Me)=>Me[1]-Ie[1]).slice(0,3),Re.reduce((Ie,[,Me])=>Ie+Me,0)===0&&(Re=E.filter(([,Ie])=>Ie>0).sort((Ie,Me)=>Me[1]-Ie[1]).slice(0,3),Ye=Re.reduce((Ie,[,Me])=>Ie+Me,0))}else Re=E.filter(([,Qe])=>Qe>0).sort((Qe,lt)=>lt[1]-Qe[1]).slice(0,3);const tt=Math.max(0,Ye-Re.reduce((Qe,[,lt])=>Qe+lt,0)),St={year:h,unit:l},es=Re.map(([Qe])=>Qe);St.Top1=((ut=Re[0])==null?void 0:ut[1])??0,St.Top1_name=((Ct=Re[0])==null?void 0:Ct[0])??"N/A",St.Top2=((oe=Re[1])==null?void 0:oe[1])??0,St.Top2_name=((je=Re[1])==null?void 0:je[0])??"N/A",St.Top3=((yt=Re[2])==null?void 0:yt[1])??0,St.Top3_name=((qe=Re[2])==null?void 0:qe[0])??"N/A",St.Others=tt,St.total=Ye,Je.push(St)}),{data:Je,series:[...ka],stackOrder:[...Ga]}}catch{return{data:[],series:[...ka],stackOrder:[...Ga]}}},[Ae,xs,w,d,F,Dt]),Ke=i.useMemo(()=>{var m,D,O,de,he,Ue;if(!F)return null;try{const Se=fa(Ae,$)||Ae,se=(D=(m=Se==null?void 0:Se.dto)==null?void 0:m.tables)==null?void 0:D[0],ke=((de=(O=se==null?void 0:se.row_groups)==null?void 0:O[0])==null?void 0:de.rowsNew)||((Ue=(he=se==null?void 0:se.row_groups)==null?void 0:he[0])==null?void 0:Ue.rows)||[],be=ks(Se);if(!Array.isArray(ke)||!ke.length||!be.length)return null;const We=ke.map(Oe=>{var Je,l,h,Y;return String(((l=(Je=Oe==null?void 0:Oe.rowEntries)==null?void 0:Je[0])==null?void 0:l.value)??((Y=(h=Oe==null?void 0:Oe.entries)==null?void 0:h[0])==null?void 0:Y.value)??"N/A")}),rt={};return be.forEach((Oe,Je)=>{var l;rt[Oe]={};for(const h of ke){const Y=(h==null?void 0:h.rowEntries)||(h==null?void 0:h.entries)||[],E=String(((l=Y==null?void 0:Y[0])==null?void 0:l.value)??"N/A"),Le=Math.max(0,Y.length-be.length),ae=Y[Le+Je]??0,Pe=((ae==null?void 0:ae.value)??ae??"0").toString();rt[Oe][E]=parseFloat(Pe.replace(/[^0-9.\-]/g,""))||0}}),{years:be,countries:We,valuesByYear:rt}}catch{return null}},[Ae,F,$]),Rt=i.useMemo(()=>{if(!Ke)return[];const m=ft.filter(D=>Ke.years.includes(D));return m.length?m:Ke.years},[Ke,ft]);i.useEffect(()=>{if(F&&Rt.length){const m=Rt.slice(-5);f(m)}},[F,Rt]);const ms=i.useMemo(()=>Ke?j.length?j:Rt.length?Rt:Ke.years:[],[Ke,Rt,j]),Kt=i.useMemo(()=>{if(!Ke)return null;const m=Rt;return it&&m.includes(it)?it:m[m.length-1]||null},[Ke,it,Rt]);i.useEffect(()=>{!F||!Kt||it!==Kt&&M({...B,year:Kt})},[F,Kt,it,B,M]);const Lt=i.useMemo(()=>{var he,Ue;if(!Ke)return[];const m=Kt;if(!m)return[];const D=[];for(const Se of Ke.countries||[]){const se=((Ue=(he=Ke.valuesByYear)==null?void 0:he[m])==null?void 0:Ue[Se])??0;D.push({name:Se,total:se})}const O=D.sort((Se,se)=>se.total-Se.total),de=O.filter(Se=>Se.total>0).slice(0,Math.max(1,U||5));return de.length===0?O.slice(0,Math.max(1,U||5)).map(Se=>Se.name):de.map(Se=>Se.name)},[it,Ke,U]),os=i.useMemo(()=>Object.entries(xs||{}).map(([m,D])=>({year:m,quantity:D,unit:k==="value"?"USD":"number"})).sort((m,D)=>parseInt(String(m.year))-parseInt(String(D.year))),[xs,k]),cs=i.useMemo(()=>F?[]:zt.data.length>0?zt.data.map(m=>{const D=m.total??null,de=["Top1","Top2","Top3","Others"].map(he=>{const Ue=Number(m[he]||0),Se=D&&D>0?Ue/D*100:null,se=m[`${he}_name`]||he;return{key:he,name:se,value:Ue,pct:Se}});return{year:m.year,total:D,entries:de}}):xt.length>0?xt.map(m=>({year:m.year,total:m.quantity,entries:[{key:"Top1",name:"Total",value:m.quantity,pct:100},{key:"Top2",name:"N/A",value:0,pct:0},{key:"Top3",name:"N/A",value:0,pct:0},{key:"Others",name:"Others",value:0,pct:0}]})):os.length>0?os.map(m=>({year:m.year,total:m.quantity,entries:[{key:"Top1",name:"Total",value:m.quantity,pct:100},{key:"Top2",name:"N/A",value:0,pct:0},{key:"Top3",name:"N/A",value:0,pct:0},{key:"Others",name:"Others",value:0,pct:0}]})):[],[zt,F,xt,os]);i.useEffect(()=>{(async()=>{const m=await sl();if(c(m),w.length===0&&s.length>0){const D=rn(s,m);D.length&&(S(D),_(!1))}})()},[le,t,x]);async function hs(){try{p(!0);const m=await Od();if(c(m),w.length===0&&s.length){const D=rn(s,m);D.length&&(S(D),_(!1))}}catch{}finally{p(!1)}}function Fs(){var se,ke;if(!xt.length)return;const m=a(F?"market.chart.tableCountry":"market.chart.tableYear"),D=q(k),de=[[m,`${D}${(se=xt[0])!=null&&se.unit?` (${(ke=xt[0])==null?void 0:ke.unit})`:""}${F&&it?` - ${it}`:""}`],...xt.map(be=>[be.year,String(be.quantity)])].filter(Boolean).map(be=>be.map(We=>`"${String(We).replace(/"/g,'""')}"`).join(",")).join(`
`),he=new Blob([de],{type:"text/csv;charset=utf-8;"}),Ue=URL.createObjectURL(he),Se=document.createElement("a");Se.href=Ue,Se.download=`market_trends_${ya(t)}_${b}_${k}${F?`_bo${it||"auto"}`:""}.csv`,Se.click(),URL.revokeObjectURL(Ue)}function Wt(){const m=a(b==="gen"?"market.chart.flowGen":"market.chart.flowCons"),D=V(k);return`Market Trends - ${m} - ${D}`}function ds(){const m=t.replace(/\./g,"").length===10,D=F;let O,de,he;m&&!D?(O="Display Commodities Separately",de=[t.replace(/\./g,"").substring(0,10)],he="10"):(O="Aggregate Commodities",de=[ya(t)],he="6");const Ue=Md(xt.map(rt=>rt.year),5),Se=Ue.length?Ue:Array.from({length:5},(rt,Oe)=>String(new Date().getFullYear()-4+Oe)),se={savedQueryName:"",savedQueryDesc:Wt(),isOwner:!0,runMonthly:!1,reportOptions:{tradeType:b==="gen"?"GenImp":"Import",classificationSystem:"HTS"},searchOptions:{MiscGroup:{districts:{districtsSelectType:"all"},importPrograms:{programsSelectType:"all"},extImportPrograms:{programsSelectType:"all"},provisionCodes:{provisionCodesSelectType:"all"}},commodities:{aggregation:O,codeDisplayFormat:"YES",commodities:de,commoditiesExpanded:[],commoditiesManual:"",commodityGroups:{systemGroups:[],userGroups:[]},commoditySelectType:"list",granularity:he,groupGranularity:null,searchGranularity:null},componentSettings:{dataToReport:Ce(),scale:"1",timeframeSelectType:"fullYears",years:Se,startDate:null,endDate:null,startMonth:null,endMonth:null,yearsTimeline:"Annual"},countries:w.length>0?{aggregation:"Aggregate Countries",countries:w,countriesExpanded:w.map(rt=>{const Oe=d.find(Je=>Je.value===rt);return{name:(Oe==null?void 0:Oe.name)||rt,value:rt}}),countriesSelectType:"list",countryGroups:{systemGroups:[],userGroups:[]}}:{aggregation:"Aggregate Countries",countries:[],countriesExpanded:[{name:"All Countries",value:"all"}],countriesSelectType:"all",countryGroups:{systemGroups:[],userGroups:[]}}},sortingAndDataFormat:{DataSort:{columnOrder:[],fullColumnOrder:[],sortOrder:[]},reportCustomizations:{exportCombineTables:!1,showAllSubtotal:!0,totalRecords:"20000",exportRawData:k!=="quantity"}}},ke=new Blob([JSON.stringify(se,null,2)],{type:"application/json"}),be=URL.createObjectURL(ke),We=document.createElement("a");We.href=be,We.download=`runreport_${de[0]||"unknown"}.json`,We.click(),URL.revokeObjectURL(be)}const gs=()=>{if(F&&Ke){const m=ms.length?ms:Ke.years,D=Lt;return e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-border",children:[e.jsx("thead",{className:"bg-muted",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:a("market.chart.tableYear")}),D.map(O=>e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:O},O))]})}),e.jsx("tbody",{className:"bg-card divide-y divide-border text-sm text-card-foreground",children:m.map(O=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:O}),D.map(de=>{var Ue,Se;const he=((Se=(Ue=Ke.valuesByYear)==null?void 0:Ue[O])==null?void 0:Se[de])??0;return e.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:he.toLocaleString()},de)})]},O))})]})})}return e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-border",children:[e.jsx("thead",{className:"bg-muted",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:a("market.chart.tableYear")}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:a("market.chart.tableTotal")}),["Top1","Top2","Top3","Others"].map(m=>e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:m},m))]})}),e.jsx("tbody",{className:"bg-card divide-y divide-border text-sm text-card-foreground",children:cs.map(m=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:m.year}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:m.total!==null?m.total.toLocaleString():"-"}),["Top1","Top2","Top3","Others"].map(D=>{const O=m.entries.find(Ue=>Ue.key===D);if(!O)return e.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:"-"},D);const de=O.pct!==null?` (${O.pct.toFixed(1)}%)`:"",he=O.name?`${O.name} `:"";return e.jsx("td",{className:"px-4 py-2",children:e.jsxs("div",{className:"flex flex-col leading-tight",children:[e.jsx("span",{className:"font-medium",children:O.name||he||D}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[O.value.toLocaleString()," ",de]})]})},D)})]},m.year))})]})})},ps=F?420:380,Jt=i.useRef(null),[Ut,Cs]=i.useState({width:0,height:0}),ns=i.useCallback(()=>{var he;const m=Jt.current;if(!m)return;const D=((he=m.getBoundingClientRect)==null?void 0:he.call(m))||{width:0,height:0},O=D.width||m.clientWidth||m.scrollWidth||0,de=D.height||m.clientHeight||ps;(O!==Ut.width||de!==Ut.height)&&Cs({width:O,height:de})},[Ut.height,Ut.width,ps]);i.useLayoutEffect(()=>{ns()},[ns]),i.useEffect(()=>{const m=Jt.current;if(!m||typeof ResizeObserver>"u")return;const D=new ResizeObserver(()=>ns());return D.observe(m),()=>D.disconnect()},[ns]);const C=Ut.width>10&&Ut.height>10,re=Math.max(10,Math.floor(Ut.width)),ie=Math.max(ps,Math.floor(Ut.height));return e.jsx(la,{children:e.jsxs(Ne,{className:"rounded-2xl shadow-md w-full",children:[e.jsx(ot,{children:e.jsx(pt,{children:Wt()})}),e.jsxs(Be,{className:"space-y-6 pb-6",children:[e.jsxs("div",{className:"mb-3 flex flex-wrap items-center gap-2",children:[e.jsxs("div",{className:"relative flex items-center gap-2",children:[e.jsx(rl,{countryCodes:w,setCountryCodes:S}),e.jsx(ee,{size:"sm",variant:"glass",onClick:hs,disabled:u,children:a(u?"market.chart.refreshingCountries":"market.chart.loadCountries")}),e.jsx(ee,{size:"sm",onClick:vt,disabled:!t,children:a(X?"market.chart.refreshingData":"market.chart.refreshData")})]}),w.length>0&&e.jsx("div",{className:"flex flex-wrap items-center gap-1",children:w.map(m=>{const D=d.find(de=>de.value===m),O=(D==null?void 0:D.name)||m;return e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-muted px-2 py-0.5 text-xs text-muted-foreground",children:[O,e.jsxs(Us,{children:[e.jsx(Bs,{asChild:!0,children:e.jsx("button",{className:"text-muted-foreground hover:text-foreground","aria-label":"Remove country",onClick:()=>{const de=w.filter(he=>he!==m);S(de)},children:"✕"})}),e.jsx(Ms,{children:e.jsx("p",{children:a("market.chart.remove")})})]})]},m)})}),e.jsxs("div",{className:"w-full flex flex-wrap items-center gap-2",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 w-full",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Te,{children:a("market.chart.flow")}),e.jsxs(ba,{type:"single",value:b,onValueChange:m=>m&&R(m),size:"sm",children:[e.jsx(as,{value:"cons",children:a("market.chart.flowCons")}),e.jsx(as,{value:"gen",children:a("market.chart.flowGen")})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx(Te,{children:a("market.chart.metric")}),e.jsxs(ba,{type:"single",value:k,onValueChange:m=>m&&I(m),size:"sm",className:"flex-wrap",children:[e.jsx(as,{value:"quantity",children:V("quantity")}),e.jsx(as,{value:"value",children:V("value")}),e.jsx(as,{value:"cif",children:V("cif")}),e.jsx(as,{value:"charges",children:V("charges")}),b==="cons"&&e.jsxs(e.Fragment,{children:[e.jsx(as,{value:"calc_duties",children:V("calc_duties")}),e.jsx(as,{value:"dutiable",children:V("dutiable")}),e.jsx(as,{value:"landed",children:V("landed")})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Te,{children:a("market.chart.period")}),e.jsxs("div",{className:"flex items-center gap-2 rounded-md border p-2",children:[e.jsx(fs,{id:"ytd",checked:$,onCheckedChange:m=>g({...y,ytd:!!m})}),e.jsx(Te,{htmlFor:"ytd",className:"text-sm",children:a("market.chart.ytd")}),e.jsx(Qr,{value:[ge],onValueChange:m=>g({...y,years:m[0]}),min:1,max:20,step:1,className:"w-24"}),e.jsx("span",{className:"text-sm text-foreground",children:a("market.chart.historyYearsShort",{years:ge})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Te,{children:a("market.chart.breakout")}),e.jsxs("div",{className:"flex items-center gap-2 rounded-md border p-2",children:[e.jsx(fs,{id:"breakout",checked:F,onCheckedChange:m=>M({...B,enabled:!!m})}),e.jsx(Te,{htmlFor:"breakout",className:"text-sm",children:a("market.chart.topN")}),e.jsx(He,{type:"number",value:U,onChange:m=>M({...B,topN:Math.max(1,Math.min(20,parseInt(m.target.value||"5",10)))}),className:"w-16 h-8",disabled:!F}),e.jsx(Te,{htmlFor:"breakout-year",className:"text-sm",children:a("market.chart.year")}),e.jsxs($t,{value:ne||"auto",onValueChange:m=>{M({...B,year:m==="auto"?null:m})},disabled:!F,children:[e.jsx(Pt,{className:"w-24 h-8",children:e.jsx(Ht,{placeholder:a("market.chart.auto")})}),e.jsxs(Et,{children:[e.jsx(nt,{value:"auto",children:a("market.chart.auto")}),ft.map(m=>e.jsx(nt,{value:m,children:m},m))]})]})]})]})]}),e.jsx(ee,{size:"sm",variant:"glass",onClick:Fs,children:a("market.chart.exportCsv")}),e.jsx(ee,{size:"sm",variant:"glass",onClick:ds,children:a("market.chart.exportJson",{metric:V(k)})}),e.jsxs("div",{className:"flex items-center space-x-2 ml-2",children:[e.jsx(fs,{id:"diagnostic-mode",checked:Ee,onCheckedChange:m=>Fe(!!m)}),e.jsx(Te,{htmlFor:"diagnostic-mode",className:"text-xs font-normal",children:a("market.chart.diagnostic")})]}),(Z||fe)&&e.jsxs("span",{className:"text-[11px] px-2 py-1 rounded-full bg-muted text-muted-foreground",children:[Z,fe?` P ${fe}`:""]}),e.jsxs("div",{className:"flex items-center gap-2 ml-2",children:[e.jsx(Te,{htmlFor:"sync-adv",className:"text-xs font-normal",children:a("market.chart.sync")}),e.jsx(pa,{id:"sync-adv",checked:le,onCheckedChange:m=>_e(!!m)})]}),e.jsxs($a,{children:[e.jsx(Ha,{asChild:!0,children:e.jsx(ee,{size:"sm",variant:"ghost",children:a("market.chart.info")})}),e.jsx(va,{className:"max-w-xl",children:e.jsxs("div",{className:"text-xs text-muted-foreground space-y-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-1",children:a("market.chart.infoFlowTitle")}),e.jsx("p",{children:a("market.chart.infoFlowDesc")})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-1",children:a("market.chart.infoMetricTitle")}),e.jsx("p",{children:a("market.chart.infoMetricDesc")})]})]})})]})]})]}),e.jsxs("div",{ref:Jt,className:"mb-4 w-full overflow-hidden",style:{minHeight:ps,height:ps,minWidth:0,width:"100%"},children:[jt&&e.jsxs("div",{className:"pt-4 animate-pulse",children:[e.jsx("div",{className:"h-4 bg-muted rounded w-1/3 mb-2"}),e.jsx("div",{className:"h-64 bg-muted rounded"})]}),De&&e.jsxs("div",{className:"text-center text-destructive pt-4",children:[a("status.error"),": ",De]}),!jt&&!De&&xt.length===0&&zt.data.length===0&&C&&e.jsx(As,{icon:e.jsx(po,{className:"h-10 w-10"}),title:a("market.chart.emptyTitle"),description:a("market.chart.emptyDesc"),className:"mt-4"}),!C&&!jt&&e.jsx("div",{className:"pt-4 h-full flex items-center justify-center text-sm text-muted-foreground",children:a("market.chart.preparing")}),!jt&&!De&&!F&&zt.data.length>0&&C&&e.jsx(Ps,{width:re,height:ie,children:e.jsxs(ar,{data:zt.data,children:[e.jsx(ta,{strokeDasharray:"3 3"}),e.jsx(sa,{dataKey:"year",fontSize:12}),e.jsx(Es,{width:90,fontSize:12,tickFormatter:m=>m.toLocaleString()}),e.jsx(Os,{formatter:(m,D,O)=>[`${m.toLocaleString()} ${O.payload.unit||""}`,D]}),e.jsx(Ia,{}),(zt.stackOrder||ka).map((m,D)=>{var O;return e.jsx(Fa,{dataKey:m,stackId:"a",name:m==="Others"?"Others":((O=zt.data[0])==null?void 0:O[`${m}_name`])||m,fill:Ya(D+1)},m)})]})}),!jt&&!De&&!F&&zt.data.length===0&&(xt.length>0||os.length>0)&&C&&e.jsx(Ps,{width:re,height:ie,children:e.jsxs(ar,{data:xt.length?xt:os,children:[e.jsx(ta,{strokeDasharray:"3 3"}),e.jsx(sa,{dataKey:"year",fontSize:12}),e.jsx(Es,{width:90,fontSize:12,tickFormatter:m=>m.toLocaleString()}),e.jsx(Os,{formatter:(m,D,O)=>[`${m.toLocaleString()} ${O.payload.unit||""}`,D]}),e.jsx(Ia,{}),e.jsx(Fa,{dataKey:"quantity",name:q(k),fill:Ya(1)})]})}),!jt&&!De&&F&&Ke&&ms.length>0&&Lt.length>0&&C&&e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:Ke.years.map(m=>e.jsx(ee,{size:"sm",variant:j.includes(m)?"default":"outline",onClick:()=>{f(D=>D.includes(m)?D.filter(O=>O!==m):[...D,m])},children:m},m))}),e.jsx("div",{className:"h-96 w-full",style:{minWidth:0},children:e.jsx(Ps,{width:re,height:ie,children:e.jsxs(Xo,{data:Ke.years.map(m=>{const D={year:m};return Lt.forEach(O=>{var de,he;D[O]=((he=(de=Ke.valuesByYear)==null?void 0:de[m])==null?void 0:he[O])??0}),D}).filter(m=>ms.includes(String(m.year))),children:[e.jsx(ta,{strokeDasharray:"3 3"}),e.jsx(sa,{dataKey:"year",fontSize:12}),e.jsx(Es,{width:90,fontSize:12,tickFormatter:m=>m.toLocaleString()}),e.jsx(Os,{content:e.jsx(Hd,{})}),e.jsx(Ia,{}),Lt.map((m,D)=>e.jsx(Fa,{dataKey:m,name:m,fill:Ya(D+1)},`bar-${m}`)),Lt.map((m,D)=>e.jsx(yi,{type:"monotone",dataKey:m,stroke:Ya(D+1),dot:!1},`line-${m}`))]})})})]})]}),e.jsx("div",{className:"mt-4 flex items-center gap-2",children:e.jsx(ee,{variant:"ghost",size:"sm",onClick:()=>o(!n),disabled:jt||!!De||!F&&xt.length===0||F&&(!Ke||Lt.length===0),children:a(n?"market.chart.hideData":"market.chart.showData")})}),n&&!jt&&!De&&(F&&Ke&&Lt.length>0||!F&&xt.length>0)&&gs(),Ee&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm font-semibold",children:a("market.chart.diagnostics")}),e.jsxs("div",{className:"flex items-center gap-3",children:[(Z||fe)&&e.jsxs("span",{className:"text-[11px] px-2 py-1 rounded-full bg-muted text-muted-foreground",children:[Z,fe?` ??${fe}`:""]}),ve!=null&&e.jsx("span",{className:"text-[11px] px-2 py-1 rounded-full bg-muted/50 text-muted-foreground border",children:`${Math.round(ve)} ms`}),e.jsx("button",{className:"text-xs text-muted-foreground underline",onClick:()=>{try{navigator.clipboard.writeText(pe)}catch{}},title:a("market.chart.copySummary"),children:a("market.chart.copySummary")}),e.jsx("button",{className:"text-xs text-muted-foreground underline",onClick:()=>ze(m=>!m),children:a(et?"actions.close":"actions.open")})]})]}),et&&e.jsxs("div",{className:"space-y-3 mt-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-foreground",children:a("market.chart.requestSummary")}),e.jsx("pre",{className:"bg-muted p-3 rounded max-h-96 overflow-auto text-[12px]",children:pe})]}),(Z||fe||ue)&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-foreground",children:a("market.chart.headers")}),e.jsx("pre",{className:"bg-muted p-3 rounded max-h-96 overflow-auto text-[12px]",children:JSON.stringify({"X-Adapter-Mode":Z,"X-Cache":fe,"X-Request-ID":ue},null,2)})]}),ye&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-foreground",children:a("market.chart.reportBody")}),e.jsx("pre",{className:"text-[12px] whitespace-pre-wrap break-all bg-muted border rounded p-3 max-h-80 overflow-auto",children:ye})]})]})]})]})]})})},qd=({searchTerm:t,onSearchTermChange:s,onSearch:a,isLoading:r,className:n})=>e.jsx("div",{className:J("mb-6",n),children:e.jsx(Ne,{className:"rounded-2xl shadow-lg",children:e.jsx(Be,{className:"p-3",children:e.jsxs("form",{className:"flex flex-col items-center gap-2 sm:flex-row sm:items-center",onSubmit:o=>{o.preventDefault(),r||a()},children:[e.jsxs("div",{className:"relative w-full flex-grow",children:[e.jsx(Hs,{className:"absolute left-3 top-1/2 h-5 w-5 -translate-y-1/2 text-muted-foreground"}),e.jsx(He,{placeholder:"Enter HTS code (HTS4/6/8/10/12)",className:"w-full pl-10 h-10",value:t,onChange:o=>s(o.target.value),onKeyDown:o=>{o.key==="Enter"&&(o.preventDefault(),r||a())}})]}),e.jsx(ee,{type:"submit",size:"sm",disabled:r,className:"w-full sm:w-auto h-10 px-4 text-sm",children:r?"Searching...":"Search"})]})})})}),zd=({open:t,onClose:s,favorites:a,onSelect:r,onRemove:n})=>{const{t:o}=Ge(),d=o,c=a.length>0?e.jsx("div",{className:"space-y-2",children:a.map(u=>e.jsxs("div",{className:"flex items-center justify-between rounded-xl border border-border p-3",children:[e.jsxs("div",{children:[e.jsx("button",{type:"button",className:"cursor-pointer font-mono text-sm text-left hover:text-primary",onClick:()=>{r(u.hts),s()},children:u.hts}),e.jsx("div",{className:"text-xs text-muted-foreground",children:u.note})]}),e.jsx(ee,{onClick:()=>n(u.hts),variant:"ghost",size:"icon",children:e.jsx(Lr,{className:"h-4 w-4"})})]},u.hts))}):e.jsx(As,{icon:e.jsx(kr,{className:"h-10 w-10"}),title:d("favorites.emptyTitle"),description:d("favorites.emptyDesc")});return e.jsx(cr,{open:t,onOpenChange:u=>{u||s()},children:e.jsxs(Ua,{className:"max-w-2xl",children:[e.jsxs(Ba,{children:[e.jsxs(Va,{className:"flex items-center gap-2",children:[e.jsx(kr,{className:"h-5 w-5"}),d("favorites.dialogTitle")]}),e.jsx(dr,{children:d("favorites.dialogDesc")})]}),c]})})},Yr=({isOpen:t,onClose:s,country:a,isLoading:r,error:n,rows:o,title:d,periodStart:c,periodEnd:u,periodText:p,headingText:v})=>{const{t:_}=Ge(),j=_;return e.jsx(cr,{open:t,onOpenChange:f=>!f&&s(),children:e.jsxs(Ua,{className:"sm:max-w-3xl",children:[e.jsxs(Ba,{children:[e.jsx(Va,{children:j("companyRates.title",{country:a||j("companyRates.unknownCountry")})}),e.jsx(dr,{children:j("companyRates.description")}),(v||d)&&e.jsx("div",{className:"text-sm font-medium mt-1",children:v||d}),(p||c||u)&&e.jsx("div",{className:"text-xs text-muted-foreground",children:p||(c&&u?`${c} - ${u}`:c||u)})]}),e.jsx("div",{className:"grid gap-4 py-4",children:r?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:j("status.loading")}):n?e.jsx("div",{className:"text-center py-8 text-destructive",children:n}):o.length>0?e.jsx("div",{className:"overflow-x-auto rounded-lg border max-h-[60vh]",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-muted sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left font-medium text-muted-foreground",children:j("companyRates.company")}),e.jsx("th",{className:"px-3 py-2 text-left font-medium text-muted-foreground",children:j("companyRates.rate")})]})}),e.jsx("tbody",{children:o.map((f,x)=>f.company==="N/A"?e.jsx("tr",{className:"border-t border-border",children:e.jsx("td",{colSpan:2,className:"px-3 py-2 text-center",children:e.jsx("a",{href:f.rate,target:"_blank",rel:"noreferrer",className:"text-primary hover:text-primary/80 underline",children:j("companyRates.viewOnFr")})})},x):e.jsxs("tr",{className:"border-t border-border",children:[e.jsx("td",{className:"px-3 py-2",children:f.company}),e.jsx("td",{className:"px-3 py-2 font-bold text-destructive",children:f.rate})]},x))})]})}):e.jsx(As,{icon:e.jsx(Oa,{className:"h-10 w-10"}),title:j("companyRates.emptyTitle"),description:j("companyRates.emptyDesc")})}),e.jsx(qr,{children:e.jsx(ee,{variant:"secondary",onClick:s,children:j("actions.close")})})]})})},Qd=({isLoading:t,links:s})=>{const{t:a}=Ge(),r=a,n=s&&s.length>0;return e.jsx(la,{children:e.jsxs(Ne,{className:"rounded-2xl shadow-md",children:[e.jsx(ot,{children:e.jsx(pt,{className:"break-words",children:r("idsLinks.title")})}),e.jsx(Be,{children:t?e.jsxs("div",{className:"space-y-3",children:[e.jsx(wt,{className:"h-5 w-full"}),e.jsx(wt,{className:"h-5 w-5/6"}),e.jsx(wt,{className:"h-5 w-full"})]}):n?e.jsx("div",{className:"space-y-2",children:s.map((o,d)=>e.jsxs(Us,{children:[e.jsx(Bs,{asChild:!0,children:e.jsxs("a",{href:o.url,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-start gap-1.5 text-sm text-primary hover:underline",children:[e.jsx(fo,{className:"h-4 w-4 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"break-all",children:o.title})]})}),e.jsx(Ms,{children:e.jsx("p",{className:"max-w-md",children:o.title})})]},d))}):e.jsx(As,{icon:e.jsx(xo,{className:"h-10 w-10"}),title:r("idsLinks.emptyTitle"),description:r("idsLinks.emptyDesc")})})]})})},Yd=({term:t,perPage:s,order:a="newest",debug:r=!1,skipCache:n=!0,enabled:o})=>Ft({queryKey:["fr-documents",{term:t,perPage:s,order:a,debug:r,skipCache:n}],enabled:o,queryFn:async()=>{const d=await lr({term:t||void 0,per_page:s,order:a,debug:r,includeHeaders:!0,skipCache:n});return{docs:Ur(d.payload),headers:d.headers||{},fetchUrl:d.url,raw:d}}}),nn=t=>{const s=String(t||"").trim();if(!s)return"";if(s.includes("."))return s.replace(/\.{2,}/g,".");const a=s.replace(/\D/g,"");if(a.length<4)return s;const r=[];return r.push(a.slice(0,4)),a.length>=6&&r.push(a.slice(4,6)),a.length>=8&&r.push(a.slice(6,8)),a.length>=10&&r.push(a.slice(8,10)),a.length>=12&&r.push(a.slice(10,12)),r.join(".")};function Gd({hts:t,rawHts:s,defaultPerPage:a=5}){var $;const{t:r}=Ge(),n=r,[o,d]=H.useState(""),[c,u]=H.useState(""),[p,v]=H.useState(""),[_,j]=H.useState(null),[f,x]=H.useState(null),[T,w]=H.useState(null),[S,y]=H.useState(!1),[g,b]=H.useState(null),R=ma(),[P,z]=H.useState(a),[B,M]=H.useState(""),[A,V]=H.useState(!1),q=H.useMemo(()=>[nn(A?s:t)||"",B||""].filter(Boolean).join(" ").trim(),[t,s,B,A]),I=Yd({term:q,perPage:P,debug:A,skipCache:!0,enabled:!0}),k=(($=I.data)==null?void 0:$.docs)||[],F=I.isLoading,U=I.error?I.error instanceof Error?I.error.message:String(I.error):null;H.useEffect(()=>{I.data&&(v(I.data.fetchUrl),d(I.data.headers["x-adapter-mode"]||""),u(I.data.headers["x-cache"]||""))},[I.data]),H.useEffect(()=>{j(null),x(null),b(null),w(null)},[q,P,A]);const ne=H.useCallback(()=>{j(null),x(null),b(null),w(null),I.refetch()},[I]),ge=async le=>{if(le){y(!0),b(null),x(null),w(null);try{const _e=await or(R,le);v(_e.url),w(_e.raw),_e.normalized?x(_e.normalized):b("No document details available")}catch(_e){b((_e==null?void 0:_e.message)||"Failed to load document details")}finally{y(!1)}}};return e.jsxs(Ne,{className:"rounded-2xl shadow-md",children:[e.jsx(ot,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(pt,{children:n("relatedFr.title")}),e.jsxs("div",{className:"flex items-center gap-2",children:[o&&e.jsxs("span",{className:"text-[11px] px-2 py-0.5 rounded-full bg-muted text-muted-foreground",title:"Adapter Mode",children:[o,c?` | ${c}`:""]}),e.jsx(ee,{onClick:ne,variant:"link",size:"sm",className:"h-auto p-0 text-xs",title:p||"",children:n("actions.refresh")})]})]})}),e.jsxs(Be,{className:"text-sm",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-3 mb-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(Te,{htmlFor:"fr-keyword",className:"text-xs",children:n("relatedFr.keyword")}),e.jsx(He,{id:"fr-keyword",value:B,onChange:le=>M(le.target.value),placeholder:n("relatedFr.keywordPlaceholder"),className:"h-8 text-xs"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(Te,{htmlFor:"fr-perpage",className:"text-xs",children:n("relatedFr.perPage")}),e.jsxs($t,{value:String(P),onValueChange:le=>z(parseInt(le,10)||a),children:[e.jsx(Pt,{id:"fr-perpage",className:"h-8 text-xs",children:e.jsx(Ht,{})}),e.jsx(Et,{children:[5,10,20].map(le=>e.jsx(nt,{value:String(le),children:le},le))})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fs,{id:"frcard-debug",checked:A,onCheckedChange:le=>V(!!le)}),e.jsx(Te,{htmlFor:"frcard-debug",className:"text-xs font-normal",children:n("relatedFr.debug")})]})]}),e.jsx("div",{className:"text-xs text-muted-foreground mb-2",children:n("relatedFr.queryLine",{term:nn(A?s:t)||n("relatedFr.emptyTerm"),keyword:B?` ${B}`:"",perPage:P})}),F&&e.jsx("div",{className:"space-y-2",children:[...Array(3)].map((le,_e)=>e.jsx("div",{className:"animate-pulse h-12 bg-muted rounded"},_e))}),U&&e.jsx("div",{className:"text-destructive",children:U}),!F&&!U&&k.length===0&&e.jsx(As,{icon:e.jsx(go,{className:"h-10 w-10"}),title:n("relatedFr.emptyTitle"),description:n("relatedFr.emptyDesc")}),e.jsx(la,{children:e.jsx(zs,{type:"single",collapsible:!0,className:"w-full",children:k.map((le,_e)=>{const Ee=`${le.document_number}-${_e}`;return e.jsxs(ws,{value:Ee,className:"border rounded px-2",children:[e.jsx(Ts,{className:"text-left px-0 hover:no-underline",children:e.jsxs("div",{className:"w-full text-left",children:[e.jsx("div",{className:"font-medium text-foreground text-sm",children:e.jsx("a",{href:le.html_url,target:"_blank",rel:"noreferrer",className:"text-primary hover:underline",children:le.title})}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-0.5",children:[le.document_number," | ",le.type," | ",le.publication_date]}),e.jsx("div",{className:"text-[11px] text-muted-foreground mt-0.5",children:le.agencies_text||(Array.isArray(le.agencies)?le.agencies.map(Fe=>(Fe==null?void 0:Fe.name)||(Fe==null?void 0:Fe.raw_name)||"").filter(Boolean).join(", "):"")})]})}),e.jsxs(Ss,{className:"pt-0",children:[Array.isArray(le.excerpts)&&le.excerpts.length>0&&e.jsx("div",{className:"mt-1 text-xs text-muted-foreground space-y-1",children:le.excerpts.map((Fe,et)=>e.jsx("div",{className:"prose prose-sm max-w-none",dangerouslySetInnerHTML:{__html:Vi(Fe||"")}},et))}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx(ee,{onClick:()=>{if(_===le.document_number){j(null),x(null),w(null),b(null);return}j(le.document_number),ge(le.document_number)},variant:"secondary",size:"sm",className:"h-auto px-2 py-1 text-xs",children:n("relatedFr.details")}),le.body_html_url&&e.jsx("a",{href:le.body_html_url,target:"_blank",rel:"noreferrer",className:"text-xs text-primary hover:underline",children:n("relatedFr.fullText")}),le.pdf_url&&e.jsxs(Us,{children:[e.jsx(Bs,{asChild:!0,children:e.jsx("a",{href:le.pdf_url,target:"_blank",rel:"noreferrer",className:"text-xs text-primary hover:underline",children:"PDF"})}),e.jsx(Ms,{children:e.jsxs("div",{className:"text-[11px]",children:[e.jsx("div",{className:"font-semibold",children:n("relatedFr.pdfTitle")}),e.jsx("div",{children:n("relatedFr.pdfDesc1")}),e.jsx("div",{children:n("relatedFr.pdfDesc2")})]})})]}),le.public_inspection_pdf_url&&e.jsxs(Us,{children:[e.jsx(Bs,{asChild:!0,children:e.jsx("a",{href:le.public_inspection_pdf_url,target:"_blank",rel:"noreferrer",className:"text-xs text-primary hover:underline",children:n("relatedFr.piPdf")})}),e.jsx(Ms,{children:e.jsxs("div",{className:"text-[11px]",children:[e.jsx("div",{className:"font-semibold",children:n("relatedFr.piPdfTitle")}),e.jsx("div",{children:n("relatedFr.piPdfDesc1")}),e.jsx("div",{children:n("relatedFr.piPdfDesc2")})]})})]})]}),_===le.document_number&&e.jsxs("div",{className:"mt-2 text-xs bg-muted/50 p-2 rounded border",children:[S&&e.jsx("div",{children:n("relatedFr.loadingDetail")}),g&&e.jsx("div",{className:"text-destructive",children:g}),!S&&!g&&f&&e.jsx(La,{doc:f}),!S&&!g&&!f&&!T&&e.jsx("div",{children:n("relatedFr.noDetail")}),A&&T&&e.jsx("div",{className:"mt-2",children:e.jsx(bt,{title:n("relatedFr.rawJson"),data:T})})]})]})]},Ee)})})})]})]})}const ln=t=>{if(!t)return 0;const s=t.match(/([\d.]+)/);return s?parseFloat(s[1]):0},jr=t=>{if(!t||t.toLowerCase().includes("free"))return 0;const s=t.match(/([\d.]+)%/);return s?parseFloat(s[1])/100:0},Kd=({htsCode:t,tariffData:s,programsLookup:a})=>{var y;const{t:r}=Ge(),n=r,[o,d]=i.useState(""),[c,u]=i.useState("10000"),[p,v]=i.useState("1000"),[_,j]=i.useState(null),[f,x]=i.useState(null),T=i.useMemo(()=>{if(!a)return[];const g=new Set;return Object.values(a).forEach(b=>{var R;(R=b.countries)==null||R.forEach(P=>g.add(String(P)))}),Array.from(g).sort((b,R)=>b.localeCompare(R))},[a]),w=i.useMemo(()=>{var R,P,z,B;if(s!=null&&s.base_rate){const M=s.base_rate.match(/\/\s*([a-zA-Z.\s]+)/);if(M&&M[1]){const A=M[1].trim();if(A.toLowerCase()!=="ad val")return A}}const g=(P=(R=s==null?void 0:s.raw)==null?void 0:R.sections)==null?void 0:P.find(M=>M.id==="tariff_treatment"),b=(B=(z=g==null?void 0:g.children)==null?void 0:z.find(M=>M.id==="uoq1"))==null?void 0:B.value;return b&&b.trim()&&b!=="N/A"?b:"N/A"},[s]),S=()=>{var g,b,R,P,z,B,M,A,V,q,I,k,F,U,ne;if(!t||!o||!c||!s){j(n("tariffCalc.errorMissing"));return}j(null),x(null);try{const ge=parseFloat(c),$=parseFloat(p);let le=0,_e=0,Ee=s.base_rate||"N/A",Fe=null;const et=(b=(g=s.raw)==null?void 0:g.sections)==null?void 0:b.find($e=>$e.id==="tariff_treatment"),ze=(R=et==null?void 0:et.children)==null?void 0:R.find($e=>$e.id==="mfn"),G=(z=(P=ze==null?void 0:ze.children)==null?void 0:P.find($e=>$e.id==="adv_rate_comp"))==null?void 0:z.value,Ce=(M=(B=ze==null?void 0:ze.children)==null?void 0:B.find($e=>$e.id==="spec_rate_comp"))==null?void 0:M.value,pe=jr(G)||jr(s.base_rate),W=ln(Ce);le=pe,_e=W;const Q=(s.programs_dataweb||[]).filter($e=>$e.status==="Eligible");for(const $e of Q){const Ae=a==null?void 0:a[$e.code];if(Ae&&Ae.countries.includes(o)){const ct=(I=(q=(V=(A=s.raw)==null?void 0:A.sections)==null?void 0:V.find(ye=>ye.id==="tariff_program"))==null?void 0:q.children)==null?void 0:I.find(ye=>ye.id===$e.code.toLowerCase()),Tt=((F=(k=ct==null?void 0:ct.children)==null?void 0:k.find(ye=>ye.id==="advr"))==null?void 0:F.value)??$e.rate_text,Z=((ne=(U=ct==null?void 0:ct.children)==null?void 0:U.find(ye=>ye.id==="spec"))==null?void 0:ne.value)??$e.rate_text,fe=jr(Tt),ue=ln(Z);le=fe,_e=ue,Ee=Tt||Ee,Fe={...$e,description:Ae.desc};break}}const K=ge*le,we=$*_e,X=K+we,xe={inputs:{hts:t,country:o,value:ge,quantity:$},calculation:{baseRate:{text:s.base_rate||"N/A",value:pe},preferential:Fe?{applied:!0,programCode:Fe.code,programName:Fe.description,rate:{text:Ee,value:le}}:{applied:!1},finalRate:{adValorem:le,specific:_e,text:Ee},adValoremDuty:K,specificDuty:we,totalDuty:X}};x(xe)}catch(ge){j(ge.message)}};return e.jsxs(Ne,{className:"rounded-2xl shadow-md",children:[e.jsx(ot,{children:e.jsx(pt,{children:n("tariffCalc.title")})}),e.jsxs(Be,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Te,{htmlFor:"country-select",children:n("tariffCalc.country")}),e.jsxs($t,{value:o,onValueChange:d,disabled:!a,children:[e.jsx(Pt,{id:"country-select",children:e.jsx(Ht,{placeholder:n(a?"tariffCalc.selectCountry":"tariffCalc.loadingCountries")})}),e.jsx(Et,{children:T.map(g=>e.jsx(nt,{value:g,children:g},g))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Te,{htmlFor:"declared-value",children:n("tariffCalc.declaredValue")}),e.jsx(He,{id:"declared-value",type:"number",value:c,onChange:g=>u(g.target.value),placeholder:n("tariffCalc.declaredPlaceholder")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Te,{htmlFor:"quantity",children:n("tariffCalc.quantity",{unit:w})}),e.jsx(He,{id:"quantity",type:"number",value:p,onChange:g=>v(g.target.value),placeholder:n("tariffCalc.quantityPlaceholder")})]})]}),e.jsx(ee,{onClick:S,disabled:!s||!a,children:n(s?"tariffCalc.calculate":"tariffCalc.loadingHts")}),_&&e.jsxs(Rs,{variant:"destructive",children:[e.jsx(aa,{className:"h-4 w-4"}),e.jsx(ua,{children:n("status.error")}),e.jsx(Is,{children:_})]}),f&&e.jsxs("div",{className:"pt-4 border-t",children:[e.jsxs("div",{className:"p-3 bg-muted rounded-lg text-xs text-muted-foreground mb-4",children:[e.jsx("p",{className:"font-semibold",children:n("tariffCalc.noteTitle")}),e.jsx("p",{children:n("tariffCalc.noteBody")})]}),e.jsx("h3",{className:"font-semibold mb-2",children:n("tariffCalc.resultTitle")}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{children:[e.jsxs("strong",{children:[n("tariffCalc.baseRate"),":"]})," ",f.calculation.baseRate.text]}),f.calculation.preferential.applied?e.jsxs("div",{className:"p-2 bg-success/10 border-l-4 border-success",children:[e.jsxs("p",{children:[e.jsxs("strong",{children:[n("tariffCalc.prefApplied"),":"]})," ",f.calculation.preferential.programName," (",f.calculation.preferential.programCode,")"]}),e.jsxs("p",{children:[e.jsxs("strong",{children:[n("tariffCalc.prefRate"),":"]})," ",(y=f.calculation.preferential.rate)==null?void 0:y.text]})]}):e.jsx("p",{className:"text-muted-foreground",children:n("tariffCalc.noPref",{country:f.inputs.country})}),e.jsxs("div",{className:"mt-2 p-2 bg-primary/10 border-l-4 border-primary",children:[e.jsxs("p",{children:[n("tariffCalc.adValoremDuty"),": $",f.calculation.adValoremDuty.toFixed(2)]}),e.jsxs("p",{children:[n("tariffCalc.specificDuty"),": $",f.calculation.specificDuty.toFixed(2)]})]}),e.jsxs("p",{className:"font-bold text-lg",children:[n("tariffCalc.finalDuty"),": ",e.jsxs("span",{className:"text-primary",children:[f.calculation.totalDuty.toFixed(2)," USD"]})]}),e.jsxs("div",{className:"mt-4 space-y-2 pt-4 border-t",children:[e.jsxs("div",{className:"p-2 bg-warning/10 border-l-4 border-warning",children:[e.jsx("p",{children:e.jsx("strong",{children:n("tariffCalc.notice232")})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:n("tariffCalc.notice232Desc")})]}),e.jsxs("div",{className:"p-2 bg-info/10 border-l-4 border-info",children:[e.jsx("p",{children:e.jsx("strong",{children:n("tariffCalc.noticeAdcvd")})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:n("tariffCalc.noticeAdcvdDesc")})]})]})]})]})]})]})},Wd=t=>({total:(t==null?void 0:t.total)??0,count:(t==null?void 0:t.count)??0,offset:(t==null?void 0:t.offset)??0,results:Array.isArray(t==null?void 0:t.results)?t.results.map(s=>({id:(s==null?void 0:s.id)??"",case_number:(s==null?void 0:s.case_number)??"",country:(s==null?void 0:s.country)??"",product:(s==null?void 0:s.product)??"",commodity:(s==null?void 0:s.commodity)??"",url:(s==null?void 0:s.url)??"",hts_numbers:Array.isArray(s==null?void 0:s.hts_numbers)?s.hts_numbers:[]})):[]}),Jd=({q:t,size:s,offset:a,enabled:r=!0})=>Ft({queryKey:["adcvd-orders",{q:t,size:s,offset:a}],enabled:r&&!!t,queryFn:async()=>{const n=new URLSearchParams({q:t,size:String(s),offset:String(a)}),{data:o}=await rs(`/api/adcvd-orders?${n.toString()}`);return Wd(o||{})}}),il=(t,s)=>Ft({queryKey:["federal-register-search",t],enabled:!!(s&&t),queryFn:async()=>{var c;if(!t)throw new Error("Search parameters are required");const a=await lr({term:t.term||void 0,per_page:t.perPage,page:t.page,order:t.order,facets:t.facets,conditions:t.conditions,debug:t.debugMode,base_uri:t.debugMode?t.baseUri:void 0}),r=a.status??200;if(r!==200){const u=a.payload&&(a.payload.error||a.payload.message)||`HTTP ${r}`;throw new Error(u)}const n=a.payload,o=Ur(n),d=typeof(n==null?void 0:n.total_pages)=="number"?n.total_pages:typeof((c=n==null?void 0:n.documents)==null?void 0:c.total_pages)=="number"?n.documents.total_pages:0;return{docs:o,payload:n,totalPages:d||0,url:a.url,debugInfo:(n==null?void 0:n.__debug)??null}}});function ll(t){const{results:s,expandedDoc:a,expandedLoading:r,expandedError:n,expandedRaw:o,expandedDetail:d,onLoadDetail:c,page:u,totalPages:p,totalCount:v,onPrevPage:_,onNextPage:j,paginationDisabled:f,debugMode:x,onLoadSearchDetails:T,searchDetails:w,companyRatesEnabled:S,onCompanyRatesToggle:y,onShowCompanyRates:g}=t,{t:b}=Ge(),[R,P]=H.useState(a||"");H.useEffect(()=>{P(a||"")},[a]);const z=Pr,B=typeof u=="number"||typeof p=="number"||typeof v=="number"||_||j,M=p?b("fr.pageWithTotal",{page:u||1,totalPages:p}):b("fr.page",{page:u||1}),A=b("fr.totalCount",{count:typeof v=="number"?v:s.length}),V=f||!_||(typeof u=="number"?u<=1:!1),q=f||!j||(typeof p=="number"&&typeof u=="number"?p>0&&u>=p:!1),I=typeof y=="function";return e.jsxs("div",{children:[B&&e.jsxs("div",{className:"flex items-center gap-2 text-sm flex-wrap md:flex-nowrap gap-y-2 mb-3",children:[_&&e.jsx(ee,{variant:"secondary",size:"sm",className:"h-auto px-2 py-1",disabled:V,onClick:_,children:b("fr.prev")}),j&&e.jsx(ee,{variant:"secondary",size:"sm",className:"h-auto px-2 py-1",disabled:q,onClick:j,children:b("fr.next")}),e.jsx("span",{children:M}),e.jsx("span",{className:"text-xs text-muted-foreground",children:A}),e.jsx("span",{className:"font-semibold text-sm",children:b("fr.results.title",{count:s.length})}),I&&e.jsxs("div",{className:"ml-auto flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:b("fr.results.companyRatesToggle")}),e.jsx(pa,{checked:!!S,onCheckedChange:k=>y==null?void 0:y(!!k)})]})]}),!B&&e.jsx("div",{className:"font-semibold text-sm mb-2",children:b("fr.results.title",{count:s.length})}),s.length===0&&e.jsx("div",{className:"text-xs text-muted-foreground",children:b("fr.results.empty")}),e.jsx(la,{children:e.jsx(zs,{type:"single",collapsible:!0,className:"w-full divide-y",value:R,onValueChange:k=>P(k||""),children:s.map(k=>e.jsxs(ws,{value:k.document_number,className:"py-2",children:[e.jsx(z,{asChild:!0,className:"text-left px-0 items-start w-full",children:e.jsxs("div",{className:"flex w-full items-start justify-between gap-3",children:[e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium text-sm",children:k.html_url?e.jsx("a",{href:k.html_url,target:"_blank",rel:"noreferrer",className:"text-primary hover:underline",children:k.title}):e.jsx("span",{children:k.title})}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-0.5",children:[k.document_number," | ",k.type||""," | ",k.publication_date||""]}),e.jsx("div",{className:"text-[11px] text-muted-foreground mt-0.5",children:k.agencies_text||(Array.isArray(k.agencies)?k.agencies.map(F=>(F==null?void 0:F.name)||(F==null?void 0:F.raw_name)||"").filter(Boolean).join(", "):"")})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{onClick:F=>{F.stopPropagation(),P(k.document_number),c(k.document_number)},variant:"secondary",size:"sm",className:"h-auto px-2 py-1 text-xs",children:b("fr.results.details")}),x&&T&&e.jsx(ee,{onClick:F=>{F.stopPropagation(),T()},variant:"ghost",size:"sm",className:"h-auto px-2 py-1 text-xs",children:b("fr.results.searchDetails")}),S&&g&&e.jsx(ee,{onClick:F=>{F.stopPropagation(),g(k)},variant:"ghost",size:"sm",className:"h-auto px-2 py-1 text-xs",children:b("fr.results.companyRatesButton")}),k.body_html_url&&e.jsx("a",{href:k.body_html_url,target:"_blank",rel:"noreferrer",className:"text-xs text-primary hover:underline",onClick:F=>F.stopPropagation(),children:b("fr.results.fullText")})]}),k.public_inspection_pdf_url&&e.jsx("div",{className:"flex items-center",children:e.jsxs(Us,{children:[e.jsx(Bs,{asChild:!0,children:e.jsx("a",{href:k.public_inspection_pdf_url,target:"_blank",rel:"noreferrer",className:"text-xs text-primary hover:underline",onClick:F=>F.stopPropagation(),children:b("fr.results.publicInspection")})}),e.jsx(Ms,{children:e.jsxs("div",{className:"text-[11px]",children:[e.jsx("div",{className:"font-semibold",children:b("fr.results.publicInspectionTitle")}),e.jsx("div",{children:b("fr.results.publicInspectionDesc1")}),e.jsx("div",{children:b("fr.results.publicInspectionDesc2")})]})})]})}),k.pdf_url&&e.jsx("div",{className:"flex items-center",children:e.jsxs(Us,{children:[e.jsx(Bs,{asChild:!0,children:e.jsx("a",{href:k.pdf_url,target:"_blank",rel:"noreferrer",className:"text-xs text-primary hover:underline",onClick:F=>F.stopPropagation(),children:b("fr.results.pdf")})}),e.jsx(Ms,{children:e.jsxs("div",{className:"text-[11px]",children:[e.jsx("div",{className:"font-semibold",children:b("fr.results.pdfTitle")}),e.jsx("div",{children:b("fr.results.pdfDesc1")}),e.jsx("div",{children:b("fr.results.pdfDesc2")})]})})]})})]})]})}),e.jsxs(Ss,{className:"pt-0",children:[Array.isArray(k.excerpts)&&k.excerpts.length>0&&e.jsx("div",{className:"mt-1 text-xs text-muted-foreground space-y-1",children:k.excerpts.map((F,U)=>e.jsx("div",{className:"prose prose-sm max-w-none",dangerouslySetInnerHTML:{__html:Vi(F||"")}},U))}),a===k.document_number&&e.jsxs("div",{className:"mt-2 text-xs bg-muted/50 p-2 rounded border w-full",children:[r&&e.jsx("div",{children:b("fr.results.loadingDetail")}),n&&e.jsx("div",{className:"text-destructive",children:n}),!r&&!n&&d&&d.document_number===k.document_number&&e.jsx(La,{doc:d}),!r&&!n&&(!d||d.document_number!==k.document_number)&&e.jsx("div",{className:"text-muted-foreground",children:b("fr.results.noDetail")}),x&&o?e.jsx("div",{className:"mt-2",children:e.jsx(bt,{title:b("fr.results.docRaw"),data:o})}):null,x&&w?e.jsx("div",{className:"mt-2",children:e.jsx(bt,{title:b("fr.results.searchDetailsDebug"),data:w})}):null]})]})]},k.document_number))})})]})}const qs=t=>{if(!t)return null;if(typeof t=="object"&&"date"in t)return t.isNa?null:String(t.date).split("T")[0];if(typeof t=="string"&&t.includes("-")){const s=t.split("-");if(s.length===3&&s[2].length===4)return`${s[2]}-${s[0]}-${s[1]}`}return String(t)},Ve=(t,s)=>s.reduce((a,r)=>a!==void 0?a:t==null?void 0:t[r],void 0),on=(t,s)=>t==null||s==null?null:`https://ids.usitc.gov/case/${t}/investigation/${s}`,Xd=t=>i.useMemo(()=>{var z,B,M,A,V,q,I,k,F,U,ne,ge,$,le,_e,Ee,Fe,et,ze;const s=t??{},a=Ve(s,["Case ID","case_id"]),r=Ve(s,["Investigation ID","investigation_id"]),n=Ve(s,["Product Group Code"]),o=((z=Ve(s,["Phase Number"]))==null?void 0:z.Name)||((B=Ve(s,["Phase Number"]))==null?void 0:B.name)||Ve(s,["Phase Number"]),d={id:Ve(s,["Investigation ID","investigation_id"]),displayNumber:Ve(s,["official_investigation_number","Investigation Number"])||"",title:Ve(s,["Full Title","investigation_title","Topic"])||"",product:Ve(s,["Topic","product_name","short_product_name"])||"",status:((M=Ve(s,["Investigation Status","investigation_status_name"]))==null?void 0:M.Name)||((A=Ve(s,["Investigation Status","investigation_status_name"]))==null?void 0:A.name)||Ve(s,["Investigation Status","investigation_status_name"])||"",isActive:Ve(s,["Is Active?","is_active"])??!1,type:((V=Ve(s,["Investigation Type","investigation_type_name"]))==null?void 0:V.Name)||((q=Ve(s,["Investigation Type","investigation_type_name"]))==null?void 0:q.name)||Ve(s,["Investigation Type","investigation_type_name"])||"",phase:((I=Ve(s,["Investigation Phase","phase_long_title","phase_title"]))==null?void 0:I.Name)||((k=Ve(s,["Investigation Phase","phase_long_title","phase_title"]))==null?void 0:k.name)||Ve(s,["Investigation Phase","phase_long_title","phase_title"])||"",idsLink:on(a,r),productGroup:n,phaseNumber:o},c=((F=Ve(s,["Countries","countries"]))==null?void 0:F.map(G=>G.name||G["Country Name"]||G.country_name))||[],u=((U=Ve(s,["Investigation Categories"]))==null?void 0:U.map(G=>G.Name||G.name))||[],p=((ne=Ve(s,["Investigation Categories"]))==null?void 0:ne.map(G=>({id:G.ID??G.id,name:G.Name||G.name,active:G["Is Active?"]})))||[],v=Ve(s,["Case Manager"]),_=v?{name:`${v["Staff First Name"]||""} ${v["Staff Last Name"]||""}`.trim()||v.Name,email:v.Email,phone:v["Phone Number"],title:v["Staff Title"]}:null,j=[{key:"frNotice",defaultLabel:"FR Notice",date:qs(Ve(s,["Date of Publication of FR Notice (NOI)"])),type:"doc"},{key:"commerceInit",defaultLabel:"Commerce Initiation",date:qs(Ve(s,["Commerce Initiation Date"])),type:"milestone"},{key:"vote",defaultLabel:"Vote",date:qs(Ve(s,["Vote Date"])),type:"vote"}].filter(G=>G.date).sort((G,Ce)=>new Date(Ce.date).getTime()-new Date(G.date).getTime()),f=[{key:"startDate",label:"Start Date",value:Ve(s,["Start Date"])},{key:"investigationEnd",label:"Investigation End Date",value:Ve(s,["Investigation End Date"])},{key:"termination",label:"Investigation Termination Date",value:Ve(s,["Investigation Termination Date"])},{key:"finalDetermination",label:"Final Determination Date",value:Ve(s,["Final Determination Date"])},{key:"determination",label:"Determination Date",value:Ve(s,["Determination Date"])},{key:"initiatingDoc",label:"Initiating Document Received Date",value:Ve(s,["Initiating Document Received Date"])},{key:"responsesDue",label:"Responses to Notice of Institution Due Date",value:Ve(s,["Responses to Notice of Institution Due Date"])}].map(({key:G,label:Ce,value:pe})=>({key:G,label:Ce,date:qs(pe)})).filter(G=>G.date),x=((ge=Ve(s,["Commerce Orders"]))==null?void 0:ge.map(G=>{const Ce=Ve(G,["Case ID"])??a,pe=Ve(G,["Investigation ID"])??Ve(G,["Sub-Investigation","Investigation ID"])??r;return{number:G["Commerce Order/Case Number"],date:qs(G["Order Issuance/Suspension Agreement Date"]),desc:"Commerce Order",idsLink:on(Ce,pe),sub:Ve(G,["Sub-Investigation"])}}))||[],T=(($=Ve(s,["Staff","case_officers"]))==null?void 0:$.map(G=>{var Ce,pe;return{name:((Ce=G["Staff Name"])==null?void 0:Ce.Name)||G.Name||`${G.staff_first_name||""} ${G.staff_last_name||""}`.trim(),role:((pe=G["Staff Assigned Type"])==null?void 0:pe.Name)||G.staff_role_name,active:G["Is Active?"]}}))||[],w=((le=Ve(s,["Participants"]))==null?void 0:le.map(G=>{var Ce,pe,W,Q;return{name:(Ce=G.Participant)==null?void 0:Ce.Name,country:(W=(pe=G.Participant)==null?void 0:pe.Country)==null?void 0:W.name,type:(Q=G["Participant Type"])==null?void 0:Q.Name,isPetitioner:G["Is Petitioner?"]}}))||[],S=((_e=Ve(s,["HTS Number"]))==null?void 0:_e.map(G=>{var Ce,pe;return{active:G.Active,code:(Ce=G["HTS Number & Description"])==null?void 0:Ce.Name,desc:(pe=G["HTS Number & Description"])==null?void 0:pe.Description}}))||[],y=((Ee=Ve(s,["Intellectual Property"]))==null?void 0:Ee.map(G=>{var Ce,pe,W;return{activeDate:qs(G["Active Date"]),expiration:qs((Ce=G["Intellectual Property ID"])==null?void 0:Ce["IP Expiration Date"]),type:(W=(pe=G["Intellectual Property ID"])==null?void 0:pe.Type)==null?void 0:W.Name}}))||[],g=((Fe=Ve(s,["Unfair Act"]))==null?void 0:Fe.map(G=>{var Ce;return((Ce=G["Unfair Act in Notice"])==null?void 0:Ce.name)||G.name}))||[],b=((et=Ve(s,["Sub-investigation"]))==null?void 0:et.map(G=>{var Ce;return{number:G["Investigation Number"],country:(Ce=G.Country)==null?void 0:Ce.name,votes:G.Votes||[]}}))||[],R=((ze=Ve(s,["Investigation Documents"]))==null?void 0:ze.map(G=>{var Ce;return{title:G["Document Title"],link:G["Document Link"],type:(Ce=G["Document Type"])==null?void 0:Ce["Investigation Document Name"]}}))||[],P=[{label:"F.R. Citation for Notice of Institution",citation:Ve(s,["F.R. Citation for Notice of Institution"]),date:qs(Ve(s,["Date of Publication of FR Notice (NOI)"]))}].filter(G=>G.citation||G.date);return{...d,countries:c,categories:u,categoriesDetailed:p,manager:_,timeline:j,extraDates:f,orders:x,staff:T,participants:w,hts:S,ip:y,unfairActs:g,subInvestigations:b,documents:R,frNotices:P}},[t]),Zd=({status:t,active:s})=>{const{t:a}=Ge(),r=a,n=r("caseDashboard.completed",{defaultValue:"Completed"}),o=r("caseDashboard.active",{defaultValue:"Active"}),d=r("caseDashboard.inactive",{defaultValue:"Inactive"}),c=r("caseDashboard.na",{defaultValue:"N/A"}),u=(t==null?void 0:t.toLowerCase())==="completed"||t===n,p=s?"bg-success/20 text-success border-success/30":u?"bg-muted text-muted-foreground border-border":"bg-warning/20 text-warning border-warning/30",v=s?vo:u?ai:Or;return e.jsxs("span",{className:`inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-sm font-medium border ${p}`,children:[e.jsx(v,{size:14}),t||c," ",s?`(${o})`:`(${d})`]})},Ka=({icon:t,label:s,value:a,subValue:r})=>e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-muted/30 rounded-xl border border-border shadow-sm",children:[e.jsx("div",{className:"p-2 bg-primary/10 text-primary rounded-lg shrink-0",children:e.jsx(t,{size:20})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wide mb-0.5",children:s}),e.jsx("p",{className:"text-foreground font-medium",children:a||"N/A"}),r&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:r})]})]}),eu=({item:t,isLast:s})=>{const a=n=>{switch(n){case"milestone":return e.jsx(ai,{size:16,className:"text-white"});case"vote":return e.jsx(Or,{size:16,className:"text-white"});case"meeting":return e.jsx(So,{size:16,className:"text-white"});default:return e.jsx(Oa,{size:16,className:"text-white"})}},r=n=>{switch(n){case"milestone":return"bg-primary";case"vote":return"bg-warning";default:return"bg-muted-foreground"}};return e.jsxs("div",{className:"relative pl-8 pb-8 group",children:[!s&&e.jsx("div",{className:"absolute left-[11px] top-8 bottom-0 w-0.5 bg-border group-hover:bg-primary/40 transition-colors"}),e.jsx("div",{className:`absolute left-0 top-0 w-6 h-6 rounded-full flex items-center justify-center ring-4 ring-primary/10 ${r(t.type)}`,children:a(t.type)}),e.jsxs("div",{className:"bg-muted/30 p-4 rounded-lg border border-border shadow-sm group-hover:border-primary/40 transition-colors relative -top-2",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("span",{className:"text-sm font-bold text-foreground",children:t.label||t.event||t.defaultLabel||t.key}),e.jsx("span",{className:"text-xs font-mono text-muted-foreground bg-muted px-2 py-0.5 rounded",children:t.date})]}),t.detail&&e.jsxs("p",{className:"text-sm text-foreground mt-2 bg-muted/40 p-2 rounded border border-border flex items-start gap-2",children:[e.jsx(No,{size:14,className:"mt-0.5 text-primary shrink-0"}),t.detail]})]})]})},xa=({title:t,children:s,defaultOpen:a})=>{const[r,n]=i.useState(!!a),{t:o}=Ge(),d=o;return e.jsxs("div",{className:"rounded-xl border border-border bg-muted/20 shadow-sm",children:[e.jsxs("button",{className:"w-full flex items-center justify-between px-4 py-3 text-left text-foreground",onClick:()=>n(c=>!c),children:[e.jsx("span",{className:"font-semibold",children:t}),e.jsx("span",{className:"text-muted-foreground text-xs",children:r?d("caseDashboard.collapse",{defaultValue:"Collapse"}):d("caseDashboard.expand",{defaultValue:"Expand"})})]}),r&&e.jsx("div",{className:"border-t border-border px-4 py-3 space-y-3 bg-muted/10",children:s})]})},ol=({raw:t})=>{var v,_,j;const{t:s}=Ge(),a=s,r=a("caseDashboard.na",{defaultValue:"N/A"}),n=a("caseDashboard.inactive",{defaultValue:"Inactive"}),o=a("caseDashboard.petitioner",{defaultValue:"Petitioner"}),d=a("caseDashboard.commerceOrder",{defaultValue:"Commerce Order"}),c=f=>a(`caseDashboard.timeline.${f.key}`,{defaultValue:f.defaultLabel||f.key}),u=f=>a(`caseDashboard.extra.${f.key}`,{defaultValue:f.label||f.key}),p=Xd(t);return e.jsxs("div",{className:"bg-card text-card-foreground rounded-2xl border border-border p-4 space-y-4 shadow-sm",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[e.jsx("span",{className:"px-2 py-0.5 bg-muted text-muted-foreground text-xs font-bold rounded border border-border",children:p.type||a("caseDashboard.typeNA",{defaultValue:"Type N/A"})}),e.jsxs("span",{className:"text-sm font-mono text-muted-foreground",children:["#",p.displayNumber||"N/A"]})]}),e.jsx("h1",{className:"text-xl md:text-2xl font-bold leading-tight text-foreground",children:p.title||"No Title"}),p.phaseNumber&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[a("caseDashboard.phaseNumber",{defaultValue:"Phase Number"}),": ",p.phaseNumber]})]}),e.jsxs("div",{className:"shrink-0 text-right space-y-1",children:[e.jsx(Zd,{status:p.status,active:!!p.isActive}),p.idsLink&&e.jsx("div",{children:e.jsx("a",{href:p.idsLink,target:"_blank",rel:"noreferrer",className:"text-xs text-primary underline",children:a("caseDashboard.viewOnIds",{defaultValue:"View on IDS"})})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsx(Ka,{icon:yo,label:a("caseDashboard.cards.countries",{defaultValue:"Countries"}),value:p.countries.join(", ")||r}),e.jsx(Ka,{icon:bo,label:a("caseDashboard.cards.categories",{defaultValue:"Investigation Categories"}),value:p.categories.join(" & ")||r}),e.jsx(Ka,{icon:jo,label:a("caseDashboard.cards.product",{defaultValue:"Product"}),value:p.product||r}),e.jsx(Ka,{icon:Or,label:a("caseDashboard.cards.phase",{defaultValue:"Phase"}),value:p.phase||r})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(xa,{title:a("caseDashboard.sections.basic",{defaultValue:"Basic Info / Categories"}),defaultOpen:!0,children:e.jsxs("div",{className:"text-sm text-foreground space-y-2",children:[p.productGroup&&e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:a("caseDashboard.productGroup",{defaultValue:"Product Group Code"})}),e.jsxs("div",{className:"text-muted-foreground text-sm",children:[((v=p.productGroup)==null?void 0:v.Name)||r," ",((_=p.productGroup)==null?void 0:_["Product Group Code Description"])&&e.jsxs("span",{className:"text-muted-foreground",children:["(",(j=p.productGroup)==null?void 0:j["Product Group Code Description"],")"]})]})]}),p.categoriesDetailed.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:a("caseDashboard.categories",{defaultValue:"Investigation Categories"})}),e.jsx("ul",{className:"list-disc pl-5 text-muted-foreground",children:p.categoriesDetailed.map((f,x)=>e.jsxs("li",{children:[f.name," ",f.active===!1?`(${n})`:"",f.id?` [ID: ${f.id}]`:""]},x))})]})]})}),e.jsx(xa,{title:a("caseDashboard.sections.timeline",{defaultValue:"Timeline & Dates"}),defaultOpen:!0,children:e.jsxs("div",{className:"space-y-3",children:[p.timeline.length>0?p.timeline.map((f,x)=>e.jsx(eu,{item:{...f,label:c(f)},isLast:x===p.timeline.length-1},x)):e.jsx("p",{className:"text-sm text-muted-foreground",children:a("caseDashboard.empty.timeline",{defaultValue:"No timeline events"})}),p.extraDates.length>0&&e.jsx("div",{className:"rounded-md border border-border p-3 text-sm text-foreground space-y-1 bg-muted/30",children:p.extraDates.map((f,x)=>e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:u(f)}),e.jsx("span",{className:"font-mono text-foreground",children:f.date})]},x))})]})}),e.jsx(xa,{title:a("caseDashboard.sections.people",{defaultValue:"People & Participants"}),defaultOpen:!1,children:e.jsxs("div",{className:"space-y-3 text-sm text-foreground",children:[tu(p.manager),p.staff.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-1",children:a("caseDashboard.staff",{defaultValue:"Staff"})}),e.jsx("ul",{className:"list-disc pl-5 text-muted-foreground",children:p.staff.map((f,x)=>e.jsxs("li",{children:[f.name||r," ",f.role?`(${f.role})`:""," ",f.active===!1?` - ${n}`:""]},x))})]}),p.participants.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-1",children:a("caseDashboard.participants",{defaultValue:"Participants"})}),e.jsx("ul",{className:"list-disc pl-5 text-muted-foreground",children:p.participants.map((f,x)=>e.jsxs("li",{children:[f.name||r," ",f.type?`(${f.type})`:""," ",f.country?`- ${f.country}`:""," ",f.isPetitioner?`[${o}]`:""]},x))})]})]})}),e.jsx(xa,{title:a("caseDashboard.sections.scope",{defaultValue:"Scope & Items (HTS / IP / Unfair Act)"}),defaultOpen:!1,children:e.jsxs("div",{className:"space-y-3 text-sm text-foreground",children:[p.hts.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-1",children:a("caseDashboard.hts",{defaultValue:"HTS Number"})}),e.jsx("ul",{className:"list-disc pl-5 text-muted-foreground",children:p.hts.map((f,x)=>e.jsxs("li",{children:[f.code||r," - ",f.desc||r," ",f.active===!1?`(${n})`:""]},x))})]}),p.ip.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-1",children:a("caseDashboard.ip",{defaultValue:"Intellectual Property"})}),e.jsx("ul",{className:"list-disc pl-5 text-muted-foreground",children:p.ip.map((f,x)=>e.jsxs("li",{children:[f.type||r," | ",a("caseDashboard.activeDate",{defaultValue:"Active"}),": ",f.activeDate||r," | ",a("caseDashboard.expiration",{defaultValue:"Expiration"}),": ",f.expiration||r]},x))})]}),p.unfairActs.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-1",children:a("caseDashboard.unfairActs",{defaultValue:"Unfair Acts"})}),e.jsx("ul",{className:"list-disc pl-5 text-muted-foreground",children:p.unfairActs.map((f,x)=>e.jsx("li",{children:f},x))})]}),p.hts.length===0&&p.ip.length===0&&p.unfairActs.length===0&&e.jsx("p",{className:"text-muted-foreground",children:a("caseDashboard.empty.general",{defaultValue:"No related data"})})]})}),e.jsx(xa,{title:a("caseDashboard.sections.orders",{defaultValue:"Orders / Sub-investigation / Votes"}),defaultOpen:!1,children:e.jsxs("div",{className:"space-y-3 text-sm text-foreground",children:[p.orders.length>0?p.orders.map((f,x)=>{var T,w;return e.jsxs("div",{className:"rounded-md border border-border p-3 bg-muted/30",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:f.desc||d}),e.jsx("div",{className:"font-mono text-muted-foreground",children:f.number||r}),f.idsLink&&e.jsx("a",{href:f.idsLink,target:"_blank",rel:"noreferrer",className:"text-xs text-primary underline",children:a("caseDashboard.viewOnIds",{defaultValue:"View on IDS"})})]}),e.jsxs("div",{className:"text-right text-xs text-muted-foreground",children:[e.jsx("div",{children:a("caseDashboard.date",{defaultValue:"Date"})}),e.jsx("div",{className:"text-sm text-foreground",children:f.date||r})]})]}),f.sub&&e.jsxs("div",{className:"mt-2 text-xs text-muted-foreground",children:[a("caseDashboard.subInvestigation",{defaultValue:"Sub-Investigation"}),":"," ",f.sub["Investigation Number"]||r," ",(T=f.sub.Country)!=null&&T.name?`- ${(w=f.sub.Country)==null?void 0:w.name}`:""]})]},x)}):e.jsx("p",{className:"text-muted-foreground",children:a("caseDashboard.empty.orders",{defaultValue:"No orders data"})}),p.subInvestigations.length>0&&e.jsxs("div",{className:"rounded-md border border-border p-3 bg-muted/30",children:[e.jsx("div",{className:"font-semibold mb-2",children:a("caseDashboard.subInv",{defaultValue:"Sub-investigation / Votes"})}),e.jsx("ul",{className:"list-disc pl-5 space-y-2 text-muted-foreground",children:p.subInvestigations.map((f,x)=>e.jsxs("li",{children:[f.number||r," ",f.country?`- ${f.country}`:"",f.votes&&f.votes.length>0&&e.jsx("ul",{className:"list-disc pl-5 mt-1 text-xs",children:f.votes.map((T,w)=>{var S;return e.jsxs("li",{children:[a("caseDashboard.voteType",{defaultValue:"Vote Type"}),": ",((S=T["Vote Type"])==null?void 0:S.Name)||r," |"," ",a("caseDashboard.voteDate",{defaultValue:"Vote Date"}),": ",qs(T["Vote Date"])||r]},w)})})]},x))})]})]})}),e.jsx(xa,{title:a("caseDashboard.sections.documents",{defaultValue:"Documents / Notices"}),defaultOpen:!1,children:e.jsxs("div",{className:"space-y-3 text-sm text-foreground",children:[p.documents.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-1",children:a("caseDashboard.documents",{defaultValue:"Investigation Documents"})}),e.jsx("ul",{className:"list-disc pl-5 text-muted-foreground",children:p.documents.map((f,x)=>e.jsxs("li",{className:"space-x-1",children:[f.link?e.jsx("a",{href:f.link,target:"_blank",rel:"noreferrer",className:"text-primary underline",children:f.title||"Document"}):e.jsx("span",{children:f.title||"Document"}),f.type&&e.jsxs("span",{className:"text-xs text-slate-500",children:["(",f.type,")"]})]},x))})]}),p.frNotices.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-1",children:a("caseDashboard.frNotices",{defaultValue:"FR Notices / Citation"})}),e.jsx("ul",{className:"list-disc pl-5 text-muted-foreground",children:p.frNotices.map((f,x)=>e.jsxs("li",{children:[f.citation||r," ",f.date?`- ${f.date}`:""]},x))})]}),p.documents.length===0&&p.frNotices.length===0&&e.jsx("p",{className:"text-muted-foreground",children:a("caseDashboard.empty.documents",{defaultValue:"No documents/notices"})})]})})]})]})},tu=t=>{if(!t)return null;const{t:s}=Ge(),a=s;return e.jsxs("div",{className:"rounded-lg border border-border p-3 bg-muted/40",children:[e.jsxs("div",{className:"flex items-center gap-2 text-primary font-semibold",children:[e.jsx(wo,{size:16})," ",a("caseDashboard.caseManager",{defaultValue:"Case Manager"})]}),e.jsx("div",{className:"text-sm text-foreground mt-1",children:t.name}),t.title&&e.jsx("div",{className:"text-xs text-muted-foreground",children:t.title}),t.email&&e.jsx("div",{className:"text-xs text-primary mt-1",children:e.jsx("a",{href:`mailto:${t.email}`,className:"underline",children:t.email})}),t.phone&&e.jsx("div",{className:"text-xs text-muted-foreground",children:t.phone})]})},su=["","Completed","Terminated","Inactive","Active","Pending before the ALJ","Not Instituted","Complaint/Request Withdrawn","Pre-institution","Pending before the Commission","Adequacy","Pending","Cancelled","Petition/Request Withdrawn","Consolidated"],au=({defaultCountry:t="",defaultOrderNumber:s="",defaultOfficialId:a="",defaultStatus:r="",autoSearch:n=!1,title:o})=>{const{t:d}=Ge(),c=d,[u,p]=i.useState(""),[v,_]=i.useState(t),[j,f]=i.useState(r),[x,T]=i.useState(a),[w,S]=i.useState(s),[y,g]=i.useState(1),[b,R]=i.useState(null),[P,z]=i.useState({keyword:"",country:"",status:"",officialId:"",orderNumber:""}),B=i.useMemo(()=>!!P.keyword||!!P.country||!!P.status||!!P.officialId||!!P.orderNumber,[P]),{data:M,isFetching:A,isError:V,error:q}=Ft({queryKey:["id-search-card",P.keyword,P.country,P.status,P.officialId,P.orderNumber,y],queryFn:async()=>{const U=new URLSearchParams({q:P.keyword,country:P.country,status:P.status,officialId:P.officialId,orderNumber:P.orderNumber,page:y.toString(),pageSize:"10",includeRaw:"1"}),ne=await fetch(`/api/ids-search?${U.toString()}`);if(!ne.ok){const ge=await ne.json().catch(()=>({}));throw new Error(ge.message||"Failed to fetch IDS data")}return ne.json()},enabled:B,placeholderData:vi}),I=()=>{g(1),z({keyword:u.trim(),country:v.trim(),status:j.trim(),officialId:x.trim(),orderNumber:w.trim()})};i.useEffect(()=>{_(t),S(s),T(a),f(r),n&&(t||s||a||r)&&(z({keyword:"",country:t.trim(),status:r.trim(),officialId:a.trim(),orderNumber:s.trim()}),g(1))},[t,s,a,r,n]);const k=U=>{U.key==="Enter"&&I()};i.useEffect(()=>{M!=null&&M.rawData&&M.rawData.length>0?R(0):R(null)},[M==null?void 0:M.rawData]);const F=b!==null&&(M!=null&&M.rawData)&&M.rawData[b]?M.rawData[b]:null;return e.jsxs(Ne,{className:"p-4 md:p-6 space-y-4 border border-border bg-card text-card-foreground shadow-sm",children:[e.jsx(ot,{className:"p-0",children:e.jsx(pt,{className:"text-lg text-foreground",children:o||c("idSearch.title",{defaultValue:"USITC Investigation Search"})})}),e.jsxs(Be,{className:"p-0 space-y-4",children:[e.jsx("div",{className:"flex flex-col gap-3",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3 items-center",children:[e.jsx(He,{placeholder:c("idSearch.keyword",{defaultValue:"Keyword (topic/product/country)"}),value:u,onChange:U=>p(U.target.value),onKeyDown:k,disabled:A}),e.jsx("select",{className:"h-10 w-full rounded-md border border-input bg-background px-3 text-sm shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",value:j,onChange:U=>f(U.target.value),disabled:A,children:su.map(U=>e.jsx("option",{value:U,children:U||c("idSearch.allStatuses",{defaultValue:"All statuses"})},U||"all"))}),e.jsx(He,{placeholder:c("idSearch.invNumber",{defaultValue:"Inv. Number (e.g., 701-253)"}),value:x,onChange:U=>T(U.target.value),onKeyDown:k,disabled:A}),e.jsx("div",{className:"flex justify-end md:justify-start",children:e.jsxs(ee,{onClick:I,className:"w-full md:w-auto",disabled:A||!B&&!u&&!v&&!j&&!x&&!w,children:[A?e.jsx(ri,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(Hs,{className:"mr-2 h-4 w-4"}),c("common.search",{defaultValue:"Search"})]})})]})}),e.jsxs("div",{className:"relative min-h-[200px]",children:[A&&!M&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(wt,{className:"h-4 w-1/2"}),e.jsx(wt,{className:"h-4 w-full"}),e.jsx(wt,{className:"h-4 w-5/6"})]}),V&&!A&&e.jsxs("div",{className:"text-sm text-destructive",children:[c("idSearch.error",{defaultValue:"Failed to load search results."})," ",q==null?void 0:q.message]}),!A&&M&&M.data.length===0&&e.jsx("div",{className:"text-sm text-muted-foreground",children:c("idSearch.noResults",{defaultValue:"No results found for current filters."})}),M&&M.data.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm text-muted-foreground",children:[e.jsxs("span",{children:[c("idSearch.showing",{defaultValue:"Showing"})," ",M.metadata.totalItems>M.metadata.pageSize?`${(M.metadata.currentPage-1)*M.metadata.pageSize+1}-${Math.min(M.metadata.currentPage*M.metadata.pageSize,M.metadata.totalItems)}`:M.metadata.totalItems," ",c("idSearch.of",{defaultValue:"of"})," ",M.metadata.totalItems," ",c("idSearch.results",{defaultValue:"results."})]}),M.metadata.sourceDataTimestamp&&e.jsxs("span",{className:"text-xs",children:[c("idSearch.source",{defaultValue:"Source"}),":"," ",new Date(M.metadata.sourceDataTimestamp).toLocaleString()]})]}),e.jsx("div",{className:"overflow-x-auto rounded-md border border-border bg-muted/30",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-muted/40",children:e.jsxs("tr",{className:"border-b border-border text-left text-xs uppercase text-muted-foreground",children:[e.jsx("th",{className:"py-2 pr-3",children:c("idSearch.table.invNumber",{defaultValue:"Inv. Number"})}),e.jsx("th",{className:"py-2 pr-3",children:c("idSearch.table.topic",{defaultValue:"Topic"})}),e.jsx("th",{className:"py-2 pr-3",children:c("idSearch.table.phase",{defaultValue:"Phase"})}),e.jsx("th",{className:"py-2 pr-3",children:c("idSearch.table.countries",{defaultValue:"Countries"})}),e.jsx("th",{className:"py-2 pr-3",children:c("idSearch.table.startDate",{defaultValue:"Start Date"})}),e.jsx("th",{className:"py-2 pr-3",children:c("idSearch.table.endDate",{defaultValue:"End Date"})}),e.jsx("th",{className:"py-2 pr-3"})]})}),e.jsx("tbody",{children:M.data.map((U,ne)=>e.jsxs("tr",{className:"border-b border-border last:border-none",children:[e.jsx("td",{className:"py-2 pr-3 font-semibold text-primary",children:U.officialId||U.legacyId||U.id}),e.jsxs("td",{className:"py-2 pr-3",children:[e.jsx("div",{className:"font-medium",children:U.topic||U.title}),e.jsx("div",{className:"text-xs text-muted-foreground line-clamp-2",children:U.title})]}),e.jsx("td",{className:"py-2 pr-3",children:U.phase||"N/A"}),e.jsx("td",{className:"py-2 pr-3 text-xs text-muted-foreground",children:U.countries.length>0?U.countries.join(", "):"N/A"}),e.jsx("td",{className:"py-2 pr-3 text-xs",children:U.startDate||"—"}),e.jsx("td",{className:"py-2 pr-3 text-xs",children:U.endDate||"—"}),e.jsx("td",{className:"py-2 pr-3 text-right",children:e.jsxs(ee,{variant:"outline",size:"sm",onClick:()=>R(ne),disabled:!M.rawData||!M.rawData[ne],children:[e.jsx(Kn,{className:"h-4 w-4 mr-1"})," ",c("common.view",{defaultValue:"View"})]})})]},U.id))})]})}),M.metadata.totalPages>1&&e.jsxs("div",{className:"flex items-center justify-between pt-2",children:[e.jsx(ee,{variant:"outline",size:"sm",onClick:()=>g(U=>Math.max(U-1,1)),disabled:y<=1||A,children:c("common.prev",{defaultValue:"Previous"})}),e.jsx("span",{className:"text-sm text-muted-foreground",children:c("common.pageOf",{defaultValue:"Page {{current}} of {{total}}",current:M.metadata.currentPage,total:M.metadata.totalPages})}),e.jsx(ee,{variant:"outline",size:"sm",onClick:()=>g(U=>Math.min(U+1,M.metadata.totalPages)),disabled:y>=M.metadata.totalPages||A,children:c("common.next",{defaultValue:"Next"})})]}),F&&e.jsx("div",{className:"rounded-lg border border-border bg-muted/30 p-3",children:e.jsx(ol,{raw:F})})]})]})]})]})},ru=({item:t})=>{const{t:s}=Ge(),a=ma(),[r,n]=i.useState(!1),[o,d]=i.useState(1),[c,u]=i.useState(null),[p,v]=i.useState(null),[_,j]=i.useState(null),[f,x]=i.useState(!1),[T,w]=i.useState(null),S=i.useMemo(()=>{const X=[t.case_number,t.country,t.product].filter(Ae=>!!(Ae!=null&&Ae.trim())),xe=["Final Results","Administrative"];return[...X,...xe].map(Ae=>`"${Ae}"`).join(" & ").trim()},[t.case_number,t.country,t.product,s]),y=i.useMemo(()=>S?{term:S,perPage:10,page:o,order:"recent",facets:[],conditions:{},debugMode:!1}:null,[S,o]),g=il(y,r&&!!y),b=g.data,R=(b==null?void 0:b.docs)??[],P=(b==null?void 0:b.totalPages)??0,z=i.useMemo(()=>{var xe;const X=b==null?void 0:b.payload;return typeof(X==null?void 0:X.count)=="number"?X.count:typeof(X==null?void 0:X.total)=="number"?X.total:typeof((xe=X==null?void 0:X.documents)==null?void 0:xe.count)=="number"?X.documents.count:R.length},[b==null?void 0:b.payload,R]),B=g.error?g.error instanceof Error?g.error.message:String(g.error):null,M=g.isFetching||g.isLoading;i.useEffect(()=>{d(1),u(null)},[S]);const A=async X=>{if(X){u(X),w(null),x(!0);try{const xe=await or(a,X);v(xe.normalized),j(xe.raw)}catch(xe){w(xe instanceof Error?xe.message:String(xe))}finally{x(!1)}}},[V,q]=i.useState(!1),[I,k]=i.useState(!1),[F,U]=i.useState(null),[ne,ge]=i.useState(null),[$,le]=i.useState({start:null,end:null}),[_e,Ee]=i.useState(null),[Fe,et]=i.useState(null),[ze,G]=i.useState([]),[Ce,pe]=i.useState(!1),[W,Q]=i.useState(null),K=zr({documentNumber:F??"",enabled:V&&!!F}),we=X=>{if(!(!V||!(X!=null&&X.document_number))){if(F===X.document_number&&K.data){const xe=K.data;ge(xe.title||X.title||X.document_number),le({start:xe.period_start||null,end:xe.period_end||null}),Ee(xe.period_text||null),et(xe.heading_text||null),G(Array.isArray(xe==null?void 0:xe.rates)?xe.rates:[]),Q(null),k(!0),pe(!1);return}U(X.document_number),ge(X.title||X.document_number),le({start:null,end:null}),Ee(null),et(null),G([]),Q(null),k(!0),pe(!0)}};return i.useEffect(()=>{if(!F)return;if(K.isFetching){pe(!0);return}if(pe(!1),K.error){const xe=K.error instanceof Error?K.error.message:String(K.error);Q(xe);return}const X=K.data;if(X){if(le({start:X.period_start||null,end:X.period_end||null}),Ee(X.period_text||null),et(X.heading_text||null),X.title&&ge(X.title),X.special_case){Q(s("adcvdCard.frSection.specialCaseError",{case:X.special_case})),G([{company:"N/A",rate:X.source_url||`https://www.federalregister.gov/d/${F}`}]);return}G(Array.isArray(X==null?void 0:X.rates)?X.rates:[])}},[F,K.data,K.error,K.isFetching,s]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-4",children:e.jsx(zs,{type:"single",collapsible:!0,className:"w-full",children:e.jsxs(ws,{value:"ids-search",children:[e.jsx(Ts,{className:"px-0 text-sm font-medium text-left",children:"Investigation Search (prefilled from ADCVD case)"}),e.jsx(Ss,{className:"px-0",children:e.jsx(au,{title:"Investigation Search (prefilled from ADCVD case)",defaultOrderNumber:t.case_number||"",defaultCountry:t.country||"",autoSearch:!0})})]})})}),e.jsx(zs,{type:"single",collapsible:!0,value:r?"fr":"",onValueChange:X=>n(!!X),className:"w-full",children:e.jsxs(ws,{value:"fr",children:[e.jsx(Ts,{className:"px-0 text-sm font-medium text-left",children:s("adcvdCard.frSection.title")}),e.jsxs(Ss,{className:"px-0",children:[e.jsxs("div",{className:"text-xs text-muted-foreground mb-2",children:[s("adcvdCard.frSection.searchTerms"),": ",e.jsx("span",{className:"font-mono break-all",children:S||"N/A"})]}),M&&e.jsx("div",{className:"text-sm",children:s("adcvdCard.frSection.loading")}),B&&e.jsx("div",{className:"text-sm text-destructive",children:B}),!M&&!B&&y&&(R.length>0?e.jsx(ll,{results:R,expandedDoc:c,expandedLoading:f,expandedError:T,expandedRaw:_,expandedDetail:p,onLoadDetail:A,page:o,totalPages:P,totalCount:z,onPrevPage:()=>d(X=>Math.max(1,X-1)),onNextPage:()=>d(X=>P>0?Math.min(P,X+1):X+1),paginationDisabled:M,companyRatesEnabled:V,onCompanyRatesToggle:X=>{q(X),X||(k(!1),U(null),G([]),Q(null))},onShowCompanyRates:we}):e.jsx("div",{className:"text-sm text-muted-foreground",children:s("adcvdCard.frSection.noResults")})),!y&&e.jsx("div",{className:"text-sm text-muted-foreground",children:s("adcvdCard.frSection.noInfo")})]})]})}),e.jsx(Yr,{isOpen:I,onClose:()=>k(!1),country:ne||F,isLoading:Ce,error:W,rows:ze,title:ne,periodStart:$.start,periodEnd:$.end,periodText:_e,headingText:Fe})]})},cl=({htsCode:t})=>{const{t:s}=Ge(),a=t?t.replace(/\./g,""):"",[r,n]=i.useState(a),[o,d]=i.useState(10),[c,u]=i.useState(1),[p,v]=i.useState(a),_=Math.max(0,(c-1)*o),j=!!p,f=Jd({q:p,size:o,offset:_,enabled:j}),x=f.data??null,T=(x==null?void 0:x.total)??0,w=Math.max(1,Math.ceil((T||0)/o)),S=f.isFetching||f.isLoading,y=f.error?f.error instanceof Error?f.error.message:String(f.error):null;i.useEffect(()=>{if(t){const R=t.replace(/\./g,"");R!==r&&n(R),R!==p&&(u(1),v(R))}},[t]);const g=()=>{const R=r.trim();if(!R)return;const P=R.replace(/\./g,"");u(1),v(P)};i.useEffect(()=>{},[p,c,o]);const b=(x==null?void 0:x.results)??[];return e.jsxs(Ne,{className:"p-4 md:p-6 space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:s("adcvdCard.title")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("adcvdCard.description")})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3 items-end",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:s("adcvdCard.queryLabel")}),e.jsx(He,{value:r,onChange:R=>n(R.target.value),onKeyDown:R=>R.key==="Enter"&&g()})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:s("adcvdCard.sizeLabel")}),e.jsx(He,{type:"number",value:o,min:1,max:50,onChange:R=>{const P=Math.min(50,Math.max(1,Number(R.target.value)||10));d(P),u(1)}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:s("adcvdCard.pageLabel")}),e.jsx(He,{type:"number",value:c,min:1,max:w||1e9,onChange:R=>u(Math.max(1,Number(R.target.value)||1))})]})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap items-center",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ee,{onClick:g,disabled:S,children:s(S?"adcvdCard.searching":"adcvdCard.search")}),e.jsx(ee,{variant:"outline",onClick:()=>{n(""),u(1),v("")},children:s("adcvdCard.reset")})]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[s("adcvdCard.source"),":",e.jsx("a",{href:"https://access.trade.gov/ADCVD_Search.aspx",target:"_blank",rel:"noreferrer",className:"text-primary underline ml-1",children:"https://access.trade.gov/ADCVD_Search.aspx"})]})]}),y&&e.jsx(Rs,{variant:"destructive",children:e.jsx(Is,{children:y})}),j&&!S&&!y&&b.length===0&&e.jsx(Rs,{children:e.jsx(Is,{children:s("adcvdCard.noData")})}),b.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm text-muted-foreground flex-wrap gap-2",children:[e.jsx("span",{children:s("adcvdCard.results.summary",{total:T||b.length,count:b.length,offset:_})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{variant:"secondary",size:"sm",disabled:c<=1||S,onClick:()=>u(R=>Math.max(1,R-1)),children:s("adcvdCard.results.prev")}),e.jsx("span",{children:s("adcvdCard.results.page",{page:c,totalPages:w})}),e.jsx(ee,{variant:"secondary",size:"sm",disabled:c>=w||S,onClick:()=>u(R=>Math.min(w,R+1)),children:s("adcvdCard.results.next")})]})]}),e.jsx("div",{className:"overflow-auto border rounded-md",children:e.jsxs(Ys,{children:[e.jsx(oa,{children:e.jsxs(Gt,{children:[e.jsx(us,{className:"whitespace-nowrap",children:s("adcvdCard.table.case")}),e.jsx(us,{children:s("adcvdCard.table.country")}),e.jsx(us,{children:s("adcvdCard.table.product")}),e.jsx(us,{children:s("adcvdCard.table.hts")})]})}),e.jsx(Gs,{children:b.map((R,P)=>e.jsxs(H.Fragment,{children:[e.jsxs(Gt,{children:[e.jsx(_t,{className:"space-y-1 whitespace-nowrap",children:R.case_number?e.jsx("a",{className:"font-semibold text-primary hover:text-primary/80 underline",href:R.url||"#",target:"_blank",rel:"noreferrer",children:R.case_number}):e.jsx("div",{className:"font-semibold",children:"—"})}),e.jsx(_t,{children:R.country||"—"}),e.jsxs(_t,{className:"space-y-1",children:[e.jsx("div",{className:"text-sm font-medium",children:R.product||"—"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:R.commodity||"—"})]}),e.jsx(_t,{className:"text-xs text-muted-foreground",children:(R.hts_numbers||[]).join(", ")||"—"})]}),e.jsx(Gt,{children:e.jsx(_t,{colSpan:4,className:"bg-muted/40",children:e.jsx(ru,{item:R})})})]},`${R.case_number||P}-${P}`))})]})})]})]})},dl=i.createContext(void 0),nu=({children:t})=>{const[s,a]=i.useState(""),[r,n]=i.useState(""),[o,d]=i.useState(!1),[c,u]=i.useState(null),[p,v]=i.useState(null),[_,j]=i.useState([]),[f,x]=i.useState([]),[T,w]=i.useState(null),S=i.useMemo(()=>({searchTerm:s,setSearchTerm:a,activeHts:r,setActiveHts:n,isSearchLoading:o,setIsSearchLoading:d,searchError:c,setSearchError:u,tariffData:p,setTariffData:v,adcvdCountryList:_,setAdcvdCountryList:j,idsLinks:f,setIdsLinks:x,adcvdUpdatedAt:T,setAdcvdUpdatedAt:w}),[s,r,o,c,p,_,f,T]);return e.jsx(dl.Provider,{value:S,children:t})},iu=()=>{const t=i.useContext(dl);if(t===void 0)throw new Error("useIntelligence must be used within an IntelligenceProvider");return t},lu=()=>Ft({queryKey:["htsReleaseList"],staleTime:1e3*60*60,queryFn:async()=>{const t=typeof Intl<"u"&&Intl.DateTimeFormat().resolvedOptions().timeZone||"UTC",s=`/api/get-hts-release-list?timezone=${encodeURIComponent(t)}`,{data:a}=await rs(s);return Array.isArray(a)?a:[]}}),ou=t=>{const s=String(t||"").trim();if(!s)return"";if(s.includes("."))return s.replace(/\.{2,}/g,".");const a=s.replace(/\D/g,"");if(a.length<4)return s;const r=[];return r.push(a.slice(0,4)),a.length>=6&&r.push(a.slice(4,6)),a.length>=8&&r.push(a.slice(6,8)),a.length>=10&&r.push(a.slice(8,10)),a.length>=12&&r.push(a.slice(10,12)),r.join(".")},cu=t=>{if(t==null||t==="")return"";try{const s=new Date(t);if(Number.isNaN(s.getTime()))return String(t);const a=String(s.getMonth()+1).padStart(2,"0"),r=String(s.getDate()).padStart(2,"0");return`${s.getFullYear()}/${a}/${r}`}catch{return String(t)}};function cn(){const{t}=Ge(),{searchTerm:s,setSearchTerm:a,activeHts:r,setActiveHts:n,isSearchLoading:o,setIsSearchLoading:d,searchError:c,setSearchError:u,tariffData:p,setTariffData:v,adcvdCountryList:_,setAdcvdCountryList:j,idsLinks:f,setIdsLinks:x,adcvdUpdatedAt:T,setAdcvdUpdatedAt:w}=iu(),{htsSearchTerm:S,htsNavToken:y}=ra(),g=H.useRef(0),[b,R]=i.useState([]),[P,z]=i.useState(""),[B,M]=i.useState(!1),{addTrailItem:A}=Mr(),{data:V}=Nd(),q=V??null,I=lu(),k=H.useMemo(()=>{const ue=Array.isArray(I.data)?I.data:[];return ue.find(ve=>((ve==null?void 0:ve.status)||"").toLowerCase()==="current")||ue[0]||null},[I.data]),F=P||"",U=Mi(F),ne=jd(F),[ge,$]=i.useState(!1),[le,_e]=i.useState(null),[Ee,Fe]=i.useState([]),[et,ze]=i.useState(!1),[G,Ce]=i.useState(null),[pe,W]=i.useState(null),Q=zr({documentNumber:pe??"",enabled:!!pe}),K=!!P&&(U.isLoading||U.isFetching&&!p),we=!!P&&ne.isFetching;i.useEffect(()=>{const ue=!!P&&(U.isFetching||ne.isFetching);d(ue)},[P,U.isFetching,ne.isFetching,d]),i.useEffect(()=>{U.data&&v(U.data||null)},[U.data,v]),i.useEffect(()=>{if(U.error){const ue=U.error instanceof Error?U.error.message:String(U.error);u(ue)}},[U.error,u]),i.useEffect(()=>{ne.data&&(j(ne.data.countries),x(ne.data.idsLinks),w(ne.data.updatedAt))},[ne.data,j,x,w]),i.useEffect(()=>{ne.error&&console.error("AD/CVD data fetch error:",ne.error)},[ne.error]),i.useEffect(()=>{try{const ue=JSON.parse(localStorage.getItem("tariff_favorites")||"[]");R(ue)}catch(ue){console.error("Failed to save favorites to localStorage",ue)}},[]);async function X(ue){const ye=(ue??s)||"",ve=typeof ye=="string"?ye.replace(/\./g,"").trim():"";if(!ve)return;const De=ve.replace(/\D/g,"");if(De.length<4){u(t("tariff.enterDigits"));return}const jt=De.slice(0,12);A({type:"search",term:jt}),n(ou(ye)||jt),u(null),v(null),j([]),x([]),w(null),d(!0),z(jt)}i.useEffect(()=>{y>g.current&&(g.current=y,S&&(a(S),X(S)))},[y]),i.useEffect(()=>{try{const ue=new URLSearchParams(window.location.search),ye=ue.get("hts")||ue.get("term");ye&&ye.trim()&&(a(ye),X(ye))}catch{}},[]);function xe(ue,ye){ye&&(_e(ue),$(!0),Ce(null),Fe([]),W(ye),ze(!0))}i.useEffect(()=>{if(!pe)return;if(Q.isFetching){ze(!0);return}if(ze(!1),Q.error){const ye=Q.error instanceof Error?Q.error.message:String(Q.error);Ce(ye);return}const ue=Q.data;if(ue){if(ue.special_case){Ce(`This document has a special case: ${ue.special_case}. Please check the Federal Register directly.`),Fe([{company:"N/A",rate:ue.source_url||`https://www.federalregister.gov/d/${pe}`}]);return}Fe(Array.isArray(ue==null?void 0:ue.rates)?ue.rates:[])}},[pe,Q.data,Q.error,Q.isFetching]);function $e(ue){R(ue);try{localStorage.setItem("tariff_favorites",JSON.stringify(ue))}catch(ye){console.error("Failed to save favorites to localStorage",ye)}}function Ae(){if(!r||b.some(ye=>ye.hts===r))return;const ue=[...b,{hts:r,note:`Added on ${new Date().toLocaleDateString()}`}];$e(ue)}function ct(ue){const ye=b.filter(ve=>ve.hts!==ue);$e(ye)}const Tt=ue=>{a(ue),X(ue)},Z=()=>e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs(Ne,{children:[e.jsx(ot,{children:e.jsx(wt,{className:"h-8 w-3/4"})}),e.jsxs(Be,{className:"space-y-4",children:[e.jsx(wt,{className:"h-4 w-full"}),e.jsx(wt,{className:"h-4 w-full"}),e.jsx(wt,{className:"h-4 w-5/6"})]})]}),e.jsxs(Ne,{children:[e.jsx(ot,{children:e.jsx(wt,{className:"h-8 w-1/2"})}),e.jsxs(Be,{className:"space-y-4",children:[e.jsx(wt,{className:"h-10 w-full"}),e.jsx(wt,{className:"h-10 w-full"})]})]})]}),fe=()=>K?Z():p?e.jsxs(e.Fragment,{children:[e.jsx(Sd,{data:p}),e.jsx(Vd,{htsCode:r,defaultAdcvdCountries:_.map(ue=>ue.country)}),e.jsx(cl,{htsCode:r})]}):!o&&!c?e.jsx(As,{icon:e.jsx(Hs,{className:"h-12 w-12"}),title:t("tariff.welcomeTitle"),description:t("tariff.welcomeDesc")}):null;return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"sticky top-0 z-30 border-b bg-background/90 backdrop-blur-sm",children:e.jsxs("div",{className:"mx-auto flex w-full flex-wrap items-center justify-between gap-4 px-6 py-3",children:[e.jsxs("div",{className:"flex flex-shrink-0 items-center gap-3",children:[e.jsx(Ln,{className:"h-6 w-6 text-primary"}),e.jsx("h1",{className:"text-xl font-bold tracking-tight text-foreground",children:t("tariff.title")})]}),e.jsxs("div",{className:"flex w-full flex-wrap items-center justify-end gap-4 sm:w-auto sm:flex-1 sm:flex-nowrap",children:[e.jsx("div",{className:"order-first w-full min-w-[220px] sm:order-none sm:w-auto sm:flex-1",children:e.jsx(qd,{className:"mb-0",searchTerm:s,onSearchTermChange:a,onSearch:()=>X(),isLoading:o})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(ee,{size:"sm",variant:"outline",onClick:Ae,disabled:!r,className:"h-10",children:[e.jsx(kr,{className:"mr-2 h-4 w-4"}),t("tariff.addFavorite")]}),e.jsxs(ee,{size:"sm",variant:"outline",onClick:()=>M(!0),className:"h-10",children:[e.jsx(Co,{className:"mr-2 h-4 w-4"}),t("tariff.favorites")]})]}),e.jsx("div",{className:"hidden h-[54px] min-w-[240px] max-w-[240px] flex-col justify-center rounded-xl border bg-muted/50 px-3 py-2 text-xs leading-tight sm:text-sm lg:flex",children:I.isLoading?e.jsx("span",{className:"text-muted-foreground whitespace-nowrap",children:t("tariff.htsLoading")}):k?e.jsxs(e.Fragment,{children:[e.jsx("a",{href:"https://hts.usitc.gov/",target:"_blank",rel:"noreferrer",className:"font-semibold text-foreground underline-offset-2 hover:text-primary hover:underline truncate",title:k.description||k.title||void 0,children:k.description||k.title||"N/A"}),e.jsxs("span",{className:"text-muted-foreground whitespace-nowrap",children:[t("tariff.releaseDate"),"：",cu(k.formattedDate||k.date||k.releaseStartDate)||"N/A"]})]}):e.jsx("span",{className:"text-muted-foreground whitespace-nowrap",children:t("tariff.htsMissing")})})]})]})}),e.jsxs("main",{className:"mx-auto w-full px-6 py-6",children:[c&&e.jsxs(Rs,{variant:"destructive",className:"mt-4",children:[e.jsx(aa,{className:"h-4 w-4"}),e.jsx(ua,{children:t("tariff.searchErrorTitle")}),e.jsx(Is,{children:c})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 lg:grid-cols-3 lg:gap-6",children:[e.jsx("div",{className:"lg:col-span-2 flex flex-col gap-6",children:fe()}),e.jsx("div",{className:"flex flex-col gap-6 mt-6 lg:mt-0",children:K?e.jsxs(Ne,{children:[e.jsx(ot,{children:e.jsx(wt,{className:"h-8 w-3/4"})}),e.jsx(Be,{children:e.jsx(wt,{className:"h-24 w-full"})})]}):p?e.jsxs(e.Fragment,{children:[e.jsx(Kd,{htsCode:r,tariffData:p,programsLookup:q}),e.jsx(Rd,{isLoading:we,countryList:_,updatedAt:T,onViewDetails:xe}),e.jsx(Qd,{isLoading:we,links:f}),e.jsx(Gd,{hts:r,rawHts:s,defaultPerPage:5})]}):e.jsx("div",{className:"hidden lg:block",children:e.jsx(As,{icon:e.jsx(Hs,{className:"h-12 w-12"}),title:t("tariff.toolsTitle"),description:t("tariff.toolsDesc")})})})]})]}),e.jsx(Yr,{isOpen:ge,onClose:()=>$(!1),country:le,isLoading:et,error:G,rows:Ee}),e.jsx(zd,{open:B,onClose:()=>M(!1),favorites:b,onSelect:Tt,onRemove:ct})]})}const du=async t=>{var n,o;const s=await lr({...t,includeHeaders:!0,skipCache:!0});if(s.status!==200)throw new Error(((n=s.payload)==null?void 0:n.error)||`HTTP ${s.status}`);const a=s.headers||{},r=a["x-adapter-mode"]||(typeof((o=s.payload)==null?void 0:o.adapter_mode)=="string"?s.payload.adapter_mode:"");return{payload:s.payload,url:s.url,headers:a,adapterMode:r}},uu=t=>Ft({queryKey:["company-rates-verifier",t],enabled:!!t,staleTime:5*60*1e3,queryFn:async()=>{if(!t)throw new Error("Missing verifier parameters");const s=new URLSearchParams;Object.entries(t).forEach(([r,n])=>{n!=null&&s.set(r,String(n))});const{data:a}=await rs(`/api/get-company-rates-verifier?${s.toString()}`);return a}}),Mt={agenciesHelp:"FR 檢索機關（例如 international-trade-administration，或填 all）",typeHelp:"文件類型（例如 RULE,NOTICE 或 all）",perPageHelp:"每次 FR 回傳筆數上限（數字越大回應體量越大）",chunkSizeHelp:"每個 OR 合併查詢的子句數（越大請求數越少）",perCountryMinHelp:"公平輪詢保底：每國至少執行的查詢次數",fetchCapHelp:"全域 FR 請求上限（避免 30 秒超時）",tableCheckCapHelp:"全域 HTML 檢測上限（表格偵測上限）",legalTermsHelp:"將附加於預設產生的產品標題/案件號查詢（customTerms 路徑不會強加）。",includeCountryLabel:"Include Country in Search（預設構造時將國家名稱加入 AND 條件）",includeCountryHelp:"僅對「預設詞組構造」生效；使用自訂詞組 customTerms 時，請在詞組中選擇目標國家或 all。",phraseGenTitle:"Phrase Generator（自訂詞組清單）",phrasePlaceholder:"例如 Hot-Rolled Steel Products 或 701-TA-405",exactLabel:"Exact（加引號）",countryPlaceholder:"all 或特定國名（如 China）",addTableSignalsHelp:"檢測是否存在公司/稅率表格（HTML）以加分",tableCheckModeHelp:"none 不檢測；topN 檢測前 N 筆；all 檢測全部（受上限約束）",tableCheckTopNHelp:"topN 模式下要檢測的數量（較小較快）",scoreWeightsHelp:"可新增關鍵詞條（terms）與 bonus（has_body_html / has_rate_table）",broadcastLabel:"自訂詞組國家缺失時廣播（Broadcast）",broadcastHelp:"開啟：若 customTerms 指定國家不在本次 grouped，將套用到所有國家；關閉（建議）：跳過該詞組不廣播。",tipsTitle:"提示",tip1:"perCountryMin 大於 1 時，建議搭配較小的 chunk_size 或增加每國 terms，才能實際跑到多輪。",tip2:"customTerms 指定的國家不在本次 grouped 時，是否廣播到所有國家由「Country Broadcast」決定。"},ul=t=>t instanceof Error?t.message:String(t),Wa=H.forwardRef(({title:t,fetcher:s},a)=>{const[r,n]=i.useState(""),[o,d]=i.useState("Awaiting verification..."),[c,u]=i.useState(null),[p,v]=i.useState(""),[_,j]=i.useState(null),f=w=>{const S=new Date().toISOString().replace(/[:.]/g,"-");return`${t.toLowerCase().replace(/ /g,"-")}_${w}_${S}.json`},x=(w,S,y)=>{j(w);const g=JSON.stringify(w,null,2),b=S?`Fetch URL: ${S}

${g}`:g,R=new Blob([b],{type:"application/json"}),P=URL.createObjectURL(R);u(P),y&&v(y)},T=(w,S)=>{if(d("Loading..."),j(null),n(""),u(null),s){s(w,S).then(y=>{n(y.statusText??"Status: 200 Query cache"),x(y.payload,w,y.filename??f(S))}).catch(y=>{d(`Error: ${ul(y)}`),j(null),console.error(`Error fetching ${t}:`,y)});return}fetch(w).then(y=>(n(`Status: ${y.status} ${y.statusText}`),y.ok?y.json():y.text().then(g=>{throw new Error(g||`HTTP error ${y.status}`)}))).then(y=>{x(y,w,f(S))}).catch(y=>{d(`Error: ${y.message}`),j(null),console.error(`Error fetching ${t}:`,y)})};return H.useImperativeHandle(a,()=>({runFetch:T})),e.jsxs($r,{children:[e.jsx($i,{asChild:!0,children:e.jsxs("div",{className:"flex w-full cursor-pointer items-center justify-between p-4 border rounded-lg bg-card text-card-foreground",children:[e.jsx("span",{className:"font-semibold text-lg",children:t}),e.jsx(Dn,{className:"h-4 w-4"})]})}),e.jsx(Hr,{children:e.jsxs("div",{className:"p-4 border-t border-border",children:[e.jsx("div",{className:`text-sm mb-2 ${r.includes("200")?"text-success-foreground":"text-destructive"}`,children:r||"Awaiting verification..."}),_?e.jsx(bt,{data:_,title:"Response JSON"}):e.jsx("pre",{className:"bg-muted p-3 rounded-md text-xs flex-grow overflow-auto max-h-96",children:o}),c&&e.jsx("a",{href:c,download:p,className:"mt-2 text-sm text-primary hover:underline block",children:"Download Data"})]})})]})});function mu(){const[t,s]=i.useState("7306.30.10"),[a,r]=i.useState(!1),n=ma(),[o,d]=i.useState("term=Circular Welded Pipe&q_phrase=Final Results"),[c,u]=i.useState("international-trade-administration"),[p,v]=i.useState("RULE,NOTICE"),[_,j]=i.useState(!0),[f,x]=i.useState("auto"),[T,w]=i.useState(""),[S,y]=i.useState(null),[g,b]=i.useState(null),[R,P]=i.useState(null),[z,B]=i.useState(null),[M,A]=i.useState(null),[V,q]=i.useState(null),[I,k]=i.useState(""),[F,U]=i.useState(!1),[ne,ge]=i.useState(!1),[$,le]=i.useState(!1),[_e,Ee]=i.useState(50),[Fe,et]=i.useState("agency,type,section,topic,daily,weekly,monthly,quarterly"),ze=ne||$||F,G={"hts-proxy":H.useRef(null),"dataweb-proxy":H.useRef(null),"baseline-adapter":H.useRef(null),"dataweb-adapter":H.useRef(null)},Ce=H.useCallback(async(l,h)=>{const Y=new URL(l,window.location.origin),E=Y.searchParams.get("year")||new Date().getFullYear().toString(),Le=Y.searchParams.get("search_term")||h;return{payload:await n.fetchQuery({queryKey:["baseline-adapter",E,Le],queryFn:()=>qi(E,Le)}),statusText:"Status: 200 (Query cache)",filename:`baseline-adapter_${Le}_${E}.json`}},[n]),pe=(l,h,Y)=>{switch(l){case"hts-proxy":return`/api/hts-proxy?query=${h}`;case"dataweb-proxy":const E=`/api/v2/tariff/currentTariffDetails?year=${Y}&hts8=${h}`;return`/api/dataweb-proxy?endpoint=${encodeURIComponent(E)}`;case"baseline-adapter":return`/api/baseline-adapter?year=${Y}&search_term=${h}`;case"dataweb-adapter":return`/api/dataweb-adapter?year=${Y}&hts8=${h}`;default:return""}},W=async()=>{const l=t.trim().replace(/\./g,"");if(!l){alert("Please enter an HTS code.");return}r(!0);const h=new Date().getFullYear().toString();Object.entries(G).forEach(([Y,E])=>{var ae;const Le=pe(Y,l,h);(ae=E.current)==null||ae.runFetch(Le,l)}),setTimeout(()=>r(!1),5e3)},Q=(l,h)=>{const Y=`Fetch URL: ${l}

${JSON.stringify(h,null,2)}`;return URL.createObjectURL(new Blob([Y],{type:"text/plain"}))},K=async(l,h)=>{const Y=l.trim();if(!Y)return;const E=h==="primary"?ge:le,Le=h==="primary"?y:B,ae=h==="primary"?b:A,Pe=h==="primary"?P:q;E(!0);try{const{payload:Re,url:Ye,adapterMode:tt}=await n.fetchQuery({queryKey:["fr-adapter-find",Y],queryFn:()=>Br(Y)});ae(Ye),Le({status:"200 OK",data:Re,adapterMode:tt}),Pe(Q(Ye,Re))}catch(Re){Le({status:"Fetch Error",data:{error:ul(Re)}}),ae(null),Pe(null)}finally{E(!1)}},we=()=>{y(null),b(null),P(null),k(""),B(null),A(null),q(null);const l=T.trim();if(l){K(l,"primary");return}const h=new URLSearchParams(o),Y=[h.get("term")||"",h.get("q_phrase")||""].filter(Boolean).join(" ").trim()||void 0,E=Re=>Re.split(",").map(Ye=>Ye.trim()).filter(Boolean),Le={};c&&c!=="all"&&(Le.agencies=E(c)),p&&p!=="all"&&(Le.type=E(p));const ae=Fe.split(",").map(Re=>Re.trim()).filter(Boolean),Pe={term:Y,conditions:Le,per_page:_e,facets:ae,debug:_};U(!0),n.fetchQuery({queryKey:["fr-adapter-search",Pe],queryFn:()=>du(Pe)}).then(({payload:Re,url:Ye,adapterMode:tt})=>{b(Ye),y({status:"200 OK",data:Re,adapterMode:tt}),P(Q(Ye,Re))}).catch(Re=>{const Ye=Re instanceof Error?Re.message:String(Re);y({status:"Fetch Error",data:{error:Ye}}),b(null),P(null)}).finally(()=>U(!1))},X=()=>{const l=new URL(window.location.href);l.searchParams.set("tab","intelligence"),t&&l.searchParams.set("hts",t),window.location.href=l.toString()},xe=l=>{var Y,E,Le;return l?(Array.isArray(l==null?void 0:l.results)?l.results:Array.isArray((Y=l==null?void 0:l.documents)==null?void 0:Y.results)?l.documents.results:Array.isArray(l==null?void 0:l.documents)?l.documents:Array.isArray((E=l==null?void 0:l.processed_output)==null?void 0:E.documents)?l.processed_output.documents:Array.isArray((Le=l==null?void 0:l.raw_gem_output)==null?void 0:Le.results)?l.raw_gem_output.results:[]).map(ae=>{var Pe;return(ae==null?void 0:ae.document_number)||(ae==null?void 0:ae.documentNumber)||((Pe=ae==null?void 0:ae.attributes)==null?void 0:Pe.document_number)}).filter(ae=>typeof ae=="string"&&ae.trim().length>0):[]},$e=l=>{var h,Y,E;return l?Array.isArray(l==null?void 0:l.results)?l.results:Array.isArray((h=l==null?void 0:l.documents)==null?void 0:h.results)?l.documents.results:Array.isArray(l==null?void 0:l.documents)?l.documents:Array.isArray((Y=l==null?void 0:l.processed_output)==null?void 0:Y.documents)?l.processed_output.documents:Array.isArray((E=l==null?void 0:l.raw_gem_output)==null?void 0:E.results)?l.raw_gem_output.results:[]:[]},Ae=l=>l&&l.attributes&&typeof l.attributes=="object"?{...l,...l.attributes}:l,ct=(l,h)=>{var E;if(!l||!h)return null;const Y=$e(l);for(const Le of Y){const ae=Ae(Le)||{},Pe=ae.document_number||ae.documentNumber||((E=ae.attributes)==null?void 0:E.document_number);if(String(Pe)===String(h))return ae}return null},Tt=l=>!l&&l!==0?e.jsx("span",{className:"text-muted-foreground",children:"—"}):typeof l=="string"&&(l.startsWith("http://")||l.startsWith("https://"))?e.jsx("a",{href:l,target:"_blank",rel:"noreferrer",className:"text-primary hover:underline break-all",children:l}):Array.isArray(l)?l.join(", "):typeof l=="object"?e.jsx("code",{className:"text-[11px] break-all",children:JSON.stringify(l)}):String(l),Z=l=>{const h=Array.isArray(l==null?void 0:l.agencies)?l.agencies:[];if(h.length)return h.map(Y=>(Y==null?void 0:Y.name)||(Y==null?void 0:Y.raw_name)||"").filter(Boolean).join(", ")},fe=(l,h)=>{const Y=[],E=(St,es,Nt)=>Y.push({k:St,a:es,b:Nt});if(!l&&!h)return Y;E("document_number",(l==null?void 0:l.document_number)||(l==null?void 0:l.documentNumber),(h==null?void 0:h.document_number)||(h==null?void 0:h.documentNumber)),E("title",l==null?void 0:l.title,h==null?void 0:h.title),E("type",(l==null?void 0:l.type)||(l==null?void 0:l.action),(h==null?void 0:h.type)||(h==null?void 0:h.action)),E("publication_date",(l==null?void 0:l.publication_date)||(l==null?void 0:l.date),(h==null?void 0:h.publication_date)||(h==null?void 0:h.date)),E("agencies",Z(l),Z(h)),E("agency_names",l==null?void 0:l.agency_names,h==null?void 0:h.agency_names),E("html_url",(l==null?void 0:l.html_url)||(l==null?void 0:l.body_html_url),(h==null?void 0:h.html_url)||(h==null?void 0:h.body_html_url)),E("body_html_url",l==null?void 0:l.body_html_url,h==null?void 0:h.body_html_url),E("pdf_url",l==null?void 0:l.pdf_url,h==null?void 0:h.pdf_url),E("public_inspection_pdf_url",l==null?void 0:l.public_inspection_pdf_url,h==null?void 0:h.public_inspection_pdf_url),E("abstract",l==null?void 0:l.abstract,h==null?void 0:h.abstract),E("addresses",l==null?void 0:l.addresses,h==null?void 0:h.addresses),E("contact",l==null?void 0:l.contact,h==null?void 0:h.contact),E("comment_url",l==null?void 0:l.comment_url,h==null?void 0:h.comment_url),E("comments_close_on",l==null?void 0:l.comments_close_on,h==null?void 0:h.comments_close_on),E("disposition_notes",l==null?void 0:l.disposition_notes,h==null?void 0:h.disposition_notes),E("action",l==null?void 0:l.action,h==null?void 0:h.action);const Le=Array.isArray(l==null?void 0:l.excerpts)?l.excerpts:void 0,ae=Array.isArray(h==null?void 0:h.excerpts)?h.excerpts:void 0;E("excerpts",Le,ae),E("dates",l==null?void 0:l.dates,h==null?void 0:h.dates),E("effective_on",l==null?void 0:l.effective_on,h==null?void 0:h.effective_on),E("start_page",l==null?void 0:l.start_page,h==null?void 0:h.start_page),E("end_page",l==null?void 0:l.end_page,h==null?void 0:h.end_page),E("page_length",l==null?void 0:l.page_length,h==null?void 0:h.page_length),E("volume",l==null?void 0:l.volume,h==null?void 0:h.volume),E("docket_id",l==null?void 0:l.docket_id,h==null?void 0:h.docket_id),E("docket_ids",l==null?void 0:l.docket_ids,h==null?void 0:h.docket_ids),E("dockets",l==null?void 0:l.dockets,h==null?void 0:h.dockets),E("full_text_xml_url",l==null?void 0:l.full_text_xml_url,h==null?void 0:h.full_text_xml_url),E("raw_text_url",l==null?void 0:l.raw_text_url,h==null?void 0:h.raw_text_url),E("json_url",l==null?void 0:l.json_url,h==null?void 0:h.json_url),E("mods_url",l==null?void 0:l.mods_url,h==null?void 0:h.mods_url),E("regulation_id_number_info",l==null?void 0:l.regulation_id_number_info,h==null?void 0:h.regulation_id_number_info),E("regulation_id_numbers",l==null?void 0:l.regulation_id_numbers,h==null?void 0:h.regulation_id_numbers),E("regulations_dot_gov_info",l==null?void 0:l.regulations_dot_gov_info,h==null?void 0:h.regulations_dot_gov_info),E("regulations_dot_gov_url",l==null?void 0:l.regulations_dot_gov_url,h==null?void 0:h.regulations_dot_gov_url),E("further_information",l==null?void 0:l.further_information,h==null?void 0:h.further_information),E("supplementary_information",l==null?void 0:l.supplementary_information,h==null?void 0:h.supplementary_information),E("toc_doc",l==null?void 0:l.toc_doc,h==null?void 0:h.toc_doc),E("toc_subject",l==null?void 0:l.toc_subject,h==null?void 0:h.toc_subject),E("topics",l==null?void 0:l.topics,h==null?void 0:h.topics),E("significant",l==null?void 0:l.significant,h==null?void 0:h.significant),E("signing_date",l==null?void 0:l.signing_date,h==null?void 0:h.signing_date),E("subtype",l==null?void 0:l.subtype,h==null?void 0:h.subtype),E("presidential_document_number",l==null?void 0:l.presidential_document_number,h==null?void 0:h.presidential_document_number),E("proclamation_number",l==null?void 0:l.proclamation_number,h==null?void 0:h.proclamation_number);const Pe=l==null?void 0:l.page_views,Re=h==null?void 0:h.page_views;E("page_views.count",Pe==null?void 0:Pe.count,Re==null?void 0:Re.count),E("page_views.last_updated",Pe==null?void 0:Pe.last_updated,Re==null?void 0:Re.last_updated);const Ye=Array.isArray(l==null?void 0:l.cfr_references)?l.cfr_references:void 0,tt=Array.isArray(h==null?void 0:h.cfr_references)?h.cfr_references:void 0;return E("cfr_references",Ye,tt),Y},ue=l=>{l&&(B(null),A(null),q(null),K(l,"comparison"))},[ye,ve]=i.useState({agencies:"international-trade-administration",type:"RULE,NOTICE",per_page:50,chunk_size:5,legalTerms:'("Final Results of Administrative Review" OR "Amended Final Results" OR "Final Determination")',enableScoring:!0,addTableSignals:!0,tableCheckMode:"topN",tableCheckTopN:5,scoreWeights:JSON.stringify({terms:[{pattern:"amended final",score:7,type:"contains"},{pattern:"final results",score:6,type:"contains",and:["administrative review"]},{pattern:"final determination",score:5,type:"contains"},{pattern:"preliminary",score:4,type:"contains"},{pattern:"initiation",score:3,type:"contains"},{pattern:"changed circumstances",score:2,type:"contains"},{pattern:"sunset review",score:1,type:"contains"}],bonus:{has_body_html:.5,has_rate_table:1}},null,2),perCountryMin:1,fetchCap:12,tableCheckCap:10,includeCountry:!1,countryBroadcast:!1}),[De,jt]=i.useState(null),vt=uu(De),qt=vt.isFetching,[ft,Zt]=i.useState(null),[it,xt]=i.useState(null),[xs,Dt]=i.useState(null),[zt,Ke]=i.useState(""),[Rt,ms]=i.useState(1),[Kt,Lt]=i.useState("contains"),[os,cs]=i.useState(""),[hs,Fs]=i.useState(""),[Wt,ds]=i.useState(!1),[gs,ps]=i.useState(!1),[Jt,Ut]=i.useState("all"),[Cs,ns]=i.useState([]),[C,re]=i.useState(!1),[ie,m]=i.useState(!1),[D,O]=i.useState(null),[de,he]=i.useState([]),[Ue,Se]=i.useState("From FR Verifier"),[se,ke]=i.useState(null),be=zr({documentNumber:se??"",enabled:!!se});i.useEffect(()=>{if(!se){m(!1);return}if(be.isFetching){m(!0);return}if(m(!1),be.error){const h=be.error instanceof Error?be.error.message:String(be.error);O(h);return}const l=be.data;if(l){if(l.special_case){O(`Special case: ${l.special_case}. Please check FR directly.`),he([{company:"N/A",rate:l.source_url||`https://www.federalregister.gov/d/${se}`}]);return}he(Array.isArray(l==null?void 0:l.rates)?l.rates:[])}},[se,be.data,be.error,be.isFetching]);const We=()=>{xt(null),Zt(null),Dt(null);const l=t.trim().replace(/\./g,"");if(!l){jt(null),xt("Please enter an HTS code.");return}const h={hts_code:l,...ye,customTerms:JSON.stringify(Cs)};jt(h)};i.useEffect(()=>{if(!De||vt.isFetching)return;if(vt.error){const E=vt.error instanceof Error?vt.error.message:String(vt.error);xt(E);return}if(!vt.data)return;Zt(vt.data);const l=new URL("/api/get-company-rates-verifier",window.location.origin);Object.entries(De).forEach(([E,Le])=>l.searchParams.set(E,String(Le)));const h=`URL: ${l.toString()}

${JSON.stringify(vt.data,null,2)}`,Y=new Blob([h],{type:"text/plain"});Dt(URL.createObjectURL(Y))},[vt.data,vt.error,vt.isFetching,De]);const rt=()=>{var l;if(ft)try{const h=JSON.parse(ye.scoreWeights),Y=Array.isArray(h.terms)?h.terms:[],E=h.bonus||{},Le=Nt=>{const It=(Nt||"").toLowerCase();let gt=0;const ut=[];for(const Ct of Y)if(Ct.type==="regex")try{new RegExp(Ct.pattern,"i").test(Nt)&&(gt=Math.max(gt,Ct.score),ut.push(`/${Ct.pattern}/:${Ct.score}`))}catch{}else It.includes(String(Ct.pattern).toLowerCase())&&(!Ct.and||Ct.and.every(je=>It.includes(je.toLowerCase())))&&(gt=Math.max(gt,Ct.score),ut.push(`${Ct.pattern}:${Ct.score}`));return{s:gt,matched:ut}},ae={},Pe=[],Re=ft.features||{};for(const[Nt,It]of Object.entries(ft.raw_documents||{})){let gt=null;for(const ut of It){const Ct=Le(ut.title||"");let oe=Ct.s;const je=((l=Re==null?void 0:Re[Nt])==null?void 0:l[ut.document_number])||{};E.has_body_html&&je.has_body_html&&(oe+=E.has_body_html),E.has_rate_table&&je.has_rate_table&&(oe+=E.has_rate_table),Pe.push({country:Nt,doc:ut,score:oe,matched_rules:Ct.matched,bonus:{has_body_html_bonus:je.has_body_html&&E.has_body_html||0,has_rate_table_bonus:je.has_rate_table&&E.has_rate_table||0}}),(!gt||oe>gt.score||oe===gt.score&&new Date(ut.publication_date||0).getTime()>new Date(gt.doc.publication_date||0).getTime())&&(gt={doc:ut,score:oe})}gt&&(ae[Nt]={latest:{title:gt.doc.title,url:gt.doc.html_url,date:gt.doc.publication_date,document_number:gt.doc.document_number},score:gt.score})}const Ye=Object.keys(ft.raw_documents||{}).sort().map(Nt=>{var It;return{country:Nt,hasCase:!!ae[Nt],latest:((It=ae[Nt])==null?void 0:It.latest)||null}}),tt={...ft,scoring:{...ft.scoring||{},selected_per_country:ae,candidates_per_country:Pe},output:{...ft.output||{},countries:Ye}};Zt(tt);const St=`LOCAL RESCORE
Params: ${ye.scoreWeights}

${JSON.stringify(tt,null,2)}`,es=new Blob([St],{type:"text/plain"});Dt(URL.createObjectURL(es))}catch{alert("Invalid scoreWeights JSON")}},Oe=()=>{try{const l=JSON.parse(ye.scoreWeights||"{}");Array.isArray(l.terms)||(l.terms=[]);const h={pattern:zt,score:Number(Rt),type:Kt},Y=(os||"").split(",").map(E=>E.trim()).filter(Boolean);Y.length&&(h.and=Y),l.terms.push(h),ve(E=>({...E,scoreWeights:JSON.stringify(l,null,2)})),Ke(""),ms(1),Lt("contains"),cs("")}catch{alert("Invalid scoreWeights JSON - cannot add term")}},Je=(l,h)=>{if(Se(h||"From FR Verifier"),re(!0),O(null),he([]),!l){ke(null),m(!1),O("Missing document number.");return}ke(l),m(!0)};return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Data Source Verifier"}),e.jsx(ee,{onClick:X,variant:"outline",children:"Open Intelligence"})]}),e.jsxs(ha,{defaultValue:"hts",children:[e.jsxs(na,{className:"grid w-full grid-cols-3",children:[e.jsx(is,{value:"hts",children:"HTS Sources"}),e.jsx(is,{value:"fr",children:"FR Adapter"}),e.jsx(is,{value:"rates",children:"Rates Verifier"})]}),e.jsx(ls,{value:"hts",className:"mt-4",children:e.jsxs(Ne,{children:[e.jsxs(ot,{children:[e.jsx(pt,{children:"HTS Data Source Verification"}),e.jsx($s,{children:"Verify HTS-related data sources for a given HTS code."})]}),e.jsxs(Be,{children:[e.jsxs("form",{onSubmit:l=>{l.preventDefault(),a||W()},className:"flex items-center gap-2 mb-6",children:[e.jsxs("div",{className:"relative flex-grow",children:[e.jsx(Hs,{className:"absolute left-3 top-1/2 h-5 w-5 -translate-y-1/2 text-muted-foreground"}),e.jsx(He,{type:"text",value:t,onChange:l=>s(l.target.value),className:"pl-10",placeholder:"Enter HTS code..."})]}),e.jsx(ee,{type:"submit",disabled:a,children:a?"Verifying...":"Verify HTS Sources"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(Wa,{ref:G["hts-proxy"],title:"hts-proxy (Raw)"}),e.jsx(Wa,{ref:G["dataweb-proxy"],title:"dataweb-proxy (Raw)"}),e.jsx(Wa,{ref:G["baseline-adapter"],title:"baseline-adapter (Processed)",fetcher:Ce}),e.jsx(Wa,{ref:G["dataweb-adapter"],title:"dataweb-adapter (Processed)"})]})]})]})}),e.jsx(ls,{value:"fr",className:"mt-4",children:e.jsxs(Ne,{children:[e.jsx(ot,{children:e.jsx(pt,{children:"FR Ruby Adapter Verifier"})}),e.jsxs(Be,{children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(Te,{htmlFor:"fr-raw-query",children:"Query Parameters (e.g., term=pipe&q_any=steel,aluminum)"}),e.jsx(nr,{id:"fr-raw-query",value:o,onChange:l=>d(l.target.value),className:"mt-1 font-mono text-xs",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx(Te,{htmlFor:"fr-mode",children:"Mode"}),e.jsxs($t,{value:f,onValueChange:l=>x(l),children:[e.jsx(Pt,{id:"fr-mode",className:"mt-1",children:e.jsx(Ht,{})}),e.jsxs(Et,{children:[e.jsx(nt,{value:"auto",children:"Auto"}),e.jsx(nt,{value:"http",children:"HTTP (Fallback)"}),e.jsx(nt,{value:"ruby",children:"Ruby"})]})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(Te,{htmlFor:"fr-doc-number",children:"Document Number (optional)"}),e.jsx(He,{id:"fr-doc-number",type:"text",value:T,onChange:l=>w(l.target.value),placeholder:"e.g., 2025-19448",className:"mt-1"})]})]}),e.jsxs("div",{children:[e.jsx(Te,{htmlFor:"fr-agencies",children:"Agencies (comma-separated, or 'all')"}),e.jsx(He,{id:"fr-agencies",type:"text",value:c,onChange:l=>u(l.target.value),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(Te,{htmlFor:"fr-types",children:"Types (comma-separated, or 'all')"}),e.jsx(He,{id:"fr-types",type:"text",value:p,onChange:l=>v(l.target.value),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(Te,{htmlFor:"fr-per-page",children:"每頁筆數 (per_page)"}),e.jsx(He,{id:"fr-per-page",type:"number",min:1,value:_e,onChange:l=>Ee(Number(l.target.value)||1),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(Te,{htmlFor:"fr-facets",children:"Facets (逗號分隔)"}),e.jsx(He,{id:"fr-facets",type:"text",value:Fe,onChange:l=>et(l.target.value),className:"mt-1"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"將 facets 傳給 fr-ts-search 以取得更豐富的分面資料。"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(fs,{id:"fr-debug",checked:_,onCheckedChange:l=>j(!!l)}),e.jsx(Te,{htmlFor:"fr-debug",children:"Enable Debug Mode"})]}),e.jsx("div",{children:e.jsx(ee,{onClick:we,disabled:ze,children:ze?"Verifying...":"Verify FR Adapter"})})]}),g&&e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-sm font-medium",children:"Fetch URL:"}),e.jsx("code",{className:"block text-xs bg-muted p-2 rounded-md break-all",children:g})]}),S&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h3",{className:"text-lg flex items-center gap-3",children:["Response: ",e.jsx("span",{className:`font-mono text-sm ${S.status.includes("200")?"text-success-foreground":"text-destructive"}`,children:S.status}),S.adapterMode&&e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-muted text-muted-foreground",title:"Adapter Mode",children:S.adapterMode})]}),R&&e.jsx("a",{href:R,download:`fr-adapter-response-${new Date().toISOString().replace(/[:.]/g,"-")}.txt`,className:"text-sm text-primary hover:underline",children:"Download Results"})]}),xe(S.data).length>0&&e.jsxs("div",{className:"mt-3 flex items-end gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(Te,{htmlFor:"fr-selected-doc",children:"Pick a document_number to fetch full record"}),e.jsxs($t,{value:I,onValueChange:l=>{k(l),l&&ue(l)},children:[e.jsx(Pt,{id:"fr-selected-doc",className:"mt-1",children:e.jsx(Ht,{placeholder:"Select a document..."})}),e.jsx(Et,{children:xe(S.data).map(l=>e.jsx(nt,{value:l,children:l},l))})]})]}),I&&e.jsx(ee,{onClick:()=>ue(I),disabled:ze,children:"Fetch by Document Number"})]}),e.jsx("div",{className:"mt-2",children:e.jsx(bt,{title:"FR Adapter Response",data:S.data})}),z&&e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"FR Document by Number"}),M&&e.jsx("code",{className:"block text-xs bg-muted p-2 rounded-md break-all",children:M}),V&&e.jsx("a",{href:V,download:`fr-doc-response-${new Date().toISOString().replace(/[:.]/g,"-")}.txt`,className:"text-sm text-primary hover:underline",children:"Download Document"}),e.jsx(bt,{title:"FR Find Response",data:z.data})]}),S&&(I||xe(S.data).length>0)&&e.jsxs("div",{className:"mt-6",children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:"Comparison Table (Search vs Find)"}),(()=>{const l=I||xe(S.data)[0]||"",h=ct(S.data,l),Y=(z==null?void 0:z.data)||null,E=Y?Y.document?Y.document:Y:null,Le=fe(h,E);return e.jsxs(Ys,{children:[e.jsx(oa,{children:e.jsxs(Gt,{children:[e.jsx(us,{className:"w-1/4",children:"Field"}),e.jsxs(us,{className:"w-3/8",children:["Search (doc: ",l||"—",")"]}),e.jsxs(us,{className:"w-3/8",children:["Find (doc: ",z&&(E==null?void 0:E.document_number)||"—",")"]})]})}),e.jsx(Gs,{children:Le.map(ae=>e.jsxs(Gt,{children:[e.jsx(_t,{className:"font-medium",children:ae.k}),e.jsx(_t,{children:Tt(ae.a)}),e.jsx(_t,{children:Tt(ae.b)})]},ae.k))})]})})()]})]})]})]})}),e.jsx(ls,{value:"rates",className:"mt-4",children:e.jsxs(Ne,{children:[e.jsx(ot,{children:e.jsx(pt,{children:"Rates from FR Verifier"})}),e.jsxs(Be,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(Te,{htmlFor:"rfv-agencies",children:"Agencies"}),e.jsx(He,{id:"rfv-agencies",value:ye.agencies,onChange:l=>ve(h=>({...h,agencies:l.target.value}))}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:Mt.agenciesHelp})]}),e.jsxs("div",{children:[e.jsx(Te,{htmlFor:"rfv-type",children:"Type"}),e.jsx(He,{id:"rfv-type",value:ye.type,onChange:l=>ve(h=>({...h,type:l.target.value}))}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:Mt.typeHelp})]}),e.jsxs("div",{children:[e.jsx(Te,{htmlFor:"rfv-per-page",children:"Per Page"}),e.jsx(He,{id:"rfv-per-page",type:"number",value:ye.per_page,onChange:l=>ve(h=>({...h,per_page:parseInt(l.target.value||"50",10)}))}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:Mt.perPageHelp})]}),e.jsxs("div",{children:[e.jsx(Te,{htmlFor:"rfv-chunk-size",children:"Chunk Size"}),e.jsx(He,{id:"rfv-chunk-size",type:"number",value:ye.chunk_size,onChange:l=>ve(h=>({...h,chunk_size:parseInt(l.target.value||"5",10)}))}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:Mt.chunkSizeHelp})]}),e.jsxs("div",{children:[e.jsx(Te,{htmlFor:"rfv-per-country-min",children:"perCountryMin"}),e.jsx(He,{id:"rfv-per-country-min",type:"number",value:ye.perCountryMin,onChange:l=>ve(h=>({...h,perCountryMin:parseInt(l.target.value||"1",10)}))}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:Mt.perCountryMinHelp})]}),e.jsxs("div",{children:[e.jsx(Te,{htmlFor:"rfv-fetch-cap",children:"fetchCap"}),e.jsx(He,{id:"rfv-fetch-cap",type:"number",value:ye.fetchCap,onChange:l=>ve(h=>({...h,fetchCap:parseInt(l.target.value||"12",10)}))}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:Mt.fetchCapHelp})]}),e.jsxs("div",{children:[e.jsx(Te,{htmlFor:"rfv-table-check-cap",children:"tableCheckCap"}),e.jsx(He,{id:"rfv-table-check-cap",type:"number",value:ye.tableCheckCap,onChange:l=>ve(h=>({...h,tableCheckCap:parseInt(l.target.value||"10",10)}))}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:Mt.tableCheckCapHelp})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(Te,{htmlFor:"rfv-legal-terms",children:"Legal Terms"}),e.jsx(He,{id:"rfv-legal-terms",value:ye.legalTerms,onChange:l=>ve(h=>({...h,legalTerms:l.target.value}))}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:Mt.legalTermsHelp})]}),e.jsxs("div",{className:"md:col-span-2 flex items-center space-x-2",children:[e.jsx(fs,{id:"rfv-include-country",checked:ye.includeCountry,onCheckedChange:l=>ve(h=>({...h,includeCountry:!!l}))}),e.jsx(Te,{htmlFor:"rfv-include-country",children:Mt.includeCountryLabel}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:Mt.includeCountryHelp})]}),e.jsxs("div",{className:"md:col-span-2 border rounded p-3 bg-card",children:[e.jsx("div",{className:"font-semibold mb-2",children:Mt.phraseGenTitle}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-2 items-end",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(Te,{htmlFor:"ct-phrase",children:"Phrase"}),e.jsx(He,{id:"ct-phrase",placeholder:Mt.phrasePlaceholder,value:hs,onChange:l=>Fs(l.target.value)})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(fs,{id:"ct-exact",checked:Wt,onCheckedChange:l=>ds(!!l)}),e.jsx(Te,{htmlFor:"ct-exact",children:Mt.exactLabel})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(fs,{id:"ct-final",checked:gs,onCheckedChange:l=>ps(!!l)}),e.jsx(Te,{htmlFor:"ct-final",children:"AND Final Results"})]}),e.jsxs("div",{children:[e.jsx(Te,{htmlFor:"ct-country",children:"Country"}),e.jsx(He,{id:"ct-country",placeholder:Mt.countryPlaceholder,value:Jt,onChange:l=>Ut(l.target.value)})]}),e.jsx(ee,{onClick:()=>{if(!hs)return;const l={phrase:hs,exact:Wt,andFinal:gs,country:Jt||"all"};ns(h=>[...h,l]),Fs("")},variant:"outline",className:"w-full",children:"Add phrase"})]}),Cs.length>0?e.jsx("div",{className:"mt-3 space-y-2",children:Cs.map((l,h)=>e.jsxs("div",{className:"flex items-center justify-between border rounded p-2",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-mono",children:l.phrase}),e.jsxs("span",{className:"ml-2 text-muted-foreground",children:["[",l.exact?"exact":"loose",l.andFinal?", +Final":"","]"]}),e.jsxs("span",{className:"ml-2",children:["country: ",l.country||"all"]})]}),e.jsx(ee,{variant:"destructive",size:"sm",onClick:()=>ns(Y=>Y.filter((E,Le)=>Le!==h)),children:"Delete"})]},h))}):e.jsx("p",{className:"mt-2 text-xs text-muted-foreground",children:"No customTerms set: fall back to default logic (product titles/case numbers with legalTerms/country as needed)."})]}),e.jsxs("div",{className:"md:col-span-2 flex items-center space-x-2",children:[e.jsx(fs,{id:"rfv-country-broadcast",checked:ye.countryBroadcast,onCheckedChange:l=>ve(h=>({...h,countryBroadcast:!!l}))}),e.jsx(Te,{htmlFor:"rfv-country-broadcast",children:Mt.broadcastLabel}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:Mt.broadcastHelp})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(fs,{id:"rfv-enable-scoring",checked:ye.enableScoring,onCheckedChange:l=>ve(h=>({...h,enableScoring:!!l}))}),e.jsx(Te,{htmlFor:"rfv-enable-scoring",children:"Enable Scoring"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(fs,{id:"rfv-add-table-signals",checked:ye.addTableSignals,onCheckedChange:l=>ve(h=>({...h,addTableSignals:!!l}))}),e.jsx(Te,{htmlFor:"rfv-add-table-signals",children:"Add Table Signals"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:Mt.addTableSignalsHelp})]}),e.jsxs("div",{children:[e.jsx(Te,{htmlFor:"rfv-table-check-mode",children:"Table Check Mode"}),e.jsxs($t,{value:ye.tableCheckMode,onValueChange:l=>ve(h=>({...h,tableCheckMode:l})),children:[e.jsx(Pt,{id:"rfv-table-check-mode",className:"mt-1",children:e.jsx(Ht,{})}),e.jsxs(Et,{children:[e.jsx(nt,{value:"none",children:"none"}),e.jsx(nt,{value:"topN",children:"topN"}),e.jsx(nt,{value:"all",children:"all"})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:Mt.tableCheckModeHelp})]}),e.jsxs("div",{children:[e.jsx(Te,{htmlFor:"rfv-table-check-topn",children:"Table Check TopN"}),e.jsx(He,{id:"rfv-table-check-topn",type:"number",value:ye.tableCheckTopN,onChange:l=>ve(h=>({...h,tableCheckTopN:parseInt(l.target.value||"5",10)}))}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:Mt.tableCheckTopNHelp})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(Te,{htmlFor:"rfv-score-weights",children:"Score Weights (JSON)"}),e.jsx(nr,{id:"rfv-score-weights",rows:6,className:"mt-1 font-mono text-xs",value:ye.scoreWeights,onChange:l=>ve(h=>({...h,scoreWeights:l.target.value}))}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:Mt.scoreWeightsHelp}),e.jsxs("div",{className:"mt-2 grid grid-cols-1 md:grid-cols-4 gap-2",children:[e.jsx(He,{placeholder:"pattern",value:zt,onChange:l=>Ke(l.target.value)}),e.jsx(He,{placeholder:"score",value:Rt,onChange:l=>ms(parseInt(l.target.value||"1",10))}),e.jsxs($t,{value:Kt,onValueChange:l=>Lt(l),children:[e.jsx(Pt,{children:e.jsx(Ht,{})}),e.jsxs(Et,{children:[e.jsx(nt,{value:"contains",children:"contains"}),e.jsx(nt,{value:"regex",children:"regex"})]})]}),e.jsx(He,{placeholder:"AND (comma-separated)",value:os,onChange:l=>cs(l.target.value)}),e.jsx(ee,{onClick:Oe,className:"md:col-span-4",variant:"outline",children:"Add Term to Weights"})]}),e.jsxs("div",{className:"mt-3 border rounded p-2",children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:"Current Terms"}),e.jsx("div",{className:"space-y-2",children:(()=>{try{const l=JSON.parse(ye.scoreWeights||"{}"),h=Array.isArray(l.terms)?l.terms:[];if(h.length===0)return e.jsx("div",{className:"text-xs text-muted-foreground",children:"No terms yet."});const Y=E=>{const Le=JSON.parse(ye.scoreWeights||"{}");Array.isArray(Le.terms)||(Le.terms=[]),Le.terms.splice(E,1),ve(ae=>({...ae,scoreWeights:JSON.stringify(Le,null,2)}))};return h.map((E,Le)=>e.jsxs("div",{className:"flex items-center justify-between text-xs bg-muted/80 rounded p-2",children:[e.jsxs("div",{className:"mr-2 truncate",children:[e.jsx("span",{className:"font-mono text-muted-foreground",children:E.type||"contains"}),e.jsx("span",{className:"mx-1",children:"|"}),e.jsx("span",{className:"font-mono",children:String(E.pattern)}),Array.isArray(E.and)&&E.and.length>0&&e.jsxs("span",{className:"ml-1 text-muted-foreground",children:["and[",E.and.join(", "),"]"]}),e.jsxs("span",{className:"ml-2 font-semibold",children:["score=",E.score]})]}),e.jsx(ee,{onClick:()=>Y(Le),variant:"destructive",size:"sm",children:"Delete"})]},Le))}catch{return e.jsx("div",{className:"text-xs text-destructive",children:"Invalid scoreWeights JSON"})}})()})]})]})]}),e.jsxs("div",{className:"mt-3 text-xs text-muted-foreground bg-muted border border-border rounded p-2",children:[e.jsx("div",{className:"font-medium mb-1",children:Mt.tipsTitle}),e.jsxs("ul",{className:"list-disc pl-5 space-y-1",children:[e.jsx("li",{children:Mt.tip1}),e.jsx("li",{children:Mt.tip2})]})]}),e.jsxs("div",{className:"mt-3 flex gap-3",children:[e.jsx(ee,{onClick:We,disabled:qt,children:qt?"Running...":"Run"}),e.jsx(ee,{onClick:rt,disabled:!ft,variant:"secondary",children:"Re-score Locally"}),xs&&e.jsx(ee,{asChild:!0,variant:"outline",children:e.jsx("a",{href:xs,download:`fr-rates-verifier-${new Date().toISOString().replace(/[:.]/g,"-")}.txt`,children:"Save Snapshot"})})]}),e.jsxs("div",{className:"mt-4",children:[it&&e.jsx("div",{className:"text-destructive",children:it}),ft&&e.jsxs("div",{className:"space-y-3",children:[e.jsx(bt,{title:"Input",data:ft.input}),e.jsx(bt,{title:"Investigations",data:ft.investigations}),e.jsx(bt,{title:"Grouped (by country)",data:ft.grouped}),e.jsx(bt,{title:"Constructed Terms",data:ft.constructed_terms}),e.jsx(bt,{title:"Chunks",data:ft.chunks}),e.jsx(bt,{title:"Fetches",data:ft.fetches}),e.jsx(bt,{title:"Raw Documents",data:ft.raw_documents}),e.jsxs("div",{className:"border rounded p-3",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Quick Test: Open Company Rates"}),e.jsx("div",{className:"space-y-2",children:Object.entries(ft.raw_documents||{}).map(([l,h],Y)=>e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-foreground mb-1",children:l}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(h||[]).slice(0,10).map(E=>e.jsx(ee,{onClick:()=>Je(E.document_number,l),size:"sm",className:"h-auto px-2 py-1 text-xs",title:E.title,children:E.document_number},E.document_number))})]},Y))})]}),ft.features&&e.jsx(bt,{title:"Features (table signals)",data:ft.features}),ft.scoring&&e.jsx(bt,{title:"Scoring",data:ft.scoring}),e.jsx(bt,{title:"Final Output",data:ft.output})]})]})]})]})})]}),e.jsx(Yr,{isOpen:C,onClose:()=>re(!1),country:Ue,isLoading:ie,error:D,rows:de})]})}const ml=i.forwardRef(({className:t,...s},a)=>e.jsx(ys,{ref:a,className:J("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",t),...s}));ml.displayName=ys.displayName;const hu=i.forwardRef(({className:t,...s},a)=>e.jsxs("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[e.jsx(Hs,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),e.jsx(ys.Input,{ref:a,className:J("flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",t),...s})]}));hu.displayName=ys.Input.displayName;const hl=i.forwardRef(({className:t,...s},a)=>e.jsx(ys.List,{ref:a,className:J("max-h-[300px] overflow-y-auto overflow-x-hidden",t),...s}));hl.displayName=ys.List.displayName;const pl=i.forwardRef((t,s)=>e.jsx(ys.Empty,{ref:s,className:"py-6 text-center text-sm",...t}));pl.displayName=ys.Empty.displayName;const fl=i.forwardRef(({className:t,...s},a)=>e.jsx(ys.Group,{ref:a,className:J("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",t),...s}));fl.displayName=ys.Group.displayName;const pu=i.forwardRef(({className:t,...s},a)=>e.jsx(ys.Separator,{ref:a,className:J("-mx-1 h-px bg-border",t),...s}));pu.displayName=ys.Separator.displayName;const xl=i.forwardRef(({className:t,...s},a)=>e.jsx(ys.Item,{ref:a,className:J("relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",t),...s}));xl.displayName=ys.Item.displayName;const fu=({data:t,columns:s,percent:a,currentSortKey:r,currentSortDesc:n,onRequestGlobalSort:o})=>{var v;const[d,c]=H.useState([]),u=H.useMemo(()=>(s||[]).map(j=>({accessorKey:j.key,header:j.label,enableSorting:!0,cell:({row:f})=>{const x=f.getValue(j.key);if(j.key!=="year"){if(a&&typeof x=="number"&&isFinite(x))return`${(x*100).toLocaleString(void 0,{maximumFractionDigits:2})}%`;if(typeof x=="number")return x.toLocaleString()}return x}})),[s,a]),p=ni({data:t||[],columns:u,state:{sorting:d},onSortingChange:c,getCoreRowModel:wi(),getSortedRowModel:Ni()});return H.useEffect(()=>{r&&p.setSorting([{id:r,desc:!!n}])},[r,n]),e.jsx("div",{className:"rounded-md border",children:e.jsxs(Ys,{children:[e.jsx(oa,{children:p.getHeaderGroups().map(_=>e.jsx(Gt,{children:_.headers.map(j=>e.jsxs(us,{className:j.column.getCanSort()?"cursor-pointer select-none":"",onClick:()=>{const f=j.column.id;if(!f||f==="year")return;const T=j.column.getIsSorted()==="asc";o?o(f,T):j.column.toggleSorting(T)},children:[j.isPlaceholder?null:sr(j.column.columnDef.header,j.getContext()),{asc:" 🔼",desc:" 🔽"}[j.column.getIsSorted()]??null]},j.id))},_.id))}),e.jsx(Gs,{children:(v=p.getRowModel().rows)!=null&&v.length?p.getRowModel().rows.map(_=>e.jsx(Gt,{children:_.getVisibleCells().map(j=>e.jsx(_t,{children:sr(j.column.columnDef.cell,j.getContext())},j.id))},_.id)):e.jsx(Gt,{children:e.jsx(_t,{colSpan:u.length,className:"h-24 text-center",children:"No results."})})})]})})},xu=({data:t,columns:s})=>{var d;const[a,r]=H.useState([]),n=H.useMemo(()=>(s||[]).map(u=>({accessorKey:u.key,header:u.label,enableSorting:!0,cell:({row:p})=>{const v=p.getValue(u.key);return typeof v=="number"?v.toLocaleString():v}})),[s]),o=ni({data:t||[],columns:n,state:{sorting:a},onSortingChange:r,getCoreRowModel:wi(),getSortedRowModel:Ni()});return e.jsx("div",{className:"rounded-md border",children:e.jsxs(Ys,{children:[e.jsx(oa,{children:o.getHeaderGroups().map(c=>e.jsx(Gt,{children:c.headers.map(u=>e.jsxs(us,{className:u.column.getCanSort()?"cursor-pointer select-none":"",onClick:u.column.getToggleSortingHandler(),children:[u.isPlaceholder?null:sr(u.column.columnDef.header,u.getContext()),{asc:" 🔼",desc:" 🔽"}[u.column.getIsSorted()]??null]},u.id))},c.id))}),e.jsx(Gs,{children:(d=o.getRowModel().rows)!=null&&d.length?o.getRowModel().rows.map(c=>e.jsx(Gt,{children:c.getVisibleCells().map(u=>e.jsx(_t,{children:sr(u.column.columnDef.cell,u.getContext())},u.id))},c.id)):e.jsx(Gt,{children:e.jsx(_t,{colSpan:n.length,className:"h-24 text-center",children:"No results."})})})]})})},gu=({queryKey:t,buildUrl:s,enabled:a=!1})=>Ft({queryKey:t,enabled:a,gcTime:10*60*1e3,queryFn:async({signal:r})=>{const n=s(),o=typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now(),{data:d,response:c}=await rs(n,{signal:r}),u=typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now(),p=Number.isFinite(u-o)?Math.max(0,u-o):null;return{payload:d,adapterMode:c.headers.get("X-Adapter-Mode")||"",adapterCache:c.headers.get("X-Cache")||"",requestId:c.headers.get("X-Request-ID")||"",lastReportBody:c.headers.get("X-Report-Body")||"",diagDurationMs:p}}}),da=[{key:"quantity",label:"Quantity",flow:["cons","gen"]},{key:"value",label:"Customs Value / Balance",flow:["cons","gen","balance"]},{key:"cif",label:"CIF Value",flow:["cons","gen"]},{key:"charges",label:"Import Charges",flow:["cons","gen"]},{key:"calc_duties",label:"Calculated Duties",flow:["cons"]},{key:"dutiable",label:"Dutiable Value",flow:["cons"]},{key:"landed",label:"Landed (CIF + Duties)",flow:["cons"]}],gl=["#1d4ed8","#16a34a","#dc2626","#ca8a04","#7c3aed","#0ea5e9","#f97316","#0891b2","#a855f7","#22c55e","#f43f5e","#14b8a6","#6366f1","#ef4444","#facc15","#0f766e","#ec4899","#fb7185","#4ade80","#38bdf8"],yu={quantity:void 0,value:"4 0",cif:"6 4",charges:"3 3",calc_duties:"2 6",dutiable:"10 4",landed:"1 4"},dn=(t,s=gl)=>{const r=`rgb(var(--chart-${t%10+1}))`,n=s[t%s.length]||"#2563eb";return r||n};function bu(){const{t}=Ge(),{hts:s,setHts:a,countryCodes:r,setCountryCodes:n,period:o,setPeriod:d,flow:c,setFlow:u,metrics:p,setMetrics:v,breakout:_}=Yi(),[j,f]=i.useState("10"),{data:x=[]}=al(),[T,w]=i.useState(!1),[S,y]=i.useState(!1),[g,b]=i.useState("quantity"),[R,P]=i.useState(""),[z,B]=i.useState(""),[M,A]=i.useState("abs"),[V,q]=i.useState(10),[I,k]=i.useState("desc"),[F,U]=i.useState(!1),[ne,ge]=i.useState(!1),[$,le]=i.useState(!1),[_e,Ee]=i.useState(gl),[Fe,et]=i.useState("commodities"),ze=i.useMemo(()=>({cons:t("market.advanced.flowCons"),gen:t("market.advanced.flowGen"),balance:t("market.advanced.flowBalance")}),[t]),G=i.useMemo(()=>t("market.advanced.metricLabels",{returnObjects:!0}),[t]),Ce=C=>{var re;return(G==null?void 0:G[C])||((re=da.find(ie=>ie.key===C))==null?void 0:re.label)||C};i.useEffect(()=>{try{const C=getComputedStyle(document.documentElement),re=[];for(let ie=1;ie<=12;ie++){const m=C.getPropertyValue(`--chart-${ie}`).trim();m&&re.push(`oklch(${m})`)}re.length&&Ee(re)}catch{}},[]);const pe=i.useMemo(()=>{const C=s.map(re=>ya(re)).filter(Boolean);return Array.from(new Set(C))},[s]),W=(C,re)=>{if(C==="balance")return"FAS_VALUE-GEN_CUSTOMS_VALUE";const ie={"cons:quantity":"CONS_FIR_UNIT_QUANT","cons:value":"CONS_CUSTOMS_VALUE","cons:cif":"CONS_COST_INS_FREIGHT","cons:charges":"CONS_CHARGES_INS_FREIGHT","cons:dutiable":"CONS_CUSTOMS_VALUE_SUB_DUTY","cons:calc_duties":"CONS_CALC_DUTY","gen:quantity":"GEN_FIR_UNIT_QUANTITY","gen:value":"GEN_CUSTOMS_VALUE","gen:cif":"GEN_COST_INS_FREIGHT","gen:charges":"GEN_CHARGES_INS_FREIGHT","gen:dutiable":"GEN_DUTIABLE_VALUE","gen:calc_duties":"GEN_CALC_DUTY"};return ie[C+":"+re]||ie["cons:quantity"]};i.useEffect(()=>{c==="balance"&&((p.length!==1||p[0]!=="value")&&v(["value"]),S&&g!=="value"&&b("value"))},[c,S,g,p,v]);const[Q,K]=i.useState(null),we=H.useCallback(C=>{K(C)},[]),[X,xe]=i.useState({w:0,h:0});i.useEffect(()=>{if(!Q)return;const C=Q,re=()=>{const m=C.getBoundingClientRect(),D=Math.floor(m.width||C.clientWidth||0),O=Math.floor(m.height||C.clientHeight||0);xe({w:D,h:O})};let ie;try{const m=window.ResizeObserver;if(m){const D=new m(()=>re());D.observe(C),re(),ie=()=>D.disconnect()}}catch{}if(!ie){const m=()=>re();window.addEventListener("resize",m),re();let D=0;const O=window.setInterval(()=>{D++;const de=C.getBoundingClientRect();(de.width||C.clientWidth)>0&&(de.height||C.clientHeight)>0?(re(),window.clearInterval(O)):D>20&&window.clearInterval(O)},100);ie=()=>{window.removeEventListener("resize",m),window.clearInterval(O)}}return()=>{ie==null||ie()}},[Q]);const $e=X.w>10&&X.h>10,Ae=X.h||384,ct=C=>{const re=C.target.value;Z(re),fe.current&&clearTimeout(fe.current),fe.current=setTimeout(()=>{const ie=re.split(/[\s,]+/).filter(Boolean);a(ie)},300)},[Tt,Z]=i.useState(()=>s.join(", ")),fe=i.useRef(null);i.useEffect(()=>{const C=Tt.split(/[\s,]+/).filter(Boolean);s.length===C.length&&s.every((ie,m)=>ie===C[m])||Z(s.join(", "))},[s]);const ue=i.useMemo(()=>{try{const C=ye(),re=da.filter(O=>O.flow.includes(c)).map(O=>O.key),ie=p.filter(O=>re.includes(O));let m=[];c==="balance"?m=["value"]:S?m=re:m=ie.length?ie:["quantity"];const D=Array.from(new Set(m.map(O=>W(c,O))));return JSON.stringify({url:C,dataToReport:D},null,2)}catch{return JSON.stringify({url:"",dataToReport:[]},null,2)}},[c,p,S,o.ytd,j,r,pe,g,M,I,V]);function ye(){const C=new URLSearchParams;s.length&&C.set("commodities",c==="balance"?pe.join(","):s.join(",")),C.set("flow",c),C.set("history_years",String(o.years)),C.set("ytd",String(o.ytd));const re=!S&&!_.enabled&&s.length>1;(_.enabled||S||re)&&C.set("breakout","true"),(_.enabled||re)&&Fe==="commodities"&&C.set("commodities_breakout","true");const ie=da.filter(D=>D.flow.includes(c)).map(D=>D.key),m=p.filter(D=>ie.includes(D));S?c==="balance"?C.set("metric","value"):C.set("metrics",ie.join(",")):c==="balance"?C.set("metric","value"):m.length>1?C.set("metrics",m.join(",")):C.set("metric",m[0]||"quantity"),r.length&&C.set("countries",r.join(","));try{const D=pe&&pe.length===1,O=!!_.enabled||!!S||re,de=!D&&s.length>0;c==="balance"?C.set("granularity","6"):O?Fe==="commodities"?C.set("granularity",j||"10"):C.set("granularity","6"):de&&C.set("granularity",j)}catch{C.has("granularity")||C.set("granularity",j)}return T&&C.set("diagnostic","1"),S&&C.set("compare","1"),`/api/get-trade-report?${C.toString()}`}const ve=i.useMemo(()=>["advanced-trends",{hts:s,normalizedHts:pe,countryCodes:r,period:o,flow:c,metrics:p,breakout:_,compareEnabled:S,granularity:j,diagnostic:T}],[s,pe,r,o,c,p,_,S,j,T,Fe]),{data:De,error:jt,isFetching:vt,isLoading:qt,refetch:ft}=gu({queryKey:ve,buildUrl:ye,enabled:!1}),Zt=(De==null?void 0:De.payload)??null,it=(De==null?void 0:De.adapterMode)??"",xt=(De==null?void 0:De.adapterCache)??"",xs=(De==null?void 0:De.requestId)??"",Dt=(De==null?void 0:De.lastReportBody)??"",zt=(De==null?void 0:De.diagDurationMs)??null,Ke=jt?jt instanceof Error?jt.message:String(jt):null,Rt=vt||qt,ms=()=>{ft()},Kt=i.useMemo(()=>da.filter(C=>C.flow.includes(c)),[c]),Lt=C=>{var m;const ie=(((m=C==null?void 0:C.tableInfo)==null?void 0:m.tabName)||(C==null?void 0:C.tab_name)||(C==null?void 0:C.name)||"").toString().toLowerCase().replace(/\(in actual.*\)/,"").trim();return ie.includes("1st unit")||ie.includes("first unit")||ie.includes("unit of qty")||ie.includes("unit of quantity")?"quantity":ie.includes("customs value")||ie.includes("trade balance")||ie.includes("tot ex fas")||ie.includes("fas - genimp")||ie.includes("fas")&&ie.includes("genimp")?"value":ie.includes("cif")?"cif":ie.includes("import charges")||ie.includes("charges, insurance, and freight")?"charges":ie.includes("calculated duties")?"calc_duties":ie.includes("dutiable value")?"dutiable":ie.includes("landed duty-paid value")||ie.includes("landed duty")?"landed":null},os=C=>{if(!C||C==="Not Valid"||C.trim()==="")return null;const re=Number(C.replace(/,/g,""));return Number.isFinite(re)?re:null},cs=(C,re,ie)=>{var Se;const m=((Se=C==null?void 0:C.row_groups)==null?void 0:Se.flatMap(se=>se.rowsNew??se.rows??[]))??(C==null?void 0:C.rows)??[];if(!Array.isArray(m))return[];const O=((C==null?void 0:C.column_groups)||[]).flatMap(se=>(se==null?void 0:se.columns)||[]).map(se=>String((se==null?void 0:se.label)||"")),de=O.map((se,ke)=>/(19|20)\d{2}/.test(se)?ke:-1).filter(se=>se>=0),he=de.map(se=>{const ke=O[se].match(/((19|20)\d{2})/);return ke?ke[1]:O[se].substring(0,4)}),Ue=he.length?he:((C==null?void 0:C.column_groups)||[]).flatMap(se=>(se==null?void 0:se.columns)||[]).map(se=>String((se==null?void 0:se.label)||"")).map(se=>{var ke;return((ke=se.match(/((19|20)\d{2})/))==null?void 0:ke[1])||se.substring(0,4)}).filter(se=>/^(19|20)\d{2}$/.test(se));return m.map(se=>{const ke=se.rowEntries||se.entries||[],be=ke.map(Y=>Y&&typeof Y=="object"&&"value"in Y?Y.value:Y);let We="TOTAL",rt="",Oe="",Je=-1,l=be.findIndex(Y=>ie.includes(ya(String(Y))));if(l===-1&&(l=be.findIndex(Y=>/^\d{10}$/.test(Y==null?void 0:Y.replace(/\./g,"")))),l!==-1){We=be[l],rt=be[l+1]||"";const Y=l+2,E=typeof be[Y]=="string"&&!/^\d{4}$/.test(be[Y].substring(0,4))&&isNaN(Number(be[Y].charAt(0)));Je=l+(E?3:2)}else{const Y=Array.isArray(ie)&&ie.length?ya(String(ie[0])):"";Y&&(We=Y),Oe=String(be[0]||Oe),rt="",Je=1}const h={};return de.length?de.forEach((Y,E)=>{const Le=he[E],ae=be[Y],Pe=ae&&typeof ae=="object"&&"value"in ae?ae.value:ae;h[Le]=os(typeof Pe=="string"?Pe:Pe!=null?String(Pe):null)}):(Ue&&Ue.length?Ue:re).forEach((E,Le)=>{const ae=ke[Je+Le],Pe=ae&&typeof ae=="object"&&"value"in ae?ae.value:be[Je+Le]??null;h[E]=os(typeof Pe=="string"?Pe:Pe!=null?String(Pe):null)}),re.forEach(Y=>{Y in h||(h[Y]=null)}),{hts10:We,hts6:ya(We),desc:rt,unit:Oe||be.find(Y=>typeof Y=="string"&&(Y.toLowerCase().includes("kilogram")||Y.toLowerCase().includes("dollar")))||"",values:h}}).filter(se=>se.hts6)},hs=C=>{const re=new Map;for(const ie of C)if(ie.hts6)for(const m of Object.keys(ie.values)){const D=ie.values[m];if(D==null)continue;re.has(ie.hts6)||re.set(ie.hts6,new Map);const O=re.get(ie.hts6);O.set(m,(O.get(m)??0)+D)}return re},Fs=C=>{const re=new Map;for(const ie of C)if(ie.hts6)for(const m of Object.keys(ie.values)){const D=ie.values[m];if(D==null)continue;re.has(ie.hts6)||re.set(ie.hts6,new Map);const O=re.get(ie.hts6);O.has(m)||O.set(m,{total:0,details:[]});const de=O.get(m);de.total+=D,de.details.push({hts10:ie.hts10,value:D})}return re},Wt=i.useMemo(()=>{var It,gt,ut,Ct;const C=(It=Zt==null?void 0:Zt.dto)==null?void 0:It.tables;if(!Array.isArray(C))return{data:[],series:[]};const re=C.filter(oe=>{const je=String((oe==null?void 0:oe.name)||(oe==null?void 0:oe.tab_name)||"").toLowerCase();return o.ytd?je.includes("year-to-date")||je.includes("ytd"):!(je.includes("year-to-date")||je.includes("ytd"))}),ie=re.find(oe=>Lt(oe)==="cif"),m=re.find(oe=>Lt(oe)==="quantity"),D=re.find(oe=>Lt(oe)==="charges"),O=re.find(oe=>Lt(oe)==="calc_duties"),de=re.find(oe=>Lt(oe)==="value"),he=re.find(oe=>Lt(oe)==="landed"),Ue=re.find(oe=>Lt(oe)==="dutiable"),Se=oe=>oe?(oe.column_groups||[]).flatMap(je=>(je==null?void 0:je.columns)||[]).map(je=>String((je==null?void 0:je.label)||"")).map(je=>{var yt;return((yt=je.match(/((19|20)\d{2})/))==null?void 0:yt[1])||je.substring(0,4)}).filter(je=>/^(19|20)\d{2}$/.test(je)):[];let se=Array.from(new Set([...Se(ie),...Se(m),...Se(D),...Se(O),...Se(de),...Se(he),...Se(Ue)])).sort();if(se.length===0)try{const oe=re[0],yt=(((ut=(gt=oe==null?void 0:oe.row_groups)==null?void 0:gt[0])==null?void 0:ut.columnInfo)||[]).filter(qe=>String((qe==null?void 0:qe.type)||"").toLowerCase()==="data").map(qe=>String((qe==null?void 0:qe.columnLabel)||"")).map(qe=>{var Qe;return((Qe=qe.match(/((19|20)\d{2})/))==null?void 0:Qe[1])||""}).filter(Boolean);se=Array.from(new Set(yt)).sort()}catch{}if(se.length===0)return{data:[],series:[]};const ke=ie?cs(ie,se,pe):[],be=m?cs(m,se,pe):[],We=D?cs(D,se,pe):[],rt=O?cs(O,se,pe):[],Oe=de?cs(de,se,pe):[],Je=he?cs(he,se,pe):[],l=Ue?cs(Ue,se,pe):[],h=Fs(ke),Y=hs(be),E=hs(We),Le=hs(rt),ae=hs(Oe),Pe=hs(Je),Re=hs(l),Ye={},tt={},St=new Map;se.forEach(oe=>{tt[oe]={year:oe},pe.forEach(je=>{var Yt,Ot,Xt,ss,Ds,vs,Ns;const yt=(Yt=h.get(je))==null?void 0:Yt.get(oe),qe=(yt==null?void 0:yt.total)??null,Qe=((Ot=Y.get(je))==null?void 0:Ot.get(oe))??null,lt=((Xt=ae.get(je))==null?void 0:Xt.get(oe))??null;let Ie=null;ie&&!m&&(Ie="CIF=YTD, QTY=Annual/Unavailable");const Me=Ie?null:Qe,kt=((ss=E.get(je))==null?void 0:ss.get(oe))??null,ts=((Ds=Le.get(je))==null?void 0:Ds.get(oe))??null,Qt=(vs=Re.get(je))==null?void 0:vs.get(oe),bs=Qt??null,Bt=(Ns=Pe.get(je))==null?void 0:Ns.get(oe),js=Bt??(qe!==null&&ts!==null?qe+ts:null),mt=js!==null&&qe!==null&&ts!==null?js-(qe+ts):null;Ie&&(tt[oe].periodWarning=Ie),tt[oe][`${je}-quantity`]=Me,tt[oe][`${je}-value`]=lt,tt[oe][`${je}-cif`]=qe,tt[oe][`${je}-charges`]=kt,tt[oe][`${je}-calc_duties`]=ts,tt[oe][`${je}-dutiable`]=bs,tt[oe][`${je}-landed`]=js,tt[oe][`${je}-landed_check`]=mt})}),pe.forEach(oe=>{da.forEach(je=>{const yt=`${oe}-${je.key}`;St.set(yt,{key:yt,hts:oe,metric:je.key,label:`${oe} - ${je.label}`})})});const es=Object.values(tt).sort((oe,je)=>parseInt(oe.year)-parseInt(je.year)),Nt=Array.from(St.values());if(se.forEach(oe=>{Ye[oe]={},pe.forEach(je=>{var qe,Qe;const yt=(qe=h.get(je))==null?void 0:qe.get(oe);if(yt){const lt=((Qe=es.find(Me=>Me.year===oe))==null?void 0:Qe[`${je}-cif`])??null,Ie=lt!==null?lt-yt.total:null;Ye[oe][je]={...yt,final:lt,diff:Ie,mismatch:Ie!==null&&Math.abs(Ie)>1}}})}),(!es||es.length===0)&&Array.isArray(re)&&re.length>0)try{const oe=pe&&pe.length?pe[0]:"TOTAL",je={};se.forEach(mt=>{je[mt]={year:mt}});const yt=mt=>{var vs,Ns,Ks,ca,Ws,Js;const Yt=((ca=(Ks=(Ns=(vs=mt==null?void 0:mt.row_groups)==null?void 0:vs[0])==null?void 0:Ns.rowsNew)==null?void 0:Ks[0])==null?void 0:ca.rowEntries)||[],Ot=(((Js=(Ws=mt==null?void 0:mt.column_groups)==null?void 0:Ws[1])==null?void 0:Js.columns)||[]).map(Xs=>String((Xs==null?void 0:Xs.label)||"")),Xt=Yt[Yt.length-1],ss=(Xt==null?void 0:Xt.value)??Xt??null;return os(typeof ss=="string"?ss:ss!=null?String(ss):null)},qe=mt=>re.find(Yt=>{var Ot;return String(((Ot=Yt==null?void 0:Yt.tableInfo)==null?void 0:Ot.tabName)||(Yt==null?void 0:Yt.tab_name)||"").toLowerCase().includes(mt)}),Qe=qe("first unit")||qe("quantity"),lt=qe("customs value"),Ie=qe("cif"),Me=qe("charges")||qe("insurance"),kt=qe("calculated duties"),ts=qe("dutiable"),Qt=qe("landed"),bs=se[se.length-1],Bt=(mt,Yt)=>{const Ot=yt(Yt);Ot!=null&&(je[bs]||(je[bs]={year:bs}),je[bs][`${oe}-${mt}`]=Ot,St.set(`${oe}-${mt}`,{key:`${oe}-${mt}`,hts:oe,metric:mt,label:`${oe} - ${mt}`}))};Bt("quantity",Qe),Bt("value",lt),Bt("cif",Ie),Bt("charges",Me),Bt("calc_duties",kt),Bt("dutiable",ts),Bt("landed",Qt);const js=Object.values(je).filter(mt=>Object.keys(mt).length>1);if(js.length){const mt=Array.from(St.values());return{data:js,series:mt,reconciliation:Ye,relevant:re,years:se}}}catch{}if((!es||es.length===0)&&Array.isArray(re)&&re.length>0)try{const oe=pe&&pe.length?pe[0]:"TOTAL",je={},yt=Ie=>{const Me=String(Ie||"").match(/\b(19|20)\d{2}\b/);return Me?Me[0]:null},qe=Ie=>{const Me=String(Ie||"").toLowerCase();return Me.includes("first unit")||Me.includes("unit of quantity")?"quantity":Me.includes("customs value")?"value":Me.includes("cif import value")||Me.includes("cif")?"cif":Me.includes("import charges")||Me.includes("charges, insurance")?"charges":Me.includes("calculated duties")?"calc_duties":Me.includes("dutiable value")?"dutiable":Me.includes("landed duty-paid")?"landed":null};for(const Ie of re){const Me=((Ct=Ie==null?void 0:Ie.tableInfo)==null?void 0:Ct.tabName)||(Ie==null?void 0:Ie.tab_name)||(Ie==null?void 0:Ie.name)||"",kt=qe(Me);if(!kt)continue;const ts=Array.isArray(Ie==null?void 0:Ie.row_groups)?Ie.row_groups:[];for(const Qt of ts){const Bt=(Array.isArray(Qt==null?void 0:Qt.columnInfo)?Qt.columnInfo:[]).find(Ot=>String((Ot==null?void 0:Ot.type)||"").toLowerCase()==="data"),js=((Bt==null?void 0:Bt.columnIndex)??2)-1,mt=yt((Bt==null?void 0:Bt.queryResultLabel)||"")||se[se.length-1],Yt=Array.isArray(Qt==null?void 0:Qt.rowsNew)?Qt.rowsNew:[];for(const Ot of Yt){const ss=(Array.isArray(Ot==null?void 0:Ot.rowEntries)?Ot.rowEntries:[])[js],Ds=(ss==null?void 0:ss.suppressed)===1,vs=(ss==null?void 0:ss.value)??null,Ns=Ds?null:os(vs);je[mt]||(je[mt]={year:mt}),Ns!=null&&(je[mt][`${oe}-${kt}`]=Ns)}}}const Qe=Object.values(je);if(Qe.length){const Ie=Qe[0];Object.keys(Ie).filter(Me=>Me.includes("-")).forEach(Me=>{const[kt,ts]=Me.split("-");St.set(Me,{key:Me,hts:kt,metric:ts,label:`${kt} - ${ts}`})})}const lt=Array.from(St.values());if(Qe.length)return{data:Qe,series:lt,reconciliation:Ye,relevant:re,years:se}}catch{}return{data:es,series:Nt,reconciliation:Ye,relevant:re,years:se}},[Zt,o.ytd,pe]),ds=Wt.data,gs=Wt.series,ps=(Wt==null?void 0:Wt.relevant)||[],Jt=(Wt==null?void 0:Wt.years)||[],Ut=i.useMemo(()=>{if(!gs.length)return[];const C=new Set(pe),re=new Set(p),ie=da.map(O=>O.key),m=pe.length?pe:Array.from(new Set(gs.map(O=>O.hts).filter(O=>!O.startsWith("TOTAL")))),D=m.length?m:Array.from(new Set(gs.map(O=>O.hts)));return gs.filter(O=>re.has(O.metric)).filter(O=>C.size===0||C.has(O.hts)||O.hts.startsWith("TOTAL")).map((O,de)=>{const he=D.indexOf(O.hts),Ue=he>=0?he:D.length,Se=Math.max(0,ie.indexOf(O.metric)),se=Ue*ie.length+Se,ke=dn(se,_e);return{...O,label:`${O.hts} - ${Ce(O.metric)}`,color:ke,strokeDasharray:yu[O.metric]}})},[gs,p,pe,G,_e]);i.useEffect(()=>{S&&Jt&&Jt.length&&(R||P(Jt[Jt.length-1]),z||B(Jt[Math.max(0,Jt.length-2)]))},[S,Jt]);const Cs=i.useMemo(()=>{const C=Number(R),re=Number(z);return Number.isFinite(C)&&Number.isFinite(re)&&re>C?{primary:z,secondary:R}:{primary:R,secondary:z}},[R,z]),ns=i.useMemo(()=>{var C,re,ie,m,D;try{if(!S)return[];const O=new Set(Kt.map(ke=>ke.key)),de=p&&p.length?p.filter(ke=>O.has(ke)):Kt.map(ke=>ke.key),he=new Map;for(const ke of de){const be=ps.find(ae=>Lt(ae)===(ke==="value"?"value":ke));if(!be)continue;const We=((be==null?void 0:be.column_groups)||[]).flatMap(ae=>(ae==null?void 0:ae.columns)||[]),rt=We.map(ae=>String((ae==null?void 0:ae.label)||"").substring(0,4)).filter(ae=>/^(19|20)\d{2}/.test(ae));if(!rt.length)continue;const Oe=rt,Je={};We.forEach((ae,Pe)=>{const Re=String((ae==null?void 0:ae.label)||"").substring(0,4);/^(19|20)\d{2}/.test(Re)&&!(Re in Je)&&(Je[Re]=Pe)});const l=R&&Oe.includes(R)?R:Oe.length?Oe[Oe.length-1]:"",h=z&&Oe.includes(z)?z:Oe.length>1?Oe[Oe.length-2]:"",Y=Je[l],E=Je[h];if(Y==null||E==null)continue;const Le=((re=(C=be==null?void 0:be.row_groups)==null?void 0:C[0])==null?void 0:re.rowsNew)||((m=(ie=be==null?void 0:be.row_groups)==null?void 0:ie[0])==null?void 0:m.rows)||(be==null?void 0:be.rows)||[];for(const ae of Le){const Pe=(ae==null?void 0:ae.rowEntries)||(ae==null?void 0:ae.entries)||[],Re=String(((D=Pe==null?void 0:Pe[0])==null?void 0:D.value)??(Pe==null?void 0:Pe[0])??"N/A"),Ye=Pe[Y],tt=Pe[E],St=Ye&&typeof Ye=="object"&&"value"in Ye?Ye.value:Ye,es=tt&&typeof tt=="object"&&"value"in tt?tt.value:tt,Nt=Ie=>{if(Ie==null)return null;const Me=String(Ie).replace(/[^0-9.\-]/g,"");if(!Me.length)return null;const kt=Number(Me);return Number.isFinite(kt)?kt:null},It=Nt(St),gt=Nt(es);if(It==null||gt==null)continue;const ut=Number(l),Ct=Number(h),oe=Number.isFinite(ut)&&Number.isFinite(Ct)?ut>=Ct:!0,je=oe?It:gt,yt=oe?gt:It,Qe=M==="pct"?yt===0?null:(je-yt)/Math.abs(yt):je-yt;if(Qe==null)continue;const lt=he.get(Re)||{year:Re};lt[ke]=Qe,he.set(Re,lt)}}let Ue=Array.from(he.values());const Se=O.has(g)?g:O.has("quantity")?"quantity":de[0]||"quantity",se=(ke,be)=>{const We=Number((ke==null?void 0:ke[Se])??0),rt=Number((be==null?void 0:be[Se])??0),Oe=I==="abs"?Math.abs(We):We,Je=I==="abs"?Math.abs(rt):rt;return I==="asc"?Oe-Je:Je-Oe};return Ue=Ue.sort(se).slice(0,Math.max(1,V)),Ue}catch{return[]}},[S,p,Kt,g,ps,R,z,M,V,I]);return e.jsxs("div",{className:"space-y-6 p-4",children:[e.jsxs(Ne,{className:"rounded-2xl shadow-md",children:[e.jsx(ot,{children:e.jsx(pt,{children:t("market.advanced.title")})}),e.jsx(Be,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 items-start",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:t("market.advanced.htsLabel")}),e.jsx(He,{value:Tt,onChange:ct,onKeyDown:C=>C.key==="Enter"&&ms(),placeholder:t("market.advanced.htsPlaceholder"),className:"w-full mt-1"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:t("market.advanced.granularity")}),e.jsxs(ba,{type:"single",value:j,onValueChange:C=>{C&&f(C)},className:"justify-start",children:[e.jsx(as,{value:"6",children:t("market.advanced.granularity6")}),e.jsx(as,{value:"8",children:t("market.advanced.granularity8")}),e.jsx(as,{value:"10",children:t("market.advanced.granularity10")})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:t("market.advanced.breakout")}),e.jsxs($t,{value:Fe,onValueChange:C=>et(C),children:[e.jsx(Pt,{children:e.jsx(Ht,{})}),e.jsxs(Et,{children:[e.jsx(nt,{value:"commodities",children:t("market.advanced.breakoutCommodities")}),e.jsx(nt,{value:"countries",children:t("market.advanced.breakoutCountries")})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:t("market.advanced.tradeFlow")}),e.jsxs($t,{value:c,onValueChange:C=>u(C),children:[e.jsx(Pt,{children:e.jsx(Ht,{})}),e.jsxs(Et,{children:[e.jsx(nt,{value:"cons",children:ze.cons}),e.jsx(nt,{value:"gen",children:ze.gen}),e.jsx(nt,{value:"balance",children:ze.balance})]})]}),c==="balance"&&e.jsxs("div",{className:"mt-2 text-xs text-amber-700 dark:text-amber-500 bg-warning/10 border border-warning/20 rounded p-2",children:[e.jsx("div",{className:"font-medium",children:t("market.advanced.balanceNoticeTitle")}),e.jsx("ul",{className:"list-disc pl-4 mt-1 space-y-0.5",children:t("market.advanced.balanceNoticeItems",{returnObjects:!0}).map((C,re)=>e.jsx("li",{children:C},re))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:t("market.advanced.metrics")}),e.jsxs($a,{children:[e.jsx(Ha,{asChild:!0,children:e.jsx(ee,{variant:"outline",className:"w-full justify-start font-normal h-auto min-h-10",children:p.length>0?e.jsxs("div",{className:"flex flex-wrap items-center gap-1",children:[p.slice(0,3).map(C=>{const re=Ce(C);return e.jsx(ht,{variant:"secondary",children:re},C)}),p.length>3&&e.jsx(ht,{variant:"outline",children:t("market.advanced.metricsMore",{count:p.length-3})})]}):e.jsx("span",{className:"text-muted-foreground",children:t("market.advanced.metricsPlaceholder")})})}),e.jsx(va,{className:"w-[280px] p-0",align:"start",children:e.jsx(ml,{children:e.jsxs(hl,{children:[e.jsx(pl,{children:t("market.advanced.metricsEmpty")}),e.jsx(fl,{children:e.jsx(la,{children:da.map(C=>{const re=Kt.some(D=>D.key===C.key),ie=p.includes(C.key),m=()=>{re&&v(D=>ie?D.filter(O=>O!==C.key):Array.from(new Set([...D,C.key])))};return re?e.jsxs(xl,{value:Ce(C.key),onSelect:m,className:"flex items-center justify-between cursor-pointer",children:[e.jsx("span",{className:"flex-1",children:Ce(C.key)}),ie&&e.jsx(Er,{className:"h-4 w-4 text-primary"})]},C.key):e.jsxs(Us,{delayDuration:100,children:[e.jsx(Bs,{asChild:!0,children:e.jsx("div",{className:"relative flex cursor-not-allowed select-none items-center rounded-sm px-2 py-1.5 text-sm opacity-50 outline-none",children:Ce(C.key)})}),e.jsx(Ms,{children:e.jsx("p",{children:t("market.advanced.metricsUnavailable",{flow:ze[c]||c})})})]},C.key)})})})]})})})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:t("market.advanced.period")}),e.jsxs("div",{className:"mt-1 space-y-2 text-sm text-muted-foreground",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx(fs,{checked:o.ytd,onCheckedChange:C=>d({...o,ytd:!!C})}),t("market.advanced.ytd")]})}),e.jsxs("div",{className:"flex items-center gap-3 text-muted-foreground",children:[e.jsx("div",{className:"text-xs",children:t("market.advanced.historyYears",{years:o.years})}),e.jsx(Qr,{value:[o.years],onValueChange:C=>d({...o,years:C[0]||5}),min:1,max:20,step:1,className:"flex-1"})]})]})]}),e.jsxs("div",{children:[e.jsx(rl,{countryCodes:r,setCountryCodes:n}),r.length>0&&e.jsx("div",{className:"mt-2 flex flex-wrap items-center gap-1",children:r.map(C=>{const re=x.find(m=>m.value===C),ie=(re==null?void 0:re.name)||C;return e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-muted px-2 py-0.5 text-xs text-muted-foreground",children:[ie,e.jsx("button",{className:"text-muted-foreground hover:text-foreground","aria-label":t("market.advanced.removeCountry"),title:t("market.advanced.removeCountry"),onClick:()=>n(r.filter(m=>m!==C)),children:"x"})]},C)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:t("market.advanced.diagnostic")}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[e.jsx(fs,{id:"diag-check",checked:T,onCheckedChange:C=>w(!!C)}),e.jsx("label",{htmlFor:"diag-check",className:"text-xs text-muted-foreground",children:t("market.advanced.showRequestBody")}),(it||xt)&&e.jsxs("span",{className:"text-[11px] px-2 py-1 rounded-full bg-muted text-muted-foreground",children:[it,xt?` · ${xt}`:""]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fs,{id:"compare-enabled",checked:S,onCheckedChange:C=>y(!!C)}),e.jsx("label",{htmlFor:"compare-enabled",className:"text-sm text-muted-foreground",children:t("market.advanced.compareToggle")})]}),S&&e.jsx("div",{className:"grid grid-cols-2 gap-2 text-sm p-2 border rounded-lg mt-2",children:e.jsxs("div",{className:"col-span-2 grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:t("market.advanced.yearA")}),e.jsxs($t,{value:R,onValueChange:P,children:[e.jsx(Pt,{children:e.jsx(Ht,{})}),e.jsx(Et,{children:Jt.map(C=>e.jsx(nt,{value:C,children:C},C))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:t("market.advanced.yearB")}),e.jsxs($t,{value:z,onValueChange:B,children:[e.jsx(Pt,{children:e.jsx(Ht,{})}),e.jsx(Et,{children:Jt.map(C=>e.jsx(nt,{value:C,children:C},C))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:t("market.advanced.diff")}),e.jsxs($t,{value:M,onValueChange:C=>A(C),children:[e.jsx(Pt,{children:e.jsx(Ht,{})}),e.jsxs(Et,{children:[e.jsx(nt,{value:"abs",children:t("market.advanced.diffAbsolute")}),e.jsx(nt,{value:"pct",children:t("market.advanced.diffPercent")})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:t("market.advanced.topN")}),e.jsx(He,{type:"number",min:1,max:20,value:V,onChange:C=>q(Math.max(1,Math.min(20,parseInt(C.target.value||"10",10))))})]})]})})]}),e.jsx("div",{className:"flex items-end h-full",children:e.jsx(ee,{onClick:ms,disabled:Rt,className:"w-full",children:t(Rt?"market.advanced.running":"market.advanced.run")})})]})]})})]}),e.jsx("div",{className:"min-w-0",children:e.jsxs(Ne,{className:"w-full rounded-2xl shadow-md",children:[e.jsx(ot,{children:e.jsx(pt,{children:t("market.advanced.results")})}),e.jsxs(Be,{className:"w-full",children:[S&&ns.length>0&&e.jsx("div",{className:"w-full overflow-x-auto",children:e.jsx("div",{ref:we,className:"min-w-[720px]",children:$e?e.jsx(Ps,{width:"100%",height:Ae,children:e.jsxs(ar,{data:ns,layout:"vertical",children:[e.jsx(ta,{strokeDasharray:"3 3"}),e.jsx(sa,{type:"number",tickFormatter:C=>M==="pct"?C.toLocaleString(void 0,{style:"percent",minimumFractionDigits:2}):C.toLocaleString()}),e.jsx(Es,{type:"category",dataKey:"year",width:140}),e.jsx(Os,{formatter:(C,re)=>M==="pct"?C.toLocaleString(void 0,{style:"percent",minimumFractionDigits:2}):C.toLocaleString()}),e.jsx(Ia,{}),e.jsx(Fa,{dataKey:g,name:t("market.advanced.barName",{label:Ce(g),yearA:Cs.primary||"-",yearB:Cs.secondary||"-"}),fill:dn(0,_e)},g)]},`compare:${g}:${I}:${V}`)}):e.jsx("div",{className:"h-[384px] flex items-center justify-center text-sm text-muted-foreground",children:t("market.chart.preparing")})})}),S&&ns.length>0&&e.jsx("div",{className:"mt-4",children:(()=>{const C=new Set(Kt.map(m=>m.key)),re=p&&p.length?p.filter(m=>C.has(m)):Kt.map(m=>m.key),ie=[{key:"year",label:t("market.advanced.countryLabel")},...re.map(m=>({key:m,label:Ce(m)}))];return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx("h4",{className:"text-sm font-semibold text-foreground",children:t("market.advanced.compareTable")}),e.jsx("span",{className:"text-[11px]",children:t("market.advanced.compareDiffLabel",{mode:t(M==="pct"?"market.advanced.diffPercent":"market.advanced.diffAbsolute")})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:t("market.advanced.compareSortBy")}),e.jsxs($t,{value:g,onValueChange:m=>b(m),children:[e.jsx(Pt,{className:"text-xs h-7",children:e.jsx(Ht,{})}),e.jsx(Et,{children:Kt.map(m=>e.jsx(nt,{value:m.key,children:Ce(m.key)},m.key))})]}),e.jsx("label",{className:"text-xs text-muted-foreground",children:t("market.advanced.compareOrder")}),e.jsxs($t,{value:I,onValueChange:m=>k(m),children:[e.jsx(Pt,{className:"text-xs h-7",children:e.jsx(Ht,{})}),e.jsxs(Et,{children:[e.jsx(nt,{value:"abs",children:t("market.advanced.orderAbs")}),e.jsx(nt,{value:"desc",children:t("market.advanced.orderDesc")}),e.jsx(nt,{value:"asc",children:t("market.advanced.orderAsc")})]})]})]})]}),e.jsx("div",{className:"mt-2 overflow-x-auto",children:e.jsx("div",{className:"min-w-[720px]",children:e.jsx(fu,{onRequestGlobalSort:(m,D)=>{try{m&&m!=="year"&&(m!==g&&b(m),k(O=>O==="abs"?"abs":D?"desc":"asc"))}catch{}},currentSortKey:g,currentSortDesc:I==="desc"||I==="abs",data:ns,columns:ie,percent:M==="pct"})})})]})})()}),Ke&&e.jsxs(Rs,{variant:"destructive",className:"mt-4",children:[e.jsx(aa,{className:"h-4 w-4"}),e.jsx(ua,{children:t("status.error")}),e.jsx(Is,{children:Ke})]}),!S&&!Ke&&!Rt&&ds.length>0&&Ut.length>0&&e.jsx("div",{className:"w-full overflow-x-auto",children:e.jsx("div",{ref:we,className:"min-w-[720px]",style:{minHeight:384},children:$e?e.jsx(Ps,{width:"100%",height:Ae,children:e.jsxs(bi,{data:ds,margin:{top:8,right:20,left:12,bottom:8},children:[e.jsx(ta,{strokeDasharray:"3 3"}),e.jsx(sa,{dataKey:"year"}),e.jsx(Es,{tickFormatter:C=>new Intl.NumberFormat("en-US",{notation:"compact",compactDisplay:"short"}).format(C)}),e.jsx(Os,{formatter:C=>C.toLocaleString()}),e.jsx(Ia,{}),Ut.map(C=>e.jsx(ji,{type:"monotone",dataKey:C.key,name:C.label,stroke:C.color,fill:C.color,fillOpacity:.22,strokeWidth:2,strokeDasharray:C.strokeDasharray,activeDot:{r:3}},C.key))]})}):e.jsx("div",{className:"h-[384px] flex items-center justify-center text-sm text-muted-foreground",children:t("market.chart.preparing")})})}),!S&&!Ke&&!Rt&&ds.length>0&&Ut.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h4",{className:"text-base font-semibold mb-2",children:t("market.advanced.dataTable")}),e.jsx("div",{className:"mt-2 overflow-x-auto",children:e.jsx("div",{className:"min-w-[720px]",children:e.jsx(xu,{data:ds,columns:[{key:"year",label:t("market.advanced.yearLabel")},...Ut.map(C=>({key:C.key,label:C.label}))]})})})]}),!Ke&&!Rt&&ds.length>0&&Ut.length===0&&e.jsx("div",{className:"text-xs text-amber-600 dark:text-amber-500 mt-2",children:t("market.advanced.noSeries")}),!Ke&&!Rt&&ds.length===0&&e.jsx("div",{className:"text-sm text-muted-foreground mt-2",children:t("market.advanced.noSeries")}),!Ke&&!Rt&&Zt&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-sm font-semibold text-muted-foreground",children:t("market.advanced.processedTitle")}),e.jsx("button",{className:"text-xs text-muted-foreground underline",onClick:()=>U(C=>!C),children:t(F?"actions.close":"actions.open")})]}),F&&e.jsx("pre",{className:"bg-muted p-3 rounded max-h-96 overflow-auto text-xs",children:JSON.stringify(ds,null,2)})]}),!Ke&&!Rt&&Wt.reconciliation&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-sm font-semibold text-muted-foreground",children:t("market.advanced.reconciliationTitle")}),e.jsx("button",{className:"text-xs text-muted-foreground underline",onClick:()=>ge(C=>!C),children:t(ne?"actions.close":"actions.open")})]}),ne&&e.jsx("pre",{className:"bg-muted p-3 rounded max-h-96 overflow-auto text-xs",children:JSON.stringify(Wt.reconciliation,null,2)})]}),T&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-sm font-semibold text-muted-foreground",children:t("market.advanced.diagnostics")}),e.jsxs("div",{className:"flex items-center gap-2",children:[(it||xt)&&e.jsxs("span",{className:"text-[11px] px-2 py-1 rounded-full bg-muted text-muted-foreground",children:[it,xt?` ??${xt}`:""]}),zt!=null&&e.jsx("span",{className:"text-[11px] px-2 py-1 rounded-full bg-muted/50 text-muted-foreground border",children:`${Math.round(zt)} ms`}),e.jsx("button",{className:"text-xs text-muted-foreground underline",onClick:()=>{try{navigator.clipboard.writeText(ue)}catch{}},children:t("market.advanced.copySummary")}),e.jsx("button",{className:"text-xs text-muted-foreground underline",onClick:()=>le(C=>!C),children:t($?"actions.close":"actions.open")})]})]}),$&&e.jsxs("div",{className:"space-y-3 mt-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-foreground",children:t("market.advanced.requestSummary")}),e.jsx("pre",{className:"bg-muted p-3 rounded max-h-96 overflow-auto text-[12px]",children:ue})]}),(it||xt||xs)&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-foreground",children:t("market.advanced.headers")}),e.jsx("pre",{className:"bg-muted p-3 rounded max-h-96 overflow-auto text-[12px]",children:JSON.stringify({"X-Adapter-Mode":it,"X-Cache":xt,"X-Request-ID":xs},null,2)})]}),Dt&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-foreground",children:t("market.advanced.reportBody")}),e.jsx("pre",{className:"bg-muted p-3 rounded max-h-96 overflow-auto text-[12px]",children:Dt})]})]})]}),!Ke&&Rt&&e.jsxs("div",{className:"mt-4 animate-pulse",children:[e.jsx("div",{className:"h-4 bg-muted rounded w-1/3 mb-2"}),e.jsx("div",{className:"h-64 bg-muted rounded"})]}),!Ke&&!Rt&&!Zt&&e.jsx("div",{className:"text-sm text-muted-foreground",children:t("market.advanced.runPrompt")})]})]})})]})}const Qs=(t=1)=>`rgb(var(--chart-${(t-1)%5+1}))`,ur="rgb(var(--chart-grid))",mr=t=>t>=1e9?(t/1e9).toFixed(1)+"B":t>=1e6?(t/1e6).toFixed(1)+"M":t>=1e3?(t/1e3).toFixed(1)+"K":String(t);function Na({active:t,payload:s,label:a}){return!t||!s||s.length===0?null:e.jsxs("div",{className:"rounded-lg border border-slate-200 bg-white/95 p-3 text-xs shadow-lg backdrop-blur dark:border-slate-700 dark:bg-slate-900/90",children:[e.jsx("div",{className:"mb-1 font-medium text-foreground dark:text-muted-foreground",children:String(a)}),e.jsx("div",{className:"space-y-1",children:s.map((r,n)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"inline-block h-2 w-2 rounded",style:{backgroundColor:r.color}}),e.jsxs("span",{className:"text-muted-foreground dark:text-muted-foreground",children:[r.name,": ",e.jsx("span",{className:"font-medium",children:r.value})]})]},n))})]})}function yl({series:t}){return e.jsx("div",{className:"mt-3 flex flex-wrap items-center gap-2",children:t.map((s,a)=>e.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border border-slate-200 px-2 py-1 text-xs dark:border-slate-700",children:[e.jsx("span",{className:"h-2 w-2 rounded-full",style:{backgroundColor:Qs((s.colorIndex||a)+1)}}),e.jsx("span",{className:"text-foreground dark:text-muted-foreground",children:s.name||s.key})]},s.key))})}function wa({title:t,description:s,info:a,showDataLabels:r,onToggle:n,series:o}){const d=i.useCallback(c=>{n(!!c)},[n]);return e.jsxs(ot,{children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx(pt,{children:t}),s?e.jsx($s,{children:s}):null]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Label"}),e.jsx(pa,{checked:r,onCheckedChange:d})]}),e.jsx(la,{children:e.jsxs(Us,{children:[e.jsx(Bs,{asChild:!0,children:e.jsx("button",{className:"text-muted-foreground hover:text-foreground dark:text-muted-foreground dark:hover:text-muted-foreground","aria-label":"Chart info",children:"i"})}),e.jsx(Ms,{children:e.jsxs("div",{className:"max-w-xs space-y-2",children:[a!=null&&a.units?e.jsxs("p",{className:"text-xs",children:[e.jsx("span",{className:"font-medium",children:"Units:"})," ",a.units]}):null,a!=null&&a.dictionary?e.jsxs("div",{className:"text-xs",children:[e.jsx("div",{className:"font-medium mb-1",children:"Fields"}),e.jsx("ul",{className:"list-disc pl-4 space-y-0.5",children:Object.entries(a.dictionary).map(([c,u])=>e.jsxs("li",{children:[e.jsx("span",{className:"font-mono text-[11px]",children:c})," – ",u]},c))})]}):e.jsx("p",{className:"text-xs",children:'Hover to see values. Use stackId for stacking; set yAxis="right" to enable dual axis.'})]})})]})})]})]}),o?e.jsx(yl,{series:o}):null]})}function ju({title:t="Area Chart",description:s,className:a,height:r=260,data:n,xKey:o,series:d,grid:c=!0,yFormatter:u=mr,y2Formatter:p,showDataLabels:v,info:_}){const[j,f]=i.useState(!!v);return e.jsxs(Ne,{className:a,children:[e.jsx(wa,{title:t,description:s,info:_,series:d,showDataLabels:j,onToggle:f}),e.jsx(Be,{children:e.jsx("div",{style:{height:r},children:e.jsx(Ps,{width:"100%",height:"100%",children:e.jsxs(bi,{data:n,margin:{left:8,right:16,top:16,bottom:0},children:[c&&e.jsx(ta,{stroke:ur,strokeDasharray:"3 3"}),e.jsx(sa,{dataKey:o,tickLine:!1,axisLine:!1}),e.jsx(Es,{yAxisId:"left",tickFormatter:u,tickLine:!1,axisLine:!1,width:40}),d.some(x=>x.yAxis==="right")?e.jsx(Es,{orientation:"right",yAxisId:"right",tickFormatter:p||u,tickLine:!1,axisLine:!1,width:40}):null,e.jsx(Os,{content:e.jsx(Na,{})}),d.map((x,T)=>e.jsx(ji,{type:"monotone",dataKey:x.key,name:x.name||x.key,stroke:Qs((x.colorIndex||T)+1),fill:Qs((x.colorIndex||T)+1),fillOpacity:.2,strokeWidth:2,activeDot:{r:3},yAxisId:x.yAxis==="right"?"right":"left",label:j?{position:"top"}:void 0},x.key))]})})})})]})}function vr({title:t="Bar Chart",description:s,className:a,height:r=260,data:n,xKey:o,series:d,grid:c=!0,yFormatter:u=mr,y2Formatter:p,showDataLabels:v,info:_}){const[j,f]=i.useState(!!v);return e.jsxs(Ne,{className:a,children:[e.jsx(wa,{title:t,description:s,info:_,series:d,showDataLabels:j,onToggle:f}),e.jsx(Be,{children:e.jsx("div",{style:{height:r},children:e.jsx(Ps,{width:"100%",height:"100%",children:e.jsxs(ar,{data:n,margin:{left:8,right:16,top:16,bottom:0},children:[c&&e.jsx(ta,{stroke:ur,strokeDasharray:"3 3"}),e.jsx(sa,{dataKey:o,tickLine:!1,axisLine:!1}),e.jsx(Es,{yAxisId:"left",tickFormatter:u,tickLine:!1,axisLine:!1,width:40}),d.some(x=>x.yAxis==="right")?e.jsx(Es,{orientation:"right",yAxisId:"right",tickFormatter:p||u,tickLine:!1,axisLine:!1,width:40}):null,e.jsx(Os,{content:e.jsx(Na,{})}),d.map((x,T)=>e.jsx(Fa,{dataKey:x.key,name:x.name||x.key,fill:Qs((x.colorIndex||T)+1),radius:[6,6,0,0],yAxisId:x.yAxis==="right"?"right":"left",stackId:x.stackId,label:j?{position:"top"}:void 0},x.key))]})})})})]})}function un({title:t="Line Chart",description:s,className:a,height:r=260,data:n,xKey:o,series:d,grid:c=!0,yFormatter:u=mr,y2Formatter:p,showDataLabels:v,info:_}){const[j,f]=i.useState(!!v);return e.jsxs(Ne,{className:a,children:[e.jsx(wa,{title:t,description:s,info:_,series:d,showDataLabels:j,onToggle:f}),e.jsx(Be,{children:e.jsx("div",{style:{height:r},children:e.jsx(Ps,{width:"100%",height:"100%",children:e.jsxs(Zo,{data:n,margin:{left:8,right:16,top:16,bottom:0},children:[c&&e.jsx(ta,{stroke:ur,strokeDasharray:"3 3"}),e.jsx(sa,{dataKey:o,tickLine:!1,axisLine:!1}),e.jsx(Es,{yAxisId:"left",tickFormatter:u,tickLine:!1,axisLine:!1,width:40}),d.some(x=>x.yAxis==="right")?e.jsx(Es,{orientation:"right",yAxisId:"right",tickFormatter:p||u,tickLine:!1,axisLine:!1,width:40}):null,e.jsx(Os,{content:e.jsx(Na,{})}),d.map((x,T)=>e.jsx(yi,{type:"monotone",dataKey:x.key,name:x.name||x.key,stroke:Qs((x.colorIndex||T)+1),strokeWidth:2,dot:!1,activeDot:{r:3},yAxisId:x.yAxis==="right"?"right":"left",label:j?{position:"top"}:void 0},x.key))]})})})})]})}function vu({title:t="Pie Chart",description:s,className:a,height:r=260,data:n,valueKey:o,nameKey:d="label",colors:c,info:u}){const p=c||[1,2,3,4,5].map(v=>Qs(v));return e.jsxs(Ne,{className:a,children:[e.jsx(wa,{title:t,description:s,info:u,showDataLabels:!1,onToggle:()=>{}}),e.jsxs(Be,{children:[e.jsx("div",{style:{height:r},children:e.jsx(Ps,{width:"100%",height:"100%",children:e.jsxs(ec,{children:[e.jsx(Os,{content:e.jsx(Na,{})}),e.jsx(tc,{data:n,dataKey:o,nameKey:d,outerRadius:90,innerRadius:50,paddingAngle:2,label:!0,children:n.map((v,_)=>e.jsx(sc,{fill:p[_%p.length]},`slice-${_}`))})]})})}),e.jsx(yl,{series:n.map((v,_)=>({key:String(v[d]??_),name:String(v[d]??_),colorIndex:_+1}))})]})]})}function Nu({title:t="Radar Chart",description:s,className:a,height:r=300,data:n,xKey:o,valueKey:d,info:c}){return e.jsxs(Ne,{className:a,children:[e.jsx(wa,{title:t,description:s,info:c,series:[{key:d,name:d}],showDataLabels:!1,onToggle:()=>{}}),e.jsx(Be,{children:e.jsx("div",{style:{height:r},children:e.jsx(Ps,{width:"100%",height:"100%",children:e.jsxs(ac,{data:n,outerRadius:90,children:[e.jsx(rc,{stroke:ur}),e.jsx(nc,{dataKey:o}),e.jsx(ic,{}),e.jsx(Os,{content:e.jsx(Na,{})}),e.jsx(lc,{dataKey:d,name:d,stroke:Qs(2),fill:Qs(2),fillOpacity:.2})]})})})})]})}function wu({title:t="Radial Chart",description:s,className:a,height:r=260,data:n,max:o=100,info:d}){return e.jsxs(Ne,{className:a,children:[e.jsx(wa,{title:t,description:s,info:d,series:n.map((c,u)=>({key:c.name,name:c.name,colorIndex:(c.fillIndex||u)+1})),showDataLabels:!1,onToggle:()=>{}}),e.jsxs(Be,{children:[e.jsx("div",{style:{height:r},children:e.jsx(Ps,{width:"100%",height:"100%",children:e.jsxs(oc,{cx:"50%",cy:"50%",innerRadius:"40%",outerRadius:"90%",barSize:12,data:n.map((c,u)=>({...c,fill:Qs((c.fillIndex||u)+1)})),startAngle:90,endAngle:-270,children:[e.jsx(cc,{dataKey:"value",cornerRadius:6}),e.jsx(Os,{content:e.jsx(Na,{})})]})})}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:e.jsxs(ht,{variant:"outline",children:["Max: ",o]})})]})]})}const Nr=[{key:"apples",name:"Apples",colorIndex:1},{key:"bananas",name:"Bananas",colorIndex:2}],mn=[{key:"q1",name:"Q1",colorIndex:1,stackId:"s1"},{key:"q2",name:"Q2",colorIndex:2,stackId:"s1"},{key:"q3",name:"Q3",colorIndex:3,stackId:"s1"},{key:"q4",name:"Q4",colorIndex:4,stackId:"s1"}],Su=[{key:"revenue",name:"Revenue",colorIndex:1,yAxis:"left"},{key:"margin",name:"Margin %",colorIndex:2,yAxis:"right"}],wr=[{month:"Jan",apples:1200,bananas:900},{month:"Feb",apples:2100,bananas:1400},{month:"Mar",apples:800,bananas:1200},{month:"Apr",apples:1600,bananas:1700},{month:"May",apples:2400,bananas:2100},{month:"Jun",apples:2200,bananas:1800}],Cu=[{label:"Chrome",value:58},{label:"Safari",value:22},{label:"Edge",value:12},{label:"Firefox",value:6},{label:"Other",value:2}],_u=[{metric:"A",score:110},{metric:"B",score:98},{metric:"C",score:86},{metric:"D",score:99},{metric:"E",score:85},{metric:"F",score:65}],ku=[{name:"CPU",value:74},{name:"RAM",value:56},{name:"Disk",value:82}],bl=[{cat:"A",q1:40,q2:30,q3:20,q4:10},{cat:"B",q1:20,q2:35,q3:25,q4:20},{cat:"C",q1:10,q2:15,q3:30,q4:45}],Tu=bl.map(t=>{const s=["q1","q2","q3","q4"].reduce((a,r)=>a+Number(t[r]||0),0);return{cat:t.cat,q1:s?Math.round(Number(t.q1||0)/s*100):0,q2:s?Math.round(Number(t.q2||0)/s*100):0,q3:s?Math.round(Number(t.q3||0)/s*100):0,q4:s?Math.round(Number(t.q4||0)/s*100):0}}),Au=[{month:"Jan",revenue:12e4,margin:18},{month:"Feb",revenue:15e4,margin:22},{month:"Mar",revenue:9e4,margin:16},{month:"Apr",revenue:175e3,margin:24}];function Ru(){return e.jsxs("div",{className:"mx-auto max-w-6xl space-y-6 p-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold tracking-tight",children:"Shadcn Charts – 全工具包"}),e.jsx("p",{className:"mt-1 text-sm text-muted-foreground dark:text-muted-foreground",children:"包含 7 種常見圖表與統一樣式 Tooltip（Recharts hover + shadcn 提示說明），支援資料標籤開關。"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsx(ju,{title:"Area – 月度水果銷量",description:"以面積圖呈現兩組序列",data:wr,xKey:"month",series:Nr,info:{units:"units",dictionary:{apples:"Apples units",bananas:"Bananas units"}},showDataLabels:!0}),e.jsx(vr,{title:"Bar – 月度水果銷量",description:"分組直條圖",data:wr,xKey:"month",series:Nr,info:{units:"units",dictionary:{apples:"Apples units",bananas:"Bananas units"}}}),e.jsx(un,{title:"Line – 月度水果銷量",description:"折線趨勢圖",data:wr,xKey:"month",series:Nr,info:{units:"units",dictionary:{apples:"Apples units",bananas:"Bananas units"}},showDataLabels:!0}),e.jsx(vu,{title:"Pie – 瀏覽器佔比",description:"環形圓餅組合",data:Cu,valueKey:"value",nameKey:"label"}),e.jsx(Nu,{title:"Radar – 指標評分",description:"雷達網狀圖",data:_u,xKey:"metric",valueKey:"score"}),e.jsx(wu,{title:"Radial – 系統資源使用率",description:"多環徑向條圖",data:ku,max:100})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsx(vr,{title:"Stacked Bar – 季度組成",description:"使用 stackId 將多序列堆疊",data:bl,xKey:"cat",series:mn,info:{units:"units",dictionary:{q1:"Quarter 1",q2:"Quarter 2",q3:"Quarter 3",q4:"Quarter 4"}},showDataLabels:!0}),e.jsx(vr,{title:"% Stacked Bar – 比例",description:"資料端已正規化成百分比",data:Tu,xKey:"cat",series:mn,yFormatter:t=>`${t}%`,info:{units:"%",dictionary:{q1:"Quarter 1 %",q2:"Quarter 2 %",q3:"Quarter 3 %",q4:"Quarter 4 %"}},showDataLabels:!0}),e.jsx(un,{title:"Dual Axis – 營收/毛利",description:"左軸金額、右軸百分比",data:Au,xKey:"month",series:Su,yFormatter:t=>`$${mr(t)}`,y2Formatter:t=>`${t}%`,info:{units:"Revenue: USD / Margin: %",dictionary:{revenue:"Revenue (USD)",margin:"Margin (%)"}},showDataLabels:!0})]}),e.jsxs(Ne,{children:[e.jsxs(ot,{children:[e.jsx(pt,{children:"Tooltip – 說明"}),e.jsxs($s,{children:["圖上滑動的即時提示為 Recharts Tooltip（以 ",e.jsx("code",{children:"content"})," 客製樣式）；標題右側的提示為 shadcn/ui Tooltip（顯示單位與資料字典）。"]})]}),e.jsx(Be,{children:e.jsxs("div",{className:"text-sm text-muted-foreground dark:text-muted-foreground",children:["如需將圖例完全抽換為 shadcn 按鈕/切換控制，可擴充 ",e.jsx("code",{children:"SeriesLegend"}),"，加入顯示/隱藏序列的交互。"]})})]})]})}const Iu=()=>ii({mutationFn:async({hts8:t,year:s})=>{const{data:a}=await rs("/api/dataweb-adapter?translation=commodity",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({hts8:t,year:s})});return a}}),Fu=({initialHts8:t="",initialYear:s=String(new Date().getFullYear()),onResult:a})=>{const[r,n]=i.useState(t),[o,d]=i.useState(s),[c,u]=i.useState(null),[p,v]=i.useState([]),[_,j]=i.useState(null),f=Iu(),x=w=>{const S=Array.isArray(w==null?void 0:w.imports)?w.imports:[],y=Array.isArray(w==null?void 0:w.exports)?w.exports:[],g=w==null?void 0:w.import,b=w==null?void 0:w.export,R=Array.isArray(g==null?void 0:g.list)?g.list:[],P=Array.isArray(b==null?void 0:b.list)?b.list:[],z=Array.isArray(g==null?void 0:g.classifications)?g.classifications:[],B=Array.isArray(b==null?void 0:b.classifications)?b.classifications:[],M=I=>{const k=I.map(U=>String(U).toUpperCase()),F=k.indexOf("NAICS");return F>=0?F:k.indexOf("NAIC")},A=M(z),V=M(B),q=new Set;for(const I of[].concat(S,y)){const k=(I==null?void 0:I.naics)||(I==null?void 0:I.NAICS)||(I==null?void 0:I.naic)||[];for(const F of Array.isArray(k)?k:[]){const ne=((F==null?void 0:F.code)??(F==null?void 0:F.id)??"").toString().replace(/\D/g,"").slice(0,6);ne.length===6&&q.add(ne)}}if(A>=0){for(const I of R)if(Array.isArray(I)&&I.length>A){const k=String(I[A]??"").replace(/\D/g,"").slice(0,6);k.length===6&&q.add(k)}}if(V>=0){for(const I of P)if(Array.isArray(I)&&I.length>V){const k=String(I[V]??"").replace(/\D/g,"").slice(0,6);k.length===6&&q.add(k)}}return Array.from(q).sort((I,k)=>I.localeCompare(k))},T=async()=>{try{u(null),v([]),j(null);const w=String(r||"").replace(/\D/g,"").slice(0,10);if(!w)throw new Error("請輸入 8 或 10 碼 HTS");const S=String(o||new Date().getFullYear()),y=await f.mutateAsync({hts8:w,year:S}),g=x(y);v(g),j(y),a==null||a({raw:y,naics6:g})}catch(w){u((w==null?void 0:w.message)||"翻譯發生錯誤")}};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-wrap items-end gap-3",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs text-muted-foreground",htmlFor:"hts8",children:"HTS (8/10 碼)"}),e.jsx(He,{id:"hts8",value:r,onChange:w=>n(w.target.value),placeholder:"例如 73063800 或 7306380020"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs text-muted-foreground",htmlFor:"year",children:"年度"}),e.jsx(He,{id:"year",value:o,onChange:w=>d(w.target.value),className:"w-28",placeholder:"2025"})]}),e.jsx(ee,{onClick:T,disabled:f.isPending,children:f.isPending?"查詢中…":"HTS 對 NAICS 翻譯"})]}),c&&e.jsx(Rs,{variant:"destructive",children:e.jsx(Is,{children:c})}),p.length>0&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm text-foreground",children:"辨識出的 NAICS 六碼（已去重）："}),e.jsx("div",{className:"flex flex-wrap gap-2",children:p.map(w=>e.jsx("span",{className:"px-2 py-1 rounded border text-xs font-mono bg-background text-foreground",children:w},w))})]}),_&&e.jsxs("details",{className:"mt-2",children:[e.jsx("summary",{className:"text-sm text-muted-foreground cursor-pointer",children:"檢視原始回應（翻譯 API）"}),e.jsx("pre",{className:"text-xs bg-muted p-3 rounded overflow-auto",children:JSON.stringify(_,null,2)})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"資料來源：/api/dataweb-adapter?translation=commodity（POST），行為與 DataWeb 官方工具一致。"})]})},Du=t=>Ft({queryKey:["ustr-301",t],queryFn:async()=>{const s=new URLSearchParams;t.q&&s.set("q",t.q),t.list&&t.list!=="ALL"&&s.set("list",t.list),t.rate&&t.rate!=="ALL"&&s.set("rate",t.rate),s.set("page",String(t.page)),s.set("pageSize",String(t.pageSize)),s.set("sortKey",t.sortKey),s.set("sortDir",t.sortDir);const{data:a}=await rs(`/api/get-ustr-301?${s.toString()}`);return{items:Array.isArray(a.items)?a.items:[],total:typeof a.total=="number"?a.total:0,listOptions:Array.isArray(a.listOptions)?a.listOptions:[],rateOptions:Array.isArray(a.rateOptions)?a.rateOptions:[]}}}),Lu=["1","2","3","4","4A","4B"],Pu=["7.5%","10%","15%","25%","0%"],Ta={q:"",list:"ALL",rate:"ALL"},Eu=()=>{var I,k,F,U,ne,ge;const[t,s]=i.useState(Ta.q),[a,r]=i.useState(Ta.list),[n,o]=i.useState(Ta.rate),[d,c]=i.useState(1),[u,p]=i.useState(20),[v,_]=i.useState("hts"),[j,f]=i.useState("asc"),[x,T]=i.useState(Ta),w=i.useMemo(()=>({q:x.q,list:x.list,rate:x.rate,page:d,pageSize:u,sortKey:v,sortDir:j}),[x,d,u,v,j]),S=Du(w),y=S.isLoading||S.isFetching,g=S.error?S.error instanceof Error?S.error.message:String(S.error):null,b=((I=S.data)==null?void 0:I.items)??[],R=((k=S.data)==null?void 0:k.total)??0,P=i.useMemo(()=>Math.max(1,Math.ceil(R/u)),[R,u]),z=(U=(F=S.data)==null?void 0:F.listOptions)!=null&&U.length?S.data.listOptions:Lu,B=(ge=(ne=S.data)==null?void 0:ne.rateOptions)!=null&&ge.length?S.data.rateOptions:Pu,M=i.useMemo(()=>["ALL",...z],[z]),A=i.useMemo(()=>["ALL",...B],[B]);i.useEffect(()=>{a!=="ALL"&&z.length&&!z.includes(a)&&r("ALL")},[a,z]),i.useEffect(()=>{n!=="ALL"&&B.length&&!B.includes(n)&&o("ALL")},[n,B]);function V(){const $=t.trim();c(1),T({q:$,list:a,rate:n})}function q($){const le=v===$&&j==="asc"?"desc":"asc";_($),f(le),c(1)}return e.jsxs(Ne,{className:"p-4 md:p-6 space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"USTR 301 Explorer"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"查詢與篩選 USTR Section 301 清單（支援 8/10 位 HTS）。"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-3 items-end",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:"HTS 查詢（可輸入 8/10 位）"}),e.jsx(He,{value:t,onChange:$=>s($.target.value),placeholder:"例如 85176200 或 8517.62.0090",onKeyDown:$=>{$.key==="Enter"&&V()}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:"List"}),e.jsxs($t,{value:a,onValueChange:$=>r($),children:[e.jsx(Pt,{className:"w-full",children:e.jsx(Ht,{})}),e.jsx(Et,{children:M.map($=>e.jsx(nt,{value:$,children:$==="ALL"?"ALL":`List ${$}`},$))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:"Rate"}),e.jsxs($t,{value:n,onValueChange:$=>o($),children:[e.jsx(Pt,{className:"w-full",children:e.jsx(Ht,{})}),e.jsx(Et,{children:A.map($=>e.jsx(nt,{value:$,children:$},$))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:"Page"}),e.jsx(He,{type:"number",min:1,value:d,onChange:$=>c(Math.max(1,Number($.target.value)||1))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ee,{className:"grow",onClick:V,children:"搜尋"}),e.jsx(ee,{variant:"outline",onClick:()=>{s(""),r("ALL"),o("ALL"),T(Ta),c(1)},children:"重置"})]})]}),g&&e.jsx(Rs,{variant:"destructive",children:e.jsx(Is,{children:g})}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-muted-foreground",children:[e.jsxs("span",{children:["共 ",R," 筆，頁次 ",d," / ",P]}),e.jsxs("span",{children:["排序 ",v.toUpperCase(),"（",j==="asc"?"升冪":"降冪","）"]})]}),e.jsx("div",{className:"overflow-auto border rounded-md",children:e.jsxs(Ys,{children:[e.jsx(oa,{children:e.jsx(Gt,{children:[{key:"hts",label:"HTS Code",sortable:!0},{key:"list",label:"List",sortable:!0},{key:"rate",label:"Rate",sortable:!0},{key:"effective",label:"Effective Date",sortable:!0},{key:"action",label:"Action",sortable:!0},{key:"description",label:"Description",sortable:!1},{key:"note",label:"Note",sortable:!1}].map($=>e.jsx(us,{className:$.sortable?"cursor-pointer select-none":void 0,onClick:()=>$.sortable&&q($.key),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:$.label}),$.sortable&&v===$.key&&e.jsx(ht,{variant:"outline",className:"text-[10px]",children:j==="asc"?"ASC":"DESC"})]})},$.key))})}),e.jsx(Gs,{children:y?e.jsx(Gt,{children:e.jsx(_t,{colSpan:5,className:"text-center text-sm text-muted-foreground",children:"Loading ..."})}):b.length?b.map(($,le)=>e.jsxs(Gt,{children:[e.jsx(_t,{className:"font-mono",children:$.hts||"—"}),e.jsx(_t,{children:$.list_base?e.jsx(ht,{variant:"secondary",children:$.list_base}):"—"}),e.jsx(_t,{children:$.max_rate_text||"—"}),e.jsx(_t,{children:$.effective_date||"—"}),e.jsx(_t,{className:"max-w-xs",children:$.action_title||"—"}),e.jsx(_t,{className:"max-w-lg",children:$.description||"—"}),e.jsx(_t,{className:"max-w-xs text-muted-foreground",children:$.note||"—"})]},`${$.hts}_${le}`)):e.jsx(Gt,{children:e.jsx(_t,{colSpan:7,className:"text-center text-muted-foreground",children:"沒有資料"})})})]})}),e.jsxs("div",{className:"flex items-center gap-3 text-sm justify-between flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"每頁筆數"}),e.jsxs($t,{value:String(u),onValueChange:$=>{p(Number($)||10),c(1)},children:[e.jsx(Pt,{className:"w-24",children:e.jsx(Ht,{})}),e.jsx(Et,{children:[10,20,50,100].map($=>e.jsx(nt,{value:String($),children:$},$))})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{variant:"secondary",size:"sm",disabled:d<=1,onClick:()=>c($=>Math.max(1,$-1)),children:"Prev"}),e.jsxs("span",{children:["Page ",d," / ",P]}),e.jsx(ee,{variant:"secondary",size:"sm",disabled:d>=P,onClick:()=>c($=>Math.min(P,$+1)),children:"Next"})]})]})]})},Ja=({label:t,type:s,value:a,children:r,defaultOpen:n})=>{const[o,d]=i.useState(!!n),c=!!r;return e.jsxs("div",{className:"ml-4 border-l border-slate-200 pl-3 py-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[c?e.jsx("button",{onClick:()=>d(!o),className:"text-slate-500 hover:text-slate-700",children:o?e.jsx(Ea,{size:14}):e.jsx(ir,{size:14})}):e.jsx("span",{className:"w-4"}),e.jsx("span",{className:"text-slate-700 font-mono text-sm",children:t}),e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full border bg-slate-50 text-slate-500",children:s}),a!=null&&e.jsxs("span",{className:"text-xs text-slate-500 truncate max-w-xs",children:["= ",String(a)]})]}),c&&o&&e.jsx("div",{className:"mt-1",children:r})]})},Ir=(t,s,a=0)=>t==null?e.jsx(Ja,{label:s,type:"null",value:null}):typeof t!="object"?e.jsx(Ja,{label:s,type:typeof t,value:t}):Array.isArray(t)?e.jsx(Ja,{label:s,type:"array",defaultOpen:a===0,children:t.map((r,n)=>e.jsx("div",{className:"mb-1",children:Ir(r,`[${n}]`,a+1)},n))}):e.jsx(Ja,{label:s,type:"object",defaultOpen:a===0,children:Object.entries(t).map(([r,n])=>e.jsx("div",{className:"mb-1",children:Ir(n,r,a+1)},r))}),Ou=({raw:t})=>{const s=i.useMemo(()=>Ir(t??{},"{Investigation Item}"),[t]);return e.jsxs("div",{className:"border rounded-2xl p-4 bg-white shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(_o,{className:"text-indigo-500",size:18}),e.jsx("h3",{className:"font-semibold text-slate-800 text-sm",children:"Raw JSON Tree (Dev)"})]}),e.jsxs("div",{className:"text-xs text-slate-500 mb-2 flex items-center gap-2",children:[e.jsx(ko,{size:14}),"直接顯示 API 回傳的階層資料，便於開發者檢視欄位。"]}),e.jsx("div",{className:"max-h-[480px] overflow-auto pr-2",children:s})]})},Mu=["","Completed","Terminated","Inactive","Active","Pending before the ALJ","Not Instituted","Complaint/Request Withdrawn","Pre-institution","Pending before the Commission","Adequacy","Pending","Cancelled","Petition/Request Withdrawn","Consolidated"],$u=()=>{const[t,s]=i.useState(""),[a,r]=i.useState(""),[n,o]=i.useState(""),[d,c]=i.useState(""),[u,p]=i.useState(""),[v,_]=i.useState(!1),[j,f]=i.useState(1),[x,T]=i.useState(0),[w,S]=i.useState({keyword:"",country:"",status:"",officialId:"",orderNumber:""}),y=i.useMemo(()=>!!w.keyword||!!w.country||!!w.status||!!w.officialId||!!w.orderNumber,[w]),{data:g,isFetching:b,isError:R,error:P}=Ft({queryKey:["ids-card-search",w.keyword,w.country,w.status,w.officialId,w.orderNumber,j,v],queryFn:async()=>{const A=new URLSearchParams({q:w.keyword,country:w.country,status:w.status,officialId:w.officialId,orderNumber:w.orderNumber,page:j.toString(),pageSize:"10",includeRaw:"1"}),V=await fetch(`/api/ids-search?${A.toString()}`);if(!V.ok){const q=await V.json().catch(()=>({}));throw new Error(q.message||"Failed to fetch IDS data")}return V.json()},enabled:y,placeholderData:vi}),z=()=>{f(1),S({keyword:t.trim(),country:a.trim(),status:n.trim(),officialId:d.trim(),orderNumber:u.trim()})},B=A=>{A.key==="Enter"&&z()};i.useEffect(()=>{g!=null&&g.rawData&&g.rawData.length>0&&T(0)},[g==null?void 0:g.rawData]);const M=g!=null&&g.rawData&&g.rawData.length>0?g.rawData[Math.min(x,g.rawData.length-1)]:null;return e.jsxs(Ne,{className:"p-4 md:p-6 space-y-4",children:[e.jsx(ot,{className:"p-0",children:e.jsx(pt,{className:"text-lg",children:"USITC Investigation Search"})}),e.jsxs(Be,{className:"p-0 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:[e.jsx(He,{placeholder:"Keyword (topic/product/country)",value:t,onChange:A=>s(A.target.value),onKeyDown:B,disabled:b}),e.jsx(He,{placeholder:"Country",value:a,onChange:A=>r(A.target.value),onKeyDown:B,disabled:b}),e.jsx("select",{className:"h-10 w-full rounded-md border border-input bg-background px-3 text-sm shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",value:n,onChange:A=>o(A.target.value),disabled:b,children:Mu.map(A=>e.jsx("option",{value:A,children:A||"All statuses"},A||"all"))}),e.jsx(He,{placeholder:"Inv. Number (e.g., 701-253)",value:d,onChange:A=>c(A.target.value),onKeyDown:B,disabled:b}),e.jsx(He,{placeholder:"Commerce Order/Case Number",value:u,onChange:A=>p(A.target.value),onKeyDown:B,disabled:b})]}),e.jsxs("div",{className:"flex justify-end",children:[e.jsxs("label",{className:"mr-3 inline-flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx("input",{type:"checkbox",className:"h-4 w-4",checked:v,onChange:A=>_(A.target.checked),disabled:b}),"Show raw tree"]}),e.jsxs(ee,{onClick:z,disabled:b,children:[b?e.jsx(ri,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(Hs,{className:"mr-2 h-4 w-4"}),"Search"]})]}),e.jsxs("div",{className:"relative min-h-[200px]",children:[b&&!g&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(wt,{className:"h-4 w-1/2"}),e.jsx(wt,{className:"h-4 w-full"}),e.jsx(wt,{className:"h-4 w-5/6"})]}),R&&!b&&e.jsxs("div",{className:"text-sm text-destructive",children:["Failed to load search results. ",P==null?void 0:P.message]}),!b&&g&&g.data.length===0&&e.jsx("div",{className:"text-sm text-muted-foreground",children:"No results found for current filters."}),g&&g.data.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing"," ",g.metadata.totalItems>g.metadata.pageSize?`${(g.metadata.currentPage-1)*g.metadata.pageSize+1}-${Math.min(g.metadata.currentPage*g.metadata.pageSize,g.metadata.totalItems)}`:g.metadata.totalItems," ","of ",g.metadata.totalItems," results."]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b text-left text-xs uppercase text-muted-foreground",children:[e.jsx("th",{className:"py-2 pr-3",children:"Inv. Number"}),e.jsx("th",{className:"py-2 pr-3",children:"Topic"}),e.jsx("th",{className:"py-2 pr-3",children:"Phase"}),e.jsx("th",{className:"py-2 pr-3",children:"Countries"}),e.jsx("th",{className:"py-2 pr-3",children:"Start Date"}),e.jsx("th",{className:"py-2 pr-3",children:"End Date"})]})}),e.jsx("tbody",{children:g.data.map(A=>e.jsxs("tr",{className:"border-b last:border-none",children:[e.jsx("td",{className:"py-2 pr-3 font-semibold text-primary",children:A.officialId||A.id}),e.jsxs("td",{className:"py-2 pr-3",children:[e.jsx("div",{className:"font-medium",children:A.topic||A.title}),e.jsx("div",{className:"text-xs text-muted-foreground line-clamp-2",children:A.title})]}),e.jsx("td",{className:"py-2 pr-3",children:A.phase||"N/A"}),e.jsx("td",{className:"py-2 pr-3 text-xs text-muted-foreground",children:A.countries.length>0?A.countries.join(", "):"N/A"}),e.jsx("td",{className:"py-2 pr-3 text-xs",children:A.startDate||"—"}),e.jsx("td",{className:"py-2 pr-3 text-xs",children:A.endDate||"—"})]},A.id))})]})}),g.metadata.totalPages>1&&e.jsxs("div",{className:"flex items-center justify-between pt-2",children:[e.jsx(ee,{variant:"outline",size:"sm",onClick:()=>f(A=>Math.max(A-1,1)),disabled:j<=1||b,children:"Previous"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",g.metadata.currentPage," of ",g.metadata.totalPages]}),e.jsx(ee,{variant:"outline",size:"sm",onClick:()=>f(A=>Math.min(A+1,g.metadata.totalPages)),disabled:j>=g.metadata.totalPages||b,children:"Next"})]}),g.rawData&&g.rawData.length>0&&e.jsxs("div",{className:"space-y-3 rounded-md border p-3",children:[e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("div",{className:"text-sm font-semibold",children:"Raw data preview"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Preview item"}),e.jsx("select",{className:"h-9 rounded-md border border-input bg-background px-2 text-sm",value:x,onChange:A=>T(Number(A.target.value)),children:g.rawData.map((A,V)=>e.jsx("option",{value:V,children:(A==null?void 0:A.official_investigation_number)||(A==null?void 0:A["Investigation Number"])||(A==null?void 0:A.investigation_id)||`Item ${V+1}`},V))})]})]}),v&&e.jsx("div",{className:"space-y-2",children:g.rawData.map((A,V)=>e.jsxs("details",{className:"rounded border border-muted p-2",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold",children:(A==null?void 0:A.official_investigation_number)||(A==null?void 0:A["Investigation Number"])||(A==null?void 0:A.investigation_id)||"Item"}),e.jsx("div",{className:"mt-2",children:e.jsx(Fr,{data:A,depth:0})})]},V))}),M&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"rounded-lg bg-slate-50 p-3 border border-slate-200",children:e.jsx(Ou,{raw:M})}),e.jsx("div",{className:"rounded-lg bg-slate-50 p-3 border border-slate-200",children:e.jsx(ol,{raw:M})})]})]}),!g.rawData&&v&&e.jsx("div",{className:"text-xs text-muted-foreground",children:"Raw data 尚未載入，請重新搜尋。"})]})]})]})]})},Xa=12,Fr=({data:t,depth:s})=>t==null?e.jsx("div",{style:{paddingLeft:s*Xa},className:"text-xs text-muted-foreground",children:"null"}):typeof t!="object"?e.jsx("div",{style:{paddingLeft:s*Xa},className:"text-xs",children:String(t)}):Array.isArray(t)?e.jsx("div",{style:{paddingLeft:s*Xa},className:"space-y-1",children:t.map((a,r)=>e.jsxs("details",{className:"rounded border border-muted/50 p-1",children:[e.jsxs("summary",{className:"text-xs font-semibold",children:["[",r,"]"]}),e.jsx(Fr,{data:a,depth:s+1})]},r))}):e.jsx("div",{style:{paddingLeft:s*Xa},className:"space-y-1",children:Object.entries(t).map(([a,r])=>e.jsxs("details",{className:"rounded border border-muted/50 p-1",children:[e.jsx("summary",{className:"text-xs font-semibold",children:a}),e.jsx(Fr,{data:r,depth:s+1})]},a))});function Hu(){return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h2",{className:"text-xl font-bold text-foreground",children:"Commodity Search Tool"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"HTScode to NAICS / ADCVD case Number / USTR 301"})]}),e.jsxs(Ne,{className:"p-4 md:p-6 space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"NAICS Commodity Translator"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"呼叫 `/api/dataweb-adapter?translation=commodity`（POST）以 DataWeb Commodity Translation API 轉換。"})]}),e.jsx(Fu,{}),e.jsx(Rs,{children:e.jsxs(Is,{children:["參考來源：",e.jsx("a",{className:"text-primary hover:text-primary/80 underline ml-1",href:"https://dataweb.usitc.gov/classification/commodity-translation",target:"_blank",rel:"noreferrer",children:"dataweb.usitc.gov/classification/commodity-translation"})]})})]}),e.jsx(cl,{}),e.jsx(Eu,{}),e.jsx($u,{})]})}const Uu=Ao,Bu=Ro,Sr=Io,Vu=i.forwardRef(({className:t,inset:s,children:a,...r},n)=>e.jsxs(li,{ref:n,className:J("flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:h-4 [&_svg]:w-4 [&_svg]:shrink-0",s&&"pl-8",t),...r,children:[a,e.jsx(ir,{className:"ml-auto"})]}));Vu.displayName=li.displayName;const qu=i.forwardRef(({className:t,...s},a)=>e.jsx(oi,{ref:a,className:J("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",t),...s}));qu.displayName=oi.displayName;const jl=i.forwardRef(({className:t,sideOffset:s=4,...a},r)=>e.jsx(To,{children:e.jsx(ci,{ref:r,sideOffset:s,className:J("z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",t),...a})}));jl.displayName=ci.displayName;const zu=i.forwardRef(({className:t,inset:s,...a},r)=>e.jsx(di,{ref:r,className:J("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:h-4 [&_svg]:w-4 [&_svg]:shrink-0",s&&"pl-8",t),...a}));zu.displayName=di.displayName;const Qu=i.forwardRef(({className:t,children:s,checked:a,...r},n)=>e.jsxs(ui,{ref:n,className:J("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),checked:a,...r,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(mi,{children:e.jsx(Er,{className:"h-4 w-4"})})}),s]}));Qu.displayName=ui.displayName;const ga=i.forwardRef(({className:t,children:s,...a},r)=>e.jsxs(hi,{ref:r,className:J("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...a,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(mi,{children:e.jsx(Xn,{className:"h-2 w-2 fill-current"})})}),s]}));ga.displayName=hi.displayName;const tr=i.forwardRef(({className:t,inset:s,...a},r)=>e.jsx(pi,{ref:r,className:J("px-2 py-1.5 text-sm font-semibold",s&&"pl-8",t),...a}));tr.displayName=pi.displayName;const Dr=i.forwardRef(({className:t,...s},a)=>e.jsx(fi,{ref:a,className:J("-mx-1 my-1 h-px bg-muted",t),...s}));Dr.displayName=fi.displayName;const Yu=[{value:"default",label:"Default"},{value:"ocean",label:"Ocean"},{value:"jade",label:"Jade"},{value:"plum",label:"Plum"}],Gu=[{value:"zh-TW",label:"繁體中文"},{value:"en",label:"English"}];function Ku({theme:t,setTheme:s,themeName:a,setThemeName:r}){const{i18n:n}=Ge(),o=n.resolvedLanguage||n.language||"zh-TW",d=c=>{n.changeLanguage(c);try{window.localStorage.setItem("lng",c)}catch{}};return e.jsxs(Uu,{children:[e.jsx(Bu,{asChild:!0,children:e.jsx(ee,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded-full border border-border/60 p-0",title:"外觀 / 語言",children:e.jsx(Fo,{className:"h-4 w-4"})})}),e.jsxs(jl,{align:"end",className:"w-56",children:[e.jsxs(tr,{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(Do,{className:"h-3.5 w-3.5"}),"模式"]}),e.jsxs(Sr,{value:t,onValueChange:s,children:[e.jsx(ga,{value:"light",children:"亮色"}),e.jsx(ga,{value:"dark",children:"暗色"}),e.jsx(ga,{value:"system",children:"系統"})]}),e.jsx(Dr,{}),e.jsxs(tr,{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(Lo,{className:"h-3.5 w-3.5"}),"主題"]}),e.jsx(Sr,{value:a,onValueChange:r,children:Yu.map(c=>e.jsx(ga,{value:c.value,children:c.label},c.value))}),e.jsx(Dr,{}),e.jsxs(tr,{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(xi,{className:"h-3.5 w-3.5"}),"語言"]}),e.jsx(Sr,{value:o,onValueChange:d,children:Gu.map(c=>e.jsx(ga,{value:c.value,children:c.label},c.value))})]})]})}function Wu(t){const{name:s,selectedCount:a,onClear:r,popover:n}=t,o=s,{t:d}=Ge(),c=n.totalPages?d("fr.facet.pageWithTotal",{page:n.page||1,total:n.totalPages}):d("fr.facet.page",{page:n.page||1});return e.jsx("div",{className:"border border-border rounded p-3 md:p-4",children:e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"font-semibold text-sm capitalize flex items-center gap-2",children:[e.jsx("span",{children:o}),a>0&&e.jsx("span",{className:"inline-flex items-center justify-center h-5 min-w-5 px-1 rounded-full bg-accent text-accent-foreground text-[10px]",children:a})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{variant:"ghost",size:"sm",className:"h-7 px-2 text-xs",disabled:a===0&&o!=="daily"&&o!=="weekly"&&o!=="monthly"&&o!=="quarterly",onClick:r,children:d("fr.facet.clear")}),e.jsxs($a,{open:n.open,onOpenChange:n.onOpenChange,children:[e.jsx(Ha,{asChild:!0,children:e.jsx(ee,{variant:"secondary",size:"sm",className:"h-7 px-2 text-xs",children:d("fr.facet.browse")})}),e.jsxs(va,{className:"w-96 max-h-96 overflow-auto",children:[e.jsxs("div",{className:"text-xs font-medium mb-2",children:[o," - ",c]}),n.loading&&e.jsx("div",{className:"text-xs text-muted-foreground",children:d("status.loading")}),!n.loading&&e.jsx("div",{className:"space-y-2",children:n.groups.map((u,p)=>e.jsxs("div",{children:[u.year&&(n.isQuarterly?e.jsxs("button",{className:"text-sm font-medium text-muted-foreground mb-1 underline-offset-2 hover:underline",onClick:()=>n.onSelect({name:u.year||""}),title:d("fr.facet.applyYear",{year:u.year}),children:[u.year,e.jsxs("span",{className:"ml-1 text-xs text-muted-foreground",children:["(",u.yearCount??(u.items||[]).reduce((v,_)=>v+((_==null?void 0:_.count)??0),0),")"]})]}):e.jsxs("div",{className:"text-sm font-medium text-muted-foreground mb-1",children:[u.year,e.jsxs("span",{className:"ml-1 text-xs text-muted-foreground",children:["(",u.yearCount??(u.items||[]).reduce((v,_)=>v+((_==null?void 0:_.count)??0),0),")"]})]})),e.jsx("div",{className:"space-y-1",children:(u.items||[]).map((v,_)=>{const j=(v==null?void 0:v.name)||"",f=(v==null?void 0:v.slug)||j,x=(v==null?void 0:v.count)??0;return e.jsxs("div",{className:"flex items-center justify-between gap-2 text-sm h-9 rounded px-2 cursor-pointer hover:bg-accent/30",onClick:T=>{T.stopPropagation(),n.onSelect({name:j,slug:f,count:x}),n.autoClose&&n.onOpenChange(!1)},children:[e.jsx("div",{className:"truncate",children:j}),e.jsx("span",{className:"text-muted-foreground",children:x})]},`${f}-${_}`)})})]},`${o}-grp-${p}`))}),e.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx(fs,{id:`auto-${o}`,checked:n.autoClose,onCheckedChange:u=>n.onAutoCloseChange(!!u)}),e.jsx(Te,{htmlFor:`auto-${o}`,className:"text-xs",children:d("fr.facet.autoClose")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{variant:"secondary",size:"sm",className:"h-7 px-2 text-xs",disabled:(n.page||1)<=1,onClick:n.onPrev,children:d("fr.prev")}),e.jsx(ee,{variant:"secondary",size:"sm",className:"h-7 px-2 text-xs",disabled:!!n.totalPages&&(n.page||1)>=(n.totalPages||1),onClick:n.onNext,children:d("fr.next")}),e.jsx(ee,{variant:"ghost",size:"sm",className:"h-7 px-2 text-xs",onClick:r,children:d("fr.facet.clear")}),e.jsx(ee,{variant:"secondary",size:"sm",className:"h-7 px-2 text-xs",onClick:()=>{},children:d("fr.facet.apply")}),e.jsx(ee,{variant:"ghost",size:"sm",className:"h-7 px-2 text-xs",onClick:n.onClose,children:d("actions.close")})]})]})]})]})]})]})})}function Ju(t){const{rowKeys:s,facetsObj:a,getFacetSelectedCount:r,onClear:n,facetOpen:o,setFacetOpen:d,facetPage:c,facetTotalPages:u,facetItems:p,facetLoading:v,facetAutoClose:_,setFacetAutoClose:j,loadFacetPage:f,onSelectItem:x,groupByYear:T}=t,{t:w}=Ge();return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3",children:s.map(S=>{const y=a==null?void 0:a[S],g=((y==null?void 0:y.results)||[]).map(R=>(R==null?void 0:R.attributes)??R),b=w(`fr.facet.names.${S}`,{defaultValue:S});return e.jsx(Wu,{name:b,selectedCount:r(S),onClear:()=>n(S),popover:{open:!!o[S],onOpenChange:R=>{if(d(P=>({...P,[S]:R})),R){const P=c[S]||1;if(f(S,P),S==="quarterly"){const z=c.yearly||1;f("yearly",z)}}},loading:!!v[S],page:c[S]||1,totalPages:u[S]||1,onPrev:()=>f(S,Math.max(1,(c[S]||1)-1)),onNext:()=>f(S,(c[S]||1)+1),autoClose:_,onAutoCloseChange:R=>j(!!R),groups:(()=>{const R=p[S]||g||[];if(S==="quarterly"){const P=p.yearly||[];return P.length?[...P].sort((B,M)=>{var q,I;const A=Number(((q=String((B==null?void 0:B.name)||(B==null?void 0:B.slug)||"").match(/(19|20)\d{2}/))==null?void 0:q[0])||0);return Number(((I=String((M==null?void 0:M.name)||(M==null?void 0:M.slug)||"").match(/(19|20)\d{2}/))==null?void 0:I[0])||0)-A}).map(B=>{const M=String((B==null?void 0:B.name)||(B==null?void 0:B.slug)||""),A=(R||[]).filter(V=>String((V==null?void 0:V.name)||"").includes(M)&&((V==null?void 0:V.count)??0)>0);return{year:M,items:A,yearCount:(B==null?void 0:B.count)??0}}):T(R).map(z=>({...z,items:(z.items||[]).filter(B=>((B==null?void 0:B.count)??0)>0),yearCount:(z.items||[]).reduce((B,M)=>B+((M==null?void 0:M.count)??0),0)}))}return S==="daily"||S==="weekly"||S==="monthly"?T(R).map(P=>({...P,items:(P.items||[]).filter(z=>((z==null?void 0:z.count)??0)>0)})):[{year:"",items:(R||[]).filter(P=>((P==null?void 0:P.count)??0)>0)}]})(),onSelect:({name:R,slug:P})=>{const z=String(R||"");x(S,z,P),_&&d(B=>({...B,[S]:!1}))},onClose:()=>d(R=>({...R,[S]:!1})),isQuarterly:S==="quarterly"}},S)})})}function Xu(t){const{term:s,onTermChange:a,loading:r,onSearch:n,debugMode:o,searchUrl:d}=t,{t:c}=Ge();return e.jsxs(Ne,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative flex-grow",children:[e.jsx(Hs,{className:"w-4 h-4 text-muted-foreground absolute left-3 top-1/2 -translate-y-1/2"}),e.jsx(Te,{htmlFor:"fr-term",className:"sr-only",children:c("fr.search.label")}),e.jsx(He,{id:"fr-term",value:s,onChange:u=>a(u.target.value),placeholder:c("fr.search.placeholder"),className:"w-full h-10 text-sm pl-9"})]}),e.jsx(ee,{onClick:n,disabled:!!r,variant:"default",size:"sm",className:"h-10 px-4 text-sm",children:c(r?"fr.search.searching":"fr.search.search")})]}),o&&d&&e.jsx("div",{className:"mt-2",children:e.jsx("span",{className:"text-[11px] text-muted-foreground truncate",title:d,children:d})})]})}function Zu(t){const{t:s}=Ge(),{dateStart:a,dateEnd:r,perPage:n,order:o,onDateStartChange:d,onDateEndChange:c,onPerPageChange:u,onOrderChange:p,onClearDates:v}=t,_=s("fr.controls.datePlaceholder",{defaultValue:"YYYY-MM-DD"});return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-2 md:gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx(Te,{htmlFor:"fr-date-start",className:"text-xs",children:s("fr.controls.startDate")}),v&&e.jsx(ee,{variant:"ghost",size:"sm",className:"h-auto px-2 py-1 text-xs",onClick:v,children:s("fr.clearDates")})]}),e.jsx(He,{id:"fr-date-start",value:a,onChange:j=>d(j.target.value),placeholder:_,className:"h-9 text-sm"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(Te,{htmlFor:"fr-date-end",className:"text-xs",children:s("fr.controls.endDate")}),e.jsx(He,{id:"fr-date-end",value:r,onChange:j=>c(j.target.value),placeholder:_,className:"h-9 text-sm"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(Te,{htmlFor:"fr-perpage",className:"text-xs",children:s("fr.controls.perPage")}),e.jsxs($t,{value:String(n),onValueChange:j=>u(parseInt(j,10)||10),children:[e.jsx(Pt,{id:"fr-perpage",className:"h-9 text-sm",children:e.jsx(Ht,{})}),e.jsx(Et,{children:[5,10,20,50].map(j=>e.jsx(nt,{value:String(j),children:j},j))})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(Te,{htmlFor:"fr-order",className:"text-xs",children:s("fr.controls.order")}),e.jsxs($t,{value:o,onValueChange:j=>p(j),children:[e.jsx(Pt,{id:"fr-order",className:"h-9 text-sm",children:e.jsx(Ht,{})}),e.jsxs(Et,{children:[e.jsx(nt,{value:"recent",children:s("fr.controls.orderRecent")}),e.jsx(nt,{value:"oldest",children:s("fr.controls.orderOldest")}),e.jsx(nt,{value:"newest",children:s("fr.controls.orderNewest")})]})]})]})]})}function em(t){const{debugMode:s,payload:a,debugInfo:r,appliedConditions:n}=t,{t:o}=Ge();return s?e.jsxs(e.Fragment,{children:[a&&e.jsx(bt,{title:o("fr.debug.searchResponse"),data:a}),r&&e.jsxs("div",{className:"mt-2 p-0",children:[e.jsx("div",{className:"text-sm font-semibold mb-1",children:o("fr.debug.upstream")}),r.documents_url&&e.jsx("div",{className:"text-xs truncate",children:e.jsx("a",{className:"text-primary hover:underline",href:r.documents_url,target:"_blank",rel:"noreferrer",children:"documents_url"})}),r.facet_urls&&typeof r.facet_urls=="object"&&e.jsx("div",{className:"mt-1 space-y-0.5",children:Object.entries(r.facet_urls).map(([d,c])=>e.jsxs("div",{className:"text-xs truncate",children:[e.jsxs("span",{className:"font-medium mr-1",children:[d,":"]}),e.jsx("a",{className:"text-primary hover:underline",href:String(c),target:"_blank",rel:"noreferrer",children:String(c)})]},d))}),r.effective_query&&e.jsx("div",{className:"mt-2",children:e.jsx(bt,{title:o("fr.debug.effectiveQuery"),data:r.effective_query})}),r.received&&e.jsxs("div",{className:"mt-2 space-y-2",children:[r.received.raw_querystring&&e.jsxs("div",{className:"text-xs break-all",children:[e.jsx("span",{className:"font-medium mr-1",children:"raw_querystring:"}),String(r.received.raw_querystring)]}),r.received.nested&&e.jsx(bt,{title:o("fr.debug.receivedNested"),data:r.received.nested}),r.received.simple&&e.jsx(bt,{title:o("fr.debug.receivedSimple"),data:r.received.simple})]}),e.jsx("div",{className:"mt-2",children:e.jsx(bt,{title:o("fr.debug.appliedConditions"),data:n})})]})]}):null}const vl=i.createContext(void 0),tm=({children:t})=>{const[s,a]=i.useState(""),[r,n]=i.useState(10),[o,d]=i.useState("recent"),[c,u]=i.useState(1),[p,v]=i.useState(0),[_,j]=i.useState(!0),[f,x]=i.useState(["agency","type","section","topic"]),[T,w]=i.useState(!1),[S,y]=i.useState("https://www.federalregister.gov/api/v1"),[g,b]=i.useState(""),[R,P]=i.useState(""),[z,B]=i.useState(""),[M,A]=i.useState(""),[V,q]=i.useState(""),[I,k]=i.useState(""),[F,U]=i.useState(""),[ne,ge]=i.useState([]),[$,le]=i.useState(!1),[_e,Ee]=i.useState(""),[Fe,et]=i.useState([]),[ze,G]=i.useState(!1),[Ce,pe]=i.useState([]),[W,Q]=i.useState(!1),[K,we]=i.useState(""),[X,xe]=i.useState([]),[$e,Ae]=i.useState(!1),[ct,Tt]=i.useState(!1),[Z,fe]=i.useState(null),[ue,ye]=i.useState(""),[ve,De]=i.useState(null),[jt,vt]=i.useState([]),[qt,ft]=i.useState(""),[Zt,it]=i.useState(null),[xt,xs]=i.useState({}),[Dt,zt]=i.useState({}),[Ke,Rt]=i.useState({}),[ms,Kt]=i.useState({}),[Lt,os]=i.useState({}),[cs,hs]=i.useState(!0),[Fs,Wt]=i.useState({}),[ds,gs]=i.useState({}),[ps,Jt]=i.useState([]),[Ut,Cs]=i.useState(!1),[ns,C]=i.useState(null),[re,ie]=i.useState(!1),[m,D]=i.useState(!1),[O,de]=i.useState(!1),[he,Ue]=i.useState(null),[Se,se]=i.useState(!1),[ke,be]=i.useState(null),[We,rt]=i.useState(null),[Oe,Je]=i.useState(null),[l,h]=i.useState(null),Y=i.useMemo(()=>({term:s,setTerm:a,perPage:r,setPerPage:n,order:o,setOrder:d,page:c,setPage:u,totalPages:p,setTotalPages:v,useAggregated:_,setUseAggregated:j,selectedFacets:f,setSelectedFacets:x,debugMode:T,setDebugMode:w,baseUri:S,setBaseUri:y,dateStart:g,setDateStart:b,dateEnd:R,setDateEnd:P,condAgencies:z,setCondAgencies:B,condTypes:M,setCondTypes:A,condSections:V,setCondSections:q,condTopics:I,setCondTopics:k,condAgencyQuery:F,setCondAgencyQuery:U,condAgencySuggests:ne,setCondAgencySuggests:ge,condAgencySuggestOpen:$,setCondAgencySuggestOpen:le,condSectionQuery:_e,setCondSectionQuery:Ee,condSectionSuggests:Fe,setCondSectionSuggests:et,condSectionSuggestOpen:ze,setCondSectionSuggestOpen:G,condSectionSource:Ce,setCondSectionSource:pe,condSectionLoaded:W,setCondSectionLoaded:Q,condTopicQuery:K,setCondTopicQuery:we,condTopicSuggests:X,setCondTopicSuggests:xe,condTopicSuggestOpen:$e,setCondTopicSuggestOpen:Ae,loading:ct,setLoading:Tt,error:Z,setError:fe,searchUrl:ue,setSearchUrl:ye,payload:ve,setPayload:De,results:jt,setResults:vt,freqUrl:qt,setFreqUrl:ft,debugInfo:Zt,setDebugInfo:it,facetOpen:xt,setFacetOpen:xs,facetPage:Dt,setFacetPage:zt,facetItems:Ke,setFacetItems:Rt,facetTotalPages:ms,setFacetTotalPages:Kt,facetLoading:Lt,setFacetLoading:os,facetAutoClose:cs,setFacetAutoClose:hs,facetTemp:Fs,setFacetTemp:Wt,facetFilter:ds,setFacetFilter:gs,agenciesData:ps,setAgenciesData:Jt,agenciesLoading:Ut,setAgenciesLoading:Cs,suggested:ns,setSuggested:C,suggestedLoading:re,setSuggestedLoading:ie,agenciesPanelOpen:m,setAgenciesPanelOpen:D,suggestedPanelOpen:O,setSuggestedPanelOpen:de,expandedDoc:he,setExpandedDoc:Ue,expandedLoading:Se,setExpandedLoading:se,expandedError:ke,setExpandedError:be,expandedRaw:We,setExpandedRaw:rt,expandedDetail:Oe,setExpandedDetail:Je,searchDetailsDoc:l,setSearchDetailsDoc:h}),[s,r,o,c,p,_,f,T,S,g,R,z,M,V,I,F,ne,$,_e,Fe,ze,Ce,W,K,X,$e,ct,Z,ue,ve,jt,qt,Zt,xt,Dt,Ke,ms,Lt,cs,Fs,ds,ps,Ut,ns,re,m,O,he,Se,ke,We,Oe,l]);return e.jsx(vl.Provider,{value:Y,children:t})},sm=()=>{const t=i.useContext(vl);if(t===void 0)throw new Error("useFederalRegister must be used within a FederalRegisterProvider");return t};function am({data:t,debugMode:s,onApply:a,applyingSlug:r}){const{t:n}=Ge(),o=(t==null?void 0:t.sections)??{},[d,c]=H.useState({}),[u,p]=H.useState("position"),[v,_]=H.useState(null),j=Object.keys(o);if(!j.length)return null;const f=T=>c(w=>({...w,[T]:!w[T]})),x=T=>T?n(`fr.sections.${T}`,{defaultValue:T}):"";return e.jsxs("div",{className:"space-y-3",children:[v&&e.jsxs(Rs,{className:"border-primary/40",children:[e.jsx(ua,{children:n("fr.suggested.appliedTitle")}),e.jsxs(Is,{children:[v.section?e.jsxs("span",{className:"mr-2",children:["[",x(v.section),"]"]}):null,e.jsx("span",{className:"mr-2",children:v.title||n("fr.suggested.untitled")}),e.jsxs("span",{className:"text-muted-foreground mr-1",children:[n("fr.suggested.appliedTermLabel"),":"]}),e.jsx("span",{className:"break-all",children:v.term||n("fr.suggested.unknown")})]})]}),e.jsxs(Ne,{className:"p-3",children:[e.jsx("div",{className:"text-sm text-muted-foreground mb-2",children:n("fr.suggested.sectionHint")}),e.jsxs(ha,{defaultValue:j[0]||"",children:[e.jsx(na,{className:"flex flex-wrap gap-1",children:j.map(T=>e.jsx(is,{value:T,children:x(T)},T))}),j.map(T=>{const w=Array.isArray(o[T])?o[T]:[];return e.jsx(ls,{value:T,children:e.jsxs(Ne,{className:"p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"text-sm font-semibold",children:x(T)}),e.jsx(ht,{variant:"secondary",children:w.length}),e.jsxs("div",{className:"ml-auto inline-flex items-center gap-2 text-xs",children:[e.jsx("span",{className:"text-muted-foreground",children:n("fr.suggested.sortLabel")}),e.jsxs(ba,{type:"single",value:u,onValueChange:S=>S&&p(S),children:[e.jsx(as,{value:"position",children:n("fr.suggested.sortDefault")}),e.jsx(as,{value:"activity",children:n("fr.suggested.sortActivity")}),e.jsx(as,{value:"comments",children:n("fr.suggested.sortComments")})]})]})]}),e.jsx("div",{className:"space-y-2",children:[...w].sort((S,y)=>{const g=(S==null?void 0:S.attributes)??S,b=(y==null?void 0:y.attributes)??y;return u==="activity"?((b==null?void 0:b.documents_in_last_year)||0)-((g==null?void 0:g.documents_in_last_year)||0):u==="comments"?((b==null?void 0:b.documents_with_open_comment_periods)||0)-((g==null?void 0:g.documents_with_open_comment_periods)||0):((g==null?void 0:g.position)||0)-((b==null?void 0:b.position)||0)}).map((S,y)=>{var M;const g=(S==null?void 0:S.attributes)??S,b=String((g==null?void 0:g.slug)||""),R=`${T}:${b||String((g==null?void 0:g.title)||y)}`,P=String(((M=g==null?void 0:g.search_conditions)==null?void 0:M.term)||"").trim(),z=!!d[R],B=!!(r&&b&&r===b);return e.jsxs("div",{className:"border rounded",children:[e.jsxs("div",{className:"w-full flex items-center gap-2 p-2 hover:bg-muted cursor-pointer",onClick:()=>f(R),children:[e.jsx("span",{className:"font-medium text-left flex-1 truncate",children:g.title||g.slug||n("fr.suggested.untitled")}),e.jsx(ht,{variant:"outline",children:typeof g.documents_in_last_year=="number"?n("fr.suggested.docsLastYear",{count:g.documents_in_last_year}):n("fr.suggested.unknown")}),typeof g.documents_with_open_comment_periods=="number"&&g.documents_with_open_comment_periods>0&&e.jsx(ht,{variant:"destructive",children:n("fr.suggested.docsComments",{count:g.documents_with_open_comment_periods})}),a&&e.jsx(ee,{size:"sm",className:"h-7",disabled:B,onClick:A=>{A.stopPropagation(),a(g,b||void 0),_({title:g.title||g.slug,term:P,section:T});try{const V=document.querySelector("[data-fr-results]");V&&V.scrollIntoView({behavior:"smooth",block:"start"})}catch{}setTimeout(()=>_(null),2600)},children:n(B?"fr.suggested.applying":"fr.suggested.apply")})]}),z&&e.jsxs("div",{className:"p-3 space-y-3 bg-muted/30",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:[n("fr.suggested.appliedTermLabel"),"：",e.jsx("span",{className:"text-foreground break-all",children:P||n("fr.suggested.unknown")})]}),e.jsx("div",{className:"prose prose-sm max-w-none text-muted-foreground",dangerouslySetInnerHTML:{__html:String((g==null?void 0:g.description)||n("fr.suggested.noDescription"))}}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium mb-1",children:n("fr.suggested.searchConditions")}),e.jsx("pre",{className:"p-2 bg-muted rounded text-xs overflow-auto",children:JSON.stringify((g==null?void 0:g.search_conditions)||{},null,2)})]}),s&&e.jsx(bt,{title:"Raw",data:g})]})]},R)})})]})},`sec-${T}`)})]})]})]})}function Nl(t,s){const a=e.jsx("span",{className:"text-muted-foreground",children:s?s("status.empty"):"N/A"});return t==null?a:Array.isArray(t)?t.length?t.join(", "):a:typeof t=="object"?e.jsx("ul",{className:"list-disc pl-4",children:Object.entries(t).map(([r,n])=>e.jsxs("li",{children:[e.jsxs("strong",{children:[r,":"]})," ",Nl(n,s)]},r))}):typeof t=="string"&&/^https?:\/\//i.test(t)?e.jsx("a",{className:"text-primary hover:underline break-all",href:t,target:"_blank",rel:"noreferrer",children:t}):e.jsx("span",{className:"break-words",children:String(t)})}function Aa({agency:t,t:s}){const a=(t==null?void 0:t.attributes)??t;return e.jsx("div",{className:"p-3 border rounded bg-muted/30",children:e.jsx(Ys,{children:e.jsx(Gs,{children:Object.entries(a).filter(([r])=>r!=="children").map(([r,n])=>e.jsxs(Gt,{children:[e.jsx(_t,{className:"w-1/3 align-top font-medium",children:r}),e.jsx(_t,{className:"w-2/3 align-top",children:Nl(n,s)})]},r))})})})}function rm(t){const s=t.map(o=>(o==null?void 0:o.attributes)??o),a=new Map;s.forEach(o=>a.set(o.id,{...o,children:[]}));const r=[];a.forEach(o=>{if(o.parent_id==null)r.push(o);else{const d=a.get(o.parent_id);d?d.children.push(o):r.push(o)}});const n=(o,d)=>String(o.name||"").localeCompare(String(d.name||""));return r.sort(n),a.forEach(o=>o.children&&o.children.sort(n)),r}const wl=t=>1+(Array.isArray(t==null?void 0:t.children)?t.children:[]).reduce((a,r)=>a+wl(r),0),hn={defense:["defense","military","army","navy","air force","security","terrorist","intelligence","weapons","counterintelligence"],finance:["financial","economic","treasury","tax","trade","commerce","business","currency","investment","export","import","budget","consumer"],health:["health","medical","disease","drug","medicare","medicaid","food","mental health","healthcare","nutrition"],justice:["justice","law","court","legal","crime","prison","enforcement","civil rights","immigration","firearms","investigation","parole"],environment:["environmental","environment","natural resources","park","wildlife","oceanic","energy","land management","mining","geological","reclamation","atmosphere","epa"],science:["science","technology","space","nasa","standards","technical","aeronautics","nanotechnology","cyber"],transport:["transportation","aviation","highway","railroad","maritime","transit","motor carrier","seaway"],agriculture:["agriculture","agricultural","farm","crop","rural","forest"],admin:["administration","service","personnel","archives","management","government","oversight","relations","commission","policy","ethics","services"],social:["humanities","arts","education","social security","housing","veterans","labor","disability","indian","community"]},nm={defense:"fr.agencies.funcDefense",finance:"fr.agencies.funcFinance",health:"fr.agencies.funcHealth",justice:"fr.agencies.funcJustice",environment:"fr.agencies.funcEnvironment",science:"fr.agencies.funcScience",transport:"fr.agencies.funcTransport",agriculture:"fr.agencies.funcAgriculture",admin:"fr.agencies.funcAdmin",social:"fr.agencies.funcSocial",other:"fr.agencies.funcOther"},pn={departments:["department"],commissions:["commission"],administrations:["administration","bureau"],offices:["office"],foundations:["foundation","board"],corporations:["corporation"],services:["service"],councils:["council"]},im={departments:"fr.agencies.typeDepartments",commissions:"fr.agencies.typeCommissions",administrations:"fr.agencies.typeAdministrations",offices:"fr.agencies.typeOffices",foundations:"fr.agencies.typeFoundations",corporations:"fr.agencies.typeCorporations",services:"fr.agencies.typeServices",councils:"fr.agencies.typeCouncils",other:"fr.agencies.typeOther"};function lm(t){const s=new Map(Object.keys(hn).map(n=>[n,[]])),a=[];for(const n of t){const o=(n==null?void 0:n.attributes)??n,d=(String(o.name||"")+" "+String(o.description||"")).toLowerCase();let c=!1;for(const[u,p]of Object.entries(hn))if(p.some(v=>d.includes(v))){s.get(u).push(o),c=!0;break}c||a.push(o)}const r=(n,o)=>String(n.name||"").localeCompare(String(o.name||""));return s.forEach(n=>n.sort(r)),a.sort(r),a.length&&s.set("other",a),s}function om(t){const s=new Map(Object.keys(pn).map(n=>[n,[]])),a=[];for(const n of t){const o=(n==null?void 0:n.attributes)??n,d=String(o.name||"");let c=!1;for(const[u,p]of Object.entries(pn))if(new RegExp(`\\b(${p.join("|")})\\b`,"i").test(d)){s.get(u).push(o),c=!0;break}c||a.push(o)}const r=(n,o)=>String(n.name||"").localeCompare(String(o.name||""));return s.forEach(n=>n.sort(r)),a.sort(r),a.length&&s.set("other",a),s}function cm({agencies:t,debugMode:s}){const{t:a}=Ge(),r=a,n=i.useMemo(()=>rm(t||[]),[t]),o=i.useMemo(()=>(t||[]).map(y=>(y==null?void 0:y.attributes)??y),[t]),[d,c]=H.useState("type"),[u,p]=H.useState(""),[v,_]=H.useState("name"),[j,f]=H.useState("name");if(!n.length)return null;const x=y=>{const g=u.trim().toLowerCase();if(!g)return!0;const b=String((y==null?void 0:y.name)||"").toLowerCase(),R=String((y==null?void 0:y.slug)||"").toLowerCase();return b.includes(g)||R.includes(g)},T=y=>{const g=[];for(const b of y){const R=Array.isArray(b.children)?T(b.children):[];(x(b)||R.length)&&g.push({...b,children:R})}return g},w=i.useMemo(()=>u.trim()?T(n):n,[u,n]),S=i.useMemo(()=>(o||[]).filter(x),[u,o]);return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("div",{className:"flex-1 min-w-[220px] max-w-[420px]",children:e.jsx(He,{placeholder:a("fr.agencies.searchPlaceholder"),value:u,onChange:y=>p(y.target.value),className:"h-9 text-sm"})}),u&&e.jsx(ee,{size:"sm",variant:"ghost",className:"h-8",onClick:()=>p(""),children:a("fr.agencies.clear")})]}),e.jsxs(ha,{value:d,onValueChange:y=>c(y),children:[e.jsxs(na,{className:"grid w-full grid-cols-3",children:[e.jsx(is,{value:"hierarchical",children:a("fr.agencies.tabHierarchical")}),e.jsx(is,{value:"functional",children:a("fr.agencies.tabFunctional")}),e.jsx(is,{value:"type",children:a("fr.agencies.tabType")})]}),e.jsx(ls,{value:"hierarchical",children:w.length===0?e.jsx("div",{className:"text-sm text-muted-foreground",children:a("fr.agencies.noResults")}):e.jsx(Ne,{className:"p-3",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("details",{className:"border rounded",children:[e.jsxs("summary",{className:"flex items-center justify-between px-2 py-2 cursor-pointer font-semibold hover:bg-muted/50",children:[e.jsx("span",{children:a("fr.agencies.topWithChildren")}),e.jsx(ht,{variant:"outline",children:a("fr.agencies.agencyCount",{count:w.filter(y=>Array.isArray(y.children)&&y.children.length>0).reduce((y,g)=>y+wl(g),0)})})]}),e.jsx("div",{className:"pt-1 space-y-2",children:w.filter(y=>Array.isArray(y.children)&&y.children.length>0).map(y=>{var g;return e.jsxs("details",{className:"border-b group",children:[e.jsxs("summary",{className:"flex items-center justify-between py-2 cursor-pointer hover:underline",children:[e.jsxs("span",{className:"font-semibold flex items-center gap-2",children:[y.name,y.short_name&&e.jsx(ht,{variant:"secondary",children:y.short_name}),y.slug&&e.jsx(ht,{variant:"outline",children:y.slug})]}),e.jsx(ht,{variant:"secondary",className:"ml-2",children:a("fr.agencies.childCount",{count:y.children.length})})]}),e.jsxs("div",{className:"space-y-3 pb-2",children:[e.jsx(Aa,{agency:y,t:r}),e.jsxs("details",{className:"mt-2 pl-3 border-l-2 border-border",children:[e.jsxs("summary",{className:"flex items-center justify-between py-1 cursor-pointer text-sm font-medium text-primary hover:underline",children:[e.jsx("span",{children:a("fr.agencies.children")}),e.jsx(ht,{variant:"outline",children:((g=y.children)==null?void 0:g.length)||0})]}),e.jsx("div",{className:"mt-1 space-y-2",children:(y.children||[]).map(b=>e.jsxs("details",{className:"border-b group ml-2",children:[e.jsx("summary",{className:"flex items-center justify-between py-2 cursor-pointer hover:underline",children:e.jsx("span",{className:"font-medium",children:b.name})}),e.jsx("div",{className:"pb-2",children:e.jsx(Aa,{agency:b,t:r})})]},`child-${String(y.id)}-${String(b.id)}`))})]})]})]},`top-${String(y.id)}`)})})]}),e.jsxs("details",{className:"border rounded",children:[e.jsxs("summary",{className:"flex items-center justify-between px-2 py-2 cursor-pointer font-semibold hover:bg-muted/50",children:[e.jsx("span",{children:a("fr.agencies.noChildren")}),e.jsx(ht,{variant:"outline",children:a("fr.agencies.agencyCount",{count:w.filter(y=>!y.children||y.children.length===0).length})})]}),e.jsx("div",{className:"pt-1",children:w.filter(y=>!y.children||y.children.length===0).map(y=>e.jsxs("details",{className:"border-b group",children:[e.jsx("summary",{className:"flex items-center justify-between py-2 cursor-pointer hover:underline",children:e.jsxs("span",{className:"font-semibold flex items-center gap-2",children:[y.name,y.short_name&&e.jsx(ht,{variant:"secondary",children:y.short_name}),y.slug&&e.jsx(ht,{variant:"outline",children:y.slug})]})}),e.jsx("div",{className:"pb-2",children:e.jsx(Aa,{agency:y,t:r})})]},`ind-${String(y.id)}`))})]})]})})}),e.jsxs(ls,{value:"functional",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-xs",children:[e.jsx("span",{className:"text-muted-foreground",children:a("fr.agencies.sortLabel")}),e.jsx(ee,{size:"sm",variant:v==="name"?"secondary":"ghost",className:"h-7",onClick:()=>_("name"),children:a("fr.agencies.sortName")}),e.jsx(ee,{size:"sm",variant:v==="count"?"secondary":"ghost",className:"h-7",onClick:()=>_("count"),children:a("fr.agencies.sortCount")})]}),e.jsx(Ne,{className:"p-3",children:Array.from(lm(S).entries()).sort((y,g)=>v==="count"?g[1].length-y[1].length:String(y[0]).localeCompare(String(g[0]))).map(([y,g])=>g.length>0&&e.jsxs("details",{className:"border-b group",children:[e.jsxs("summary",{className:"flex items-center justify-between py-2 cursor-pointer hover:underline",children:[e.jsx("span",{className:"font-semibold",children:r(nm[y]||y)}),e.jsx(ht,{variant:"secondary",className:"ml-2",children:a("fr.agencies.agencyCount",{count:g.length})})]}),e.jsx("div",{className:"pb-2",children:g.map(b=>e.jsxs("details",{className:"border-b group ml-2",children:[e.jsx("summary",{className:"flex items-center justify-between py-2 cursor-pointer hover:underline",children:e.jsx("span",{className:"font-medium",children:b.name})}),e.jsx("div",{className:"pb-2",children:e.jsx(Aa,{agency:b,t:r})})]},`fun-ag-${String(y)}-${String(b.id)}`))})]},`fun-${String(y)}`))})]}),e.jsxs(ls,{value:"type",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-xs",children:[e.jsx("span",{className:"text-muted-foreground",children:a("fr.agencies.sortLabel")}),e.jsx(ee,{size:"sm",variant:j==="name"?"secondary":"ghost",className:"h-7",onClick:()=>f("name"),children:a("fr.agencies.sortName")}),e.jsx(ee,{size:"sm",variant:j==="count"?"secondary":"ghost",className:"h-7",onClick:()=>f("count"),children:a("fr.agencies.sortCount")})]}),e.jsx(Ne,{className:"p-3",children:Array.from(om(S).entries()).sort((y,g)=>j==="count"?g[1].length-y[1].length:String(y[0]).localeCompare(String(g[0]))).map(([y,g])=>g.length>0&&e.jsxs("details",{className:"border-b group",children:[e.jsxs("summary",{className:"flex items-center justify-between py-2 cursor-pointer hover:underline",children:[e.jsx("span",{className:"font-semibold",children:r(im[y]||y)}),e.jsx(ht,{variant:"secondary",className:"ml-2",children:a("fr.agencies.agencyCount",{count:g.length})})]}),e.jsx("div",{className:"pb-2",children:g.map(b=>e.jsxs("details",{className:"border-b group ml-2",children:[e.jsx("summary",{className:"flex items-center justify-between py-2 cursor-pointer hover:underline",children:e.jsx("span",{className:"font-medium",children:b.name})}),e.jsx("div",{className:"pb-2",children:e.jsx(Aa,{agency:b,t:r})})]},`typ-ag-${String(y)}-${String(b.id)}`))})]},`typ-${String(y)}`))})]})]}),s&&e.jsx(Ne,{className:"p-3",children:e.jsx(bt,{title:"Agencies (Raw)",data:t})})]})}function fn({title:t,isOpen:s,hasData:a,onLoad:r,onToggle:n,children:o,loadText:d="Load",loading:c=!1}){const{t:u}=Ge(),p=d||u("fr.load");return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"text-base font-semibold",children:t}),e.jsxs("div",{className:"flex items-center gap-2",children:[!a&&e.jsx(ee,{size:"sm",variant:"secondary",className:"h-8",onClick:r,disabled:c,children:c?u("status.loading"):p}),e.jsx(ee,{size:"sm",variant:"ghost",className:"h-8",onClick:n,children:u(s?"fr.hide":"fr.show")})]})]}),s&&o]})}const dm=({debugMode:t,baseUri:s,enabled:a=!0})=>Ft({queryKey:["fr-agencies-all",{debugMode:t,baseUri:s}],enabled:a,queryFn:async()=>{var n,o;const r=await Hc({base_uri:t?s:void 0});if(r.status!==200)throw new Error(((n=r.payload)==null?void 0:n.error)||`HTTP ${r.status}`);return Array.isArray((o=r.payload)==null?void 0:o.agencies)?r.payload.agencies:[]}}),xn=[{slug:"money",name:"Money"},{slug:"environment",name:"Environment"},{slug:"world",name:"World"},{slug:"science-and-technology",name:"Science & Technology"},{slug:"business-and-industry",name:"Business & Industry"},{slug:"health-and-public-welfare",name:"Health & Public Welfare"}],um=({term:t,debugMode:s,baseUri:a,enabled:r=!0})=>{const n=(t==null?void 0:t.trim())||"";return Ft({queryKey:["fr-sections",{term:n,debugMode:s,baseUri:a}],enabled:r,queryFn:async()=>{var c,u;const o=await qc({term:n||void 0,base_uri:s?a:void 0});if(o.status!==200)throw new Error(((c=o.payload)==null?void 0:c.error)||`HTTP ${o.status}`);const d=(u=o.payload)==null?void 0:u.sections;return!d||typeof d!="object"?[]:Object.entries(d).map(([p,v])=>({slug:p,name:String((v==null?void 0:v.name)||p)}))}})},mm=({debugMode:t,baseUri:s,enabled:a=!1})=>Ft({queryKey:["fr-suggested-searches",{debugMode:t,baseUri:s}],enabled:a,staleTime:10*60*1e3,queryFn:async()=>{var n;const r=await Bc({base_uri:t?s:void 0});if(r.status!==200)throw new Error(((n=r.payload)==null?void 0:n.error)||`HTTP ${r.status}`);return r.payload}}),hm=()=>{const t=ma();return i.useCallback(async s=>{const a=["fr-facet",s];return t.fetchQuery({queryKey:a,staleTime:5*60*1e3,queryFn:async()=>{var c,u,p;const r=await zc(s.facet,{page:s.page,conditions:s.conditions,base_uri:s.debugMode?s.baseUri:void 0});if(r.status!==200)throw new Error(((c=r.payload)==null?void 0:c.error)||`HTTP ${r.status}`);const n=r.payload,o=((n==null?void 0:n.results)||((u=n==null?void 0:n.payload)==null?void 0:u.results)||[]).map(v=>(v==null?void 0:v.attributes)??v),d=(n==null?void 0:n.total_pages)??((p=n==null?void 0:n.payload)==null?void 0:p.total_pages)??1;return{items:o,totalPages:d}}})},[t])},pm=({slug:t,debugMode:s,baseUri:a,enabled:r=!0})=>Ft({queryKey:["fr-suggested-search-find",{slug:t,debugMode:s,baseUri:a}],enabled:r&&!!t,queryFn:async()=>{var o;const n=await Vc(t,{base_uri:s?a:void 0});if(n.status!==200)throw new Error(((o=n.payload)==null?void 0:o.error)||`HTTP ${n.status}`);return n.payload},staleTime:5*60*1e3});function fm(){const{t}=Ge(),{setActiveTab:s}=ra(),{term:a,setTerm:r,perPage:n,setPerPage:o,order:d,setOrder:c,page:u,setPage:p,totalPages:v,setTotalPages:_,useAggregated:j,setUseAggregated:f,selectedFacets:x,setSelectedFacets:T,debugMode:w,setDebugMode:S,baseUri:y,setBaseUri:g,dateStart:b,setDateStart:R,dateEnd:P,setDateEnd:z,condAgencies:B,setCondAgencies:M,condTypes:A,setCondTypes:V,condSections:q,setCondSections:I,condTopics:k,setCondTopics:F,condSectionSource:U,setCondSectionSource:ne,condSectionLoaded:ge,setCondSectionLoaded:$,loading:le,setLoading:_e,error:Ee,setError:Fe,searchUrl:et,setSearchUrl:ze,payload:G,setPayload:Ce,results:pe,setResults:W,freqUrl:Q,setFreqUrl:K,debugInfo:we,setDebugInfo:X,facetOpen:xe,setFacetOpen:$e,facetPage:Ae,setFacetPage:ct,facetItems:Tt,setFacetItems:Z,facetTotalPages:fe,setFacetTotalPages:ue,facetLoading:ye,setFacetLoading:ve,facetAutoClose:De,setFacetAutoClose:jt,facetTemp:vt,setFacetTemp:qt,facetFilter:ft,setFacetFilter:Zt,agenciesData:it,setAgenciesData:xt,agenciesLoading:xs,setAgenciesLoading:Dt,suggested:zt,setSuggested:Ke,suggestedLoading:Rt,setSuggestedLoading:ms,agenciesPanelOpen:Kt,setAgenciesPanelOpen:Lt,suggestedPanelOpen:os,setSuggestedPanelOpen:cs,expandedDoc:hs,setExpandedDoc:Fs,expandedLoading:Wt,setExpandedLoading:ds,expandedError:gs,setExpandedError:ps,expandedRaw:Jt,setExpandedRaw:Ut,expandedDetail:Cs,setExpandedDetail:ns,searchDetailsDoc:C,setSearchDetailsDoc:re}=sm(),[ie,m]=H.useState(null),D=il(ie,!!ie),O=dm({debugMode:w,baseUri:y}),de=um({debugMode:w,baseUri:y}),he=hm(),Ue=ma(),Se=mm({debugMode:w,baseUri:y,enabled:!1}),[se,ke]=H.useState([]),[be,We]=H.useState(!1),[rt,Oe]=H.useState([]),[Je,l]=H.useState(1),[h,Y]=H.useState(1),[E,Le]=H.useState(!1),[ae,Pe]=H.useState([]),[Re,Ye]=H.useState(1),[tt,St]=H.useState(1),[es,Nt]=H.useState(!1),It=H.useMemo(()=>["agency","type","section","topic","daily","weekly","monthly","quarterly"],[]),gt="https://www.federalregister.gov/api/v1",[ut,Ct]=H.useState(null),oe=pm({slug:(ut==null?void 0:ut.slug)??"",debugMode:w,baseUri:y,enabled:!!(ut!=null&&ut.slug)}),je=H.useRef(!1);H.useEffect(()=>{f(!0),T(It)},[f,T,It]);const yt=H.useMemo(()=>{const N={};try{(it||[]).forEach(L=>{const ce=(L==null?void 0:L.attributes)??L;ce!=null&&ce.id&&(ce!=null&&ce.slug)&&(N[Number(ce.id)]=String(ce.slug))})}catch{}return N},[it]),qe=H.useCallback(()=>{const N={};(b||P)&&(N.publication_date={...b?{gte:b}:{},...P?{lte:P}:{}});const L=ce=>ce.split(",").map(te=>te.trim()).filter(Boolean);return B.trim()&&(N.agencies=L(B)),A.trim()&&(N.type=L(A)),q.trim()&&(N.sections=L(q)),k.trim()&&(N.topics=L(k)),N},[b,P,B,A,q,k]),Qe=H.useCallback(()=>{const N=qe();return a.trim()&&(N.term=a.trim()),N},[qe,a]),lt=H.useCallback(()=>{const N=qe(),L=j?x.filter(Boolean):[];je.current=!0,_e(!0),Fe(null),W([]),Ce(null),X(null),m({term:a.trim(),perPage:n,page:u,order:d,facets:L,conditions:N,debugMode:w,baseUri:y})},[a,n,d,u,j,x,qe,w,y,_e,Fe,W,Ce,X]),Ie=H.useRef(void 0),Me=H.useCallback((N=300)=>{try{Ie.current!==void 0&&window.clearTimeout(Ie.current)}catch{}Ie.current=window.setTimeout(()=>{lt()},N)},[lt]);H.useEffect(()=>()=>{try{Ie.current!==void 0&&window.clearTimeout(Ie.current)}catch{}},[]),i.useEffect(()=>{D.data&&(Ce(D.data.payload),W(D.data.docs),_(D.data.totalPages),ze(D.data.url),X(w?D.data.debugInfo:null),Fe(null),_e(!1))},[D.data,Ce,W,_,ze,X,Fe,_e,w]),i.useEffect(()=>{if(!D.error)return;const N=D.error instanceof Error?D.error.message:String(D.error);Fe(N),_e(!1)},[D.error,Fe,_e]),i.useEffect(()=>{const N=!!ie&&D.isFetching;_e(N)},[ie,D.isFetching,_e]);const kt=H.useCallback(N=>{const L=(N==null?void 0:N.attributes)??N??{};r(""),R(""),z(""),M(""),V(""),I(""),F("");const te={...((L==null?void 0:L.search_conditions)??{})||{}};try{if(!te.agencies&&Array.isArray(te.agency_ids)&&te.agency_ids.length){const Xe=te.agency_ids.map(me=>yt[Number(me)]).filter(me=>typeof me=="string"&&me.length>0);Xe.length>0&&(te.agencies=Xe)}}catch{}te.term&&r(String(te.term)),Array.isArray(te.agencies)&&M(te.agencies.join(", ")),Array.isArray(te.type)&&V(te.type.join(", ")),Array.isArray(te.sections)&&I(te.sections.join(", ")),Array.isArray(te.topics)&&F(te.topics.join(", ")),p(1),Me(0)},[yt,Me,M,I,F,V,z,R,p,r]),ts=H.useCallback((N,L)=>{const ce=(N==null?void 0:N.attributes)??N,te=String(L||(ce==null?void 0:ce.slug)||"").trim();if(te){Ct({slug:te,template:ce});return}kt(ce)},[kt]);H.useEffect(()=>{var L;if(!ut)return;if(oe.isError){console.error("Failed to fetch suggested search details",oe.error),kt(ut.template),Ct(null);return}if(!oe.isSuccess)return;const N=((L=oe.data)==null?void 0:L.attributes)??oe.data;kt(N??ut.template),Ct(null)},[ut,oe.isError,oe.isSuccess,oe.data,oe.error,kt]),H.useEffect(()=>{Dt(O.isFetching)},[O.isFetching,Dt]),H.useEffect(()=>{Array.isArray(O.data)&&xt(O.data)},[O.data,xt]),H.useEffect(()=>{de.isFetching&&$(!1)},[de.isFetching,$]),H.useEffect(()=>{if(!de.isSuccess)return;const N=de.data&&de.data.length?de.data:xn;ne(N),$(!0)},[de.isSuccess,de.data,ne,$]),H.useEffect(()=>{de.isError&&(ne(xn),$(!0))},[de.isError,ne,$]),H.useEffect(()=>{ms(Se.isFetching)},[Se.isFetching,ms]),H.useEffect(()=>{Se.isSuccess&&Ke(Se.data)},[Se.isSuccess,Se.data,Ke]),H.useEffect(()=>{_e(!1)},[a,_e]),H.useEffect(()=>{p(1),Me(300)},[B,A,q,k,b,P,Me,p]),H.useEffect(()=>{Se.isError&&Ke(null)},[Se.isError,Ke]);const{refetch:Qt}=O,{refetch:bs}=Se,Bt=H.useMemo(()=>{var L;const N=G;return typeof(N==null?void 0:N.count)=="number"?N.count:typeof(N==null?void 0:N.total)=="number"?N.total:typeof((L=N==null?void 0:N.documents)==null?void 0:L.count)=="number"?N.documents.count:Array.isArray(pe)?pe.length:0},[G,pe]),js=H.useCallback(()=>{Qt()},[Qt]),mt=H.useCallback(()=>{bs()},[bs]);H.useEffect(()=>{mt()},[mt]),H.useCallback(async N=>{Nt(!0);try{const L=Qe(),ce=await he({facet:"topic",page:N,conditions:L,term:L.term,debugMode:w,baseUri:y});Pe(ce.items||[]),St(ce.totalPages||1),Ye(N)}catch(L){console.error("load topic facets failed",L),Pe([]),St(1)}finally{Nt(!1)}},[he,w,y]),H.useCallback(async N=>{Le(!0);try{const L=Qe(),ce=await he({facet:"agency",page:N,conditions:L,term:L.term,debugMode:w,baseUri:y});Oe(ce.items||[]),Y(ce.totalPages||1),l(N)}catch(L){console.error("load agency facets failed",L),Oe([]),Y(1)}finally{Le(!1)}},[he,w,y]),H.useEffect(()=>{(async()=>{We(!0);try{const L=Qe(),ce=await he({facet:"type",page:1,conditions:L,term:L.term,debugMode:w,baseUri:y});ke(ce.items||[])}catch(L){console.error("load type facets failed",L),ke([])}finally{We(!1)}})()},[he,w,y]);const Yt=H.useCallback(async(N,L)=>{const ce=qe();a.trim()&&(ce.term=a.trim()),ve(te=>({...te,[N]:!0}));try{const te=await he({facet:N,page:L,conditions:ce,term:a.trim()||void 0,debugMode:w,baseUri:y});Z(Xe=>({...Xe,[N]:te.items})),ue(Xe=>({...Xe,[N]:te.totalPages||1})),ct(Xe=>({...Xe,[N]:L}))}catch(te){console.error(te),Z(Xe=>({...Xe,[N]:[]}))}finally{ve(te=>({...te,[N]:!1}))}},[qe,a,he,w,y,ve,Z,ue,ct]),Ot=N=>{const L={};for(const te of N||[]){const me=String((te==null?void 0:te.name)||"").match(/(19|20)\d{2}/),st=me?me[0]:"Other";L[st]||(L[st]=[]),L[st].push(te)}return Object.keys(L).sort((te,Xe)=>Xe==="Other"?-1:te==="Other"?1:Number(Xe)-Number(te)).map(te=>({year:te,items:L[te]}))},Xt=N=>{const L=N.getUTCFullYear(),ce=String(N.getUTCMonth()+1).padStart(2,"0"),te=String(N.getUTCDate()).padStart(2,"0");return`${L}-${ce}-${te}`},ss=N=>/^\d{4}-\d{2}-\d{2}$/.test(N),Ds=N=>{if(!N)return null;if(ss(N))return N;const L=new Date(N);if(!isNaN(L.valueOf()))return Xt(L);const ce=N.replace(/\//g,"-"),te=new Date(ce);return isNaN(te.valueOf())?null:Xt(te)},vs=N=>{let L=N.match(/^(\d{4})-Q([1-4])$/i);if(!L){const me=N.match(/^Q([1-4])\s+(\d{4})$/i);me&&(L=[me[0],me[2],me[1]])}if(!L)return null;const ce=parseInt(L[1],10),te=parseInt(L[2],10);return{1:{start:`${ce}-01-01`,end:`${ce}-03-31`},2:{start:`${ce}-04-01`,end:`${ce}-06-30`},3:{start:`${ce}-07-01`,end:`${ce}-09-30`},4:{start:`${ce}-10-01`,end:`${ce}-12-31`}}[te]||null},Ns=(N,L)=>{const ce=new Date(Date.UTC(N,0,1+(L-1)*7)),te=ce.getUTCDay()||7;return te>1&&ce.setUTCDate(ce.getUTCDate()-(te-1)),ce},Ks=N=>{let L=N.match(/^(\d{4})-W?(\d{1,2})$/i);if(L||(L=N.match(/^(\d{4})\s*week\s*(\d{1,2})$/i)),!L)return null;const ce=parseInt(L[1],10),te=parseInt(L[2],10);if(te<1||te>53)return null;const Xe=Ns(ce,te),me=new Date(Xe);return me.setUTCDate(Xe.getUTCDate()+6),{start:Xt(Xe),end:Xt(me)}},ca=N=>{const L=ce=>ce.split(",").map(te=>te.trim()).filter(Boolean).length;return N==="agency"?L(B):N==="topic"?L(k):N==="section"?L(q):N==="type"?L(A):(N==="daily"||N==="weekly"||N==="monthly"||N==="quarterly"||N==="yearly")&&b&&P?1:0},Ws=N=>{let L=N.match(/^(\d{4})[-\s]?(\d{1,2})$/),ce=null,te=null;if(L)ce=parseInt(L[1],10),te=Math.max(1,Math.min(12,parseInt(L[2],10)));else{const st={jan:1,january:1,feb:2,february:2,mar:3,march:3,apr:4,april:4,may:5,jun:6,june:6,jul:7,july:7,aug:8,august:8,sep:9,sept:9,september:9,oct:10,october:10,nov:11,november:11,dec:12,december:12},Ze=N.trim().toLowerCase();let at=Ze.match(/^([a-z]+)\s+(\d{4})$/);if(at&&st[at[1]]&&(te=st[at[1]],ce=parseInt(at[2],10)),(ce===null||te===null)&&(at=Ze.match(/^(\d{4})\s+([a-z]+)$/),at&&st[at[2]]&&(ce=parseInt(at[1],10),te=st[at[2]])),ce===null||te===null)return null}const Xe=new Date(Date.UTC(ce,te-1,1)),me=new Date(Date.UTC(ce,te,0));return{start:Xt(Xe),end:Xt(me)}},Js=N=>{if(!N.match(/^(19|20)\d{2}$/))return null;const ce=parseInt(N,10),te=new Date(Date.UTC(ce,0,1)),Xe=new Date(Date.UTC(ce,11,31));return{start:Xt(te),end:Xt(Xe)}},Xs=async N=>{Fs(N),Ut(null),ns(null),ps(null),ds(!0);try{const{payload:L}=await Ue.fetchQuery({queryKey:["fr-adapter-find",N],queryFn:()=>Br(N,w?y:void 0)}),ce=(L==null?void 0:L.document)||L;ns(Bi(L)),Ut(ce)}catch(L){ps((L==null?void 0:L.message)||"Load detail failed")}finally{ds(!1)}},qa=H.useCallback(async()=>{try{const N=await Uc({for:"documents",term:a.trim()||void 0,conditions:qe(),base_uri:w?y:void 0});(N==null?void 0:N.status)===200&&re(N.payload)}catch{}},[a,qe,w,y]),Sa=(N,L,ce)=>{const te=(me,st)=>me.split(",").map(Ze=>Ze.trim()).filter(Boolean).filter(Ze=>Ze!==st).join(","),Xe=(me,st)=>{const Ze=me.split(",").map(at=>at.trim()).filter(Boolean);return Ze.includes(st)||Ze.push(st),Ze.join(",")};if(N==="agency"){const me=B.split(",").map(st=>st.trim()).filter(Boolean).includes(L);M(me?te(B,L):Xe(B,L))}else if(N==="topic"){const me=k.split(",").map(st=>st.trim()).filter(Boolean).includes(L);F(me?te(k,L):Xe(k,L))}else if(N==="section"){const me=q.split(",").map(st=>st.trim()).filter(Boolean).includes(L);I(me?te(q,L):Xe(q,L))}else if(N==="type"){const me=(L||ce||"").toUpperCase(),st=A.split(",").map(Ze=>Ze.trim()).filter(Boolean).includes(me);V(st?te(A,me):Xe(A,me))}else if(N==="daily"){const me=Ds(L)||Ds(ce);if(me){const st=b?me<b?me:b:me,Ze=P?me>P?me:P:me;R(st),z(Ze)}}else if(N==="weekly"){const me=Ks(L)||Ks(ce);if(me){const st=b?me.start<b?me.start:b:me.start,Ze=P?me.end>P?me.end:P:me.end;R(st),z(Ze)}}else if(N==="monthly"){const me=Ws(L)||Ws(ce);if(me){const st=b?me.start<b?me.start:b:me.start,Ze=P?me.end>P?me.end:P:me.end;R(st),z(Ze)}}else if(N==="quarterly"){const me=vs(L)||vs(ce);if(me){const st=b?me.start<b?me.start:b:me.start,Ze=P?me.end>P?me.end:P:me.end;R(st),z(Ze)}}else if(N==="yearly"){const me=Js(L)||Js(ce);if(me){const st=b?me.start<b?me.start:b:me.start,Ze=P?me.end>P?me.end:P:me.end;R(st),z(Ze)}}p(1)};G!=null&&G.facets;const za=j?["agency","type","section","topic","daily","weekly","monthly","quarterly"]:[];return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold",children:t("fr.title")}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Te,{htmlFor:"fr-switch-debug",className:"text-xs",children:t("fr.debugMode")}),e.jsx(pa,{id:"fr-switch-debug",checked:w,onCheckedChange:N=>{S(!!N),Me(0)}})]})]}),e.jsx(Xu,{term:a,onTermChange:r,loading:le,onSearch:lt,debugMode:w,searchUrl:et}),e.jsx(Ne,{className:"p-4",children:e.jsx(Zu,{dateStart:b,dateEnd:P,perPage:n,order:d,onDateStartChange:R,onDateEndChange:z,onPerPageChange:o,onOrderChange:c,onClearDates:()=>{R(""),z("")}})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-sm text-muted-foreground",children:[B.split(",").map(N=>N.trim()).filter(Boolean).map(N=>e.jsx(ht,{variant:"secondary",className:"cursor-pointer",onClick:()=>{M(B.split(",").map(L=>L.trim()).filter(Boolean).filter(L=>L!==N).join(",")),p(1)},title:"Remove agency",children:t("fr.badgeAgency",{slug:N})},`ag-${N}`)),A.split(",").map(N=>N.trim()).filter(Boolean).map(N=>e.jsx(ht,{variant:"secondary",className:"cursor-pointer",onClick:()=>{V(A.split(",").map(L=>L.trim()).filter(Boolean).filter(L=>L!==N).join(",")),p(1)},title:"Remove type",children:t("fr.badgeType",{value:N})},`type-${N}`)),q.split(",").map(N=>N.trim()).filter(Boolean).map(N=>e.jsx(ht,{variant:"secondary",className:"cursor-pointer",onClick:()=>{I(q.split(",").map(L=>L.trim()).filter(Boolean).filter(L=>L!==N).join(",")),p(1)},title:"Remove section",children:t("fr.badgeSection",{slug:N})},`sec-${N}`)),k.split(",").map(N=>N.trim()).filter(Boolean).map(N=>e.jsx(ht,{variant:"secondary",className:"cursor-pointer",onClick:()=>{F(k.split(",").map(L=>L.trim()).filter(Boolean).filter(L=>L!==N).join(",")),p(1)},title:"Remove topic",children:t("fr.badgeTopic",{slug:N})},`tp-${N}`))]}),j&&e.jsx(Ne,{className:"p-3 md:p-4",children:e.jsx(Ju,{rowKeys:za,facetsObj:(G==null?void 0:G.facets)||{},getFacetSelectedCount:ca,onClear:N=>{N==="agency"?M(""):N==="topic"?F(""):N==="section"?I(""):N==="type"?V(""):(N==="daily"||N==="weekly"||N==="monthly"||N==="quarterly"||N==="yearly")&&(R(""),z("")),p(1)},facetOpen:xe,setFacetOpen:$e,facetPage:Ae,facetTotalPages:fe,facetItems:Tt,facetLoading:ye,facetAutoClose:De,setFacetAutoClose:jt,loadFacetPage:Yt,onSelectItem:(N,L,ce)=>{N==="quarterly"&&!ce&&/^(19|20)\d{2}$/.test(L)?Sa("yearly",L,L):Sa(N,ce||L,L),p(1)},groupByYear:Ot})}),e.jsx("div",{className:"flex items-center gap-2 text-sm flex-wrap md:flex-nowrap gap-y-2",children:w&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Te,{htmlFor:"fr-base-uri",className:"text-xs shrink-0",children:t("fr.baseUri")}),e.jsx(He,{id:"fr-base-uri",value:y,onChange:N=>{const L=N.target.value;L.trim()===""?g(gt):g(L)},placeholder:gt,className:"h-9 text-sm"})]})}),Ee&&e.jsx("div",{className:"text-destructive text-sm",children:Ee}),w&&e.jsx(Ne,{className:"p-3 md:p-4",children:e.jsx(em,{debugMode:w,payload:G,debugInfo:we,appliedConditions:{term:a.trim()||void 0,conditions:qe(),per_page:n,page:u,order:d,facets:j?x:[]}})}),Q&&e.jsxs("div",{className:"border rounded p-2",children:[e.jsx("div",{className:"font-semibold text-sm mb-1",children:t("fr.frequencyChart")}),e.jsx("div",{className:"overflow-auto",children:e.jsx("img",{src:Q,alt:"frequency chart",className:"max-w-full"})}),e.jsx("div",{className:"text-[11px] text-muted-foreground truncate mt-1",title:Q,children:Q})]}),e.jsx(Ne,{className:"p-3 md:p-4","data-fr-results":!0,children:e.jsx(ll,{results:pe,expandedDoc:hs,expandedLoading:Wt,expandedError:gs,expandedRaw:Jt,expandedDetail:Cs,onLoadDetail:Xs,page:u,totalPages:v,totalCount:Bt,onPrevPage:()=>{p(N=>Math.max(1,N-1)),setTimeout(lt,0)},onNextPage:()=>{p(N=>N+1),setTimeout(lt,0)},paginationDisabled:le,debugMode:w,onLoadSearchDetails:qa,searchDetails:C})}),e.jsx(Ne,{className:"p-3 md:p-4",children:e.jsx(fn,{title:t("fr.agenciesTitle"),isOpen:Kt,hasData:it.length>0,loading:xs,onLoad:js,onToggle:()=>Lt(N=>!N),children:it.length>0?e.jsx(cm,{agencies:it,debugMode:w}):e.jsx("div",{className:"text-sm text-muted-foreground",children:t("fr.agenciesEmpty")})})}),e.jsx(Ne,{className:"p-3 md:p-4",children:e.jsx(fn,{title:t("fr.suggestedTitle"),isOpen:os,hasData:!!zt,loading:Rt,onLoad:mt,onToggle:()=>cs(N=>!N),children:zt?e.jsx(am,{data:zt,debugMode:w,applyingSlug:(ut==null?void 0:ut.slug)??null,onApply:ts}):e.jsx("div",{className:"text-sm text-muted-foreground",children:t("fr.suggestedEmpty")})})})]})}function xm({className:t,classNames:s,showOutsideDays:a=!0,captionLayout:r="label",buttonVariant:n="ghost",formatters:o,components:d,...c}){const u=gi();return e.jsx(Po,{showOutsideDays:a,className:J("bg-background group/calendar p-3 [--cell-size:2rem] [[data-slot=card-content]_&]:bg-transparent [[data-slot=popover-content]_&]:bg-transparent",String.raw`rtl:**:[.rdp-button\_next>svg]:rotate-180`,String.raw`rtl:**:[.rdp-button\_previous>svg]:rotate-180`,t),captionLayout:r,formatters:{formatMonthDropdown:p=>p.toLocaleString("default",{month:"short"}),...o},classNames:{root:J("w-fit",u.root),months:J("relative flex flex-col gap-4 md:flex-row",u.months),month:J("flex w-full flex-col gap-4",u.month),nav:J("absolute inset-x-0 top-0 flex w-full items-center justify-between gap-1",u.nav),button_previous:J(Tr({variant:n}),"h-[--cell-size] w-[--cell-size] select-none p-0 aria-disabled:opacity-50",u.button_previous),button_next:J(Tr({variant:n}),"h-[--cell-size] w-[--cell-size] select-none p-0 aria-disabled:opacity-50",u.button_next),month_caption:J("flex h-[--cell-size] w-full items-center justify-center px-[--cell-size]",u.month_caption),dropdowns:J("flex h-[--cell-size] w-full items-center justify-center gap-1.5 text-sm font-medium",u.dropdowns),dropdown_root:J("has-focus:border-ring border-input has-focus:ring-ring/50 has-focus:ring-[3px] relative rounded-md border",u.dropdown_root),dropdown:J("bg-popover absolute inset-0 opacity-0",u.dropdown),caption_label:J("select-none font-medium",r==="label"?"text-sm":"[&>svg]:text-muted-foreground flex h-8 items-center gap-1 rounded-md pl-2 pr-1 text-sm [&>svg]:size-3.5",u.caption_label),table:"w-full border-collapse",weekdays:J("flex",u.weekdays),weekday:J("text-muted-foreground flex-1 select-none rounded-md text-[0.8rem] font-normal",u.weekday),week:J("mt-2 flex w-full",u.week),week_number_header:J("w-[--cell-size] select-none",u.week_number_header),week_number:J("text-muted-foreground select-none text-[0.8rem]",u.week_number),day:J("group/day relative aspect-square h-full w-full select-none p-0 text-center [&:first-child[data-selected=true]_button]:rounded-l-md [&:last-child[data-selected=true]_button]:rounded-r-md",u.day),range_start:J("bg-accent rounded-l-md",u.range_start),range_middle:J("rounded-none",u.range_middle),range_end:J("bg-accent rounded-r-md",u.range_end),today:J("bg-accent text-accent-foreground rounded-md data-[selected=true]:rounded-none",u.today),outside:J("text-muted-foreground aria-selected:text-muted-foreground",u.outside),disabled:J("text-muted-foreground opacity-50",u.disabled),hidden:J("invisible",u.hidden),...s},components:{Root:({className:p,rootRef:v,..._})=>e.jsx("div",{"data-slot":"calendar",ref:v,className:J(p),..._}),Chevron:({className:p,orientation:v,..._})=>v==="left"?e.jsx(Eo,{className:J("size-4",p),..._}):v==="right"?e.jsx(ir,{className:J("size-4",p),..._}):e.jsx(Ea,{className:J("size-4",p),..._}),DayButton:gm,WeekNumber:({children:p,...v})=>e.jsx("td",{...v,children:e.jsx("div",{className:"flex size-[--cell-size] items-center justify-center text-center",children:p})}),...d},...c})}function gm({className:t,day:s,modifiers:a,...r}){const n=gi(),o=i.useRef(null);return i.useEffect(()=>{var d;a.focused&&((d=o.current)==null||d.focus())},[a.focused]),e.jsx(ee,{ref:o,variant:"ghost",size:"icon","data-day":s.date.toLocaleDateString(),"data-selected-single":a.selected&&!a.range_start&&!a.range_end&&!a.range_middle,"data-range-start":a.range_start,"data-range-end":a.range_end,"data-range-middle":a.range_middle,className:J("data-[selected-single=true]:bg-primary data-[selected-single=true]:text-primary-foreground data-[range-middle=true]:bg-accent data-[range-middle=true]:text-accent-foreground data-[range-start=true]:bg-primary data-[range-start=true]:text-primary-foreground data-[range-end=true]:bg-primary data-[range-end=true]:text-primary-foreground group-data-[focused=true]/day:border-ring group-data-[focused=true]/day:ring-ring/50 flex aspect-square h-auto w-full min-w-[--cell-size] flex-col gap-1 font-normal leading-none data-[range-end=true]:rounded-md data-[range-middle=true]:rounded-none data-[range-start=true]:rounded-md group-data-[focused=true]/day:relative group-data-[focused=true]/day:z-10 group-data-[focused=true]/day:ring-[3px] [&>span]:text-xs [&>span]:opacity-70",n.day,t),...r})}const ym=()=>{const{t}=Ge(),s=t("fr.publicInspection.zh.defItems",{returnObjects:!0}),a=t("fr.publicInspection.zh.scopeItems",{returnObjects:!0}),r=t("fr.publicInspection.zh.flowItems",{returnObjects:!0});return e.jsxs("div",{lang:"zh-Hant",className:"space-y-3 text-sm leading-6",children:[e.jsxs("section",{className:"space-y-1.5",children:[e.jsx("h4",{className:"font-semibold text-foreground",children:t("fr.publicInspection.zh.defTitle")}),e.jsx("ul",{className:"list-disc list-outside pl-5 space-y-1 text-muted-foreground",children:s.map((n,o)=>e.jsx("li",{children:n},`def-${o}`))})]}),e.jsxs("section",{className:"space-y-1.5",children:[e.jsx("h4",{className:"font-semibold text-foreground",children:t("fr.publicInspection.zh.scopeTitle")}),e.jsx("p",{className:"text-muted-foreground",children:t("fr.publicInspection.zh.scopeIntro")}),e.jsx("ul",{className:"list-disc list-outside pl-5 space-y-1 text-muted-foreground",children:a.map((n,o)=>e.jsx("li",{children:n},`scope-${o}`))}),e.jsx("p",{className:"text-muted-foreground",children:t("fr.publicInspection.zh.scopeNote")})]}),e.jsxs("section",{className:"space-y-1.5",children:[e.jsx("h4",{className:"font-semibold text-foreground",children:t("fr.publicInspection.zh.flowTitle")}),e.jsx("p",{className:"text-muted-foreground",children:t("fr.publicInspection.zh.flowIntro")}),e.jsx("ul",{className:"list-disc list-outside pl-5 space-y-1 text-muted-foreground",children:r.map((n,o)=>e.jsx("li",{children:n},`flow-${o}`))})]}),e.jsxs("div",{className:"pt-2",children:[e.jsx("p",{className:"font-semibold text-foreground",children:t("fr.publicInspection.zh.summaryTitle")}),e.jsx("p",{className:"text-muted-foreground",children:t("fr.publicInspection.zh.summary")})]})]})},bm=()=>{const{t}=Ge(),s=t("fr.publicInspection.en.paragraphs",{returnObjects:!0}),a=t("fr.publicInspection.en.warning1"),r=t("fr.publicInspection.en.warning2");return e.jsxs("div",{lang:"en",className:"space-y-3 text-sm leading-6",children:[s.map((n,o)=>e.jsx("p",{className:"text-muted-foreground",children:o===3?e.jsxs(e.Fragment,{children:[n," ",e.jsx("a",{href:"#",className:"text-primary hover:underline",children:t("fr.publicInspection.en.aboutLink")}),"."]}):n},`p-${o}`)),e.jsx("div",{className:"my-2 p-3 bg-warning/10 border-l-4 border-warning text-foreground rounded-r-lg",children:e.jsx("p",{children:a})}),e.jsx("div",{className:"my-2 p-3 bg-info/10 border-l-4 border-info text-foreground rounded-r-lg",children:e.jsx("p",{children:r})})]})};function jm({manualText:t}){var o;const{t:s,i18n:a}=Ge(),r=(o=a.language)!=null&&o.startsWith("zh")?"zh":"en",n=i.useMemo(()=>s(r==="zh"?"fr.publicInspection.titleZh":"fr.publicInspection.titleEn"),[r,s]);return e.jsxs(Ne,{className:"shadow-sm",children:[e.jsx(ot,{className:"p-3 md:p-4 pb-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(pt,{className:"text-base md:text-lg",children:n}),e.jsxs("div",{className:"inline-flex gap-1",children:[e.jsx(ee,{size:"sm",variant:r==="zh"?"secondary":"ghost",className:"h-8","aria-pressed":r==="zh",onClick:()=>a.changeLanguage("zh-TW"),children:s("fr.publicInspection.switchZh")}),e.jsx(ee,{size:"sm",variant:r==="en"?"secondary":"ghost",className:"h-8","aria-pressed":r==="en",onClick:()=>a.changeLanguage("en"),children:s("fr.publicInspection.switchEn")})]})]})}),e.jsx(Be,{className:"p-3 md:p-4",children:e.jsx("div",{className:"min-h-[300px]",children:t?e.jsx("div",{className:"text-sm leading-6 whitespace-pre-wrap text-muted-foreground",children:t}):r==="zh"?e.jsx(ym,{}):e.jsx(bm,{})})})]})}const vm=({date:t,debugMode:s,baseUri:a})=>Ft({queryKey:["public-inspection",{date:t,debugMode:s,baseUri:a}],enabled:!!t,queryFn:async()=>{const r=new URLSearchParams;r.set("action","available_on"),r.set("date",t),s&&r.set("base_uri",a);const{data:n}=await rs(`/api/fr-ts-pi?${r.toString()}`);return n}}),Nm=({debugMode:t,baseUri:s,enabled:a})=>Ft({queryKey:["public-inspection-current",{debugMode:t,baseUri:s}],enabled:a,queryFn:async()=>{const r=new URLSearchParams;r.set("action","current"),t&&r.set("base_uri",s);const{data:n}=await rs(`/api/fr-ts-pi?${r.toString()}`);return n}}),wm=()=>ii({mutationFn:async({date:t,debugMode:s,baseUri:a})=>{const r=new URLSearchParams;r.set("kind","public_inspection"),r.set("conditions[available_on]",t),s&&r.set("base_uri",a);const{data:n}=await rs(`/api/fr-ts-search-details?${r.toString()}`);return n}});function gn(t){const s=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0");return`${s}-${a}-${r}`}function Sm(){const{t}=Ge(),[s,a]=H.useState(new Date),r=H.useMemo(()=>gn(s),[s]),[n,o]=H.useState(!1),d="https://www.federalregister.gov/api/v1",[c,u]=H.useState(d),[p,v]=H.useState(null),[_,j]=H.useState([]),[f,x]=H.useState(null),[T,w]=H.useState(null),[S,y]=H.useState(null),[g,b]=H.useState(null),[R,P]=H.useState(new Set),[z,B]=H.useState(""),[M,A]=H.useState(""),V=ma(),[q,I]=H.useState(null),[k,F]=H.useState(null),[U,ne]=H.useState(null),[ge,$]=H.useState(!1),[le,_e]=H.useState(null),Ee=vm({date:r,debugMode:n,baseUri:c}),Fe=Ee.isLoading||Ee.isFetching,[et,ze]=H.useState(!0),G=Nm({debugMode:n,baseUri:c,enabled:et}),Ce=wm(),pe=H.useCallback(Z=>{if(!Z)return 0;const fe=Z.replace(/\s+/g," "),ue=fe.match(/^(\d{4}-\d{2}-\d{2})[ T](\d{2}:\d{2}:\d{2})\s*([+-]\d{2}:?\d{2})?$/);if(ue){const ve=ue[3]?ue[3].length===5?ue[3]:`${ue[3].slice(0,3)}:${ue[3].slice(3)}`:"Z",De=new Date(`${ue[1]}T${ue[2]}${ve}`);return isNaN(De.getTime())?0:De.getTime()}const ye=new Date(fe);return isNaN(ye.getTime())?0:ye.getTime()},[]),W=H.useCallback(async Z=>{const fe=(Z||"").trim();if(fe){if(q===fe){I(null),F(null),ne(null),_e(null);return}I(fe),F(null),ne(null),_e(null),$(!0);try{const ue=await or(V,fe,{baseUri:n?c:void 0});ue.normalized?(F(ue.normalized),_e(null)):(F(null),_e(t("fr.pi.errorNoDetail"))),ne(ue.raw)}catch(ue){F(null),ne(null),_e(ue instanceof Error?ue.message:String(ue))}finally{$(!1)}}},[q,V,n,c,t]);H.useEffect(()=>{const Z=Ee.data;if(!Z)return;const fe=((Z==null?void 0:Z.results)||[]).map(ve=>(ve==null?void 0:ve.attributes)??ve);j(fe),x(Z),w(null);const ue=ve=>{var De;return((De=ve==null?void 0:ve.page_views)==null?void 0:De.last_updated)||null},ye=ve=>{let De=0,jt=null;for(const vt of fe){if(!ve(vt))continue;const qt=pe(ue(vt));qt>De&&(De=qt,jt=ue(vt))}return jt};y(ye(ve=>String(ve.filing_type||"").toLowerCase().includes("special"))||null),b(ye(ve=>!String(ve.filing_type||"").toLowerCase().includes("special"))||null),v(null),P(ve=>{const De=new Set(ve);return fe.length===0?De.add(r):De.delete(r),De})},[Ee.data,pe,r]),H.useEffect(()=>{if(!Ee.error)return;const Z=Ee.error instanceof Error?Ee.error.message:String(Ee.error);v(Z),j([]),x(null),y(null),b(null),w(null)},[Ee.error,r]),H.useEffect(()=>{var fe,ue,ye,ve,De,jt;if(!G.data||!et)return;const Z=(((fe=G.data)==null?void 0:fe.results)||[]).map(vt=>(vt==null?void 0:vt.attributes)??vt);if(Array.isArray(Z)&&Z.length>0){const vt=String(((ue=Z.find(qt=>qt==null?void 0:qt.last_public_inspection_issue))==null?void 0:ue.last_public_inspection_issue)||((ye=Z[0])!=null&&ye.publication_date?String((ve=Z[0])==null?void 0:ve.publication_date).slice(0,10):"")||((De=Z[0])!=null&&De.filed_at?String((jt=Z[0])==null?void 0:jt.filed_at).slice(0,10):""));/^\d{4}-\d{2}-\d{2}$/.test(vt)&&a(new Date(`${vt}T00:00:00`))}ze(!1)},[G.data,et]),H.useEffect(()=>{!G.error||!et||ze(!1)},[G.error,et]),H.useEffect(()=>{ze(!0)},[n,c]),H.useEffect(()=>{A(r)},[r]);const Q=H.useCallback(()=>{Ce.mutate({date:r,debugMode:n,baseUri:c},{onSuccess:Z=>w(Z),onError:Z=>{const fe=Z instanceof Error?Z.message:String(Z);v(fe)}})},[Ce,r,n,c]),K=Z=>String(Z.filing_type||"").toLowerCase().includes("special"),we=_.filter(K),X=_.filter(Z=>!K(Z));function xe(Z){var ue,ye;const fe={};for(const ve of Z){const De=String(((ye=(ue=ve.agencies)==null?void 0:ue[0])==null?void 0:ye.name)||t("fr.pi.unknownAgency"));fe[De]||(fe[De]=[]),fe[De].push(ve)}return Object.keys(fe).sort().map(ve=>({agency:ve,items:fe[ve]}))}const $e=H.useMemo(()=>xe(we),[we]),Ae=H.useMemo(()=>xe(X),[X]),ct=Z=>`${t("fr.pi.filed")}: ${Z.filed_at||""} · ${t("fr.pi.scheduled")}: ${Z.publication_date||""} · ${t("fr.pi.frNumber")}: ${Z.document_number}`,Tt=Z=>{if(!Z.pdf_url)return null;const fe=Z.num_pages?` ${Z.num_pages}p`:"",ue=Z.pdf_file_size?` (${Math.round(Z.pdf_file_size/1024)} KB)`:"";return`${t("fr.pi.pdf")}${fe}${ue}`};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"px-3 py-1.5 rounded-md bg-primary text-primary-foreground text-lg font-bold tracking-wide",children:r}),e.jsx("h2",{className:"text-xl font-semibold",children:t("fr.pi.title")})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Te,{htmlFor:"pi-switch-debug",className:"text-xs",children:t("fr.pi.debug")}),e.jsx(pa,{id:"pi-switch-debug",checked:n,onCheckedChange:Z=>o(!!Z)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-[3fr_0.9fr] gap-3 md:gap-6",children:[e.jsx("div",{children:e.jsx(jm,{manualText:z})}),e.jsxs("div",{className:"space-y-3 md:min-w-[360px] w-full",children:[e.jsx(Ne,{className:"shadow-sm border bg-accent/20",children:e.jsxs(ot,{className:"p-4 md:p-5",children:[e.jsxs("div",{className:"grid grid-cols-2 md:[grid-template-columns:auto_auto_auto_minmax(0,1fr)] gap-2 md:gap-4 text-sm place-items-center text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:t("fr.pi.documents")}),e.jsx("div",{className:"text-lg md:text-xl font-bold",children:_.length})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:t("fr.pi.special")}),e.jsx("div",{className:"text-lg md:text-xl font-bold",children:we.length})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:t("fr.pi.regular")}),e.jsx("div",{className:"text-lg md:text-xl font-bold",children:X.length})]}),e.jsxs("div",{className:"col-span-2 md:col-auto text-xs md:text-sm text-center",children:[e.jsx("div",{className:"text-foreground",children:t("fr.pi.updated")}),e.jsxs("div",{className:"text-muted-foreground break-words",children:[t("fr.pi.specialShort"),": ",S||"-"]}),e.jsxs("div",{className:"text-muted-foreground break-words",children:[t("fr.pi.regularShort"),": ",g||"-"]})]})]}),e.jsxs("div",{className:"mt-3 flex items-center justify-between text-xs md:text-sm",children:[e.jsxs("div",{className:"text-muted-foreground",children:[t("fr.pi.source")," ",e.jsx("a",{className:"text-primary underline",href:"https://www.federalregister.gov/public-inspection/current",target:"_blank",rel:"noreferrer",children:"federalregister.gov"})]}),n&&e.jsx(ee,{size:"sm",variant:"secondary",className:"h-8",onClick:Q,disabled:Ce.isPending,children:Ce.isPending?t("fr.pi.loading"):t("fr.pi.searchDetailsPi")})]})]})}),e.jsx(Ne,{className:"shadow-sm",children:e.jsxs(Be,{className:"p-3 md:p-4",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(ee,{size:"sm",variant:"ghost",className:"h-8",onClick:()=>a(new Date),children:t("fr.pi.today")}),e.jsx(He,{id:"pi-date",value:M,onChange:Z=>{A(Z.target.value)},className:"h-8 text-sm w-[140px]",placeholder:"YYYY-MM-DD"}),e.jsx(ee,{size:"sm",variant:"outline",className:"h-8",onClick:()=>{const Z=M.trim();/^\d{4}-\d{2}-\d{2}$/.test(Z)&&a(new Date(Z+"T00:00:00"))},disabled:Fe,children:t("fr.pi.go")})]}),e.jsx("div",{className:"mt-3 rounded-md border shadow-sm p-2 bg-card mx-auto w-fit",children:e.jsx(xm,{className:"[--cell-size:2.25rem] md:[--cell-size:2.5rem]",mode:"single",selected:s,onSelect:Z=>{Z&&a(Z)},captionLayout:"dropdown",showOutsideDays:!0,disabled:[Z=>Z>new Date,Z=>R.has(gn(Z))]})}),n&&e.jsx("div",{className:"mt-2 text-xs text-muted-foreground text-center",children:t("fr.pi.disabledHint")})]})})]})]}),e.jsxs(ha,{defaultValue:"special",children:[e.jsxs(na,{children:[e.jsx(is,{value:"special",children:t("fr.pi.tabSpecial")}),e.jsx(is,{value:"regular",children:t("fr.pi.tabRegular")})]}),e.jsx(ls,{value:"special",children:e.jsx(Ne,{children:e.jsxs(Be,{className:"p-3 md:p-4",children:[$e.length===0&&e.jsx("div",{className:"text-xs text-muted-foreground",children:t("fr.pi.noSpecial")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsx(Ne,{className:"md:col-span-2",children:e.jsx(Be,{className:"p-3 md:p-4 space-y-4 divide-y divide-border",children:$e.map(Z=>e.jsxs("div",{className:"py-2 first:pt-0",children:[e.jsx("div",{className:"text-sm font-semibold mb-1",children:Z.agency}),e.jsx("ul",{className:"space-y-2",children:Z.items.map(fe=>e.jsxs("li",{className:"text-xs",children:[e.jsx("div",{className:"font-medium",children:fe.html_url?e.jsx("a",{className:"text-primary hover:underline",target:"_blank",rel:"noreferrer",href:fe.html_url,children:fe.title}):fe.title}),e.jsx("div",{className:"mt-0.5 text-muted-foreground",children:ct(fe)}),e.jsxs("div",{className:"mt-0.5 flex items-center gap-2",children:[fe.pdf_url&&e.jsx("a",{className:"text-primary hover:underline",target:"_blank",rel:"noreferrer",href:fe.pdf_url,children:Tt(fe)}),e.jsx(ee,{variant:"link",size:"sm",className:"h-auto px-0 text-xs",onClick:()=>W(fe.document_number),children:q===fe.document_number?t("fr.pi.hideDetail"):t("fr.pi.showDetail")})]}),q===fe.document_number&&e.jsxs("div",{className:"mt-2 rounded-md border border-border p-2 text-xs bg-muted/40",children:[ge&&e.jsx("div",{children:t("fr.pi.loadingDetail")}),le&&e.jsx("div",{className:"text-destructive",children:le}),!ge&&!le&&k&&e.jsx(La,{doc:k}),n&&U&&e.jsx("div",{className:"mt-2",children:e.jsx(bt,{title:t("fr.pi.frRaw"),data:U})})]})]},fe.document_number))})]},`sf-${Z.agency}`))})}),e.jsxs(Ne,{children:[e.jsx(ot,{className:"p-3 md:p-4 pb-2",children:e.jsx(pt,{className:"text-xs font-semibold",children:t("fr.pi.specialAgencies")})}),e.jsx(Be,{className:"p-3 md:p-4 pt-0",children:e.jsx("ul",{className:"space-y-1",children:$e.map(Z=>e.jsxs("li",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"truncate",title:Z.agency,children:Z.agency}),e.jsx("span",{className:"ml-2 text-muted-foreground",children:Z.items.length})]},`sfa-${Z.agency}`))})})]})]})]})})}),e.jsx(ls,{value:"regular",children:e.jsx(Ne,{children:e.jsxs(Be,{className:"p-3 md:p-4",children:[Ae.length===0&&e.jsx("div",{className:"text-xs text-muted-foreground",children:t("fr.pi.noRegular")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsx(Ne,{className:"md:col-span-2",children:e.jsx(Be,{className:"p-3 md:p-4 space-y-4 divide-y divide-border",children:Ae.map(Z=>e.jsxs("div",{className:"py-2 first:pt-0",children:[e.jsx("div",{className:"text-sm font-semibold mb-1",children:Z.agency}),e.jsx("ul",{className:"space-y-2",children:Z.items.map(fe=>e.jsxs("li",{className:"text-xs",children:[e.jsx("div",{className:"font-medium",children:fe.html_url?e.jsx("a",{className:"text-primary hover:underline",target:"_blank",rel:"noreferrer",href:fe.html_url,children:fe.title}):fe.title}),e.jsx("div",{className:"mt-0.5 text-muted-foreground",children:ct(fe)}),e.jsxs("div",{className:"mt-0.5 flex items-center gap-2",children:[fe.pdf_url&&e.jsx("a",{className:"text-primary hover:underline",target:"_blank",rel:"noreferrer",href:fe.pdf_url,children:Tt(fe)}),e.jsx(ee,{variant:"link",size:"sm",className:"h-auto px-0 text-xs",onClick:()=>W(fe.document_number),children:q===fe.document_number?t("fr.pi.hideDetail"):t("fr.pi.showDetail")})]}),q===fe.document_number&&e.jsxs("div",{className:"mt-2 rounded-md border border-border p-2 text-xs bg-muted/40",children:[ge&&e.jsx("div",{children:t("fr.pi.loadingDetail")}),le&&e.jsx("div",{className:"text-destructive",children:le}),!ge&&!le&&k&&e.jsx(La,{doc:k}),n&&U&&e.jsx("div",{className:"mt-2",children:e.jsx(bt,{title:t("fr.pi.frRaw"),data:U})})]})]},fe.document_number))})]},`rf-${Z.agency}`))})}),e.jsxs(Ne,{children:[e.jsx(ot,{className:"p-3 md:p-4 pb-2",children:e.jsx(pt,{className:"text-xs font-semibold",children:t("fr.pi.regularAgencies")})}),e.jsx(Be,{className:"p-3 md:p-4 pt-0",children:e.jsx("ul",{className:"space-y-1",children:Ae.map(Z=>e.jsxs("li",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"truncate",title:Z.agency,children:Z.agency}),e.jsx("span",{className:"ml-2 text-muted-foreground",children:Z.items.length})]},`rfa-${Z.agency}`))})})]})]})]})})})]}),n&&e.jsxs(Ne,{className:"p-3 md:p-4",children:[f&&e.jsx(bt,{title:t("fr.pi.rawAvailable"),data:f}),T&&e.jsx("div",{className:"mt-2",children:e.jsx(bt,{title:t("fr.pi.searchDetailsPi"),data:T})})]})]})}const Cm=[{key:"intelligence",label:"情報總覽",icon:Uo},{key:"advanced-trends",label:"進階市場趨勢",icon:Bo},{key:"federal-register",label:"聯邦公報",icon:Pn},{key:"federal-register2",label:"聯邦預報",icon:Vo},{key:"hts",label:"HTSUS 資料庫",icon:qo},{key:"sources",label:"資料來源與工具",icon:zo}],_m=[{key:"intelligence",label:"首頁",icon:ei},{key:"query",label:"關稅查詢",icon:Oo},{key:"charts",label:"shadcn 圖表示例",icon:Mo},{key:"dataweb",label:"DataWeb 驗證",icon:$o},{key:"translation",label:"貨名翻譯",icon:xi},{key:"verifier",label:"驗證工具",icon:Ho}];function km(){const{activeTab:t,setActiveTab:s}=ra(),[a,r]=H.useState(!1),[n,o]=H.useState(()=>localStorage.getItem("theme")||"system"),[d,c]=H.useState(()=>localStorage.getItem("theme_name")||"default"),u=a?_m:Cm;H.useMemo(()=>(u||[]).filter(j=>j.key!=="federal-register2"),[u]),H.useEffect(()=>{const j=window.document.documentElement;if(j.classList.remove("light","dark"),n==="system"){const f=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";j.classList.add(f)}else j.classList.add(n);j.removeAttribute("data-theme"),d!=="default"&&j.setAttribute("data-theme",d)},[n,d]);const p=j=>{localStorage.setItem("theme",j),o(j)},v=j=>{if(localStorage.setItem("theme_name",j),c(j),n==="system"){const f=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";p(f)}},_=()=>{switch(t){case"intelligence":return e.jsx(cn,{});case"advanced-trends":return e.jsx(bu,{});case"query":return e.jsx(Lc,{});case"hts":return e.jsx(nd,{});case"sources":return e.jsx(md,{});case"federal-register":return e.jsx(fm,{});case"federal-register2":return e.jsx(Sm,{});case"dataweb":return e.jsx(bd,{});case"translation":return e.jsx(Hu,{});case"verifier":return e.jsx(mu,{});case"charts":return e.jsx(Ru,{});default:return e.jsx(cn,{})}};return e.jsx(cr,{children:e.jsxs("div",{className:"w-full max-w-screen-2xl mx-auto p-4 md:p-8",children:[e.jsx("header",{className:"text-center mb-8",children:e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-start md:justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-foreground",children:"Handy Tariff Smarty - 美國進口關稅資料查詢系統"}),e.jsx("p",{className:"text-foreground mt-2",children:"Smart HTS Research Tool with Official U.S. Trade Data & Federal Register Integration"}),e.jsx("p",{className:"text-foreground mt-2",children:"智慧關稅代碼導航工具 - 整合美國官方關稅資料庫、貿易統計與聯邦公報"})]}),e.jsx("div",{className:"flex justify-center md:justify-end md:shrink-0",children:e.jsx(Ku,{theme:n,setTheme:p,themeName:d,setThemeName:v})})]})}),e.jsxs(ha,{value:t,onValueChange:j=>{const f=j;s(f),f==="intelligence"&&r(!1)},className:"w-full",children:[e.jsx("div",{className:"w-full pb-2",children:e.jsx(na,{className:"flex flex-wrap h-auto items-center justify-center -mb-px",children:u.map(j=>e.jsxs(is,{value:j.key,className:"whitespace-nowrap px-4 py-2 text-base",children:[e.jsx(j.icon,{className:"mr-2 h-5 w-5"}),j.label]},j.key))})}),e.jsx(ls,{value:t,className:"mt-6",children:e.jsx(id,{children:_()})})]}),e.jsxs("footer",{className:"text-center mt-12 text-sm  text-foreground",children:[e.jsx("p",{children:"Integrating HTS.gov, USITC DataWeb, and Federal Register Implementation With Vibe Coding"}),e.jsx("p",{className:"mt-1",children:"本系統僅供參考，最終解釋請以美國官方公告為準。"}),e.jsxs("div",{className:"mt-2 flex items-center justify-center gap-2",children:[e.jsx("span",{children:"Author"}),e.jsx("button",{onClick:()=>{r(!0),s("charts")},className:"cursor-pointer",title:"Open Dev Mode",children:":"}),e.jsx("span",{children:"Johnway"}),e.jsx(hd,{asChild:!0,children:e.jsx("button",{className:"text-xs text-muted-foreground hover:text-primary hover:underline",title:"顯示研究軌跡",children:"(顯示軌跡)"})})]})]}),e.jsxs(Ua,{children:[e.jsx(Ba,{children:e.jsx(Va,{children:"研究軌跡"})}),e.jsx(xd,{})]})]})})}const Tm={queries:{staleTime:0,gcTime:10*60*1e3,retry:!1,refetchOnWindowFocus:!1},mutations:{retry:0}},Am=()=>new mc({defaultOptions:Tm}),Rm={title:"Handy Tariff Smarty"},Im={close:"Close",open:"Open",cancel:"Cancel",confirm:"Confirm",refresh:"Refresh"},Fm={loading:"Loading...",error:"Something went wrong",empty:"No data available"},Dm={title:"Tariff Intelligence",addFavorite:"Add to Favorites",favorites:"Favorites",searchErrorTitle:"Search Failed",welcomeTitle:"Welcome to Tariff Intelligence",welcomeDesc:"Enter an HTS code in the search bar above to get started. You can view detailed tariff rates, AD/CVD cases, market trends, and more.",toolsTitle:"Tools & Analysis",toolsDesc:"Interactive tools like the tariff calculator and market trends will appear here after a search.",htsLoading:"Loading HTS.gov data...",htsMissing:"Unable to load HTS.gov data",releaseDate:"Release date",enterDigits:"Please enter at least 4 digits of the HTS code."},Lm={advanced:{title:"Advanced Query",htsLabel:"HTS Codes (comma-separated)",htsPlaceholder:"e.g. 730630, 390110",granularity:"Granularity",granularity6:"HTS6",granularity8:"HTS8",granularity10:"HTS10",breakout:"Break Out",breakoutCommodities:"Commodities",breakoutCountries:"Countries",tradeFlow:"Trade Flow",flowCons:"Imports for Consumption",flowGen:"General Imports",flowBalance:"Trade Balance",balanceNoticeTitle:"Trade Balance Notes",balanceNoticeItems:["Only supports 6-digit HTS; granularity is fixed to 6 (auto applied).","Comparison metric: Total Exports FAS − General Imports Customs Value.","Can be used with Country Break Out and Compare / Top N."],metrics:"Metrics",metricLabels:{quantity:"Quantity",value:"Customs Value / Balance",cif:"CIF Value",charges:"Import Charges",calc_duties:"Calculated Duties",dutiable:"Dutiable Value",landed:"Landed (CIF + Duties)"},metricsPlaceholder:"Select metrics...",metricsEmpty:"No metrics found.",metricsUnavailable:"Not available for '{{flow}}' trade flow.",metricsMore:"+{{count}} more",removeCountry:"Remove country",period:"Period",ytd:"Year-to-date",historyYears:"History: {{years}} years",diagnostic:"Diagnostic",showRequestBody:"Show request body",compareToggle:"Compare (country diff across 2 years)",yearA:"Year A",yearB:"Year B",diff:"Diff",diffAbsolute:"Absolute",diffPercent:"Percent",topN:"Top N",run:"Run Query",running:"Running...",results:"Results",compareTable:"Compare Table",compareDiffLabel:"Diff: {{mode}}",compareSortBy:"Sort by",compareOrder:"Order",orderAbs:"Abs",orderDesc:"Desc",orderAsc:"Asc",countryLabel:"Country",yearLabel:"Year",dataTable:"Data Table",noSeries:"No trade statistics available. Try reducing years or switching metrics.",processedTitle:"Processed Chart Data (for debugging)",reconciliationTitle:"Reconciliation Data (for debugging)",diagnostics:"Diagnostics",copySummary:"Copy Summary",requestSummary:"Request Summary",headers:"Headers",reportBody:"reportBody",runPrompt:"Run a query to see results",barName:"{{label}} Diff ({{yearA}} vs {{yearB}})"},chart:{loadCountries:"Load Countries",refreshingCountries:"Refreshing...",refreshData:"Refresh Data",refreshingData:"Refreshing...",remove:"Remove",flow:"Flow",flowCons:"For Consumption",flowGen:"General Imports",metric:"Metric",period:"Period",ytd:"YTD",historyYearsShort:"{{years}}y",breakout:"Break Out",topN:"Top N",year:"Year",auto:"Auto",exportCsv:"Export CSV",exportJson:"Export JSON ({{metric}})",diagnostic:"Diagnostic",sync:"Sync",info:"Info",infoFlowTitle:"Trade Flow",infoFlowDesc:"Switch between Imports for Consumption and General Imports to see how metrics change across flows.",infoMetricTitle:"Metrics",infoMetricDesc:"Choose a metric to visualize. Value-based metrics are shown in USD; Quantity shows the reported unit.",unitUSD:"USD",emptyTitle:"No Trade Statistics Available",emptyDesc:"No data was found for the selected criteria. Try adjusting the period or country selection.",preparing:"Preparing chart...",hideData:"Hide Data",showData:"Show Data",copySummary:"Copy Summary",diagnostics:"Diagnostics",requestSummary:"Request Summary",headers:"Headers",reportBody:"reportBody",tableYear:"Year",tableCountry:"Country",tableTotal:"Total"}},Pm={title:"Federal Register",debugMode:"Debug mode",aggregated:"Aggregated (facets)",badgeAgency:"agency: {{slug}} ×",badgeType:"type: {{value}} ×",badgeSection:"section: {{slug}} ×",badgeTopic:"topic: {{slug}} ×",prev:"Prev",next:"Next",page:"Page {{page}}",pageWithTotal:"Page {{page}} / {{totalPages}}",clearDates:"Clear Dates",load:"Load",show:"Show",hide:"Hide",openVerifier:"Open Facets Verifier",baseUri:"Base URI (debug)",frequency:"Frequency",frequencyChart:"Frequency Chart",totalCount:"Total {{count}} documents",agenciesTitle:"Agencies All",agenciesEmpty:"Click Load to fetch agencies.",suggestedTitle:"Suggested Searches",suggestedEmpty:"Click Load to fetch curated searches.",suggested:{appliedTitle:"Applied suggested search",appliedTermLabel:"Term",sectionHint:"Pick a topic below; each entry can expand to see details.",sortLabel:"Sort",sortDefault:"Default order",sortActivity:"By activity",sortComments:"By open comments",apply:"Apply",applying:"Applying...",docsLastYear:"{{count}} docs last year",docsComments:"{{count}} open comments",unknown:"N/A",noDescription:"No description provided.",searchConditions:"Search Conditions",untitled:"Untitled"},agencies:{searchPlaceholder:"Quick filter by name / slug",clear:"Clear",tabHierarchical:"Hierarchy",tabFunctional:"By Function",tabType:"By Type",noResults:"No agencies match the filter.",topWithChildren:"Top agencies with children",noChildren:"Standalone agencies / commissions",children:"Sub-agencies",childCount:"{{count}} child agencies",sortLabel:"Sort",sortName:"Name",sortCount:"Count",agencyCount:"{{count}} agencies",typeDepartments:"Departments",typeCommissions:"Commissions",typeAdministrations:"Administrations / Bureaus",typeOffices:"Offices",typeFoundations:"Foundations / Boards",typeCorporations:"Corporations",typeServices:"Services",typeCouncils:"Councils",typeOther:"Other",funcDefense:"Defense / Security",funcFinance:"Finance / Trade",funcHealth:"Health / Food",funcJustice:"Justice / Immigration",funcEnvironment:"Environment / Energy",funcScience:"Science / Technology",funcTransport:"Transportation",funcAgriculture:"Agriculture",funcAdmin:"Administration / Management",funcSocial:"Society / Public Welfare",funcOther:"Other"},sections:{money:"Money",environment:"Environment",world:"World","science-and-technology":"Science & Technology","business-and-industry":"Business & Industry","health-and-public-welfare":"Health & Public Welfare"},controls:{startDate:"Start Date (YYYY-MM-DD)",endDate:"End Date (YYYY-MM-DD)",datePlaceholder:"YYYY-MM-DD",perPage:"Per Page",order:"Order",orderRecent:"Recent",orderOldest:"Oldest",orderNewest:"Newest"},conditions:{agencies:"Agencies",agencyPlaceholder:"Type to search slugs...",suggest:"Suggest",clickToAdd:"Click to add",close:"Close",hint:"Press Enter or click Suggest to list options. Click to add.",types:"Types",typesPlaceholder:"e.g. RULE,NOTICE",sections:"Sections",sectionPlaceholder:"Search sections...",topics:"Topics",empty:"No options.",topicPlaceholder:"Search topics...",noName:"(no name)",noSlug:"(no slug)"},debug:{searchResponse:"Search Response (Raw)",upstream:"Upstream URLs (__debug)",effectiveQuery:"Effective Query",receivedNested:"Received (nested)",receivedSimple:"Received (simple)",appliedConditions:"Applied Conditions (frontend)"},doc:{action:"Action",dates:"Dates",effectiveOn:"Effective On",commentCloseOn:"Comment Close On",addresses:"Addresses",contact:"Contact",furtherInfo:"Further Information",supplementaryInfo:"Supplementary Information",abstract:"Abstract",topics:"Topics",docketIds:"Docket IDs",dockets:"Dockets",regIdNumbers:"Regulation ID Numbers",regulationIdInfo:"Regulation ID Info",cfrReferences:"CFR References",citation:"Citation",correctionOf:"Correction Of",corrections:"Corrections",pageRange:"Page Range",pageViews:"Page Views",volume:"Volume",startPage:"Start Page",endPage:"End Page",presidentialDocNumber:"Presidential Document Number",proclamationNumber:"Proclamation Number",signingDate:"Signing Date",significant:"Significant",subtype:"Subtype",tocDoc:"TOC Doc",tocSubject:"TOC Subject",topicsRaw:"Topics (raw)",agencyNames:"Agency Names",regsGovInfo:"Regulations.gov Info",execOrderNotes:"Executive Order Notes",execOrderNumber:"Executive Order Number",htmlUrl:"HTML URL",fullText:"Full Text (HTML)",pdf:"PDF",publicInspectionPdf:"Public Inspection PDF",rawText:"Raw Text URL",jsonUrl:"JSON URL",modsUrl:"MODS URL",commentUrl:"Comment URL",regsGovUrl:"Regulations.gov URL",viewOnFr:"View on FR",regsGovJson:"Regulations.gov JSON",docketsJson:"Dockets",yes:"Yes",no:"No",na:"N/A",updatedUnknown:"updated ?"},facet:{clear:"Clear",browse:"Browse",page:"page {{page}}",pageWithTotal:"page {{page}} / {{total}}",autoClose:"Auto-close after select",apply:"Apply",applyYear:"Apply full year {{year}}",names:{agency:"Agency",type:"Type",section:"Section",topic:"Topic",daily:"Daily",weekly:"Weekly",monthly:"Monthly",quarterly:"Quarterly"}},facetControls:{presets:"Presets",default:"Default",all:"All",none:"None"},results:{title:"Results ({{count}})",empty:"No results.",details:"Details",searchDetails:"Search Details",fullText:"Full Text",publicInspection:"Public Inspection PDF",publicInspectionTitle:"public_inspection_pdf_url (pre-publication)",publicInspectionDesc1:"Preview version before formal publication (Public Inspection).",publicInspectionDesc2:"Use for early awareness of upcoming HTS or tariff changes.",pdf:"PDF",pdfTitle:"pdf_url (official PDF)",pdfDesc1:"Authoritative PDF hosted by govinfo.gov.",pdfDesc2:"Use for legal citations and compliance review.",companyRatesToggle:"Company rates",companyRatesButton:"Company rates",loadingDetail:"Loading details...",noDetail:"No detail data available for this document.",docRaw:"Document (Raw)",searchDetailsDebug:"Search Details (Debug)"},search:{label:"Keyword",placeholder:"Enter keywords or doc numbers (e.g., GC-489-502, Final Results, 7306.30.10)...",search:"Search",searching:"Searching..."},publicInspection:{titleZh:"關於 Public Inspection",titleEn:"About Public Inspection",switchZh:"繁中",switchEn:"EN",en:{aboutLink:"About Public Inspection",paragraphs:["The following documents are on file at the Office of the Federal Register (OFR) and will be published in the Federal Register on the dates listed.","Regular Filing documents are routinely placed on file at 8:45 a.m. Eastern Time, for publication in the next day’s Federal Register.","Special Filing documents are filed at other times and/or dates prior to publication.","See About Public Inspection for more information."],warning1:"Although we make a concerted effort to reproduce the original document in full on our Public Inspection pages, in some cases graphics may not be displayed, and non-substantive markup language may appear alongside substantive text. If you are using public inspection listings for legal research, you should verify the contents of documents against a final, official edition of the Federal Register. Only official editions of the Federal Register provide legal notice of publication to the public and judicial notice to the courts under 44 U.S.C. 1503 & 1507.",warning2:"Please note that most of the original documents filed with the Office of the Federal Register contain calculated effective dates, comment dates, and other applicable dates. We calculate and insert those dates after the documents go on file. You can consult the Table of Effective Dates & Time Periods to determine the calendar date of a calculated date contained in a Public Inspection document."},zh:{defTitle:"1. 功能定義",defItems:["Public Inspection（公開檢視）係聯邦政府程序，每個工作日東岸時間 8:45 在聯邦公報網站發布即將刊登的文件供預覽。","文件在正式刊登前開放查閱，強化行政透明與公眾參與，讓利害關係人提前了解規範或決策。"],scopeTitle:"2. 內容範圍",scopeIntro:"Public Inspection Desk 常見文件類型：",scopeItems:["規章/規範修訂","法律","總統文書、公報、命令","行政機關公告或文件"],scopeNote:"文件依設定日期開放檢索與下載，並於設定時間正式刊登。",flowTitle:"3. 流程與意義",flowIntro:"文件提交至 Federal Register（OFR）後提前公開的價值：",flowItems:["讓大眾得以預覽即將生效的內容","增進公眾參與與利害關係人準備","確保資訊保存與監督"],summaryTitle:"一句話",summary:"Public Inspection 是聯邦公報正式刊登前的公開閱覽機制，協助大眾提前知悉將刊登的文件並符合法定程序正義。"}},pi:{title:"Public Inspection",debug:"Debug mode",documents:"Documents",special:"Special",regular:"Regular",updated:"Updated",specialShort:"S",regularShort:"R",source:"Source:",searchDetailsPi:"Search Details (PI)",loading:"Loading...",today:"Today",go:"Go",unknownAgency:"Unknown Agency",filed:"Filed",scheduled:"Scheduled",frNumber:"FR",pdf:"PDF",showDetail:"Show Detail",hideDetail:"Hide Detail",loadingDetail:"Loading detail...",frRaw:"FR Document (Raw)",specialAgencies:"Special Filing Agencies",regularAgencies:"Regular Filing Agencies",noSpecial:"No special filings.",noRegular:"No regular filings.",tabSpecial:"Special Filing",tabRegular:"Regular Filing",rawAvailable:"Public Inspection (available_on) Raw",disabledHint:"Disabled hints: future dates and known empty dates",errorNoDetail:"No detail available",tariffQuery:{materialMixed:"Steel & Aluminum",materialSteel:"Steel",materialAluminum:"Aluminum",derivative:"Derivative",chapter:"HTSUS Chapter: {{chapter}}",applicableMeasures:"Applicable Measures",sec232:"Section 232",sec301:"Section 301",adcvd:"AD / CVD",highRisk:"High risk",cachedLoaded:"Loaded {{count}} cached records",loadError:"Failed to load tariff rules: {{message}}",remoteLoaded:"Loaded {{count}} records",searchPlaceholderLoading:"Loading...",searchPlaceholder:"Enter keyword or HTS (e.g., copper, 0101.21.00)",filterAll:"All",filterSteel:"Steel",filterAluminum:"Aluminum",emptyTitle:"No results found",emptyDesc:"Try different keywords or adjust filters."}},hts:{searchLabel:"HTS Search",placeholderFull:"Filter keywords within the full HTS table...",placeholderApi:"Enter keywords or HTS code...",search:"Search",searching:"Searching...",toggleFull:"Load full HTSUS table",emptyTitle:"No HTSUS results",emptyDesc:"Enter keywords or HTS code above to search.",versionFormatError:"Release name format is invalid; cannot locate fallback files.",versionFallbackFailed:"No data found for {{desc}} or nearby revisions.",versionLoadFailedShort:"Failed to load release info",versionLoadFailed:"Loading version info failed: {{message}}",fileLoadError:"File load error: {{message}}",fileLoadFallback:"File load fallback: {{name}} - {{desc}}",fallbackTitle:"Cannot load latest table",fallbackDesc1:"Unable to load the latest table ({{desc}}).",fallbackDesc2:"You can try fallback data: {{name}}. Load it?",fallbackConfirm:"Load fallback",warningTitle:"Version notice",advancedSearchFailed:"Advanced search failed: {{message}}"},tariffQuery:{materialMixed:"Steel & Aluminum",materialSteel:"Steel",materialAluminum:"Aluminum",derivative:"Derivative",chapter:"HTSUS Chapter: {{chapter}}",applicableMeasures:"Applicable Measures",sec232:"Section 232",sec301:"Section 301",adcvd:"AD / CVD",highRisk:"High risk",cachedLoaded:"Loaded {{count}} cached records",loadError:"Failed to load tariff rules: {{message}}",remoteLoaded:"Loaded {{count}} records",searchPlaceholderLoading:"Loading...",searchPlaceholder:"Enter keyword or HTS (e.g., copper, 0101.21.00)",filterAll:"All",filterSteel:"Steel",filterAluminum:"Aluminum",emptyTitle:"No results found",emptyDesc:"Try different keywords or adjust filters."},htsCard:{detailLoadFailed:"Unable to load HTS details",detailLoadFailedDesc:"Failed to load HTS details: {{message}}",noDescription:"(No description)",rateGeneral:"General",rateSpecial:"Special",rateOther:"Other",noData:"No data available.",docNotFound:"Document details not found",docMeta:"Published {{date}} · Agency {{agencies}}",linkOriginal:"Original",linkFullText:"Full Text",linkPublicInspection:"Public Inspection",hideDocDetail:"Hide details",showDocDetail:"Show details",loadingDocDetail:"Loading document details...",rawTitle:"FR Document (Raw)",tradeStatsTitle:"Recent import value",investigationsTitle:"Related investigations (ITC)",caseNumber:"Case No.",countries:"Countries",programsTitle:"Preference eligibility (DataWeb)",tabOverview:"Overview",tabAll:"All ({{count}})",storyHeading:"Highlights",footnoteHeading:"Footnotes",basicRates:"Basic rates:",basicRatesDesc:"General rate {{general}}, Column 2 rate {{other}}, Units {{units}}",extraDuties:"Potential additional duties:",extraDutiesDesc:"Check {{duties}} related rules; Chapter 99 may apply.",tradeRemedy:"Trade remedies:",tradeRemedyDesc:"This HTS code is linked to {{count}} AD/CVD investigations. See the Overview tab for details.",validPeriod:"Validity:",indent:"Indent",units:"Units",otherCompliance:"Other compliance info",stagedRates:"Staged rates",rateLabelGeneral:"General (Column 1)",rateLabelSpecial:"Special",rateLabelOther:"Column 2",htsLinkHint:"Left click to search this code in Intelligence; right click to open the official site for {{code}}",detailsTitle:"HTS Details: {{code}}",noHtsDescription:"No HTS description available.",noDatawebDescription:"No DataWeb description available.",mfnRate:"General Rate (MFN)",col2Rate:"Column 2 Rate",applicableRegs:"Applicable Regulations",sec232Steel:"Sec 232 Steel",sec232SteelDesc:"Section 232 tariffs on steel might apply.",sec232Aluminum:"Sec 232 Aluminum",sec232AluminumDesc:"Section 232 tariffs on aluminum might apply.",sec301:"Sec 301",sec301Desc:"Section 301 tariffs (China) might apply.",investigationBadge:"{{type}}",investigationTitle:"This HTS code is subject to {{type}} investigations.",specialRates:"Special Rates (Programs)",specialDetails:"Details",s301Measures:"Section 301 Measures",s301List:"List",s301Rate:"Rate",s301Effective:"Effective",s301Action:"Action",na:"N/A"}},Em={detailLoadFailed:"Unable to load HTS details",detailLoadFailedDesc:"Failed to load HTS details: {{message}}",noDescription:"(No description)",rateGeneral:"General",rateSpecial:"Special",rateOther:"Other",noData:"No data available.",docNotFound:"Document details not found",docMeta:"Published {{date}} · Agency {{agencies}}",linkOriginal:"Original",linkFullText:"Full Text",linkPublicInspection:"Public Inspection",hideDocDetail:"Hide details",showDocDetail:"Show details",loadingDocDetail:"Loading document details...",rawTitle:"FR Document (Raw)",tradeStatsTitle:"Recent import value",investigationsTitle:"Related investigations (ITC)",caseNumber:"Case No.",countries:"Countries",programsTitle:"Preference eligibility (DataWeb)",tabOverview:"Overview",tabAll:"All ({{count}})",storyHeading:"Highlights",footnoteHeading:"Footnotes",basicRates:"Basic rates:",basicRatesDesc:"General rate {{general}}, Column 2 rate {{other}}, Units {{units}}",extraDuties:"Potential additional duties:",extraDutiesDesc:"Check {{duties}} related rules; Chapter 99 may apply.",tradeRemedy:"Trade remedies:",tradeRemedyDesc:"This HTS code is linked to {{count}} AD/CVD investigations. See the Overview tab for details.",validPeriod:"Validity:",indent:"Indent",units:"Units",otherCompliance:"Other compliance info",stagedRates:"Staged rates",rateLabelGeneral:"General (Column 1)",rateLabelSpecial:"Special",rateLabelOther:"Column 2",htsLinkHint:"Left click to search this code in Intelligence; right click to open the official site for {{code}}",detailsTitle:"HTS Details: {{code}}",noHtsDescription:"No HTS description available.",noDatawebDescription:"No DataWeb description available.",mfnRate:"General Rate (MFN)",col2Rate:"Column 2 Rate",applicableRegs:"Applicable Regulations",sec232Steel:"Sec 232 Steel",sec232SteelDesc:"Section 232 tariffs on steel might apply.",sec232Aluminum:"Sec 232 Aluminum",sec232AluminumDesc:"Section 232 tariffs on aluminum might apply.",sec301:"Sec 301",sec301Desc:"Section 301 tariffs (China) might apply.",investigationBadge:"{{type}}",investigationTitle:"This HTS code is subject to {{type}} investigations.",specialRates:"Special Rates (Programs)",specialDetails:"Details",s301Measures:"Section 301 Measures",s301List:"List",s301Rate:"Rate",s301Effective:"Effective",s301Action:"Action",na:"N/A"},Om={title:"Related Federal Register documents, Based on HTS Code",keyword:"Additional Keyword",keywordPlaceholder:"optional",perPage:"Per Page",debug:"Debug",queryLine:"Query: term={term}{keyword} | per_page={perPage}",emptyTerm:"(empty)",emptyTitle:"No Related Documents Found",emptyDesc:"No Federal Register documents were found for the current query.",details:"Details",fullText:"Full Text",pdfTitle:"pdf_url (official PDF)",pdfDesc1:"Link to the authoritative PDF hosted by govinfo.gov.",pdfDesc2:"Use for legal citations and compliance reviews.",piPdf:"Public Inspection PDF",piPdfTitle:"public_inspection_pdf_url (pre-publication)",piPdfDesc1:"Preview release before formal publication (Public Inspection).",piPdfDesc2:"Helpful for early awareness of upcoming HTS or tariff changes.",loadingDetail:"Loading details...",noDetail:"No document details available",rawJson:"Raw Federal Register Document (JSON)"},Mm={title:"AD/CVD Country Tracker Based on DataWeb Database",lastUpdated:"Last Updated: {{date}}",country:"Country",rates:"Rates and related documents",detailsHeader:"Details",noRecent:"No recent updates.",viewDetails:"View Details",emptyTitle:"No Active AD/CVD Cases Found",emptyDesc:"No active cases were found for this HTS code in our database."},$m={title:"AD/CVD Company Rates: {{country}}",unknownCountry:"Unknown",description:"Company-specific rates as published in the Federal Register document.",company:"Company/Exporter",rate:"Rate",viewOnFr:"View this document directly on Federal Register",emptyTitle:"No Company-Specific Rates Found",emptyDesc:"No company-specific rates were found in this document."},Hm={title:"Special Rate Programs Details",description:"Details of special tariff programs, eligibility, and rates. Effective from {{start}} to {{end}}.",na:"N/A",filter:"Filter by Status:",status:{all:"All",eligible:"Eligible",notEligible:"Not Eligible"},loading:"Loading program details...",table:{program:"Program Info",rate:"Rate",countries:"Applicable Countries/Group"},countriesPlaceholder:"{{count}} countries..."},Um={title:"Related Investigations (IDS)",emptyTitle:"No Related Investigations Found",emptyDesc:"No related investigations were found in DataWeb for this HTS code."},Bm={button:"Countries",searchPlaceholder:"Search country...",all:"All Countries"},Vm={emptyTitle:"No Favorite Searches",emptyDesc:"You haven't saved any favorite searches yet. Click the star icon to add one.",dialogTitle:"Favorite Searches",dialogDesc:"Manage and reopen your saved HTS searches."},qm={title:"Tariff Calculator",country:"Country of Origin",selectCountry:"country",loadingCountries:"Loading countries...",declaredValue:"Declared Value (USD)",declaredPlaceholder:"e.g., 10000",quantity:"Quantity ({{unit}})",quantityPlaceholder:"e.g., 1000",loadingHts:"Loading HTS Data...",calculate:"Calculate",errorMissing:"Please provide HTS code, country, and value.",noteTitle:"About this calculation:",noteBody:"This calculation uses the HTSUS tariff treatment section for Normal Customs Duty (ad valorem / specific / compound). It does NOT include trade remedies or surcharges such as AD/CVD or Section 232/301/201.",resultTitle:"Calculation Result:",baseRate:"Base Rate (MFN)",prefApplied:"Preferential Rate Applied",prefRate:"Applicable Rate",noPref:"No preferential program applied for {{country}}.",adValoremDuty:"Ad Valorem Duty",specificDuty:"Specific Duty",finalDuty:"Final Calculated Duty",notice232:"Section 232 / 301 / 201",notice232Desc:"Actual rate is shown in Ch.99.",noticeAdcvd:"AD / CVD",noticeAdcvdDesc:"Refer to DOC / ITA for applicable duties."},zm={introduction:"Introduction",generalNotes:"General Notes",tariffSchedule:"Tariff Schedule",sectionsChapters:"Sections & Chapters",appendices:"Appendices",localLoaded:"Local dataset loaded",searchMatched:"Chapters matching search"},Qm={title:"AD/CVD Orders Search",description:"This product uses the International Trade Administration’s Data API but is not endorsed or certified by the International Trade Administration.",queryLabel:"Query (HTS or Keyword)",sizeLabel:"Size (1-50)",pageLabel:"Page",searching:"Searching...",search:"Search",reset:"Reset",source:"Source",noData:"No data available, please try another keyword or HTS.",results:{summary:"Total {{total}} records, showing {{count}}, offset = {{offset}}",prev:"Prev",next:"Next",page:"Page {{page}} / {{totalPages}}"},table:{case:"Case",country:"Country",product:"Product",hts:"HTS Numbers"},frSection:{title:"Related Federal Register Results",searchTerms:"Search Terms:",loading:"Loading Federal Register results...",noResults:"No Federal Register results under this condition.",noInfo:"Insufficient information to query the Federal Register.",specialCaseError:"This document has a special case: {{case}}. Please check the Federal Register directly."}},Ym={search:"Search",view:"View",prev:"Previous",next:"Next",pageOf:"Page {{current}} of {{total}}"},Gm={title:"USITC Investigation Search",keyword:"Keyword (topic/product/country)",allStatuses:"All statuses",invNumber:"Inv. Number (e.g., 701-253)",error:"Failed to load search results.",noResults:"No results found for current filters.",showing:"Showing",of:"of",results:"results.",source:"Source",table:{invNumber:"Inv. Number",topic:"Topic",phase:"Phase",countries:"Countries",startDate:"Start Date",endDate:"End Date"}},Km={na:"N/A",active:"Active",inactive:"Inactive",completed:"Completed",petitioner:"Petitioner",commerceOrder:"Commerce Order",caseManager:"Case Manager",typeNA:"Type N/A",phaseNumber:"Phase Number",viewOnIds:"View on IDS",collapse:"Collapse",expand:"Expand",productGroup:"Product Group Code",categories:"Investigation Categories",staff:"Staff",participants:"Participants",hts:"HTS Number",ip:"Intellectual Property",unfairActs:"Unfair Acts",subInv:"Sub-investigation / Votes",subInvestigation:"Sub-Investigation",voteType:"Vote Type",voteDate:"Vote Date",date:"Date",activeDate:"Active",expiration:"Expiration",frNotices:"FR Notices / Citation",documents:"Investigation Documents",sections:{basic:"Basic Info / Categories",timeline:"Timeline & Dates",people:"People & Participants",scope:"Scope & Items (HTS / IP / Unfair Act)",orders:"Orders / Sub-investigation / Votes",documents:"Documents / Notices"},cards:{countries:"Countries",categories:"Investigation Categories",product:"Product",phase:"Phase"},timeline:{frNotice:"FR Notice",commerceInit:"Commerce Initiation",vote:"Vote"},extra:{startDate:"Start Date",investigationEnd:"Investigation End Date",termination:"Investigation Termination Date",finalDetermination:"Final Determination Date",determination:"Determination Date",initiatingDoc:"Initiating Document Received Date",responsesDue:"Responses to Notice of Institution Due Date"},empty:{timeline:"No timeline events",general:"No related data",orders:"No orders data",documents:"No documents/notices"}},Wm={app:Rm,actions:Im,status:Fm,tariff:Dm,market:Lm,fr:Pm,htsCard:Em,relatedFr:Om,adcvdTracker:Mm,companyRates:$m,programs:Hm,idsLinks:Um,countrySelector:Bm,favorites:Vm,tariffCalc:qm,htsStructure:zm,adcvdCard:Qm,common:Ym,idSearch:Gm,caseDashboard:Km},Jm={title:"Handy Tariff Smarty"},Xm={close:"關閉",open:"開啟",cancel:"取消",confirm:"確認",refresh:"重新整理"},Zm={loading:"載入中...",error:"發生錯誤",empty:"目前沒有資料"},eh={title:"Tariff Intelligence",addFavorite:"加入收藏",favorites:"查看收藏",searchErrorTitle:"搜尋失敗",welcomeTitle:"歡迎使用 Tariff Intelligence",welcomeDesc:"請在上方搜尋欄輸入 HTS 稅則號碼開始查詢，您可以查看關稅、AD/CVD 案件、趨勢等資訊。",toolsTitle:"工具與分析",toolsDesc:"進行搜尋後，關稅計算器、趨勢圖等互動工具會在此呈現。",htsLoading:"正在載入 HTS.gov 資料...",htsMissing:"暫時無法載入 HTS.gov 資料",releaseDate:"版本日期",enterDigits:"請輸入至少 4 位數的 HTS 稅則碼。"},th={advanced:{title:"進階市場趨勢查詢",htsLabel:"HTS 稅則碼（逗號分隔）",htsPlaceholder:"例：730630, 390110",granularity:"顆粒度",granularity6:"HTS6",granularity8:"HTS8",granularity10:"HTS10",breakout:"拆解維度",breakoutCommodities:"商品",breakoutCountries:"國家",tradeFlow:"貿易流向",flowCons:"Consumption 進口",flowGen:"一般進口",flowBalance:"貿易平衡",balanceNoticeTitle:"貿易平衡說明",balanceNoticeItems:["僅支援 6 碼 HTS，顆粒度固定為 6（系統自動處理）。","比較欄位：Total Exports FAS − General Imports Customs Value。","可搭配 Country Break Out 與 Compare/Top N 使用。"],metrics:"指標",metricLabels:{quantity:"數量",value:"通關價值 / 平衡",cif:"CIF 價值",charges:"進口附加費",calc_duties:"計算關稅",dutiable:"應稅價值",landed:"完稅到岸價"},metricsPlaceholder:"選擇指標...",metricsEmpty:"沒有找到指標。",metricsUnavailable:"不適用於「{{flow}}」貿易流向。",metricsMore:"+{{count}} 筆",removeCountry:"移除國家",period:"期間",ytd:"年累計 (YTD)",historyYears:"歷史年數：{{years}} 年",diagnostic:"診斷模式",showRequestBody:"顯示請求摘要",compareToggle:"比較（國別兩年差）",yearA:"年份 A",yearB:"年份 B",diff:"差異",diffAbsolute:"絕對值",diffPercent:"百分比",topN:"Top N",run:"執行查詢",running:"查詢中...",results:"結果",compareTable:"比較表",compareDiffLabel:"差異：{{mode}}",compareSortBy:"排序欄位",compareOrder:"排序方式",orderAbs:"絕對值",orderDesc:"由大到小",orderAsc:"由小到大",countryLabel:"國家",yearLabel:"年份",dataTable:"資料表",noSeries:"沒有可用的貿易統計。試著縮短年份或切換指標。",processedTitle:"處理後的圖表資料（除錯用）",reconciliationTitle:"對帳資料（除錯用）",diagnostics:"診斷",copySummary:"複製摘要",requestSummary:"請求摘要",headers:"標頭",reportBody:"報表內容",runPrompt:"執行查詢以檢視結果",barName:"{{label}} 差異（{{yearA}} vs {{yearB}}）"},chart:{loadCountries:"載入國家",refreshingCountries:"重新整理中...",refreshData:"重新整理資料",refreshingData:"重新整理中...",remove:"移除",flow:"流向",flowCons:"消費進口",flowGen:"一般進口",metric:"指標",period:"期間",ytd:"年初至今 (YTD)",historyYearsShort:"{{years}}年",breakout:"拆解",topN:"前 N 名",year:"年份",auto:"自動",exportCsv:"匯出 CSV",exportJson:"匯出 JSON（{{metric}}）",diagnostic:"診斷",sync:"同步",info:"說明",infoFlowTitle:"貿易流向",infoFlowDesc:"在 消費進口 與 一般進口 間切換，檢視指標於不同流向的差異。",infoMetricTitle:"指標說明",infoMetricDesc:"選擇要呈現的指標。價值型指標以美元顯示；數量則依報表單位呈現。",unitUSD:"美元 (USD)",emptyTitle:"目前沒有貿易統計",emptyDesc:"找不到符合條件的資料，請嘗試調整區間或國家篩選。",preparing:"準備圖表中...",hideData:"隱藏資料",showData:"顯示資料",copySummary:"複製摘要",diagnostics:"診斷",requestSummary:"請求摘要",headers:"標頭",reportBody:"報表內容",tableYear:"年份",tableCountry:"國家",tableTotal:"總計"}},sh={title:"聯邦公報",debugMode:"除錯模式",aggregated:"聚合模式（facets）",badgeAgency:"agency：{{slug}} ×",badgeType:"type：{{value}} ×",badgeSection:"section：{{slug}} ×",badgeTopic:"topic：{{slug}} ×",prev:"上一頁",next:"下一頁",page:"第 {{page}} 頁",pageWithTotal:"第 {{page}} / {{totalPages}} 頁",clearDates:"清除日期",openVerifier:"開啟 Facets Verifier",baseUri:"Base URI（除錯）",frequency:"頻率",frequencyChart:"頻率圖",totalCount:"共 {{count}} 筆文件",agenciesTitle:"全部機關",agenciesEmpty:"點擊 Load 以取得機關資料。",suggestedTitle:"建議搜尋",suggestedEmpty:"點擊 Load 以取得精選搜尋。",agencies:{searchPlaceholder:"快速篩選 name / slug",clear:"清除",tabHierarchical:"階層",tabFunctional:"功能分類",tabType:"類型分類",noResults:"沒有符合的機關。",topWithChildren:"頂層機關（含子機關）",noChildren:"單一機關 / 委員會",children:"子機構",childCount:"{{count}} 個子機關",sortLabel:"排序",sortName:"名稱",sortCount:"件數",agencyCount:"{{count}} 個機關",typeDepartments:"部/署",typeCommissions:"委員會",typeAdministrations:"局/署",typeOffices:"辦公室",typeFoundations:"基金會/董事會",typeCorporations:"公司",typeServices:"服務",typeCouncils:"議會",typeOther:"其他",funcDefense:"國防/安全",funcFinance:"財經/貿易",funcHealth:"醫療/食品",funcJustice:"司法/移民",funcEnvironment:"環境/能源",funcScience:"科學/科技",funcTransport:"交通",funcAgriculture:"農業",funcAdmin:"行政/管理",funcSocial:"社會/民生",funcOther:"其他"},suggested:{appliedTitle:"已套用建議查詢",appliedTermLabel:"詞彙",sectionHint:"請從下方主題類別選擇一筆，可展開檢視詳細內容。",sortLabel:"排序",sortDefault:"預設排序",sortActivity:"依活躍度",sortComments:"依開放評論數",apply:"套用",applying:"套用中...",docsLastYear:"{{count}} 篇",docsComments:"{{count}} 篇開放評論",unknown:"未提供",noDescription:"未提供描述",searchConditions:"搜尋條件",untitled:"未命名"},sections:{money:"金融或財經",environment:"環境",world:"國際事務或全球議題","science-and-technology":"科學與技術","business-and-industry":"產業與商業","health-and-public-welfare":"衛生及公共福祉"},load:"載入",show:"展開",hide:"收起",controls:{startDate:"起始日期 (YYYY-MM-DD)",endDate:"結束日期 (YYYY-MM-DD)",datePlaceholder:"YYYY-MM-DD",perPage:"每頁筆數",order:"排序",orderRecent:"最近優先",orderOldest:"最舊優先",orderNewest:"最新優先"},conditions:{agencies:"機關",agencyPlaceholder:"輸入以搜尋 slug...",suggest:"建議",clickToAdd:"點擊以加入",close:"關閉",hint:"按 Enter 或點擊「建議」列出選項，點擊可加入。",types:"類型",typesPlaceholder:"例如 RULE,NOTICE",sections:"章節",sectionPlaceholder:"搜尋章節...",topics:"主題",empty:"清空",topicPlaceholder:"搜尋主題...",noName:"（無名稱）",noSlug:"（無 slug）"},debug:{searchResponse:"搜尋回應（原始）",upstream:"上游網址（__debug）",effectiveQuery:"Effective Query",receivedNested:"Received（巢狀）",receivedSimple:"Received（簡易）",appliedConditions:"套用條件（前端）"},doc:{action:"動作",dates:"日期",effectiveOn:"生效日",commentCloseOn:"評論截止日",addresses:"地址",contact:"聯絡方式",furtherInfo:"進一步資訊",supplementaryInfo:"補充資訊",abstract:"摘要",topics:"主題",docketIds:"案卷 ID",dockets:"案卷",regIdNumbers:"法規 ID",regulationIdInfo:"法規 ID 詳細",cfrReferences:"CFR 參考",citation:"引用",correctionOf:"更正自",corrections:"更正",pageRange:"頁碼範圍",pageViews:"頁面檢視數",volume:"卷期",startPage:"起始頁",endPage:"結束頁",presidentialDocNumber:"總統文件號",proclamationNumber:"公告號",signingDate:"簽署日",significant:"是否重大",subtype:"子類型",tocDoc:"TOC 文件",tocSubject:"TOC 主題",topicsRaw:"主題（原始）",agencyNames:"機關名稱",regsGovInfo:"Regulations.gov 資訊",execOrderNotes:"行政命令備註",execOrderNumber:"行政命令號",htmlUrl:"HTML 連結",fullText:"全文 (HTML)",pdf:"PDF",publicInspectionPdf:"公開檢視 PDF",rawText:"原始文字",jsonUrl:"JSON 連結",modsUrl:"MODS 連結",commentUrl:"評論連結",regsGovUrl:"Regulations.gov 連結",viewOnFr:"在 FR 查看",regsGovJson:"Regulations.gov JSON",docketsJson:"案卷列表",yes:"是",no:"否",na:"N/A",updatedUnknown:"更新時間未知"},facet:{clear:"清除",browse:"瀏覽",page:"第 {{page}} 頁",pageWithTotal:"第 {{page}} / {{total}} 頁",autoClose:"選取後自動收合",apply:"套用",applyYear:"套用全年 {{year}}",names:{agency:"機關",type:"類型",section:"章節",topic:"主題",daily:"每日",weekly:"每週",monthly:"每月",quarterly:"每季"}},facetControls:{presets:"預設組合",default:"預設",all:"全選",none:"清空"},results:{title:"結果（{{count}}）",empty:"沒有資料。",details:"詳情",searchDetails:"搜尋詳情",fullText:"全文",publicInspection:"公開檢視 PDF",publicInspectionTitle:"public_inspection_pdf_url（預公開）",publicInspectionDesc1:"正式公布前的預覽版本（Public Inspection）。",publicInspectionDesc2:"可提早掌握即將發布的 HTS / 關稅變動。",pdf:"PDF",pdfTitle:"pdf_url（正式 PDF）",pdfDesc1:"由 govinfo.gov 提供的正式 PDF。",pdfDesc2:"適用法律引用與合規檢閱。",companyRatesToggle:"公司稅率",companyRatesButton:"公司稅率",loadingDetail:"載入詳情中...",noDetail:"此文件沒有詳細資料。",docRaw:"Document (Raw)",searchDetailsDebug:"搜尋詳情（偵錯）"},search:{label:"關鍵字",placeholder:"輸入關鍵字或文件編號（例如 GC-489-502、Final Results、7306.30.10）...",search:"搜尋",searching:"搜尋中..."},publicInspection:{titleZh:"關於 Public Inspection",titleEn:"About Public Inspection",switchZh:"繁中",switchEn:"EN",en:{aboutLink:"About Public Inspection",paragraphs:["The following documents are on file at the Office of the Federal Register (OFR) and will be published in the Federal Register on the dates listed.","Regular Filing documents are routinely placed on file at 8:45 a.m. Eastern Time, for publication in the next day’s Federal Register.","Special Filing documents are filed at other times and/or dates prior to publication.","See About Public Inspection for more information."],warning1:"Although we make a concerted effort to reproduce the original document in full on our Public Inspection pages, in some cases graphics may not be displayed, and non-substantive markup language may appear alongside substantive text. If you are using public inspection listings for legal research, you should verify the contents of documents against a final, official edition of the Federal Register. Only official editions of the Federal Register provide legal notice of publication to the public and judicial notice to the courts under 44 U.S.C. 1503 & 1507.",warning2:"Please note that most of the original documents filed with the Office of the Federal Register contain calculated effective dates, comment dates, and other applicable dates. We calculate and insert those dates after the documents go on file. You can consult the Table of Effective Dates & Time Periods to determine the calendar date of a calculated date contained in a Public Inspection document."},zh:{defTitle:"1. 功能定義",defItems:["Public Inspection（公開檢視）係聯邦政府程序，每個工作日東岸時間 8:45 在聯邦公報網站發布即將刊登的文件供預覽。","文件在正式刊登前開放查閱，強化行政透明與公眾參與，讓利害關係人提前了解規範或決策。"],scopeTitle:"2. 內容範圍",scopeIntro:"Public Inspection Desk 常見文件類型：",scopeItems:["規章/規範修訂","法律","總統文書、公報、命令","行政機關公告或文件"],scopeNote:"文件依設定日期開放檢索與下載，並於設定時間正式刊登。",flowTitle:"3. 流程與意義",flowIntro:"文件提交至 Federal Register（OFR）後提前公開的價值：",flowItems:["讓大眾得以預覽即將生效的內容","增進公眾參與與利害關係人準備","確保資訊保存與監督"],summaryTitle:"一句話",summary:"Public Inspection 是聯邦公報正式刊登前的公開閱覽機制，協助大眾提前知悉將刊登的文件並符合法定程序正義。"}},pi:{title:"公開查閱文件",debug:"偵錯模式",documents:"文件數",special:"特別",regular:"常規",updated:"更新時間",specialShort:"特",regularShort:"常",source:"來源：",searchDetailsPi:"搜尋詳情（PI）",loading:"載入中…",today:"今天",go:"前往",unknownAgency:"未知機關",filed:"已提交",scheduled:"預定",frNumber:"FR",pdf:"PDF",showDetail:"展開詳情",hideDetail:"收合詳情",loadingDetail:"載入詳情中...",frRaw:"聯邦公報文件原文 (Raw)",specialAgencies:"特別類型的提交機關",regularAgencies:"一般類型的提交機關",noSpecial:"沒有相關特別提交文件",noRegular:"沒有相關常規提交文件",tabSpecial:"特別類型的提交文件",tabRegular:"常規類型的提交文件",rawAvailable:"Public Inspection (available_on) Raw",disabledHint:"停用提示：未來日期與已知無資料日期",errorNoDetail:"無可用詳情",tariffQuery:{materialMixed:"鋼鐵／鋁",materialSteel:"鋼鐵",materialAluminum:"鋁",derivative:"衍生品",chapter:"HTSUS 章節：{{chapter}}",applicableMeasures:"適用措施",sec232:"232條款",sec301:"301條款",adcvd:"反傾銷稅 / 反補貼稅",highRisk:"高風險",cachedLoaded:"已從快取載入 {{count}} 筆資料",loadError:"Tariff rules 讀取失敗：{{message}}",remoteLoaded:"已載入 {{count}} 筆資料",searchPlaceholderLoading:"載入中...",searchPlaceholder:"輸入關鍵字或 HTS（例如 copper, 0101.21.00）",filterAll:"全部",filterSteel:"鋼鐵",filterAluminum:"鋁",emptyTitle:"沒有找到結果",emptyDesc:"試試不同關鍵字，或調整篩選條件。"}},hts:{searchLabel:"HTS 查詢",placeholderFull:"在總表中篩選關鍵字...",placeholderApi:"輸入關鍵字或 HTS 碼...",search:"搜尋",searching:"搜尋中...",toggleFull:"載入 HTSUS 總表",emptyTitle:"尚無 HTSUS 查詢",emptyDesc:"請在上方輸入關鍵字或 HTS 碼以查詢。",versionFormatError:"最新版本名稱格式不符，無法尋找備用檔案。",versionFallbackFailed:"找不到 {{desc}} 或任何近期備用版本的總表資料。",versionLoadFailedShort:"載入版本資訊失敗",versionLoadFailed:"載入版本資訊失敗：{{message}}",fileLoadError:"檔案載入錯誤：{{message}}",fileLoadFallback:"改載用備份：{{name}} - {{desc}}",fallbackTitle:"無法載入最新總表",fallbackDesc1:"無法載入最新總表檔案（{{desc}}）。",fallbackDesc2:"可嘗試載入備份版本：{{name}}。是否載入？",fallbackConfirm:"載入備份檔案",warningTitle:"版本提示",advancedSearchFailed:"進階搜尋失敗：{{message}}"},tariffQuery:{materialMixed:"鋼鐵／鋁",materialSteel:"鋼鐵",materialAluminum:"鋁",derivative:"衍生品",chapter:"HTSUS 章節：{{chapter}}",applicableMeasures:"適用措施",sec232:"Section 232",sec301:"Section 301",adcvd:"AD / CVD",highRisk:"高風險",cachedLoaded:"已從快取載入 {{count}} 筆資料",loadError:"Tariff rules 讀取失敗：{{message}}",remoteLoaded:"已載入 {{count}} 筆資料",searchPlaceholderLoading:"載入中...",searchPlaceholder:"輸入關鍵字或 HTS（例如 copper, 0101.21.00）",filterAll:"全部",filterSteel:"鋼鐵",filterAluminum:"鋁",emptyTitle:"沒有找到結果",emptyDesc:"試試其他關鍵字或調整篩選條件。"},htsCard:{detailLoadFailed:"無法載入 HTS 詳細資訊",detailLoadFailedDesc:"HTS 詳細資訊載入失敗：{{message}}",noDescription:"(沒有描述)",rateGeneral:"一般",rateSpecial:"特別",rateOther:"其他",noData:"暫無資料。",docNotFound:"找不到文件詳情",docMeta:"發布日 {{date}} · 機關 {{agencies}}",linkOriginal:"原文",linkFullText:"全文",linkPublicInspection:"Public Inspection",hideDocDetail:"收合詳情",showDocDetail:"顯示詳情",loadingDocDetail:"載入文件詳情...",rawTitle:"FR Document (Raw)",tradeStatsTitle:"年度進口額（最近）",investigationsTitle:"相關調查案（ITC）",caseNumber:"案件編號",countries:"涉及國家",programsTitle:"優惠方案資格（DataWeb）",tabOverview:"總覽",tabAll:"全部（{{count}}）",storyHeading:"重點導讀",footnoteHeading:"註腳說明",basicRates:"基本稅率：",basicRatesDesc:"一般稅率 {{general}}，Column 2 稅率 {{other}}，計價單位 {{units}}",extraDuties:"潛在附加稅：",extraDutiesDesc:"需注意 {{duties}} 相關規定，可能需查核 Chapter 99 條款。",tradeRemedy:"貿易救濟措施：",tradeRemedyDesc:"此 HTS 碼與 {{count}} 項 AD/CVD 調查案相關，請在「總覽」分頁檢視詳情。",validPeriod:"有效期間：",indent:"縮排",units:"單位",otherCompliance:"其他合規資訊",stagedRates:"分段稅率",rateLabelGeneral:"一般（第 1 欄）",rateLabelSpecial:"特別",rateLabelOther:"第 2 欄",htsLinkHint:"左鍵在 Intelligence 搜尋，右鍵開啟官方頁面（{{code}}）",detailsTitle:"HTS 詳細：{{code}}",noHtsDescription:"暫無 HTS.gov 描述。",noDatawebDescription:"暫無 DataWeb 描述。",mfnRate:"一般（最惠國）",col2Rate:"第 2 欄",applicableRegs:"可能適用的規範",sec232Steel:"232 鋼鐵",sec232SteelDesc:"可能適用 232 鋼鐵附加關稅。",sec232Aluminum:"232 鋁",sec232AluminumDesc:"可能適用 232 鋁附加關稅。",sec301:"301 措施",sec301Desc:"可能適用 301（中國）附加關稅。",investigationBadge:"{{type}}",investigationTitle:"此 HTS 可能涉及 {{type}} 調查。",specialRates:"特別稅率（優惠計畫）",specialDetails:"查看",s301Measures:"301 措施稅率",s301List:"List",s301Rate:"Rate",s301Effective:"生效日",s301Action:"狀態",na:"無"}},ah={detailLoadFailed:"無法載入 HTS 詳細資訊",detailLoadFailedDesc:"HTS 詳細資訊載入失敗：{{message}}",noDescription:"(沒有描述)",rateGeneral:"一般",rateSpecial:"特別",rateOther:"其他",noData:"沒有資料。",docNotFound:"找不到文件詳細資訊",docMeta:"發布 {{date}} · Agency {{agencies}}",linkOriginal:"原始",linkFullText:"全文",linkPublicInspection:"公開檢視",hideDocDetail:"隱藏詳細",showDocDetail:"顯示詳細",loadingDocDetail:"正在載入文件詳細...",rawTitle:"FR 文件（Raw）",tradeStatsTitle:"近期進口價值",investigationsTitle:"相關調查 (ITC)",caseNumber:"案號",countries:"國家",programsTitle:"優惠資格 (DataWeb)",tabOverview:"總覽",tabAll:"全部 ({{count}})",storyHeading:"重點",footnoteHeading:"腳註",basicRates:"基本稅率：",basicRatesDesc:"一般 {{general}}、第 2 欄 {{other}}、單位 {{units}}",extraDuties:"可能的額外關稅：",extraDutiesDesc:"請檢查 {{duties}} 相關規則；第 99 章可能適用。",tradeRemedy:"貿易救濟：",tradeRemedyDesc:"此稅號涉及 {{count}} 件 AD/CVD 調查，可在總覽頁查看。",validPeriod:"有效期限：",indent:"縮排",units:"單位",otherCompliance:"其他合規資訊",stagedRates:"分段稅率",rateLabelGeneral:"一般（第 1 欄）",rateLabelSpecial:"特別",rateLabelOther:"第 2 欄",htsLinkHint:"左鍵在 Intelligence 搜尋，右鍵開啟官方頁面（{{code}}）",detailsTitle:"HTS 詳細：{{code}}",noHtsDescription:"暫無 HTS.gov 描述。",noDatawebDescription:"暫無 DataWeb 描述。",mfnRate:"一般（最惠國）",col2Rate:"第 2 欄",applicableRegs:"可能適用的規範",sec232Steel:"232 鋼鐵",sec232SteelDesc:"可能適用 232 鋼鐵附加關稅。",sec232Aluminum:"232 鋁",sec232AluminumDesc:"可能適用 232 鋁附加關稅。",sec301:"301 措施",sec301Desc:"可能適用 301（中國）附加關稅。",investigationBadge:"{{type}}",investigationTitle:"此 HTS 可能涉及 {{type}} 調查。",specialRates:"特別稅率（優惠計畫）",specialDetails:"查看",s301Measures:"301 措施稅率",s301List:"List",s301Rate:"Rate",s301Effective:"生效日",s301Action:"狀態",na:"無"},rh={title:"相關聯邦公報文件，基於 HTS 稅號",keyword:"額外關鍵字",keywordPlaceholder:"可留空",perPage:"每頁筆數",debug:"除錯",queryLine:"查詢：term={term}{keyword} | per_page={perPage}",emptyTerm:"(空)",emptyTitle:"找不到相關文件",emptyDesc:"目前條件下沒有找到聯邦公報文件。",details:"詳細",fullText:"全文",pdfTitle:"pdf_url（官方 PDF）",pdfDesc1:"連結到 govinfo.gov 的正式 PDF。",pdfDesc2:"適用於法律引用與合規審查。",piPdf:"Public Inspection PDF",piPdfTitle:"public_inspection_pdf_url（預刊登）",piPdfDesc1:"正式刊登前的預覽版本（Public Inspection）。",piPdfDesc2:"有助於提前掌握即將發布的 HTS 或關稅變更。",loadingDetail:"載入詳細中...",noDetail:"暫無文件詳細資料",rawJson:"原始 聯邦公報 文件（JSON）"},nh={title:"AD/CVD 國家追蹤 基於Dataweb資料庫",lastUpdated:"最後更新：{{date}}",country:"國家",rates:"稅率與相關文件",detailsHeader:"詳情",noRecent:"目前沒有最新更新。",viewDetails:"查看詳情",emptyTitle:"沒有找到活躍的 AD/CVD 案件",emptyDesc:"資料庫中此 HTS 稅號沒有活躍案件。"},ih={title:"AD/CVD 公司稅率：{{country}}",unknownCountry:"未知",description:"摘錄聯邦公報文件中的公司別稅率。",company:"公司／出口商",rate:"稅率",viewOnFr:"前往聯邦公報檢視此文件",emptyTitle:"沒有找到公司別稅率",emptyDesc:"此文件中沒有公司別稅率資料。"},lh={title:"特別稅率計畫詳情",description:"列出各優惠計畫的適用與稅率，生效期間 {{start}} 至 {{end}}。",na:"無",filter:"依狀態篩選：",status:{all:"全部",eligible:"符合資格",notEligible:"不符資格"},loading:"正在載入計畫資訊...",table:{program:"計畫資訊",rate:"稅率",countries:"適用國家／群組"},countriesPlaceholder:"{{count}} 個國家..."},oh={title:"相關調查（IDS）",emptyTitle:"找不到相關調查",emptyDesc:"此 HTS 稅號在 DataWeb 中沒有找到相關調查。"},ch={button:"國家",searchPlaceholder:"搜尋國家...",all:"全部國家"},dh={emptyTitle:"沒有收藏的搜尋",emptyDesc:"你還沒有儲存任何收藏搜尋，點擊星號即可加入。",dialogTitle:"收藏的搜尋",dialogDesc:"管理並重新開啟已儲存的 HTS 搜尋。"},uh={title:"關稅計算器",country:"原產國",selectCountry:"國家",loadingCountries:"載入國家中...",declaredValue:"申報價值 (USD)",declaredPlaceholder:"例如 10000",quantity:"數量（{{unit}}）",quantityPlaceholder:"例如 1000",loadingHts:"載入 HTS 資料...",calculate:"開始計算",errorMissing:"請提供 HTS 稅號、原產國與申報價值。",noteTitle:"關於計算結果：",noteBody:"此處計算的是基於 HTSUS tariff treatment 區塊的正常進口稅，可能包含從價、從量或複合稅。結果不包含任何貿易救濟或附加性措施（如 AD/CVD、232、301 等）。",resultTitle:"計算結果：",baseRate:"基本稅率 (MFN)",prefApplied:"已套用優惠稅率",prefRate:"適用稅率",noPref:"{{country}} 未套用任何優惠計畫。",adValoremDuty:"從價稅額",specificDuty:"從量稅額",finalDuty:"最終應納稅額",notice232:"Section 232 / 301 / 201",notice232Desc:"實際稅率請見 Ch.99。",noticeAdcvd:"AD / CVD",noticeAdcvdDesc:"請向 DOC / ITA 查詢相關稅率。"},mh={introduction:"介紹",generalNotes:"總則",tariffSchedule:"稅則架構",sectionsChapters:"章節總覽",appendices:"附錄",localLoaded:"已載入本地資料庫",searchMatched:"符合搜尋結果的章節"},hh={title:"AD/CVD 命令搜尋",description:"本產品使用美國國際貿易署的數據 API，但未經國際貿易署的認可或認證。",queryLabel:"查詢 (HTS 或關鍵字)",sizeLabel:"每頁筆數 (1-50)",pageLabel:"頁碼",searching:"查詢中…",search:"查詢",reset:"重置",source:"參考來源",noData:"無資料，請換個關鍵字或 HTS。",results:{summary:"共 {{total}} 筆，顯示 {{count}} 筆，offset = {{offset}}",prev:"上一頁",next:"下一頁",page:"第 {{page}} / {{totalPages}} 頁"},table:{case:"案件",country:"國家",product:"產品",hts:"HTS 稅號"},frSection:{title:"Federal Register 相關結果",searchTerms:"搜尋條件:",loading:"載入聯邦公報結果中...",noResults:"此條件下無聯邦公報結果。",noInfo:"缺少足夠資訊無法查詢聯邦公報。",specialCaseError:"此文件有特殊情況：{{case}}。請直接查閱聯邦公報。"}},ph={search:"搜尋",view:"檢視",prev:"上一頁",next:"下一頁",pageOf:"第 {{current}} / {{total}} 頁"},fh={title:"USITC 調查搜尋",keyword:"關鍵字（主題/產品/國家）",allStatuses:"所有狀態",invNumber:"案號（如 701-253）",error:"載入搜尋結果失敗。",noResults:"目前條件沒有找到結果。",showing:"顯示",of:"共",results:"筆結果。",source:"來源",table:{invNumber:"案號",topic:"主題",phase:"階段",countries:"國家",startDate:"開始日期",endDate:"結束日期"}},xh={na:"N/A",active:"進行中",inactive:"未啟用 / 已結案",completed:"已結案",petitioner:"申請人",commerceOrder:"商務部命令",caseManager:"案件經理",typeNA:"未分類",phaseNumber:"案件階段編號",viewOnIds:"前往 IDS 查看",collapse:"收起",expand:"展開",productGroup:"產品群組代碼",categories:"調查類別",staff:"人員",participants:"參與者",hts:"HTS 稅號",ip:"智慧財產",unfairActs:"不公平行為",subInv:"子調查 / 投票",subInvestigation:"子調查",voteType:"投票類型",voteDate:"投票日期",date:"日期",activeDate:"啟用日",expiration:"到期日",frNotices:"聯邦公報 / 引用",documents:"調查文件",sections:{basic:"基本資訊 / 類別",timeline:"時間軸與日期",people:"人員與參與者",scope:"範圍 (HTS / IP / 不公平行為)",orders:"命令 / 子調查 / 投票",documents:"文件 / 公告"},cards:{countries:"涉及國家",categories:"調查類別",product:"涉案產品",phase:"案件階段"},timeline:{frNotice:"公告發布 (FR Notice)",commerceInit:"商務部立案 / 啟動",vote:"委員會投票"},extra:{startDate:"開始日期",investigationEnd:"調查結束日期",termination:"調查終止日期",finalDetermination:"最終裁定日期",determination:"裁定日期",initiatingDoc:"立案文件收件日",responsesDue:"回覆機構公告到期日"},empty:{timeline:"尚無時間軸事件",general:"沒有相關資料",orders:"沒有命令資料",documents:"沒有文件或公告"}},gh={app:Jm,actions:Xm,status:Zm,tariff:eh,market:th,fr:sh,htsCard:ah,relatedFr:rh,adcvdTracker:nh,companyRates:ih,programs:lh,idsLinks:oh,countrySelector:ch,favorites:dh,tariffCalc:uh,htsStructure:mh,adcvdCard:hh,common:ph,idSearch:fh,caseDashboard:xh},yh={en:{common:Wm},"zh-TW":{common:gh}},bh={order:["querystring","localStorage","cookie","navigator"],caches:["localStorage","cookie"],lookupQuerystring:"lng",lookupLocalStorage:"lng",lookupCookie:"lng",cookieMinutes:60*24*30};dc.use(uc).use(Qo).init({resources:yh,defaultNS:"common",ns:["common"],lng:"zh-TW",fallbackLng:"zh-TW",supportedLngs:["zh-TW","en"],interpolation:{escapeValue:!1},detection:bh,returnNull:!1,react:{useSuspense:!0}});const Cr={},yn=document.getElementById("root"),jh=Am(),vh=typeof import.meta<"u"&&(Cr==null?void 0:Cr.VITE_QUERY_DEVTOOLS)==="1";yn&&Yo(yn).render(e.jsx(H.StrictMode,{children:e.jsx(Go,{client:jh,children:e.jsx(Nc,{children:e.jsx(wc,{children:e.jsx(kc,{children:e.jsx(nu,{children:e.jsxs(tm,{children:[e.jsx(H.Suspense,{fallback:null,children:e.jsx(km,{})}),vh?e.jsx(Ko,{initialIsOpen:!1}):null]})})})})})})}));
